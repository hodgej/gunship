'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1483:function(C,N,d){d.r(N);d.d(N,"RtcUtils",function(){return k});C=d(0);var l=d(8),e=d(1511),a=d(35);class k{static lWe(n,v=e.RealtimeChannel.tzf){let u;try{u=a.c(n)}catch(t){throw n=String.format("Failed to JSON-serialize payload : {0}",t),l.ULS.sendTraceTag(18637072,500,10,n),Error.argument("payload",n);}if(u.length>v)throw n=String.format("Payload exceeds maximum length: {0} > {1}.",u.length,v),l.ULS.sendTraceTag(18637074,
500,10,n),Error.argument("payload",n);return u}static deserialize(n,v,u){if(!n)return null;if(Object.getType(n)!==String){var t=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",v,Object.getType(n).getName(),u);l.ULS.sendTraceTag(18637075,500,10,t);return null}t=null;try{t=a.a(n)}catch(y){n=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",v,y,u),l.ULS.sendTraceTag(18637077,
500,10,n)}return t}static r$b(n){if(!n)return"";if("string"===typeof n)return n.toString();try{return a.c(n)}catch(v){return n.toString()}}static p6k(n){let v,u,t;v=0;t=u=null;if(!n)return{j6h:v,l6h:u,exception:t};try{const y=n.source;y&&Object.getType(y)===String&&(t=y);const B=n.context;B&&(n=B,v=n.status?n.status:0,u=n.statusText?n.statusText:null)}catch(y){}return{j6h:v,l6h:u,exception:t}}}Object(C.a)(k,"RtcUtils",null,[])},1502:function(C,N,d){d.r(N);C=d(0);var l=d(8),e=d(44),a=d(77),k;(function(t){t[t.SendNotification=
0]="SendNotification";t[t.SendPersistentState=1]="SendPersistentState";t[t.FindSession=2]="FindSession";t[t.Last=3]="Last"})(k||(k={}));Object(C.b)("ApiType",k);var n;(function(t){t[t.AttemptCount=0]="AttemptCount";t[t.SuccessCount=1]="SuccessCount";t[t.DropCount=2]="DropCount";t[t.FailedCount=3]="FailedCount";t[t.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";t[t.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";t[t.ThrottledCount=6]="ThrottledCount";t[t.Last=7]="Last"})(n||(n=
{}));Object(C.b)("EventCountType",n);var v=d(1584);d.d(N,"FrequentLoggingMetrics",function(){return u});class u{constructor(t){this.gqh=this.XHh=null;this.mqi=this.DKh=0;this.zx=null;this.MPg=this.xye=0;this.rg=t;this.D3l();this.cpe=this.IEg=this.dze=!1;this.erc=0}get F5k(){return this.cpe}R1n(t){this.MPg=t;window.setInterval(Object(e.a)(this,this.Lxf,"logMetricsBatchAndReset"),t);this.xye=(new Date).getTime()}YN(t,y){this.iSn(t)&&!this.IEg||this.F5k||!window.navigator.onLine||this.rg.BMa||(this.zx[t][y]++,
this.dze=!0)}D3l(){this.zx=Array(3);for(let t=0;3>t;t++){this.zx[t]=Array(7);for(let y=0;7>y;y++)this.zx[t][y]=0}}jmk(){const t={};for(let y=0;3>y;y++)for(let B=0;7>B;B++)this.anm(y,B)&&(t[k[y]+n[B]]=this.zx[y][B]);t.FSDomain=this.XHh;t.ConnectionDomain=this.gqh;t.FSRetryInterval=this.DKh;t.MaxPayloadSize=this.mqi;t.LogNumber=this.erc;1===this.erc&&(t.FSLatencies=v.a.instance.Zrl(),t.ConLatencies=v.a.instance.Hml());return t}anm(t,y){return 2===t&&3!==y&&0!==y?!1:!0}iSn(t){return 2===t?!1:!0}Lxf(){if(this.dze){this.erc++;
if((new Date).getTime()-this.xye<5E3+this.MPg){var t=a.a.toJSON(this.jmk());l.ULS.sendTraceTag(50644352,500,15,t)}this.xye=(new Date).getTime();for(t=0;3>t;t++)for(let y=0;7>y;y++)this.zx[t][y]=0;this.dze=!1}}FEm(){this.IEg=!0}static get instance(){return u._instance}static create(t){u.instance||(u._instance=new u(t));return u.instance}}u._instance=null;Object(C.a)(u,"FrequentLoggingMetrics",null,[867])},1511:function(C,N,d){d.r(N);C=d(0);var l=d(8),e=d(44),a=d(433),k=d(1653),n=d(86),v=d(2);class u{constructor(Aa,
ma){this.status=Aa;this.B8b=ma}}Object(C.a)(u,"UserStatusInfo",null,[]);var t=d(46),y=d(1584);class B{constructor(Aa,ma){this.data=Aa;this.timeStamp=ma}}Object(C.a)(B,"PresenceData",null,[]);class G{constructor(Aa){this.yya=!1;this.Xtb=0;this.ale=!1;this.setTimeout=G.K2e;this.clearTimeout=G.B2e;this.fCm=Object(e.a)(this,this.WAm,"logRtcConnectingUsageStatement");this.Yv=Aa}FQm(){this.yya||(this.Xtb=this.setTimeout(()=>{this.yya=!1;this.wni()},8E3),this.yya=!0,this.ale=!1)}wRm(){this.fZ()}PXm(){this.wni()}wni(){this.fZ();
this.ale||(this.ale=!0,this.fCm())}WAm(){l.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Yv)}fZ(){this.yya&&this.clearTimeout(this.Xtb);this.Xtb=0;this.yya=!1}static K2e(Aa,ma){return window.setTimeout(Aa,ma)}static B2e(Aa){window.clearTimeout(Aa)}}Object(C.a)(G,"ConnectedUsageKpiLogger",null,[886]);class F{constructor(){this.uKi=this.mQf;this.xKi=this.pQf;this.wKi=this.oQf;this.BKi=this.sQf;this.AKi=this.rQf;this.CQf=this.DQf;this.zQf=this.AQf;this.gIb=
this.xQf;this.eXc=this.yQf;this.vKi=this.nQf;this.HNa=this.vDf;this.Jhb=this.wDf}mQf(){}pQf(){}oQf(){}sQf(){}rQf(){}AQf(){}yQf(){}xQf(){}DQf(){}nQf(){}vDf(){}wDf(){}}Object(C.a)(F,"NoopRealtimeChannelMetrics",null,[875,257]);class K{}K.L3c="presenceUpdated";K.updateNotification="updateNotification";K.KEi="persistentStateCleared";K.updatePersistentState="persistentStateUpdated";Object(C.a)(K,"RtcClientMethodNames",null,[]);class O{}O.JZl="realtimeChannelHub";O.L3c="UpdatePresence";O.oO="SendUpdateNotification";
O.ncf="GetCompletePersistentStateWithMetadata";O.updatePersistentState="UpdatePersistentState";O.aMb="UpdateClientInfo";Object(C.a)(O,"RtcHubMethodNames",null,[]);class H{constructor(Aa){this.tv=Aa}Omn(Aa){this.tv.on(K.L3c,Aa)}Inn(Aa){this.tv.on(K.updateNotification,Aa)}Nmn(Aa){this.tv.on(K.updatePersistentState,Aa)}Mmn(Aa){this.tv.on(K.KEi,Aa)}ofo(Aa){this.tv.off(K.L3c,Aa)}yfo(Aa){this.tv.off(K.updateNotification,Aa)}nfo(Aa){this.tv.off(K.updatePersistentState,Aa)}mfo(Aa){this.tv.off(K.KEi,Aa)}L3c(Aa){return this.tv.invoke(O.L3c,
Aa)}aMb(Aa){return this.tv.invoke(O.aMb,Aa)}oO(Aa,ma){return this.tv.invoke(O.oO,Aa,ma)}ncf(Aa){return this.tv.invoke(O.ncf,Aa)}updatePersistentState(Aa,ma){return this.tv.invoke(O.updatePersistentState,Aa,ma)}}Object(C.a)(H,"RealtimeChannelProxy",null,[883,884,885]);class I{constructor(){this.yie=this.Kvg=!1;this.wie=0;this.oke=this.eHe=this.dHe=this.Bhe=!1;this.Cpe=0;this.jZg=!1;this.iZg=this.hZg=0;this.wFe=!1;this.DFe=this.BFe=this.FFe=this.xFe=0;this.CFe=!1}get Ygk(){return this.yie}get Xgk(){return this.wie}get iak(){return this.Bhe}get ITn(){return this.dHe}get JTn(){return this.eHe}get Bxk(){return this.oke}get PCd(){return this.Cpe}get vAn(){return this.jZg}get GTi(){return this.hZg}get uAn(){return this.iZg}get qAn(){return this.wFe}get rAn(){return this.xFe}get MTi(){return this.FFe}get HTi(){return this.BFe}get JTi(){return this.DFe}get ITi(){return this.CFe}static createInstance(Aa){const {RealtimeChannel:ma}=
d(1511);return Aa?Object.assign(new I,{Kvg:Aa.$("AwayStatusManagerIsEnabled"),yie:Aa.$("AwayStatusOneMinuteTimeoutIsEnabled"),wie:Aa.rc("AwayCoauthorThresholdMs",9E5),Bhe:Aa.$("RtcAllowCrossDomainAccessEnabled"),dHe:Aa.$("ShouldLogOnContentNotification"),eHe:Aa.$("ShouldLogOnHostSubscriptionNotification"),oke:Aa.$("RtcClientMetricsEnabled"),Cpe:Aa.rc("RtcFindSessionRequestTimeoutInMS",6E4),jZg:Aa.$("RtcJsClientFrequentlyLogsMetrics"),hZg:Aa.rc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),
iZg:Aa.rc("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),wFe:Aa.$("RtcClientMessageTelemetryEnabled"),xFe:Aa.rc("RtcClientMessageTelemetrySampleSize",5),FFe:Aa.rc("RtcSendTelemetryMessageIntervalInMS",3E5),BFe:Aa.rc("RtcLogClientMessageMetricsTimeOutInMs",2E4),DFe:Aa.rc("RtcMaxPayloadSizeInCharactersOverride",ma.tzf),CFe:Aa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new I,{Kvg:!1,yie:!1,wie:9E5,Bhe:!1,dHe:!1,eHe:!0,oke:!1,Cpe:9E4,wFe:!1,
xFe:5,FFe:3E5,BFe:2E4,DFe:ma.tzf,CFe:!1})}}Object(C.a)(I,"RealtimeChannelSettings",null,[879]);class J extends Sys.EventArgs{constructor(Aa,ma){super();this.newState=Aa;this.oldState=ma}}Object(C.a)(J,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class L extends Sys.EventArgs{constructor(Aa,ma){super();this.Axk=Aa;this.H3a=ma}}Object(C.a)(L,"ClientInfoEventArgs",Sys.EventArgs,[]);class S extends Sys.EventArgs{constructor(Aa){super();this.presence=Aa}}Object(C.a)(S,"MyPresenceUpdatedEventArgs",
Sys.EventArgs,[]);var E=d(1808),P=d(1807),T=d(1805);class U extends Sys.EventArgs{constructor(Aa,ma=null){super();this.Fl=Aa;this.YYj=ma}get type(){return this.Fl}get dJ(){return this.YYj}}Object(C.a)(U,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class X extends Sys.EventArgs{constructor(){super()}}Object(C.a)(X,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class Y extends Sys.EventArgs{constructor(Aa,ma,Ga,Fa,ib,ob){super();this.Vhc=Aa;this.NYe=ma;this.ZCk=Ga;this.IFh=ib;
this.TWe=Fa;this.hx=ob}}Object(C.a)(Y,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class ca extends Sys.EventArgs{constructor(Aa){super();this.hubConnection=Aa}}Object(C.a)(ca,"RefreshProxyEventArgs",Sys.EventArgs,[]);class da extends Sys.EventArgs{constructor(Aa,ma){super();this.hea=Aa;this.errorMessage=ma}}Object(C.a)(da,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class ua extends Sys.EventArgs{constructor(Aa,ma,Ga){super();this.type=Aa;this.presence=ma;this.H3a=Ga}}Object(C.a)(ua,"SendPersistentStateEventArgs",
Sys.EventArgs,[]);class ra extends Sys.EventArgs{constructor(Aa,ma,Ga,Fa){super();this.type=Aa;this.dJ=ma;this.ETk=Ga;this.H3a=Fa}}Object(C.a)(ra,"SendUpdateNotificationEventArgs",Sys.EventArgs,[]);class qa extends Sys.EventArgs{constructor(){super()}}Object(C.a)(qa,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class ka extends Sys.EventArgs{constructor(Aa){super();this.bvd=Aa}}Object(C.a)(ka,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class la extends Sys.EventArgs{constructor(Aa,
ma){super();this.type=Aa;this.fno=ma}}Object(C.a)(la,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var Ha=d(67);class wa{constructor(){this.sa=new Ha.a}Rdn(Aa,ma){this.sa.raiseEvent("CSC",new J(Aa,ma))}Len(Aa){this.sa.raiseEvent("RP",new ca(Aa))}D2d(Aa){this.sa.raiseEvent("RC",Aa)}Oen(){this.sa.raiseEvent("RMID")}Ken(Aa,ma,Ga,Fa,ib,ob){this.sa.raiseEvent("RPS",new Y(Aa,ma,Ga,Fa,ib,ob))}FJi(Aa,ma){this.sa.raiseEvent("UPSR",new la(Aa,ma))}sJi(Aa,ma){this.sa.raiseEvent("PU",new T.a(Aa,ma))}ren(Aa){this.sa.raiseEvent("MPU",
new S(Aa))}NPf(Aa,ma,Ga,Fa){this.sa.raiseEvent("SUN",new ra(Aa,ma,Ga,Fa))}dfn(Aa,ma){this.sa.raiseEvent("UNR",new U(Aa,ma))}zJi(Aa,ma,Ga){this.sa.raiseEvent("SP",new ua(Aa,ma,Ga))}Gen(Aa,ma){this.sa.raiseEvent("PSU",new P.a(Aa,ma))}Fen(Aa){this.sa.raiseEvent("PSC",new E.a(Aa))}jen(Aa){this.sa.raiseEvent("IPSC",new E.a(Aa))}efn(Aa){this.sa.raiseEvent("UPSC",new ka(Aa))}Qen(Aa,ma){this.sa.raiseEvent("SPC",new qa(Aa,ma))}wJi(Aa,ma){this.sa.raiseEvent("RCF",new da(Aa,ma))}den(Aa){this.sa.raiseEvent("CPSWM",
new X(Aa))}cfn(Aa,ma){this.sa.raiseEvent("UCI",new L(Aa,ma))}Vya(Aa){this.sa.addHandler("CSC",Aa)}aYc(Aa){this.sa.removeHandler("CSC",Aa)}R8j(Aa){this.sa.addHandler("RP",Aa)}Q8j(Aa){this.sa.addHandler("RC",Aa)}U8j(Aa){this.sa.addHandler("RMID",Aa)}P8j(Aa){this.sa.addHandler("RPS",Aa)}p9j(Aa){this.sa.addHandler("UPSR",Aa)}rVa(Aa){this.sa.addHandler("PU",Aa)}wIb(Aa){this.sa.removeHandler("PU",Aa)}S6j(Aa){this.sa.addHandler("IPU",Aa)}m9j(Aa){this.sa.addHandler("UCI",Aa)}Y8j(Aa){this.sa.addHandler("SUN",
Aa)}T6j(Aa){this.sa.addHandler("IUNR",Aa)}p1(Aa){this.sa.addHandler("UNR",Aa)}xIb(Aa){this.sa.removeHandler("UNR",Aa)}nrd(Aa){this.sa.addHandler("PSU",Aa)}Q3d(Aa){this.sa.removeHandler("PSU",Aa)}R6j(Aa){this.sa.addHandler("IPSU",Aa)}mrd(Aa){this.sa.addHandler("PSC",Aa)}P3d(Aa){this.sa.removeHandler("PSC",Aa)}Q6j(Aa){this.sa.addHandler("IPSC",Aa)}o9j(Aa){this.sa.addHandler("UPSC",Aa)}X8j(Aa){this.sa.addHandler("SP",Aa)}$8j(Aa){this.sa.addHandler("SPC",Aa)}static getInstance(){return wa._instance||
(wa._instance=new wa)}}wa._instance=null;Object(C.a)(wa,"RtcEventHub",null,[878]);var Ca=d(72),Ja=d(151);class bb{constructor(Aa){this.Hwc=null;this.fPa=0;this.Vyb=!1;this.vm=Aa;this.vm.Vya(Object(e.a)(this,this.Pfa,"onConnectionStateChanged"))}Pfa(Aa,ma){this.fPa=ma.newState}tYm(){l.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.vm.D2d()}b2l(Aa){this.Hwc.init(Aa)}}Object(C.a)(bb,"ARtcMessageHandler",null,[]);var ha=d(1375);class ia{constructor(){this.Presence=
null;this.TimeStamp=0}}Object(C.a)(ia,"PresenceDataEntryForClients",null,[]);var va=d(77);class Ka{constructor(Aa,ma=""){this.QTj=Aa;this.OHa=ma}send(){return this.QTj()}get messageId(){return this.OHa}}Object(C.a)(Ka,"MessageHandler",null,[891]);var Xa=d(1608);class xa extends Sys.EventArgs{constructor(Aa,ma,Ga,Fa){super();this.ATf=Aa;this.reconnectDelay=ma;this.reason=Ga;this.DWf=Fa}}Object(C.a)(xa,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);class Ma{constructor(){this.wIe=this.Gi=null}get oi(){return this.Gi?
this.wIe?this.wIe.getTime()-this.Gi.getTime():(new Date).getTime()-this.Gi.getTime():0}start(){this.Gi=new Date}stop(){this.wIe=new Date}}Object(C.a)(Ma,"SimpleStopwatch",null,[]);var Na=d(1658),pa;(function(Aa){Aa[Aa.contentUpdate=0]="contentUpdate";Aa[Aa.editorsTableUpdate=1]="editorsTableUpdate";Aa[Aa.fileNameUpdate=2]="fileNameUpdate";Aa[Aa.wetContentUpdate=3]="wetContentUpdate";Aa[Aa.persistedContentUpdate=4]="persistedContentUpdate";Aa[Aa.clientRtcReconnectRequest=5]="clientRtcReconnectRequest";
Aa[Aa.replicationTelemetry=6]="replicationTelemetry";Aa[Aa.lockUpdate=7]="lockUpdate";Aa[Aa.collabServiceContentUpdate=8]="collabServiceContentUpdate";Aa[Aa.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";Aa[Aa.saveTargetUpdate=10]="saveTargetUpdate";Aa[Aa.uploadToOcsUpdate=11]="uploadToOcsUpdate";Aa[Aa.labelUpdate=12]="labelUpdate";Aa[Aa.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";Aa[Aa.subscribeOrExtend=14]="subscribeOrExtend";Aa[Aa.elapsedBootTelemetry=15]=
"elapsedBootTelemetry";Aa[Aa.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";Aa[Aa.clientToClientResponseMessage=17]="clientToClientResponseMessage";Aa[Aa.verifyNotificationPipeline=18]="verifyNotificationPipeline";Aa[Aa.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";Aa[Aa.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";Aa[Aa.last=21]="last"})(pa||(pa={}));Object(C.b)("UpdateNotificationType",pa);var Ra=d(1657),Sa=d(1070),ab=d(1071);class eb extends bb{constructor(Aa,
ma,Ga,Fa,ib,ob,fb,Mb,Tb,rc){super(fb);this.tv=null;this.CPg=!1;this.OHa=0;this.BCe=new Ja.a;this.EKj=eb.knl();this.EBe=v.AFrameworkApplication.K.lb("OwningFeatureCrewForRtcNotificationKpis");this.Md=Aa;this.nSg=this.mSg=0;this.Hwc=ma;this.Hwc.ord(Object(e.a)(this,this.tYm,"onTooManyUndeliveredMessages"));this._clientId=Ga;this.xRj=ib;this.vm.R8j(Object(e.a)(this,this.aWm,"onRefreshProxyRequired"));this.vm.P8j(Object(e.a)(this,this.ZVm,"onRefreshAllPersistentStateRequest"));this.vm.Y8j(Object(e.a)(this,
this.oO,"sendUpdateNotification"));this.vm.S6j(Object(e.a)(this,this.DTm,"onInternalPresenceUpdated"));this.vm.T6j(Object(e.a)(this,this.ETm,"onInternalUpdateNotificationReceived"));this.vm.R6j(Object(e.a)(this,this.CTm,"onInternalPersistentStateUpdated"));this.vm.Q6j(Object(e.a)(this,this.BTm,"onInternalPersistentStateCleared"));this.vm.X8j(Object(e.a)(this,this.PZc,"sendPersistentState"));this.vm.m9j(Object(e.a)(this,this.aMb,"updateClientInfo"));this.le=ob;this.Yv=Fa;this.zx=Mb;this.dV=Tb;this.Brc=
rc;this.Toa=Object(Ca.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||""}aWm(Aa,ma){this.tv=this.xRj(ma.hubConnection);this.Hwc.reset();this.tv.Omn(Object(e.a)(this,this.Z2,"onPresenceUpdated"));this.tv.Nmn(Object(e.a)(this,this.wGb,"onPersistentStateUpdated"));this.tv.Mmn(Object(e.a)(this,this.Q$b,"onPersistentStateCleared"));this.tv.Inn(Object(e.a)(this,this.Caa,"onUpdateNotificationReceived"))}Pfa(Aa,ma){this.fPa=ma.newState;2===ma.newState&&this.DFn()}DFn(){for(let Aa of this.BCe)this.oO(null,
new ra(Aa.key,Aa.value,!1,new a.a));this.BCe=new Ja.a}ZVm(Aa,ma){ma.TWe();for(Aa=0;3>Aa;++Aa)this.iFn(Aa,ma)}iFn(Aa,ma){try{this.tv.ncf(Aa).done(Ga=>{ma.Vhc(ma.NYe,"GetCompletePresenceSuccess")&&(ma.ZCk.PXm(),l.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.Yv),this.vm.Oen(),this.sVm(Aa,Ga),this.vm.den(Ga),ma.IFh.xb(Aa)&&this.vm.zJi(Aa,ma.IFh.J(Aa),new a.a))}).fail(Ga=>{const {RtcUtils:Fa}=d(1483);ma.Vhc(ma.NYe,"GetCompletePresenceFail")&&(l.ULS.sendTraceTag(3249541,
500,15,"Failed to retrieve complete session state : {0} for [{1}]",Fa.r$b(Ga),this.Yv),this.vm.D2d())}).always(()=>{ma.hx&&ma.hx.stop()})}catch(Ga){l.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",ma.NYe,Ga.message)}}PZc(Aa,ma){var {RtcUtils:Ga}=d(1483);Aa=ma.presence;let Fa;const ib=ma.H3a;this.dV.YN(1,0);try{Fa=Ga.lWe(Aa,this.Brc)}catch(fb){this.dV.YN(1,
3);l.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",fb.message);ib.setException(fb);return}Ga=new n.a;Ga.Z(this._clientId,Object.assign(new ia,{Presence:Aa,TimeStamp:(new Date).getTime()}));this.vm.FJi(ma.type,Ga);if(2!==this.fPa)this.zx.gIb(),this.dV.YN(1,2),ib.Gg(null);else{var ob=this.OHa.toString();++this.OHa;Aa=new Ka(()=>this.FFn(ma.type,Fa,ob),ob);Aa=this.Daj(0,ma.type).add(Aa);Aa.NXd(fb=>{2===fb&&this.dV.YN(1,6);ib.Gg(null)});
Aa.MXd(()=>{})}}FFn(Aa,ma,Ga){let Fa=null;const ib=new Ma,ob=new Xa.a;l.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.Yv);if(2!==this.fPa)return this.zx.gIb(),this.dV.YN(1,2),l.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.Yv),ob.dzf(),ob;this.le&&20>this.mSg&&(Fa=this.le.hg("WebServiceCall","Send Presence Message"),this.mSg++);ib.start();ob.GRc(1);try{this.tv.updatePersistentState(Aa,ma).done(()=>{this.zx.zQf();this.dV.YN(1,
1);l.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Ga,this.Yv);ob.uhb(1);ib&&(ib.stop(),ib.oi>this.Md.GTi?this.dV.YN(1,4):this.dV.YN(1,5))}).fail(fb=>{const {RtcUtils:Mb}=d(1483);this.Vyb||(this.zx.gIb(),this.dV.YN(1,3),l.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Ga,Mb.r$b(fb),this.Yv));ob.uhb(2)}).always(()=>{Fa&&Fa.stop()})}catch(fb){l.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",
fb.message),this.dV.YN(1,3),ob.uhb(2)}return ob}aMb(Aa,ma){({RtcUtils:Aa}=d(1483));const Ga=ma.Axk,Fa=ma.H3a;let ib;try{ib=Aa.lWe(Ga,this.Brc)}catch(ob){l.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",ob.message);Fa.setException(ob);return}try{this.tv.aMb(ib).done(()=>{l.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(ob=>{const {RtcUtils:fb}=d(1483);this.Vyb||l.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",
fb.r$b(ob));Fa.Gg(null)})}catch(ob){l.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",ob.message),Fa.Gg(null)}}oO(Aa,ma){({RtcUtils:Aa}=d(1483));const Ga=ma.type,Fa=ma.dJ,ib=ma.ETk,ob=ma.H3a;let fb;this.dV.YN(0,0);try{fb=Aa.lWe(Fa,this.Brc)}catch(Tb){this.dV.YN(0,3);l.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",Tb.message);ob.setException(Tb);return}if(2!==this.fPa)ib?this.BCe.Z(Ga,
Fa):(this.zx.gIb(),this.dV.YN(0,2)),ob.Gg(null);else{var Mb=this.OHa.toString();++this.OHa;ma=new Ka(()=>this.mGn(Ga,fb,Mb),Mb);ma=this.Daj(1,Ga).add(ma);ma.NXd(Tb=>{2===Tb&&this.dV.YN(0,6);ob.Gg(null)});ma.MXd(()=>{})}}mGn(Aa,ma,Ga){let Fa=null;const ib=new Ma,ob=new Xa.a;l.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.Yv);if(2!==this.fPa)return this.zx.gIb(),this.dV.YN(0,2),l.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",
this.Yv),ob.dzf(),ob;this.le&&3===Aa&&20>this.nSg&&(Fa=this.le.hg("WebServiceCall","Send WetContent Update"),this.nSg++);ib.start();ob.GRc(1);this.tv.oO(Aa,ma).done(()=>{this.zx.zQf();this.dV.YN(0,1);l.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",Ga,this.Yv);ob.uhb(1);ib&&(ib.stop(),ib.oi>this.Md.GTi?this.dV.YN(0,4):this.dV.YN(0,5))}).fail(fb=>{const {RtcUtils:Mb}=d(1483);this.Vyb||(this.zx.gIb(),this.dV.YN(0,3),l.ULS.sendTraceTag(3249507,500,
15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Ga,Mb.r$b(fb),this.Yv));ob.uhb(2)}).always(()=>{Fa&&Fa.stop()});return ob}qha(){this.tv.ofo(Object(e.a)(this,this.Z2,"onPresenceUpdated"));this.tv.nfo(Object(e.a)(this,this.wGb,"onPersistentStateUpdated"));this.tv.mfo(Object(e.a)(this,this.Q$b,"onPersistentStateCleared"));this.tv.yfo(Object(e.a)(this,this.Caa,"onUpdateNotificationReceived"))}DTm(Aa,ma){this.Z2(ma.pFa,ma.Dzd)}Z2(Aa){this.zx.eXc();this.wGb(0,Aa)}CTm(Aa,
ma){this.wGb(ma.type,ma.pFa)}sVm(Aa,ma){const Ga={};for(let Fa in ma)Ga[Fa]=ma[Fa].Presence;this.bzi(Aa,Ga,ma)}wGb(Aa,ma){this.zx.eXc();this.bzi(Aa,ma)}bzi(Aa,ma,Ga=null){var {RtcUtils:Fa}=d(1483);if(l.ULS.A7(500,100))for(var ib in ma);delete ma[this._clientId];if(!va.a.isEmpty(ma)){for(var ob in ma)ib=ob,ma[ib]=Fa.deserialize(ma[ob],"Presence",ib,!1,this.Brc);Fa=new n.a;ob=(new Date).getTime();for(let fb in ma){ib=ma[fb];let Mb=fb,Tb;Ga?(Tb=Ga[Mb],Tb.Presence=ib):Tb=Object.assign(new ia,{Presence:ib,
TimeStamp:ob});Fa.Z(Mb,Tb)}this.vm.FJi(Aa,Fa);switch(Aa){case 0:this.CPg||(l.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.Yv),this.CPg=!0,v.AFrameworkApplication.jh&&v.AFrameworkApplication.jh.yEm());this.vm.sJi(ma,[]);break;default:this.vm.Gen(Aa,ma)}}}BTm(Aa,ma){this.Q$b(ma.bvd)}Q$b(Aa){this.zx.eXc();if(l.ULS.A7(500,100))for(let ma=0;ma<Aa.length;++ma);Aa.length&&(this.vm.efn(Aa),this.vm.Fen(Aa),this.vm.sJi({},Aa))}ETm(Aa,ma){this.Caa(ma.type,ma.dJ)}Caa(Aa,
ma=null){this.Md.ITn&&0===Aa&&l.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===Aa&&this.EBe&&0<this.EBe.length){var Ga=Object.assign(new Ra.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.EBe,vetoPillar:"RealTimeCoauth"});(Ga=ha.a.getInstance(Ga))&&Ga.logKpiUsage(this.EKj)}this.Md.JTn&&13===Aa&&l.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",
ma||"<none>"));this.zx.eXc();5===Aa?(ma=(Aa=this.S2m(ma))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",Aa.reason,Aa.reconnectDelay):"Received client reconnection request from the server without params.",l.ULS.sendTraceTag(18637071,500,50,ma),this.vm.D2d(Aa)):(ma=d(1483).RtcUtils.deserialize(ma,String.format("UpdateNotification-{0}",pa[Aa]),null,!1,this.Brc),this.vm.dfn(Aa,ma))}S2m(Aa){try{if(!Aa||""===Aa)return null;const ma=JSON.parse(Aa);
return new xa(ma[Na.a.xVf],ma[Na.a.pAn],ma[Na.a.tAn],ma[Na.a.DWf])}catch(ma){return l.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",ma.message),null}}Daj(Aa,ma){return this.Hwc.sMl(this.tMl(Aa,ma))}tMl(Aa,ma){return Aa+","+ma}static knl(){var Aa=new Map;Aa.set("SkipAria","True");Aa=Object.assign(new Sa.a,{extendedProperties:Aa});return Object.assign(new ab.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:Aa,blockFutureEmissionDurationInMs:3E5})}}
Object(C.a)(eb,"RtcMessageHandler",bb,[]);class zb{luh(Aa,ma=""){const {MaxOutstandingThrottler:Ga}=d(1654);return Ga.createInstance(Aa,ma)}iLk(Aa,ma=""){const {MaxRateThrottler:Ga}=d(1656);return Ga.createInstance(Aa,ma)}}Object(C.a)(zb,"ThrottlerFactory",null,[877]);var Ua=d(1659);class Ab{constructor(Aa){this.Md=null;this.Bh=!1;this.sa=new Ha.a;this.Sye=new n.a;this.Qye=new n.a;this.YJe=Aa;this.OQb=this.YJe.luh(ma=>ma.send(),"GlobalMaxOustandingThrottler");this.OQb.ord(()=>{this.sa.raiseEvent("TMUDM")})}init(Aa){this.Bh||
(this.Md=Aa,this.OQb.init(this.Md.Ilb,this.Md.AQl),this.Bh=!0)}sMl(Aa){var {MaxRateThrottler:ma}=d(1656),{MaxOutstandingThrottler:Ga}=d(1654);this.Bh||this.init(new Ua.a(ma.oxh,Ga.Mxh,Ga.Axh,Ab.aGm));({value:ma}=this.Sye.Dc(Aa)).returnValue||(({value:ma}=this.Qye.Dc(Aa)).returnValue||(ma="MaxOutstandingThrottler-"+Aa,ma=this.YJe.luh(Object(e.a)(this.OQb,this.OQb.add,"add"),ma),ma.init(this.Md.Ilb,this.Md.$Fm),ma.ord(()=>{this.sa.raiseEvent("TMUDM")}),this.Qye.add(Aa,ma)),Ga="MaxRateThrottler-"+Aa,
ma=this.YJe.iLk(Object(e.a)(ma,ma.add,"add"),Ga),ma.init(this.Md.aIm),this.Sye.add(Aa,ma));return ma}reset(){for(let Aa of this.Sye)Aa.value.BQf();for(let Aa of this.Qye)Aa.value.BQf(),Aa.value.reset();this.OQb.BQf();this.OQb.reset()}ord(Aa){this.sa.addHandler("TMUDM",Aa)}}Ab.aGm=1E3;Object(C.a)(Ab,"ThrottlerManager",null,[876]);var mb;(function(Aa){Aa[Aa.unspecified=0]="unspecified";Aa[Aa.word=1]="word";Aa[Aa.excel=2]="excel";Aa[Aa.powerPoint=3]="powerPoint";Aa[Aa.test=4]="test";Aa[Aa.wacFrontEnd=
5]="wacFrontEnd";Aa[Aa.oneNote=6]="oneNote";Aa[Aa.visio=7]="visio";Aa[Aa.officeMobile=8]="officeMobile";Aa[Aa.cosmosDBChangefeed=9]="cosmosDBChangefeed";Aa[Aa.last=10]="last"})(mb||(mb={}));Object(C.b)("RtcClientAppName",mb);const Rb=(Aa,ma,Ga,Fa,ib,ob,fb,Mb,Tb=null,rc=null,vb=null,Ya=null)=>{const wb=I.createInstance(v.AFrameworkApplication.K),jb=v.AFrameworkApplication.buildVersion?v.AFrameworkApplication.buildVersion:"1.0",Zb=hc(Aa,ma,fb,jb),Eb=wb.Bxk?d(1806).RealtimeChannelMetrics.createInstance(Zb):
new F;var tc=d(1502).FrequentLoggingMetrics.create(ib);wb.vAn&&tc.R1n(wb.uAn);var lc="";lc=Tb&&""!==Tb?Tb:"/rtc2/";tc.XHh=t.a.i2(lc);const Lc=lc+"signalr";Tb=lc+"findsession";const Bb=O.JZl;lc=new zb;vb=vb||wa.getInstance();l.ULS.shipAssertTag(556867617,500,wb.JTi<=d(1511).RealtimeChannel.nqi,"Client attempting to override max payload size beyond absolute limit");const jc=Math.min(wb.JTi,d(1511).RealtimeChannel.nqi);tc.mqi=jc;tc=new eb(wb,new Ab(lc),Aa,Zb,dc=>new H(dc.createHubProxy(Bb)),Mb,vb,Eb,
tc,jc);rc||(rc=d(1699).FindSessionStrategy.createInstance(ma,ib,Tb,Mb,jb,fb,Aa,Zb,vb,ob,Fa,Ya));rc.PCd=wb.PCd;ma=new G(Zb);Ga=Ga?Ga.split(","):null;Aa=new (d(1511).RealtimeChannel)(Aa,Ga,Zb,Mb,()=>$.hubConnection(Lc),rc,tc,ma,vb,Eb,wb,ib);Aa.init();return Aa},hc=(Aa,ma,Ga)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",Aa,Hb(mb[Ga]),Hb("browser"),ma),Hb=Aa=>Aa?Aa.charAt(0).toLocaleUpperCase()+Aa.substring(1,Aa.length):Aa;d.d(N,"RealtimeChannel",function(){return Ta});class Ta{constructor(Aa,
ma,Ga,Fa,ib,ob,fb,Mb,Tb,rc,vb,Ya){this.uIe=!1;this.l4=null;this.W0=new n.a;this.dlc=1;this.Wba=null;this.Cl=!1;this.Swe=(new Date(0)).getTime();this.O0g=0;this._clientId=Aa;this.yod=ma;this.h8=0;this.le=Fa;this.$ke=Mb;this.rTj=fb;this.Auj=Tb;this.Fzj=ib;this.t5a=ob;this.Yv=Ga;this.zx=rc;this.Md=vb;this.rg=Ya;this.wVj=1>100*Math.random()}get tNa(){return this.t5a.tNa}set tNa(Aa){this.t5a.tNa=Aa}get Njb(){return this.rTj}get vm(){return this.Auj}init(){this.vm.Q8j(Object(e.a)(this,this.Czd,"disconnectAndCreateNewConnection"));
this.vm.p9j(Object(e.a)(this,this.OYm,"onUpdatePersistentStateRequestReceivedInternal"));this.vm.o9j(Object(e.a)(this,this.NYm,"onUpdatePersistentStateClearedRequestReceived"));this.rg.SWb(this.zx);v.AFrameworkApplication.xK(()=>{const {FrequentLoggingMetrics:Aa}=d(1502);this.zx.CQf();Aa.instance&&Aa.instance.Lxf()});this.Duh();this.KWk();this.vm.$8j(Object(e.a)(this,this.vho,"updateConnectionQueryString"))}KWk(){try{const Ga=$.signalR;if(!Ga)throw Error.invalidOperation("Failed to retrieve Signalr object");
const Fa=Ga.version;if(!Fa)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===Fa){var Aa=Ga.transports;if(!Aa)throw Error.invalidOperation("Failed to retrieve transports object");var ma=Aa.longPolling;if(!ma)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!ma.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");ma.supportsKeepAlive=this.yNk()}}catch(Ga){l.ULS.sendTraceTag(6432339,
500,15,"Failed to disable longPolling KeepAlives: {0}",Ga.message)}}yNk(){return()=>!1}Duh(){const Aa=++this.dlc;this.Swe=(new Date(0)).getTime();this.Wba=this.Fzj();this.vm.Len(this.Wba);this.Wba.stateChanged(ma=>{this.JQm(ma,Aa)});this.Wba.connectionSlow(Object(e.a)(this,this.IXm,"onSlowConnection"));this.Wba.error(Object(e.a)(this,this.AXm,"onSignalRError"));this.Wba.log=Object(e.a)(this,this.BXm,"onSignalRLog")}Vhc(Aa,ma){return Aa!==this.dlc?(l.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",
ma),!1):!0}connect(){2!==this.h8&&1!==this.h8&&(l.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Yv),this.$ke.FQm(),y.a.instance.S1n(),this.Pfa(1,this.h8),this.D7i())}D7i(){const Aa=this.dlc;this.uIe=!1;this.zx.uKi();this.t5a.nHl(Object(e.a)(this,this.WCk,"connectSignalrConnection"),Object(e.a)(this,this.jxi,"onFailureToConnect"),Object(e.a)(this.Njb,this.Njb.b2l,"initThrottlerManager"),Object(e.a)(this,this.Vhc,"verifyConnectionToken"),Aa)}jxi(Aa=null){this.zx.wKi();
let ma=null;!Aa||"documentsessiondeleted"!==(ma=Aa.toLowerCase())&&"documentsessionexpired"!==ma?this.Czd():(l.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.Yv,Aa),this.disconnect())}Czd(Aa,ma=null){l.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.l4);Aa=(Aa=2===this.h8||1===this.h8)&&!this.Njb.Vyb;let Ga=!0,Fa=0;ma&&Object.getType(ma)!==Object.getType(Sys.EventArgs.Empty)&&
ma.ATf&&""!==ma.ATf&&(Aa=!0,this.t5a.gOn(ma.ATf),Ga=ma.DWf,Fa=ma.reconnectDelay);Aa&&this.Pfa(1,this.h8);++this.dlc;this.Njb.qha();this.b3n(Ga);this.t5a.fYk();this.Duh();Aa&&window.setTimeout(Object(e.a)(this,this.D7i,"startConnecting"),Math.min(Fa,3E4))}vho(){let Aa=null;const ma=({correlationId:Aa}=this.t5a.FQh()).returnValue;this.Wba.qs=ma;l.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Yv,Aa)}WCk(Aa){const {FrequentLoggingMetrics:ma}=
d(1502);this.Swe=(new Date).getTime();let Ga=null;this.Wba.qs=({correlationId:Ga}=this.t5a.FQh()).returnValue;this.Md.iak&&(this.Wba.url=Aa,ma.instance&&(ma.instance.gqh=t.a.i2(Aa)));let Fa=null;this.le&&(Fa=this.le.hg("WebServiceCall","ConnectToServer"));l.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.Yv);Aa={};this.yod&&(Aa.transport=1===this.yod.length?this.yod[0]:this.yod);Aa.pingInterval=null;y.a.instance.dXc(1,0);Aa.waitForPageLoad=!1;this.Wba.start(Aa,null).done(ib=>
{this.zx.xKi();y.a.instance.dXc(1,1,!0);l.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",ib.id,Ga)}).fail(ib=>{l.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.t5a.jW,Ga,this.Yv);this.jxi();this.zx.vKi(ib);y.a.instance.dXc(1,1,!1);this.vm.wJi(0,{["CorrelationId"]:Ga,["ErrorDetails"]:ib,["ConnectionState"]:k.a[this.h8]})}).always(()=>{const {FrequentLoggingMetrics:ib}=
d(1502);Fa&&Fa.stop();ib.instance&&(ib.instance.cpe=!1)})}disconnect(){const {FrequentLoggingMetrics:Aa}=d(1502);0===this.h8?l.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Yv):(this.zx.AKi(),Aa.instance&&(Aa.instance.cpe=!0),l.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.Yv),this.Njb.Vyb=!0,this.$ke.wRm(),this.Pfa(0,this.h8),this.Czd(),this.Njb.Vyb=!1)}b3n(Aa){const ma=this.fqk(),Ga=this.Wba,Fa=this.l4,
ib=()=>{if(this.uIe)l.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.uIe=!0,Ga.stop(!0,Aa)}catch(ob){l.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",ob.message)}};0<ma?(l.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",Fa,ma),window.setTimeout(ib,ma)):(l.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",Fa),ib())}fqk(){let Aa=0;0===this.Wba.state&&(Aa=this.Swe+Ta.Uqo-
(new Date).getTime(),0>Aa&&(Aa=0));return Aa}get connectionState(){return this.h8}Vya(Aa){this.vm.Vya(Aa)}aYc(Aa){this.vm.aYc(Aa)}ZWi(Aa){this.PZc(0,Aa)}PZc(Aa,ma){const Ga=new a.a;this.vm.zJi(Aa,ma,Ga);return Ga.task}rVa(Aa){this.vm.rVa(Aa)}wIb(Aa){this.vm.wIb(Aa)}nrd(Aa){this.vm.nrd(Aa)}Q3d(Aa){this.vm.Q3d(Aa)}mrd(Aa){this.vm.mrd(Aa)}P3d(Aa){this.vm.P3d(Aa)}XJc(Aa){return this.qOl(Aa)}Fzb(){return this.cbf(0)}cbf(Aa){const ma={};for(let Ga of this.W0)Ga.value.xb(Aa)&&(ma[Ga.key]=Ga.value.J(Aa).data);
return ma}qOl(Aa){return this.W0.xb(Aa)&&this.W0.J(Aa).xb(0)?this.W0.J(Aa).J(0).data:null}OYm(Aa,ma){for(let Ga of ma.fno)this.W0.xb(Ga.key)||this.W0.Z(Ga.key,new Ja.a),Aa=Ga.value,this.W0.J(Ga.key).Z(ma.type,new B(Aa.Presence,new Date(Aa.TimeStamp))),Ga.key===this._clientId&&0===ma.type&&this.vm.ren(Aa.Presence)}NYm(Aa,ma){for(const Ga of ma.bvd)this.W0.remove(Ga)}whl(){const Aa=new Ja.a;if(!this.W0.xb(this._clientId))return Aa;for(let ma of this.W0.J(this._clientId))Aa.Z(ma.key,ma.value.data);return Aa}oO(Aa,
ma=null,Ga=!1){const Fa=new a.a;this.vm.NPf(Aa,ma,Ga,Fa);return Fa.task}p1(Aa){this.vm.p1(Aa)}xIb(Aa){this.vm.xIb(Aa)}meb(Aa){let ma,Ga;return({value:ma}=this.W0.Dc(Aa)).returnValue&&({value:Ga}=ma.Dc(0)).returnValue?new u(this.vOl(Ga),Ga.timeStamp):null}kHc(){const Aa={};for(let ma of this.W0)ma.value.Dc(0).returnValue&&(Aa[ma.key]=this.meb(ma.key));return Aa}aMb(Aa){const ma=new a.a;this.vm.cfn(Aa,ma);return ma.task}get clientId(){return this._clientId}get sZn(){return this.wVj}dispose(){const {FrequentLoggingMetrics:Aa}=
d(1502);this.Cl||(this.Njb.qha(),this.rg.F3d(this.zx),this.zx.CQf(),Aa.instance&&Aa.instance.Lxf(),this.Cl=!0)}JQm(Aa,ma){this.Vhc(ma,"StateChangedSignalR")&&this.Pfa(this.Krh(Aa.newState),this.Krh(Aa.oldState))}Pfa(Aa,ma){var {FrequentLoggingMetrics:Ga}=d(1502),{ClientToClientMessageTelemetry:Fa}=d(1712);if((1!==this.h8||0!==ma||1!==Aa)&&this.h8!==ma){const ib=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.h8,
ma,Aa]));l.ULS.sendTraceTag(3290053,500,10,ib)}if(this.h8!==Aa){switch(Aa){case 2:Ga.instance&&Ga.instance.FEm();this.l4=this.Wba.id;l.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.l4,this.Yv);this.JBm(this.Wba);l.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Ga=null;this.le&&(Ga=this.le.hg("WebServiceCall","Receive First Presence"));Fa=this.dlc;this.vm.Ken(Object(e.a)(this,this.Vhc,"verifyConnectionToken"),Fa,this.$ke,Object(e.a)(this,
this.TWe,"clearExistingPersistentState"),this.whl(),Ga);this.Md.qAn&&(Ga=100*Math.random()<=this.Md.rAn,d(1712).ClientToClientMessageTelemetry.k3b(this.vm,this.Md,Ga).start());break;case 1:2===ma&&l.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.l4);break;case 0:if(Fa.instance&&Fa.instance.stop(),this.Njb.Vyb)l.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.l4);else{1===ma&&(l.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.l4),this.zx.BKi());2===ma&&l.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.l4);this.Czd();return}}this.h8=Aa;this.vm.Rdn(Aa,ma)}}JBm(Aa){if(Aa&&Aa.transport&&Aa.transport.name){Aa=Aa.transport.name;var ma=Aa.toLowerCase();
"websockets"===ma?l.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",Aa,this.Yv):"serversentevents"===ma?l.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",Aa,this.Yv):"foreverframe"===ma?l.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",Aa,this.Yv):"longpolling"===ma?l.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",Aa,this.Yv):"mocktransport"!==ma&&l.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
Aa)}else l.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}IXm(){if(this.Md.ITi){const Aa=t.a.rT(this.tNa,"mid");l.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.l4,Aa)}else l.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.l4)}AXm(){l.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.l4)}BXm(Aa){Aa=d(1483).RtcUtils.r$b(Aa);if(this.Md.ITi&&Aa.startsWith("Keep alive timed out.")){const ma=
t.a.rT(this.tNa,"mid");l.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",Aa,ma)}else this.sZn&&2E3>this.O0g&&!Aa.startsWith("Invok")&&!Aa.startsWith("Trigger")&&(l.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",Aa),this.O0g++)}TWe(){let Aa;const ma=[];({value:Aa}=this.W0.Dc(this._clientId)).returnValue&&this.W0.remove(this._clientId);for(let Ga of this.W0.keys)Array.add(ma,Ga);for(const Ga of ma)this.W0.remove(Ga);Aa&&this.W0.Z(this._clientId,Aa);this.vm.jen(ma)}Krh(Aa){switch(Aa){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",Aa,"Unknown SignalR state");}}vOl(Aa){return Aa&&Aa.timeStamp?(new Date).getTime()-Aa.timeStamp.getTime()>(this.Md.Ygk?6E4:this.Md.Xgk)?2:1:1}static createInstance(Aa,ma,Ga,Fa,ib,ob,fb,Mb=null,Tb=null,rc=null,vb=null,Ya=null,wb=null){return Rb(Aa,ma,Ga,wb,Fa,ib,ob,fb,Mb,Tb,rc,Ya,vb)}}Ta.nqi=31E3;Ta.tzf=8E3;Ta.Uqo=15E3;Object(C.a)(Ta,"RealtimeChannel",null,[850,851])},1584:function(C,N,d){d.d(N,"a",function(){return l});
C=d(0);class l{constructor(){this.S1g=!1;this.ysb=null;this.$zg=0;this.Ape=this.Svh();this.r8c=this.Svh();this.Ynb=this.HQb=0;this.tw=()=>new Date}get Y3n(){return this.S1g}Svh(){const e=Array(6);for(let a=0;a<e.length;a++)e[a]=0;return e}Zrl(){return this.Ape.toString()}Hml(){return this.r8c.toString()}S1n(){this.ysb=this.tw()}dXc(e,a,k=!1){this.Y3n||(k&&(this.S1g=!0),k=this.tw(),0===e&&5<this.HQb||1===e&&5<this.Ynb||(this.$zg<e?(1===this.HQb%2&&(this.Ape[this.HQb]=-1,this.HQb++),this.$zg=e,1===
a&&(this.r8c[this.Ynb]=-1,this.Ynb++),this.r8c[this.Ynb]=this.N2f(k),this.Ynb++):0===e?(this.Ape[this.HQb]=this.N2f(k),this.HQb++):(this.r8c[this.Ynb]=this.N2f(k),this.Ynb++)))}N2f(e){const a=e.getTime()-this.ysb.getTime();this.ysb=e;return a}static get instance(){l._instance||(l._instance=new l);return l._instance}static set instance(e){l._instance=e}}l._instance=null;Object(C.a)(l,"LatencyMetrics",null,[])},1608:function(C,N,d){C=d(0);class l{constructor(){this.Uwg=this.Uke=!1;this.callback=null}sTc(a){this.callback=
a;this.Ecj()}Epi(a){this.Uke||(this.Uke=!0,this.xzj=a,this.Ecj())}Ecj(){this.Uke&&this.callback&&!this.Uwg&&(this.Uwg=!0,this.callback(this.xzj))}}Object(C.a)(l,"CompletionTask",null,[]);d.d(N,"a",function(){return e});class e{constructor(){this.MQg=new l;this.KQg=new l}NXd(a){this.MQg.sTc(a)}MXd(a){this.KQg.sTc(a)}GRc(a){this.MQg.Epi(a)}uhb(a){this.KQg.Epi(a)}dzf(){this.GRc(2);this.uhb(2)}}Object(C.a)(e,"MessageStatus",null,[890])},1653:function(C,N,d){d.d(N,"a",function(){return l});C=d(0);var l;
(function(e){e[e.disconnected=0]="disconnected";e[e.connecting=1]="connecting";e[e.connected=2]="connected"})(l||(l={}));Object(C.b)("ChannelConnectionState",l)},1654:function(C,N,d){d.r(N);d.d(N,"MaxOutstandingThrottler",function(){return k});C=d(0);var l=d(44),e=d(67);N=d(1655);var a=d(1608);class k extends N.a{constructor(n,v=""){super(n,v);this.v9b=this.Ilb=0;this.sa=new e.a;this.MRb=!1;this.Pgd=this.T8c=this.s8c=this.XJe=0;this.f1=[];this.clearTimeout=k.B2e}add(n){this.NRb||this.init(k.Mxh,k.Axh);
this.bub++;const v=new a.a;this.Y6b?this.D7d(n,v):this.Pgd<this.v9b?this.OZc(n,v):(this.D7d(n,v),this.MRb=!1);return v}OZc(n,v){n=this.i_g(n);const u=this.setTimeout(Object(l.a)(this,this.rUm,"onMessageWaitTimeExpired"),this.Ilb);++this.Pgd;Array.add(this.f1,u);const t=this.s8c;n.NXd(y=>{v.GRc(y)});n.MXd(y=>{this.s8c===t&&(this.qUm(t,u),v.uhb(y))})}qUm(n,v){this.s8c===n&&(--this.Pgd,this.clearTimeout(v),Array.remove(this.f1,v),this.Y6b&&this.bGn())}bGn(){this.Y6b&&!this.MRb&&(this.XJe=this.setTimeout(Object(l.a)(this,
this.cGn,"sendThrottledMessageFromTimer"),0),this.MRb=!0)}cGn(){this.MRb=!1;if(this.Y6b){const n=this.Und,v=this.DVb;this.XAc(!1);this.OZc(n,v)}}rUm(){++this.T8c;this.T8c>Math.floor(this.v9b/2)&&(this.T8c=-1E9,this.sa.raiseEvent("TMUDM"))}ord(n){this.sa.addHandler("TMUDM",n)}reset(){this.bub=this.Gwc=this.Imc=this.T8c=0;++this.s8c;for(const n of this.f1)this.clearTimeout(n);this.Pgd=0;this.f1=[];this.XAc(!0);this.MRb&&(this.clearTimeout(this.XJe),this.XJe=0,this.MRb=!1)}init(n,v){this.NRb||(this.Ilb=
n,this.v9b=v,this.NRb=!0)}static createInstance(n,v=""){return new k(n,v)}static B2e(n){window.clearTimeout(n)}}k.Mxh=15E3;k.Axh=5;Object(C.a)(k,"MaxOutstandingThrottler",N.a,[887,888])},1655:function(C,N,d){d.d(N,"a",function(){return e});C=d(0);var l=d(8);class e{constructor(a,k=""){this.Imc=this.Gwc=0;this.Nue=!1;this.DVb=this.Und=null;this.NRb=!1;this.i_g=a;this.Eaj=k;this.setTimeout=e.K2e;this.bub=this.Gwc=this.Imc=0}BQf(){0<this.bub&&0<this.Imc&&l.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",
this.Eaj,this.Imc,this.bub);0<this.bub&&0<this.Gwc&&l.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.Eaj,this.Gwc,this.bub)}get Y6b(){return this.Nue}D7d(a,k){this.Gwc++;this.XAc(!0);this.Nue=!0;this.Und=a;this.DVb=k}XAc(a){this.Nue=!1;this.DVb&&a&&(this.Imc++,this.DVb.dzf());this.DVb=this.Und=null}static K2e(a,k){return window.setTimeout(a,k)}}Object(C.a)(e,"ThrottlerBase",null,[])},1656:function(C,N,d){d.r(N);d.d(N,"MaxRateThrottler",function(){return a});
C=d(0);var l=d(44);N=d(1655);var e=d(1608);class a extends N.a{constructor(k,n=""){super(k,n);this.D9b=0;this.Eqc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(k){this.NRb||(this.D9b=k,this.NRb=!0)}add(k){this.NRb||this.init(a.oxh);this.bub++;const n=this.currentTime(),v=new e.a;this.Eqc>n&&(this.Eqc=n);this.Y6b?(this.XAc(!0),this.D7d(k,v)):this.Eqc+this.D9b<=n?this.OZc(k,v):(this.D7d(k,v),this.setTimeout(Object(l.a)(this,this.aGn,"sendThrottledMessage"),this.Eqc+this.D9b-
n));return v}aGn(){if(this.Y6b){const k=this.Und,n=this.DVb;this.XAc(!1);this.OZc(k,n)}}OZc(k,n){this.Eqc=this.currentTime();k=this.i_g(k);k.NXd(v=>{n.GRc(v)});k.MXd(v=>{n.uhb(v)})}static createInstance(k,n=""){return new a(k,n)}}a.oxh=200;Object(C.a)(a,"MaxRateThrottler",N.a,[889,888])},1658:function(C,N,d){d.d(N,"a",function(){return l});C=d(0);class l{}l.xVf="rr";l.tAn="rd";l.pAn="rbp";l.DWf="sa";Object(C.a)(l,"RtcReconnectParams",null,[])},1659:function(C,N,d){d.d(N,"a",function(){return l});
C=d(0);class l{constructor(e,a,k,n){this.aIm=e;this.Ilb=a;this.$Fm=k;this.AQl=n}}Object(C.a)(l,"ThrottlerManagerSettings",null,[])},1699:function(C,N,d){d.r(N);C=d(0);var l=d(8),e=d(44),a=d(76),k=d(1653);class n{}n.D9b="throttling_messageDelay";n.ROc="enabled";n.Ilb="throttling_timeToWaitForResponse";n.v9b="throttling_maxNumberOfOutstandingMessages";n.K1h="throttling_globalMaxNumberOfOutstandingMessages";n.errorMessage="errorMessage";n.O5i="url";n.FDa="queryString";n.jW="connectionString";Object(C.a)(n,
"RtcFindSessionOutputFieldNameConstants",null,[]);var v=d(2),u=d(46),t=d(37),y=d(285),B=d(1362),G=d(77),F=d(16),K=d(121);class O{constructor(){this.L1h=this.kqi=this.lqi=this.qqi=0;this.$Pd=!1;this.correlationId=this.jW=this.FDa=this.OYe=this.errorMessage=null}get XBk(){return this.OYe+"?"+this.FDa}}Object(C.a)(O,"FindSessionResponse",null,[]);var H=d(591);class I{constructor(ca,da,ua,ra,qa,ka){this.PTa=null;const {FindSessionStrategy:la}=d(1699);this.FRj=ca;ca=String.format("{0}={1}",H.a.clientId,
F.a.Ij(ra));ca=String.format("{0}&{1}={2}",ca,H.a.userSessionId,F.a.Ij(qa));ca=String.format("{0}&{1}={2}",ca,H.a.Jjj,F.a.Ij(ua.toString()));ca=String.format("{0}&{1}={2}",ca,H.a.userType,F.a.Ij("1"));ca=String.format("{0}&{1}={2}",ca,H.a.Vjj,F.a.Ij(da));ca=String.format("{0}&{1}={2}",ca,H.a.unh,F.a.Ij(la.Cxk));(da=I.tbf(ua,ka))&&(ca=String.format("{0}&{1}",ca,da));this.Gzj=ca}DLi(){this.PTa=this.FRj()}Xel(){this.PTa&&""!==this.PTa||(this.DLi(),l.ULS.sendTraceTag(575784194,500,this.PTa&&""!==this.PTa?
50:15,"Query signature delegate called for refresh returned: {0} ",this.PTa));const ca=String.format("{0}={1}",H.a.VHb,F.a.Ij(this.PTa));return String.format("{0}&{1}",ca,this.Gzj)}static tbf(ca,da){return 4===ca?String.format("{0}={1}",H.a.Kti,"1"):da?da.K0h():null}}Object(C.a)(I,"FindSessionQueryStringGenerator",null,[]);var J=d(1502),L=d(1584),S=d(1483),E=d(1659);class P{}P.v$k="FSType";Object(C.a)(P,"RtcFindSessionRequestHeaders",null,[]);class T{}T.cgn="polling";Object(C.a)(T,"RtcFindSessionTypes",
null,[]);var U=d(1658);class X{}X.Mpo="RTC-TokenProofkey";X.vnm="RTC-IsWacJsBootFsRequest";Object(C.a)(X,"RtcRequestHeaders",null,[]);d.d(N,"FindSessionStrategy",function(){return Y});class Y{constructor(ca,da,ua,ra,qa,ka,la,Ha,wa,Ca,Ja,bb,ha=null){this.KNg=(new Date(0)).getTime();this.SPg=0;this.Gfd=!1;this.v_g=null;this.SQf=36E5;this.XOb=Y.P7h;this.hnc=0;this.JIb=null;this.fPa=0;this.bdc=this.iqh=null;this.HSj=[n.ROc,n.errorMessage,n.O5i,n.jW,n.FDa,n.K1h,n.v9b,n.Ilb,n.D9b];this.GSj=[n.ROc,n.errorMessage];
this.jW=this.tNa=null;this.AEg=new I(Ja?Ja:()=>v.AFrameworkApplication.xm,qa,ka,la,ca,da);this.ukc=bb;this.le=ra;this.rg=da;this.Epe=ua;this.Yv=Ha;this.vm=wa;this.Cnc=ha;this.BEg=!1;this.PCd=9E4;Ca&&Ca.execute(ia=>{ia.O$a(()=>{l.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Yv);this.AEg.DLi()})});2>=100*Math.random()&&(this.SQf=3E5);J.FrequentLoggingMetrics.instance&&(J.FrequentLoggingMetrics.instance.DKh=this.SQf)}gOn(ca){this.bdc=ca}init(){this.vm.U8j(Object(e.a)(this,
this.twn,"resetGetMachineIdDelay"));this.vm.Vya(Object(e.a)(this,this.Pfa,"onConnectionStateChanged"))}Pfa(ca,da){this.fPa=da.newState;2===da.newState&&(this.hnc=0)}FQh(){let ca;ca=this.JIb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.JIb.FDa,Y.tsh,F.a.Ij(ca)),correlationId:ca}}nHl(ca,da,ua,ra,qa){this.gFn(()=>{ra(qa,"GetMachineIdSuccess")&&(l.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.jW,this.Yv),ca(this.v_g),ua(this.uMl()))},
ka=>{ra(qa,"GetMachineIdFailure")&&(l.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Yv),da(ka))},ra,qa)}fYk(){this.Zmh();this.E0l()}gFn(ca,da,ua,ra){l.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.jW);if(this.jW)ca();else{var qa=this.lpk();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(ca,da,ua,ra)},qa)}}sendFindSessionRequestToServerInternal(ca,da,ua,ra){ua(ra,
"RequestMachineId")&&(this.KNg=(new Date).getTime(),ua=t.a.lf(),this.HFd(qa=>{const ka=t.a.lf();this.BDi(qa);this.yYf();ca();qa=t.a.lf()-ka;l.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",qa)},qa=>{const ka=t.a.lf();this.Zmh();J.FrequentLoggingMetrics.instance&&J.FrequentLoggingMetrics.instance.YN(2,3);da(qa);qa=t.a.lf()-ka;l.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",qa)},!1),ua=t.a.lf()-ua,l.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",
ua))}E0l(){this.XOb+=Y.Dyl;this.XOb=Math.min(this.XOb,Y.JFm)}lpk(){var ca=(new Date).getTime();ca=this.KNg+this.XOb-ca;0>ca&&(ca=0);return ca}BDi(ca){try{this.JIb=ca,this.tNa=ca.XBk,this.jW=ca.jW,this.iqh=ca.FDa,this.v_g=ca.OYe}catch(da){l.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",da.toString())}}Zmh(){this.jW=null;this.$mh()}yYf(){this.$mh();this.Gfd=!0;this.SPg=window.setTimeout(Object(e.a)(this,this.Ijn,"refreshMachineId"),this.SQf)}$mh(){this.Gfd&&
(window.clearTimeout(this.SPg),this.Gfd=!1)}Ijn(){this.Gfd=!1;this.HFd(ca=>{const da=this.iqh!==ca.FDa,ua=this.jW!==ca.jW,ra=this.jW;this.BDi(ca);0!==this.fPa&&(ua?(l.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",ra||"null",ca.jW),this.vm.D2d()):(this.vm.Qen(da,ua),this.yYf()))},()=>{J.FrequentLoggingMetrics.instance&&J.FrequentLoggingMetrics.instance.YN(2,3);this.yYf()},!0)}twn(){this.XOb=Y.P7h}uMl(){return new E.a(this.JIb.qqi,this.JIb.lqi,
this.JIb.kqi,this.JIb.L1h)}Cao(ca){if(Object.getType(ca)!==Object)return null;for(let da in ca);return this.EJk(ca)}EJk(ca){if(!(n.ROc in ca))return null;const da=ca[n.ROc];var ua=da?this.HSj:this.GSj;for(const ra of ua)if(!(ra in ca))return null;ua=Object.assign(new O,{$Pd:ca[n.ROc],errorMessage:ca[n.errorMessage],correlationId:K.a.create().toString()});da&&(ua.OYe=ca[n.O5i],ua.FDa=ca[n.FDa],ua.jW=ca[n.jW],ua.L1h=ca[n.K1h],ua.kqi=ca[n.v9b],ua.lqi=ca[n.Ilb],ua.qqi=ca[n.D9b]);return ua}$rl(ca,da){l.ULS.sendTraceTag(50448152,
500,50,"Using FindSessionUtils find session response");this.Cnc.YHh.continueWith(()=>{this.Cnc.YHh.result?(l.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),ca(this.Cnc.ZHh)):(l.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),da(this.Cnc.ZHh))})}kRi(ca,da,ua,ra,qa=!1){return ka=>{L.a.instance.dXc(0,1);ca&&ca.stop();this.ukc=this.bdc=null;this.uni(ka.data,!0,da);var la=S.RtcUtils.deserialize(ka.data.Ge,"FindSession",null);if(la)if(la=
this.Cao(la)){if(la.$Pd&&la.FDa&&la.jW){l.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.Yv);this.Gwm(ka.data);ua(la);return}da.FindSessionFailureReason="FindSessionInvalidResponse";da.IsRtcEnabled=la.$Pd;da.IsQueryStringEmpty=!la.FDa;da.IsConnectionStringEmpty=!la.jW;l.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",
this.Yv,la.$Pd,!la.FDa,!la.jW)}else da.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",l.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Yv);else da.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",l.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.Yv);this.xJi(da,qa);ra(null)}}dRi(ca,da,ua,ra=!1){return qa=>{L.a.instance.dXc(0,1);ca&&ca.stop();this.ukc=this.bdc=
null;this.uni(qa.data,!1,da);let ka=null;var la="unknown";let Ha="unknown";qa.data&&((la=qa.data.rj)&&Y.lZc in la&&(ka=la[Y.lZc].toString()),la=B.a[qa.data.status],Ha=qa.data.wf.toString());da.FindSessionFailureReason="FindSessionRequestFailed";da.HttpErrorCode=Ha;da.HttpErrorStatus=la;da[Y.lZc]=ka;l.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",la,Ha,this.Yv,ka,ra);this.xJi(da,ra);ua(Ha)}}HFd(ca,
da,ua=!1){let ra=null;l.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Yv);const qa={};var ka=this.AEg.Xel();qa[y.a.N5]=K.a.create().toString();this.bdc&&""!==this.bdc?ka=String.format("{0}&{1}={2}",ka,U.a.xVf,this.bdc):this.ukc&&""!==this.ukc&&(ka=String.format("{0}&{1}={2}",ka,U.a.xVf,this.ukc),qa[X.Mpo]="True",qa[X.vnm]="True");ka=this.Epe+"?"+ka;ua&&(qa[P.v$k]=T.cgn);const la={};la.IsNetworkOfflineBeforeSendRequest=this.rg.BMa;la.HasAvailableConnectionsBeforeSendRequest=
this.rg.GKd;la.MaxConnectionsAllowed=this.rg.s9b;la.IsRefreshMachineId=ua;this.Cnc&&!this.BEg?(this.$rl(this.kRi(null,la,ca,da,ua),this.dRi(null,la,da,ua)),this.BEg=!0):(this.le&&(ra=this.le.hg("WebServiceCall","GetMachineIdFromTheServer")),J.FrequentLoggingMetrics.instance&&J.FrequentLoggingMetrics.instance.YN(2,0),0>this.rg.WWb(ka,1,null,qa,[Y.dxd,Y.lZc,Y.ZSc,Y.wVf,Y.Dsi,Y.hvi,Y.gvi],1,this.kRi(ra,la,ca,da,ua),this.dRi(ra,la,da,ua),null,!1,null,this.PCd,"3",null,!0)&&(5<this.hnc&&200>this.hnc&&
l.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.hnc),window.setTimeout(()=>{this.hnc++;da("-1")},1E3)))}uni(ca,da,ua){ua||(ua={});ua.IsNetworkOfflineAfterRequestComplete=this.rg.BMa;ua.IsRequestSucceeded=da;ca&&(ua.EnqueueTime=ca.EKa,ua.InvokedTime=ca.eH,ua.CompletedTime=ca.AS,ca.rj&&(Y.dxd in ca.rj&&(ua.CorrelationId=ca.rj[Y.dxd]),Y.ZSc in ca.rj&&(ua[Y.ZSc]=ca.rj[Y.ZSc])));l.ULS.sendTraceTag(38633565,
500,da?50:15,S.RtcUtils.r$b(ua))}xJi(ca,da){ca||(ca={});ca.ConnectionState=k.a[this.fPa];da||this.vm.wJi(1,ca)}Gwm(ca){try{var da=!1,ua=!1,ra=ca.rj,qa=u.a.i2(ca.request.get_url());if(ra&&Y.wVf in ra){const Ca=ra[Y.wVf].toString().toLocaleLowerCase();ua="true"===Ca;da="false"===Ca}ra=!1;const wa=0<=qa.toLocaleLowerCase().indexOf("collab");ua&&!wa?ra=!0:da&&wa&&(ra=!0);if(ra){da={};da.HostName=qa;da.Status=B.a[ca.status];da.HttpStatus=ca.wf.toString();var ka=ca.request.get_headers();for(let Ca in ka){var la=
ka[Ca];(qa=Ca)&&0<qa.length&&(ua=0,la&&(ua=la.toString().length),da["r_"+qa]=ua)}if(ca.rj){const Ca=new a.a;Ca.add(Y.dxd);Ca.add(Y.ZSc);Ca.add(Y.lZc);Ca.add(Y.hvi);Ca.add(Y.gvi);Ca.add(Y.Dsi);Y.E4j(da,ca.rj,Ca)}Y.o4j(ca.request.get_url(),da);var Ha=G.a.toJSON(da);l.ULS.sendTraceTag(559437006,500,15,Ha)}}catch(wa){l.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",wa.toString())}}static createInstance(ca,da,ua,ra,qa,ka,la,Ha,wa,Ca,Ja,bb=null){return Y.DKk(ca,da,ua,ra,qa,ka,
la,Ha,wa,Ca,Ja,bb)}static DKk(ca,da,ua,ra,qa,ka,la,Ha,wa,Ca,Ja,bb=null){ca=ca||K.a.create().toString();ca=new Y(ca,da,ua,ra,qa,ka,la,Ha,wa,Ca,null,Ja,bb);ca.init();return ca}static E4j(ca,da,ua){for(let ra of ua)ra in da&&(ca[ra]=da[ra])}static o4j(ca,da){if(ca){var ua=ca.indexOf("?");if(-1!==ua)for(ca=ca.substr(ua+1).split("&"),ua=0;ua<ca.length;++ua){var ra=ca[ua].split("=");if(2===ra.length){const qa=ra[0];if(qa&&0<qa.length){let ka=0;if(ra=ra[1])ka=ra.length;da["q_"+qa]=ka}}}}}}Y.Dyl=3E3;Y.JFm=
3E5;Y.Cxk="1.0";Y.P7h=1E3;Y.dxd="X-CorrelationId";Y.tsh="corrid";Y.lZc="RtcErrorCode";Y.ZSc="X-OfficeCluster";Y.wVf="X-NewEnv";Y.Dsi="X-MSEdge-Ref";Y.gvi="X-OFFICEFD";Y.hvi="X-OfficeFE";Object(C.a)(Y,"FindSessionStrategy",null,[874])},1712:function(C,N,d){d.r(N);C=d(0);var l=d(8),e=d(44),a=d(433),k=d(59),n=d(76);class v{constructor(t){this.messageId=t;this.eGn=(new Date).getTime();this.Jvf=new n.a}}Object(C.a)(v,"MessageLatencyDetails",null,[]);d.d(N,"ClientToClientMessageTelemetry",function(){return u});
class u{constructor(t,y,B){this.MHa=null;this.yye=this.AGe=0;this.Md=y;this.NQg=B;this.uvc=!1;this.vm=t;this.vm.p1(Object(e.a)(this,this.Agn,"receiveMessage"))}start(){if(this.NQg&&!this.uvc){const t=this.Md.MTi;this.yye=this.Md.HTi;t<=this.yye?(l.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.Md.MTi,this.Md.HTi),this.NQg=!1):
(this.uvc=!0,this.AGe=window.setInterval(Object(e.a)(this,this.sendMessage,"sendMessage"),t))}}sendMessage(){if(this.uvc){const t=k.a.create().toString();this.MHa=new v(t);this.vm.NPf(16,t,!1,new a.a);window.setTimeout(()=>{this.Xym(t)},this.yye)}}Xym(t){this.MHa&&this.MHa.messageId===t&&(0<this.MHa.Jvf.count?(t=this.MHa.Jvf.toArray().join(","),l.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",t)):l.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.MHa=
null)}stop(){this.AGe&&(window.clearInterval(this.AGe),this.uvc=!1)}Agn(t,y){16===y.type?this.vm.NPf(17,y.dJ,!1,new a.a):17===y.type&&this.uvc&&y.dJ&&this.e$m(y.dJ)}e$m(t){t&&this.MHa&&t.toString()===this.MHa.messageId&&(t=(new Date).getTime()-this.MHa.eGn,this.MHa.Jvf.add(t))}static get instance(){return u._instance}static k3b(t,y,B){return u.instance||(u._instance=new u(t,y,B))}}u._instance=null;Object(C.a)(u,"ClientToClientMessageTelemetry",null,[])},1805:function(C,N,d){d.d(N,"a",function(){return l});
C=d(0);class l extends Sys.EventArgs{constructor(e,a){super();this.pFa=e;this.Dzd=a}}Object(C.a)(l,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1806:function(C,N,d){d.r(N);d.d(N,"RealtimeChannelMetrics",function(){return n});C=d(0);var l=d(8),e=d(185),a=d(77),k=d(1483);class n{constructor(){this.ySg=this.zSg=this.ASg=this.uSg=this.tSg=this.vSg=this.osc=this.iAe=0;this.uad=this.qxe=this.Gqc=this.cxe=this.dxe=this.Rwe=this.Y7a=this.sqc=this.XRb=this.Qwe=this.sad=this.rQb=null;this.Kye=this.Arc=this.t_g=
this.Zxg=0;this.OQg=!1;this.uKi=this.mQf;this.xKi=this.pQf;this.wKi=this.oQf;this.BKi=this.sQf;this.AKi=this.rQf;this.CQf=this.DQf;this.zQf=this.AQf;this.gIb=this.xQf;this.eXc=this.yQf;this.vKi=this.nQf;this.HNa=this.vDf;this.Jhb=this.wDf}mQf(){this.iAe++;this.Qwe=new Date;this.rQb||(this.rQb=new Date)}pQf(){this.osc++;this.Y7a=new Date;this.sad||(this.sad=this.Y7a);this.Gqc=this.Y7a;this.oCk()}oQf(){this.vSg++;this.Rwe=new Date}sQf(){this.tSg++;this.XRb=new Date}rQf(){this.uSg++;this.sqc=new Date}AQf(){this.dxe=
new Date;this.ASg++}yQf(){this.uad||(this.uad=new Date);this.zSg++}xQf(){this.cxe=new Date;this.ySg++}DQf(){!this.OQg&&this.iAe&&(l.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.jzk())),this.OQg=!0)}nQf(v){let u,t;({j6h:v,l6h:u,exception:t}=k.RtcUtils.p6k(v));v&&v!==e.a.xD&&(l.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:v,["HttpErrorStatus"]:u,["Exception"]:t})),e.a.ypf(v)&&this.Zxg++,e.a.wtf(v)&&this.t_g++)}vDf(){this.qxe=new Date}wDf(){this.XRb=this.Gqc=new Date}jzk(){return{["numberOfConnectionAttempts"]:this.iAe,
["numberOfSuccessfulConnections"]:this.osc,["numberOfFailedConnections"]:this.vSg,["numberOfDisconnectedConnections"]:this.tSg,["numberOfExplicitDisconnectedConnections"]:this.uSg,["numberOfSentMessages"]:this.ASg,["numberOfReceivedMessages"]:this.zSg,["numberOfLostMessages"]:this.ySg,["firstConnectionAttempt"]:this.rQb?this.rQb:null,["firstMessageReceived"]:this.uad?this.uad:null,["firstConnectionSuccess"]:this.sad?this.sad:null,["lastConnectionAttempt"]:this.Qwe?this.Qwe:null,["lastConnectionSuccess"]:this.Y7a?
this.Y7a:null,["lastConnectionFailure"]:this.Rwe?this.Rwe:null,["lastMessageSent"]:this.dxe?this.dxe:null,["lastMessageLost"]:this.cxe?this.cxe:null,["lastDisconnect"]:this.XRb?this.XRb:null,["lastExplicitDisconnect"]:this.sqc?this.sqc:null,["lastTimeOnline"]:this.Gqc?this.Gqc:null,["lastTimeOffline"]:this.qxe?this.qxe:null,["maxDisconnectedTimeMs"]:this.Arc,["maxExplicitDisconnectedTimeMs"]:this.Kye,["clientConnectionErrors"]:this.Zxg,["serverConnectionErrors"]:this.t_g}}oCk(){this.rQb&&1===this.osc&&
(this.Arc=Math.max(this.Arc,this.Y7a.getTime()-this.rQb.getTime()));this.XRb&&1<this.osc&&(this.Arc=Math.max(this.Arc,this.Y7a.getTime()-this.XRb.getTime()));this.sqc&&1<this.osc&&(this.Kye=Math.max(this.Kye,this.Y7a.getTime()-this.sqc.getTime()))}static createInstance(v){n._instance||(n._instance=new n,l.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",v));return n._instance}}n._instance=null;Object(C.a)(n,"RealtimeChannelMetrics",null,[875,257])},1807:function(C,
N,d){d.d(N,"a",function(){return l});C=d(0);class l extends Sys.EventArgs{constructor(e,a){super();this.type=e;this.pFa=a}}Object(C.a)(l,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1808:function(C,N,d){d.d(N,"a",function(){return l});C=d(0);class l extends Sys.EventArgs{constructor(e){super();this.bvd=e}}Object(C.a)(l,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},1935:function(C,N,d){d.r(N);var l=d(0),e=d(44);class a{constructor(Da,sb){this.Q8=null;this.ytc=Da;this.EQj=sb}init(){this.ytc.continueWith(()=>
{this.Q8=this.ytc.result;this.Q8.iXb(Object(e.a)(this,this.W6,"onUsersUpdated"))})}W6(){a.NRe(this.Q8.$Xa())&&(this.Q8.S3d(Object(e.a)(this,this.W6,"onUsersUpdated")),this.EQj.IsRealCoauthSession=!0)}get Zim(){return this.Q8?a.NRe(this.Q8.$Xa()):!1}static NRe(Da){let sb=null;for(const ec of Da)if(ec)if(Da=ec.isAnonymous||!ec.email?ec.clientId:ec.email.toUpperCase(),!sb)sb=Da;else if(sb!==Da)return!0;return!1}}Object(l.a)(a,"CoauthTelemetry",null,[693]);var k=d(8),n=d(433),v=d(72),u=d(2),t;(function(Da){Da[Da.badStatePreventedTelemetry=
0]="badStatePreventedTelemetry";Da[Da.notImplemented=1]="notImplemented";Da[Da.renderHandled=2]="renderHandled";Da[Da.renderHandledWithVeto=3]="renderHandledWithVeto"})(t||(t={}));Object(l.b)("CoauthorGalleryTelemetryEndResult",t);var y=d(83),B=d(77),G=d(122);class F{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e){this.GVg=this.syg=this.xC=null;this.W3=Da;this.Hmd=new n.a;this.Oa=ec;this.Eke=sb;this.b4=Jc;this.Mg=jd;this.FCe=Ud;this.Z8a=ve;this.ewj=bf;this.pHg=this.hHg=!1;this.Znd=0;this.qyg=1;this.Enb=$e;
this.pxc=this.Oa.$("PeoplesWellExtraButtonInfoIsEnabled");this.Toa=Object(v.a)(String,u.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get d8i(){return this.Hmd.task}init(){G.Task.WAA.call(null,this.Z8a,this.Eke,this.FCe).continueWith(()=>{this.xC=this.Z8a.result;this.syg=this.Eke.result;this.GVg=this.FCe.result;G.Task.WAA.call(null,this.Eke.result.mZb,this.FCe.result.Maj).continueWith(()=>{this.qyg=this.syg.mZb.result;this.Znd=this.GVg.Maj.result;this.xC.iXb(Object(e.a)(this,this.QYd,
"onUsersUpdatedEventListener"));this.xC.$Xa().length&&this.W6()})})}QYd(){this.W6()}W6(){this.ewj(this.xC.$Xa())?(this.xC.S3d(Object(e.a)(this,this.QYd,"onUsersUpdatedEventListener")),this.kSm(this.hHg)):this.Hmd.DU(1);this.hHg=!0}kSm(Da){this.pHg?this.d8i.continueWith(()=>{k.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",t[this.d8i.result])}):(this.pHg=!0,this.W$m(0===this.qyg&&!Da))}W$m(Da){Da?this.b4.tl(4,Object(e.a)(this,this.ZGf,"onInteractiveReady")):
this.Hmd.DU(1)}ZGf(){const Da=this.Mg.yF("AppInitStatus_interactivityReady");k.ULS.shipAssertTag(42259235,325,!!this.Znd);const sb=this.Znd-Da,ec={};ec.InteractiveTime=Da;ec.ReactRenderComplete=this.Znd;ec.HadTabSwitch=this.Enb();ec.IsModernGallery=this.pxc;k.ULS.sendTraceTag(594883104,325,50,B.a.toJSON(ec));this.pxc?(k.ULS.sendTraceTag(42062997,325,15,sb.toString()),this.Hmd.DU(this.gqo(sb)?3:2)):k.ULS.sendTraceTag(594883103,325,15,sb.toString())}gqo(Da){const sb=Da>this.Oa.rc("CoauthorGalleryTimeToRenderDurationMs",
1E4),ec="Word"===this.Toa;if(this.Enb())return k.ULS.sendTraceTag(50455714,325,50,sb.toString()),!1;ec&&y.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);sb&&(ec&&y.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),k.ULS.sendTraceTag(42062998,325,15,Da.toString()));return sb}}Object(l.a)(F,"CoauthorGalleryTelemetry",null,[694]);class K{constructor(Da){this.xC=null;this.b8c={};this.Bid=
{};this.fpc=null;this.Z8a=Da}BHd(Da){const sb=new n.a;this.init().continueWith(()=>{Da in this.b8c?sb.DU(this.b8c[Da]):this.Bid[Da]=sb});return sb.task}init(){if(this.fpc)return this.fpc.task;this.fpc=new n.a;this.Z8a.continueWith(()=>{this.xC=this.Z8a.result;this.xC.iXb(Object(e.a)(this,this.W6,"onUsersUpdated"));this.iij();this.fpc.Gg(null)});return this.fpc.task}iij(){const Da=this.xC.$Xa();Da.sort(Object(e.a)(this,this.PBk,"comparePresenceUsers"));this.b8c={};for(let sb=0;sb<Da.length&&Da[sb]&&
Da[sb].WMa;sb++)this.f4j(this.b8c,Da[sb].clientId,sb)}f4j(Da,sb,ec){Da[sb]=ec;sb in this.Bid&&(this.Bid[sb].DU(ec),delete this.Bid[sb])}W6(){this.iij()}PBk(Da,sb){return Da.WMa>sb.WMa?1:Da.WMa<sb.WMa?-1:0}}Object(l.a)(K,"CoauthorPositionFinder",null,[691]);var O=d(76),H=d(195);class I{constructor(Da,sb,ec,Jc){this.Q8=null;this.boe=this.Bze=!1;this.vOg=0;this.ytc=Da;this.fJe=sb;this.Oa=ec;this.FSb=Jc;this.xvj=u.AFrameworkApplication.Ihc||u.AFrameworkApplication.Ama}get ryd(){return this.Oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",
!1)}init(){this.ytc.continueWith(()=>{this.Q8=this.ytc.result;this.Q8.iXb(Object(e.a)(this,this.W6,"onUsersUpdated"))})}W6(){this.hzk(this.Q8.$Xa());!this.Bze||this.ryd&&!this.boe||this.Q8.S3d(Object(e.a)(this,this.W6,"onUsersUpdated"))}hzk(Da){const sb=new O.a;let ec=0;for(const Jc of Da)if(Jc&&Jc.isAnonymous){u.AFrameworkApplication.Hf("70eb6120;2gfeb930");if(this.ryd&&!this.boe)if(sb.contains(Jc.userName)){const jd=this.WMl(Da);k.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected among {0} total guest coauthors",
jd);this.boe=!0}else sb.add(Jc.userName);Jc.clientId!==this.FSb&&(ec++,2<=ec&&!this.Bze&&this.fzm())}this.ryd&&this.vOg!==ec&&(k.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",ec+(this.xvj?1:0)),this.vOg=ec)}fzm(){k.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.Bze=!0;this.ryd&&this.fJe&&this.fJe.continueWith(()=>{window.setTimeout(()=>{this.fJe.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}WMl(Da){return H.a.mf(Da)?0:H.a.T$f(Da,
sb=>sb.isAnonymous).length}}Object(l.a)(I,"GuestCoauthTelemetry",null,[]);var J=d(244);class L{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(l.a)(L,"PL",null,[]);var S=d(35);class E{constructor(){this.ct=this.vt=this.d=0}static kXi(Da,sb,ec){const Jc=new E;Jc.d=Da;Jc.vt=sb;Jc.ct=ec;return S.c(Jc)}}Object(l.a)(E,"VD",null,[]);var P=d(161);class T{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e){this.C_g=!1;this._id=Da;this.Gi=sb;this.Fr=ec;this.Cze=Jc;this.UJe=
jd;this.xub=Ud;this.wob=ve;this.Iyj=bf;this.Enb=$e;this.Toa=Object(v.a)(String,u.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Ode(Da){G.Task.WAA(this.Cze,this.UJe).continueWith(()=>{if(this.Cze.result<=this.UJe.result)Da.DU(!1);else{var sb=this.Fr-this.Gi,ec=new L;ec.id=this._id;ec.et=this.Fr;ec.st=this.Gi;ec.d=this.Fr-this.Gi;ec.mp=this.Cze.result;ec.tp=this.UJe.result;ec.ct=this.Ell(this.Iyj);ec.vc=this.Enb();var Jc=S.c(ec),jd="Word"===this.Toa;k.ULS.sendTraceTag(42078597,302,
15,Jc);if(jd){const Ud=new Map;Ud.set("data",Jc);y.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",Ud)}sb>this.xub.value&&!this.C_g&&!ec.vc&&(this.C_g=!0,Da.DU(!0),ec=Object.assign(new P.a,{inStaging:!0,extendedProperties:new Map}),ec.extendedProperties.set("data",Jc),jd&&y.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,ec),sb<this.wob.value&&k.ULS.sendTraceTag(42078598,302,15,E.kXi(sb,this.xub.value,this.wob.value)));
Da.task.isCompleted||Da.DU(!1)}})}Ell(Da){switch(Da){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(l.a)(T,"PresenceLatencyActivityLogger",null,[]);class U{constructor(Da,sb,ec){this.jxg=this.oyg=this.J7c=this.a8c=this.DNb=0;this._id=Da;this.xub=sb;this.wob=ec;this.Toa=Object(v.a)(String,u.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get Hah(){return this.DNb}set Hah(Da){this.DNb=Da;this.kWe()}get Wnh(){return this.a8c}set Wnh(Da){this.a8c=
Da;this.kWe()}get rkh(){return this.J7c}set rkh(Da){this.J7c=Da;this.kWe()}get Xnh(){return 0!==this.oyg}get skh(){return 0!==this.jxg}kWe(){!this.Xnh&&this.DNb&&this.a8c&&(this.oyg=this.Ode(this.a8c,"CoauthGalleryLightupDurationTooLong"));!this.skh&&this.DNb&&this.J7c&&(this.jxg=this.Ode(this.J7c,"CanvasPresenceLightupDurationTooLong"))}Ode(Da,sb){const ec=Da-this.DNb;var Jc=new L;Jc.id=this._id;Jc.et=Da;Jc.st=this.DNb;Jc.d=ec;var jd=S.c(Jc);Da="Word"===this.Toa;Jc="CanvasPresenceLightupDurationTooLong"===
sb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===sb?k.ULS.sendTraceTag(572289499,302,15,jd):k.ULS.sendTraceTag(571524118,302,15,jd);if(Da){var Ud=new Map;Ud.set("data",jd);y.Health.instance.recordKpiUsage(Jc,0,"wordcollabrel",Ud)}return ec>this.xub.value?(Ud=Object.assign(new P.a,{inStaging:!0,extendedProperties:new Map}),Ud.extendedProperties.set("data",jd),jd=ec<this.wob.value,Ud.extendedProperties.set("cash",jd?"true":"false"),Da&&y.Health.instance.recordKpiFailure(Jc,
sb,!1,!0,Ud),k.ULS.sendTraceTag(572289500,302,15,E.kXi(ec,this.xub.value,this.wob.value)),jd?2:1):3}}Object(l.a)(U,"PresenceLightupLatencyLogger",null,[]);var X=d(39),Y=d(155);class ca{constructor(Da,sb,ec,Jc,jd,Ud,ve=null,bf=null,$e=null){this.JWg={};this.Dke={};this.eNg=new O.a;this.gpc=this.xC=this.jj=null;this.r1g=this.q1g=0;this.xub=new J.a(()=>ve.ZP("PresenceBootLatencyThreshold",1E4));this.wob=new J.a(()=>ve.ZP("PresenceBootLatencyCutoffThreshold",6E4));this.QZj=new J.a(()=>ve.ZP("PresenceLightupLatencyThreshold",
2E3));this.HAj=new J.a(()=>ve.ZP("PresenceLightupLatencyCutoffThreshold",1E4));this.LQj=Jc;this.ryg=Da;this.mZg=sb;this.Z8a=ec;this.Mg=jd;this.FSb=bf;this.Enb=Ud;this.Ah=$e;this.fwg=!1;this.init()}gFc(Da,sb,ec=null,Jc=0){ec&&(k.ULS.shipAssertTag(42274970,302,!this.FSb||this.FSb===ec,"_myClientId is already set and you are trying to update it to something different"),this.FSb=ec);const jd=new n.a;this.init().continueWith(()=>{this.EVm(Da);this.U1k(jd,Da,sb,Jc)})}get Msi(){return this.FSb||"{"+u.AFrameworkApplication.userSessionId+
"}"}init(){if(this.gpc)return this.gpc.task;this.gpc=new n.a;this.Enb()&&k.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.ryg.continueWith(()=>{const Da=this.ryg.result,sb=Da.mZb,ec=Da.oJm;ec.continueWith(()=>{sb.continueWith(()=>{this.Ah&&this.Ah.addQosPillar("RealTimeCoauth");this.z2f(sb.result,ec.result);this.gpc.Gg(null)})})});this.mZg.continueWith(()=>{this.jj=this.mZg.result;this.jj.Vya(Object(e.a)(this,this.IWm,"onRtcConnection"));this.jj.p1(Object(e.a)(this,this.iQm,"onCoauthorBootReceived"))});
this.Z8a.continueWith(()=>{this.xC=this.Z8a.result;this.xC.iXb(Object(e.a)(this,this.QYd,"onUsersUpdatedEventListener"));0<this.xC.$Xa().length&&this.W6()});return this.gpc.task}PNh(){return this.Mg.Eda(X.a.t4a)?this.Mg.yF(X.a.t4a):Y.a.zab?window.performance.timing.fetchStart:-1}IWm(Da,sb){this.fwg||2!==sb.newState||(Da=Date.now()-this.PNh(),sb={},sb.clientId=this.Msi,sb.bootTime=Da,this.fwg=!0,this.jj.oO(15,sb))}iQm(Da,sb){if(15===sb.type){Da=Date.now();sb=sb.dJ;var ec=sb.bootTime;this.eff(sb.clientId).Hah=
Da-ec}}QYd(){this.W6()}W6(){const Da=Date.now();var sb=this.xC.$Xa();const ec=new O.a;for(const Jc of sb)this.eNg.contains(Jc.clientId)||(this.eNg.add(Jc.clientId),ec.add(Jc.clientId));if(0<ec.count)for(let Jc of ec)sb=this.eff(Jc),sb.Xnh||(sb.Wnh=Da)}EVm(Da){Da=this.eff(Da);Da.skh||(Da.rkh=Date.now())}eff(Da){return Da in this.Dke?this.Dke[Da]:this.Dke[Da]=new U(Da,this.QZj,this.HAj)}z2f(Da,sb=0){this.q1g=Da;this.r1g=sb?sb:(new Date).getTime()}U1k(Da,sb,ec,Jc){ec=ec?ec.getTime():(new Date).getTime();
sb in this.JWg?Da.oha():(Jc=new T(sb,this.SJl(),ec,this.BHd(this.Msi),this.BHd(sb),this.xub,this.wob,Jc,this.Enb),this.JWg[sb]=Jc,Jc.Ode(Da))}SJl(){return 1===this.q1g?this.r1g:this.PNh()}BHd(Da){return this.LQj.BHd(Da)}}Object(l.a)(ca,"PresenceBootTelemetry",null,[692]);var da=d(124),ua=d(178),ra=d(199),qa=d(22),ka=d(741);class la{get name(){return"Common.App.CoauthTelemetry"}yc(Da){Da.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").singleInstance().Yd(()=>
new a(ka.a.Kq(Da.Za("Common.IPeopleInfoProvider")),u.AFrameworkApplication.jh));Da.register(F,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").singleInstance().Yd(()=>new F(u.AFrameworkApplication.ya,ka.a.Kq(Da.Za("Common.ICoauthoringTelemeryInfoProvider")),u.AFrameworkApplication.K,da.a.get_instance(),ra.a.instance,ka.a.Kq(Da.Za("Common.IPeoplesWell")),ka.a.Kq(Da.Za("Common.IPeopleInfoProvider")),a.NRe,()=>this.ghh()));Da.register(ca,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").singleInstance().Yd(()=>
new ca(ka.a.Kq(Da.Za("Common.ICoauthoringTelemeryInfoProvider")),ka.a.Kq(Da.Za("Common.IRealtimeChannelBasic")),ka.a.Kq(Da.Za("Common.IPeopleInfoProvider")),Da.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),ra.a.instance,()=>this.ghh(),u.AFrameworkApplication.K,null,y.Health.instance));Da.register(K,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").singleInstance().Yd(()=>new K(ka.a.Kq(Da.Za("Common.IPeopleInfoProvider"))));
Da.register(I,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").singleInstance().Yd(()=>new I(ka.a.Kq(Da.Za("Common.IPeopleInfoProvider")),ka.a.Kq(Da.Za("Common.ISystemInitiatedFeedback")),u.AFrameworkApplication.K,"{"+u.AFrameworkApplication.userSessionId+"}"))}init(){u.AFrameworkApplication.K.zq(()=>{qa.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();qa.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();u.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&
qa.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();u.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&(qa.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),qa.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}ghh(){return Y.a.zab&&ra.a.instance.Eda(X.a.q4c)?0<ra.a.instance.yF(X.a.q4c)[X.a.Xkj]:!1}static main(){ua.a.instance.Oc(new la)}}Object(l.a)(la,"CoauthTelemetryPackage",null,[1,2]);class Ha extends Sys.EventArgs{constructor(){super()}}
Object(l.a)(Ha,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var wa;(function(Da){Da[Da.notYetStarted=0]="notYetStarted";Da[Da.polling=1]="polling";Da[Da.subscribed=2]="subscribed";Da[Da.blocked=3]="blocked";Da[Da.permanentlyStopped=4]="permanentlyStopped"})(wa||(wa={}));Object(l.b)("RtcHostNotificationSubscriptionState",wa);var Ca=d(80),Ja=d(1396),bb=d(67);class ha{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e){this.uh=!1;this.Z8=this.STb=this.Vca=this.$Ta=null;this.fwc=ha.Bge;this.sa=new bb.a;this.V9a=
new Ja.a(0);this.V9a.BPe(Object(e.a)(this,this.MXm,"onStateMachineChanged"));this.qTj=Da;this.Qkd=sb;this.pTj=ec;this.zFe=Jc;this.Hb=jd;this.ff=Ud;ve.execute(cf=>{this.uh||(this.STb=cf,this.STb.p1(Object(e.a)(this,this.Caa,"onUpdateNotificationReceived")),this.start())});bf.execute(cf=>{this.uh||(this.Z8=cf,cf.O$a(Object(e.a)(this,this.hDa,"onTokenRefreshed")))});this.Ynd=$e}get Cfc(){return this.V9a.currentState}get ahi(){return!this.ff||this.ff.bua}get xhi(){return 2===this.Cfc&&this.Ynd()<this.fwc}start(){0!==
this.Cfc?k.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",wa[this.Cfc]):(this.V9a.event(1),this.UWf(null))}UWf(){this.$Ta=null;if(this.ahi){k.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",wa[this.Cfc]);let Da=null;this.zFe&&this.zFe.length&&(Da={},Da.etts=this.zFe);this.STb.oO(14,Da,!0);this.eVi(this.qTj)}else this.V9a.event(3)}eVi(Da){this.$Ta=Ca.a.N9(1E3*Da,Object(e.a)(this,this.UWf,"sendSubscribeEvent"),
this.Qkd,192,"RtcHostNotificationSubscribe");this.Hb.$b(this.$Ta)}PCn(Da){Da=1E3*(Da+this.pTj);const sb=this.Ynd().getTime()+Da;this.fwc=new Date(sb);Da-=this.Qkd;this.Vca?this.Hb.m3(this.Vca,Da):(this.Vca=Ca.a.N9(Da,Object(e.a)(this,this.vao,"transitionToPollingEvent"),this.Qkd/2,194,"RtcHostNotificationTransitionToPolling"),this.Hb.$b(this.Vca))}vao(){this.Vca=null;2===this.Cfc&&(this.V9a.event(1),k.ULS.shipAssertTag(573100185,502,!!this.$Ta,"Missing task to ensure that we re-subscribe."))}hDa(){this.aSl()}aSl(){3===
this.Cfc&&this.ahi&&(this.V9a.event(this.xhi?2:1),this.UWf(null))}Caa(Da,sb){if(13===sb.type&&(Da=sb.dJ,k.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:Da,["DurationBeforeExpirationToResubscribeInSec"]:this.Qkd}),sb=Da.cts,!this.Qco(sb))){if(Da.sb){var ec=2;this.PCn(Da.cts)}else ec=1,this.fwc=ha.Bge,this.Vca&&(this.Hb.We(this.Vca),this.Vca=null);this.V9a.event(ec);this.$Ta?this.Hb.m3(this.$Ta,1E3*sb):this.eVi(sb)}}Qco(Da){if(!isNaN(Da)&&
isFinite(Da)&&0<Da)return!1;this.r8i(!1);return!0}r8i(Da){this.$Ta&&(this.Hb.We(this.$Ta),this.$Ta=null);this.Vca&&(this.Hb.We(this.Vca),this.Vca=null);this.STb&&(this.STb.xIb(Object(e.a)(this,this.Caa,"onUpdateNotificationReceived")),this.STb=null);this.Z8&&(this.Z8.occ(Object(e.a)(this,this.hDa,"onTokenRefreshed")),this.Z8=null);Da||this.V9a.event(4)}MXm(Da,sb){Da=sb.newState;const ec=sb.RMf,Jc={};Jc.NewState=wa[Da];Jc.PreviousState=wa[ec];Jc.PreviousStateHits=sb.SMf;Jc.PreviousStateTransitionTime=
sb.TMf.toISOString();Jc.IsSubscribed=this.xhi;this.fwc!==ha.Bge&&(Jc.SubscriptionExpiringTime=this.fwc.toISOString());k.ULS.sendTraceTag(572346515,502,4===Da?15:50,"HostNotificationChanged: {0}",Jc);this.sa.raiseEvent("HN",new Ha(ec,Da))}dispose(){this.uh||(this.uh=!0,this.r8i(!0),this.Vca&&(this.Hb.We(this.Vca),this.Vca=null))}}ha.Bge=new Date(0);Object(l.a)(ha,"RtcHostNotificationSubscriptionManager",null,[696,9]);var ia=d(390);class va{constructor(){this.Bh=this.uh=!1}get name(){return"RtcHostNotificationSubscription"}yc(Da){Da.register(ha,
"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").singleInstance().Yd(()=>{const sb=u.AFrameworkApplication.K;return new ha(sb.rc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),sb.rc("RtcHostNotificationRetryIntervalBufferInSeconds",120),sb.rc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.FHl(sb),u.AFrameworkApplication.uc,ia.SessionStatusManager.instance,
Da.Za("Common.IRealtimeChannelBasic"),Da.Za("Common.ISessionExpirationManager"),()=>new Date)})}init(){u.AFrameworkApplication.K.zq(()=>{!this.uh&&u.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&(this.Bh=!0,qa.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.uh||(this.uh=!0,this.Bh&&qa.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}FHl(Da){return Da.yu("RtcEventTypesToSubscribe")?
Da.KB("RtcEventTypesToSubscribe"):null}static main(){ua.a.instance.Oc(new va)}}Object(l.a)(va,"RtcHostNotificationSubscriptionPackage",null,[1,2]);var Ka=d(500),Xa=d(652);class xa{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e,cf,oi){this.clientId=Da;this.SkypeChatThreadId=ec;this.chatThreadDiscoveryUri=Jc;this.inChat=jd;this.localColbaltSessionId=sb;this.capabilities=Ud;this.email=ve;this.isReadOnly=bf;this.userName=$e;this.isAnonymous=cf;this.presenceStatus=oi}}Object(l.a)(xa,"SerializablePresenceUserData",
null,[]);class Ma extends Ka.a{constructor(Da,sb,ec,Jc,jd=null,Ud=null,ve=null,bf=null,$e=null,cf=!1,oi=!1,Dc=!1,Ag=null){super(Da,sb,ec,Jc,Ud,ve,bf,$e,cf,oi,Dc);this.vQ=jd;this.presenceStatus=Ag}getData(){return new xa(this.clientId,this.vQ,this.yAc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}CHd(Da){return(Da=Da.value)?Da.user:null}clone(){return new Ma(this.clientId,this.userName,this.color,
this.capabilities.clone(),this.vQ,this.yAc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static nxb(Da){return Da.clientId?new Ma(Da.clientId,Da.userName,null,new Xa.a(void 0===Da.capabilities?0:Da.capabilities),Da.localColbaltSessionId,Da.SkypeChatThreadId,Da.email,null,Da.chatThreadDiscoveryUri,Da.isAnonymous,Da.inChat,Da.isReadOnly,Da.presenceStatus):null}static Kth(Da,sb,ec,Jc=null,jd=null,Ud=null,ve=null,bf=null,$e=!1,cf=
!1,oi=!1,Dc=null){return Da?new Ma(Da,sb,null,new Xa.a(void 0===ec?0:ec),Jc,jd,Ud,ve,bf,oi,$e,cf,Dc):null}}Object(l.a)(Ma,"PresenceUser",Ka.a,[1279,1280,16]);class Na extends Ma{constructor(){super();this.ibc=this.exf=null}Pzl(){const Da=u.AFrameworkApplication.userName,sb=u.AFrameworkApplication.K.lb("UserPrincipalName"),ec=this.exf?this.exf.vQ:null,Jc=u.AFrameworkApplication.Ihc||u.AFrameworkApplication.Ama,jd=this.ibc?this.ibc.getStatus():null;return new Ma(this.clientId,Da,this.color,this.capabilities,
ec,this.yAc,sb,this.client,this.chatThreadDiscoveryUri,Jc,this.inChat,this.isReadOnly,jd)}}Object(l.a)(Na,"MyPresenceUser",Ma,[1338,16]);var pa=d(221);class Ra{constructor(Da,sb,ec,Jc,jd){this.Md=Da;this._clientId=sb;this.KBj=jd;this.DFj=ec||(()=>null);this.EFj=Jc||(()=>null)}get id(){return this.Md.id}get Zpd(){return this.Md.Zpd}get cqd(){return this.Md.cqd}get bqd(){return this.Md.bqd}get aqd(){return this.Md.aqd}get $pd(){return this.Md.$pd}get eqd(){return this.Md.eqd}get oNe(){return this.Md.oNe}get dfc(){return this.Md.dfc}get p9d(){return this.Md.p9d}get wVd(){return this.Md.wVd}get clientId(){return this._clientId}get XJc(){return this.DFj}get meb(){return this.EFj}get QXk(){return this.KBj}static createInstance(Da,
sb,ec,Jc,jd=!1){return new Ra(Da,sb,ec,Jc,jd)}}Object(l.a)(Ra,"PeoplesWellSettings",null,[]);var Sa=d(9),ab=d(56),eb=d(159),zb=d(82),Ua=d(213),Ab=d(236),mb=d(443),Rb=d(359);class hc extends Ua.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(l.a)(hc,"PeopleButtonProps",Ua.a,[]);var Hb=d(394),Ta=d(349),Aa=d(16),ma=d(121),Ga=d(375),Fa=d(86);class ib{constructor(Da){this.r4c=new Fa.a;
this.P1e=null;this.clientId=Da}ZPn(Da){this.Don();this.GIn(Da);for(const sb of Da)sb.clientId!==this.clientId&&this.F9g(sb)}get N9f(){const Da=[];for(let sb of this.r4c.values){const ec=this.dWi(sb);Array.add(Da,ec)}return Da}get Thb(){return this.r4c.count}aPe(Da,sb){Da=Da.toUpperCase();let ec;({value:ec}=this.r4c.Dc(Da)).returnValue||(ec=[],this.r4c.Z(Da,ec));Array.add(ec,sb)}Don(){this.r4c=new Fa.a}GIn(Da){for(const sb of Da)if(sb.clientId===this.clientId){this.P1e=sb;break}}}Object(l.a)(ib,"UserTracker",
null,[982]);class ob extends ib{constructor(Da,sb){super(Da);this.FFj=sb}F9g(Da){Da.isAnonymous||!Da.email?this.aPe(Da.clientId,Da):this.P1e&&Ga.a.Rj().equals(this.P1e.email,Da.email)||this.aPe(Da.email,Da)}dWi(Da){let sb=new Date(0),ec=0<Da.length?Da[0]:null;for(const Jc of Da)(Da=this.FFj(Jc.clientId))&&sb.getTime()<Da.B8b.getTime()&&(sb=Da.B8b,ec=Jc);return ec}}Object(l.a)(ob,"UniqueUserTracker",ib,[]);class fb extends ib{constructor(Da){super(Da)}F9g(Da){this.aPe(Da.clientId,Da)}dWi(Da){return Da[0]}}
Object(l.a)(fb,"UserInstanceTracker",ib,[]);const Mb=(Da,sb,ec)=>ec?new ob(Da,sb):new fb(Da);var Tb=d(60),rc=d(617),vb=d(13);class Ya{constructor(Da,sb=null,ec=null){this.xC=null;this.cKe=new n.a;this.Md=Da;this.y_d=sb;ec&&ec.continueWith(()=>{this.xC=ec.result;this.xC.iXb(Object(e.a)(this,this.W6,"onUsersUpdated"));this.a3d()});new Ka.a(this.settings.clientId,"Anonymous user","#cccccc",new Xa.a(7));this.FOd=this.Rve=!0;this.Bre=this.ECe=!1;this.owa=Mb(this.settings.clientId,this.settings.meb,Da.QXk)}get settings(){return this.Md}get S$l(){return u.AFrameworkApplication.K?
u.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get Sai(){return u.AFrameworkApplication.K?u.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}Bnl(){let Da;let sb,ec,Jc,jd;var Ud=this.Cnl();this.owa.Thb?1===this.owa.Thb?(sb=!0,ec=this.settings.dfc.cluster,Jc=this.settings.dfc.eyd,jd=this.owa.N9f[0].color):(sb=!0,ec=this.settings.wVd.cluster,Jc=this.settings.wVd.eyd,jd=""):(sb=!1,jd=Jc=ec="");Da=Ud[0];Ud=Ud.slice(1);return{G_m:Da,H_m:Ud,B_m:sb,WIo:ec,D_m:Jc,C_m:jd}}Cnl(){if(2<=
this.owa.Thb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.owa.Thb)];if(1===this.owa.Thb){const Da=this.owa.N9f[0],sb=this.settings.meb(Da.clientId);return sb&&2===sb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Da.userName]:[Da.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,Da.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}wOl(Da){return this.xOl(Da)}Qjh(Da,
sb,ec){return sb?this.hrk(sb)?(Da=this.settings.meb(Da))&&2===Da.status?!1:!0:(ec&&k.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(ec&&k.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}YJl(Da){return Da.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}xOl(Da){if(!Da.capabilities.uBa(1))return this.YJl(Da);const sb=Da.isReadOnly,ec=this.settings.meb(Da.clientId);
Da=this.settings.XJc(Da.clientId);if(!ec)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(ec.status){case 1:return Da?sb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.fGk(Da)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}tvl(Da){if(this.y_d.OQd)return this.y_d.t_b(Da.email,
"O365",u.AFrameworkApplication.xm,0)}jOl(Da){Da=this.settings.meb(Da.clientId);return!Da||Da&&1===Da.status?!0:!1}lOl(Da){var sb=String.format("buttonPeoplesWellUser-{0}",Da.clientId),ec=Da.clientId,Jc=this.wOl(Da);const jd=Da.userName,Ud=Da.color;var ve=Object,bf=ve.assign,$e=new hc,cf=this.settings.eqd.toString(),oi=this.settings.p9d.cluster,Dc=this.settings.p9d.eyd,Ag=this.JPh(),Uc=Da.isAnonymous,cl;if(cl=[jd],cl.length){var Sh=new Sys.StringBuilder("STRARRY@");for(const Kh of cl)Sh.append(Kh?
Kh.length:0),Sh.append(","),Sh.append(Kh),Sh.append(",");cl=Sh.toString().slice(0,-1)}else cl=null;sb=bf.call(ve,$e,{Id:sb,Command:cf,LabelText:"{0}",Image32by32:oi,Image32by32Class:Dc,MenuItemId:ec,CommandValueId:ec,Alt:jd,DisplayMode:Ag,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Jc,ImageBackColor:Ud,IsAnonymous:Uc,LabelTextUserGeneratedPlaceholderReplacements:cl,Upn:Da.email});u.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.y_d&&(ec=this.tvl(Da),Jc=this.jOl(Da),sb.ImageUrl=ec,sb.ActiveStatus=Jc,sb.JoinTimeInMS=Da.WMa,Da=this.Qjh(Da.clientId,this.settings.XJc(Da.clientId),!1),sb.CanJump=Da,""===ec&&k.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return sb}Htl(){return Object.assign(new Ua.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}JPh(){return this.S$l?"Initials":
"Menu32"}mOl(Da){const sb=[];for(const ec of Da)Da=this.lOl(ec),Array.add(sb,Da);return sb}eOd(){return 0<this.owa.Thb}gdn(Da){if(!this.Rve)return!0;this.FOd||(Da[rc.a.Visible]=!0);let sb,ec,Jc,jd,Ud;({G_m:sb,H_m:ec,B_m:Jc,D_m:jd,C_m:Ud}=this.Bnl());Da[rc.a.LabelText]=sb;ec&&ec.length&&(Da[rc.a.LabelTextUserGeneratedPlaceholderReplacements]=ec);Da[rc.a.ImageIsVisible]=Jc;Da[rc.a.Image16by16Class]=jd;Da[rc.a.ImageBackColor]=Ud;this.Rve=!1;return!0}Q5m(Da){if(0>=this.owa.Thb)return!1;var sb=this.K_n(this.owa.N9f),
ec=this.mOl(sb);sb=Object.assign(new mb.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});ec=Object.assign(new Rb.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.JPh(),ControlList:ec});u.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.y_d&&(ec.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,ec.TitleId="menuCoauthorsTitle",ec.Theme="Light");Array.add(sb.MenuSectionList,ec);u.AFrameworkApplication.K.$("DocChatIsEnabled")&&u.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
u.AFrameworkApplication.ua&&u.AFrameworkApplication.ua.Sb.fq&&(ec=[],Array.add(ec,this.Htl()),ec=Object.assign(new Rb.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:ec}),Array.add(sb.MenuSectionList,ec));u.AFrameworkApplication.ua&&u.AFrameworkApplication.ua.Sb.fq?Da.MenuItems=sb:Da.PopulationXML=Ab.q(sb);return!0}L9f(Da){k.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Da=Da.MenuItemId;if(!Da)return!1;const sb=this.settings.XJc(Da);if(!this.Qjh(Da,sb,
!0))return!1;this.zom(sb);return!0}Ajn(){const Da=this.Qhl();this.owa.ZPn(Da);this.FOd&&1<=this.owa.Thb&&(k.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.FOd=!1);this.Rve=!0}W6(){this.Bre||(window.setTimeout(()=>{this.a3d();this.Bre=!1},3E3),this.Bre=!0)}Qhl(){let Da;Da=this.Phl()||[];for(const sb of Da)this.rBn(sb);return Da}rBn(Da){Da.clientId||(Da.clientId=ma.a.create().toString());Da.userName||(Da.userName="Anonymous user");Da.capabilities||(Da.capabilities=
new Xa.a);Da.color||(Da.color="#cccccc");Da.WMa||(Da.WMa=0)}K_n(Da){const sb=[];Array.addRange(sb,Da);sb.sort(Ya.p_m);return sb}Jmn(){u.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.ECe&&(u.AFrameworkApplication.ya.b6(vb.a.hoh)&&Hb.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||u.AFrameworkApplication.ya.gb(vb.a.hoh,Tb.a.frame,Object(e.a)(this,this.jQm,"onCoauthorGalleryFirstRender"),96));this.Kmn();this.ECe=
!0;this.a3d()}jQm(Da,sb,ec,Jc,jd){this.cKe.DU(jd.RenderTime);return 32}get Maj(){return this.cKe.task}a3d(){if(!this.ECe&&(this.cKe.DU((new Date).getTime()),k.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.Sai))return;this.Ajn();this.Sai&&this.FOd?u.AFrameworkApplication.K&&u.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||Ta.a.h$b("ribbon","coauthorGallery"):
(u.AFrameworkApplication.K&&u.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Ta.a.yua("ribbon","coauthorGallery"),Ta.a.M0a("ribbon","coauthorGallery")),this.Bjn())}dispose(){this.xC&&(this.xC.S3d(Object(e.a)(this,this.W6,"onUsersUpdated")),this.xC=null)}static p_m(Da,sb){return Da.capabilities.uBa(1)&&sb.capabilities.uBa(1)||!Da.capabilities.uBa(1)&&!sb.capabilities.uBa(1)?Aa.a.localeCompare(Da.userName,sb.userName):Da.capabilities.uBa(1)?
-1:1}}Object(l.a)(Ya,"APeoplesWell",null,[910,9]);var wb=d(14);class jb extends Ya{constructor(Da,sb,ec=null,Jc=null){super(Da,ec,Jc);this.ZRa=()=>!0;this.ga=sb}idn(Da){return this.gdn(Da)}S5m(Da){return this.Q5m(Da)}poo(Da){return this.L9f(Da)}$Ya(Da,sb,ec,Jc,jd,Ud){Da=!1;switch(ec){case 1:Da=jd(Jc);break;case 2:Da=Ud(Jc)}return jb.jjk(Da)}Ham(Da,sb,ec,Jc,jd){return this.$Ya(Da,sb,ec,jd,()=>this.eOd(),this.ZRa)}hdn(Da,sb,ec,Jc,jd){return this.$Ya(Da,sb,ec,jd,Object(e.a)(this,this.idn,"queryUsersProxy"),
this.ZRa)}R5m(Da,sb,ec,Jc,jd){return this.$Ya(Da,sb,ec,jd,this.ZRa,Object(e.a)(this,this.S5m,"populateFlyoutContentsProxy"))}bAk(Da,sb,ec,Jc,jd){return this.$Ya(Da,sb,ec,jd,this.ZRa,this.ZRa)}aAk(Da,sb,ec,Jc,jd){return this.$Ya(Da,sb,ec,jd,this.ZRa,this.ZRa)}ooo(Da,sb,ec,Jc,jd){return this.$Ya(Da,sb,ec,jd,this.ZRa,Object(e.a)(this,this.poo,"userButtonClickProxy"))}Q3m(Da,sb,ec,Jc,jd){return this.$Ya(Da,sb,ec,jd,this.ZRa,()=>{this.a3d();return!0})}Kmn(){this.ga.pa(this.settings.Zpd,wb.a.application,
Object(e.a)(this,this.Ham,"isControlEnabledHandler"));this.ga.gb(this.settings.cqd,wb.a.application,Object(e.a)(this,this.hdn,"queryUsersHandler"),96);this.ga.gb(this.settings.aqd,wb.a.application,Object(e.a)(this,this.bAk,"commandMenuOpenHandler"),96);this.ga.gb(this.settings.$pd,wb.a.application,Object(e.a)(this,this.aAk,"commandMenuCloseHandler"),96);this.ga.gb(this.settings.bqd,wb.a.application,Object(e.a)(this,this.R5m,"populateFlyoutContentsHandler"),96);this.ga.pa(this.settings.eqd,wb.a.application,
Object(e.a)(this,this.ooo,"userButtonClickHandler"));this.ga.gb(this.settings.oNe,wb.a.application,Object(e.a)(this,this.Q3m,"peoplesWellRefreshControlHandler"),96)}static jjk(Da){return Da?32:8}}Object(l.a)(jb,"ABox4PeoplesWell",Ya,[]);var Zb=d(3),Eb=d(53),tc=d(11),lc=d(34),Lc=d(184);class Bb{static isSupported(Da){for(let sb=0;sb<Bb.u9i.length;sb++)if(Da===Bb.u9i[sb])return!0;return!1}}Bb.u9i=[1];Object(l.a)(Bb,"RTTDataVersion",null,[]);var jc=d(1585);const dc=Da=>{if("number"!==typeof Da.RK||"number"!==
typeof Da.DK)return!1;let sb,ec=!1,Jc=!1,jd=!1;switch(Da.RK){case 0:Jc=sb=!0;break;case 1:jd=ec=Jc=sb=!0;break;case 2:if(null!=Da.PE&&"number"!==typeof Da.PE)return!1;sb=!0;break;case 4:sb=!0;break;case 3:Jc=sb=!0;break;case 5:ec=sb=!0;break;default:return!1}return sb&&("number"!==typeof Da.PS||"number"!==typeof Da.TS)||Jc&&("object"!==typeof Da.OS||!Da.OS||!jc.validateVersionedCpData(Da.OS))||ec&&("number"!==typeof Da.PE||"number"!==typeof Da.TE)||jd&&("object"!==typeof Da.OE||!Da.OE||!jc.validateVersionedCpData(Da.OE))?
!1:!0},nb=Da=>{let sb="";if("number"!==typeof Da.I)return{returnValue:!1,Xea:"Invalid PacketId Type"};if("number"!==typeof Da.O)return{returnValue:!1,Xea:"Invalid Operation Type"};if("string"!==typeof Da.A)return{returnValue:!1,Xea:"Invalid ClientId Type"};if("object"!==typeof Da.AN)return{returnValue:!1,Xea:"Invalid Anchor Object Type"};if(!Da.AN)return{returnValue:!1,Xea:"Null AnchorObject"};if(!dc(Da.AN)){let ec;try{ec=S.c(Da.AN)}catch(Jc){ec=String.format("Failed to JSON-serialize payload : {0}",
Jc)}8E3<ec.length&&(ec=String.format("Payload exceeds maximum length: {0} > {1}, not logging",ec.length,8E3));sb="Invalid AnchorObject: "+ec+", Client: "+Da.C;return{returnValue:!1,Xea:sb}}return!Da.O&&Da.AN.RK?(sb="Invalid RangeKind:"+Da.AN.RK+" for Caret",{returnValue:!1,Xea:sb}):2===Da.O&&("number"!==typeof Da.TF||"undefined"!==typeof Da.TX&&"string"!==typeof Da.TX||1!==Da.AN.RK&&Da.AN.RK)?{returnValue:!1,Xea:"Invalid TypingData"}:3!==Da.O||"object"===typeof Da.AP&&Da.AP&&"number"===typeof Da.AP.TFA&&
"number"===typeof Da.AP.PN&&"number"===typeof Da.AP.TN&&2===Da.AN.RK?6!==Da.O||"object"===typeof Da.MP&&Da.MP&&"number"===typeof Da.MP.PM&&"number"===typeof Da.MP.TM&&5===Da.AN.RK?4!==Da.O||"object"===typeof Da.SP&&Da.SP&&"number"===typeof Da.SP.PA&&"number"===typeof Da.SP.TA&&"number"===typeof Da.SP.PB&&"number"===typeof Da.SP.TBS&&3===Da.AN.RK&&(Da.AN.PS===Da.SP.PA||Da.AN.PS===Da.SP.PB)?7!==Da.O||"object"===typeof Da.SPS&&Da.SPS&&"string"===typeof Da.SPS.SF&&"boolean"===typeof Da.SPS.SL?null!=Da.ISS&&
"number"!==typeof Da.ISS?{returnValue:!1,Xea:"invalid StrictlySequentialId"}:{returnValue:!0,Xea:sb}:{returnValue:!1,Xea:"Invalid SymbolData"}:{returnValue:!1,Xea:"Invalid SplitParaData"}:{returnValue:!1,Xea:"Invalid RemoveParaData"}:{returnValue:!1,Xea:"Invalid AddParaData"}};var Gb=d(1559);class lb{constructor(Da,sb=null,ec=null){this.D_=this.fKf=this.h5f=null;null!=Da&&(this.h5f=Da);null!=sb&&(this.fKf=sb);null!=ec&&(this.D_=ec)}}Object(l.a)(lb,"AddParaData",null,[]);class Kb{constructor(Da=null,
sb=null){this.igc=this.eKf=null;null!=Da&&(this.eKf=Da);null!=sb&&(this.igc=sb)}}Object(l.a)(Kb,"MergeRemoveParaData",null,[]);class Vb{constructor(Da,sb,ec,Jc,jd,Ud,ve=null,bf=null,$e=null,cf=null,oi=null,Dc=null,Ag=0,Uc=null){this.G1c=this.text=this.oLb=this.LKb=this.aSc=this.TWb=this.Aha=null;this.packetId=Da;this.client=ec;this.ft=Jc;this.clientId=sb.toLowerCase();this.rS=jd;this.version=Ag;Ud&&(this.Aha=Ud);null!=ve&&(this.oLb=ve);void 0!==bf&&null!==bf&&(this.text=bf);$e&&(this.TWb=$e);cf&&
(this.aSc=cf);oi&&(this.LKb=oi);Dc&&(this.G1c=Dc);this.strictlySequentialId=Uc}}Object(l.a)(Vb,"RTTData",null,[]);class vc{constructor(Da=null,sb=null,ec=null,Jc=null){this.g5f=this.dKf=this.d5f=this.cKf=null;null!=Da&&(this.cKf=Da);null!=sb&&(this.d5f=sb);null!=ec&&(this.dKf=ec);null!=Jc&&(this.g5f=Jc)}}Object(l.a)(vc,"SplitParaData",null,[]);class Fc{constructor(Da=null,sb=null){this.M3f=this.L3f=null;Da&&(this.L3f=Da);null!=sb&&(this.M3f=sb)}}Object(l.a)(Fc,"SymbolData",null,[]);class Zc{constructor(Da,
sb=null,ec=null){null!=Da&&(this.TFA=Da);null!=sb&&(this.PN=sb);null!=ec&&(this.TN=ec)}}Object(l.a)(Zc,"SerializableAddParaDataV1",null,[]);class td{constructor(Da=null,sb=null){null!=Da&&(this.PM=Da);null!=sb&&(this.TM=sb)}}Object(l.a)(td,"SerializableMergeRemoveParaDataV1",null,[]);class xd{}Object(l.a)(xd,"SerializableRTTDataV1",null,[]);class le{constructor(Da=null,sb=null,ec=null,Jc=null){null!=Da&&(this.PA=Da);null!=sb&&(this.TA=sb);null!=ec&&(this.PB=ec);null!=Jc&&(this.TBS=Jc)}}Object(l.a)(le,
"SerializableSplitParaDataV1",null,[]);class Yc{constructor(Da=null,sb=null){Da&&(this.SF=Da);null!=sb&&(this.SL=sb)}}Object(l.a)(Yc,"SerializableSymbolDataV1",null,[]);const xc=Da=>{var sb;if(!({Xea:sb}=nb(Da)).returnValue)return k.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",sb),null;let ec=sb=null,Jc=null,jd=null,Ud=null,ve=null,bf=null,$e=null;Da.WD&&(sb=Da.WD);null!=Da.TF&&(ec=Da.TF);void 0!==Da.TX&&null!==Da.TX&&(Jc=Da.TX);Da.AP&&(jd=new lb(Da.AP.TFA,Da.AP.PN,
Da.AP.TN));Da.MP&&(Ud=new Kb(Da.MP.PM,Da.MP.TM));Da.SP&&(ve=new vc(Da.SP.PA,Da.SP.TA,Da.SP.PB,Da.SP.TBS));Da.SPS&&(bf=new Fc(Da.SPS.SF,Da.SPS.SL));null!=Da.ISS&&($e=Da.ISS);return new Vb(Da.I,Da.A,Da.C,Da.O,Gb.a(Da.AN),sb,ec,Jc,jd,Ud,ve,bf,1,$e)},md=Da=>{let sb=Da;if("number"===typeof sb.V){if(1===sb.V)return xc(Da);k.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let ec=0,Jc=null;for(let jd=0;jd<Da.length;jd++)sb=Da[jd],Bb.isSupported(sb.V)&&sb.V>ec&&(ec=sb.V,Jc=Da[jd]);return 1===
ec?xc(Jc):null},Ie=Da=>{if(Da){const sb=new xd;sb.I=Da.packetId;sb.V=1;sb.A=Da.clientId;sb.C=Da.client;sb.O=Da.ft;sb.AN=Gb.c(Da.rS);Da.Aha&&(sb.WD=Da.Aha);null!=Da.oLb&&(sb.TF=Da.oLb);void 0!==Da.text&&null!==Da.text&&0<Da.text.length&&(sb.TX=Da.text);Da.TWb&&(sb.AP=new Zc(Da.TWb.h5f,Da.TWb.fKf,Da.TWb.D_));Da.aSc&&(sb.MP=new td(Da.aSc.eKf,Da.aSc.igc));Da.LKb&&(sb.SP=new le(Da.LKb.cKf,Da.LKb.d5f,Da.LKb.dKf,Da.LKb.g5f));Da.G1c&&(sb.SPS=new Yc(Da.G1c.L3f,Da.G1c.M3f));sb.ISS=Da.strictlySequentialId;Da=
sb}else Da=null;return Da};var Te=d(59);class rf{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e){this.LocalCobaltSessionId=Da;this.SkypeChatThreadId=sb;this.ChatThreadDiscoveryUri=ec;this.InChat=Jc;this.Capabilities=jd;this.Email=Ud;this.UserName=ve;this.IsAnonymous=bf;this.PresenceStatus=$e}}Object(l.a)(rf,"SerializableWacData",null,[]);class ke{constructor(){this.zmd=this.ymd=0}yAl(){this.zmd===Number.MAX_VALUE&&(this.zmd=0);this.zmd++;return this.zmd}xAl(){this.ymd===Number.MAX_VALUE&&(this.ymd=0);this.ymd++;
return this.ymd}static get instance(){return ke.aWj}}ke.aWj=new ke;Object(l.a)(ke,"StrictlySequentialIdGenerator",null,[297]);var xe=d(1500);class zf{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf=0){this.rqa=null;this.dryDeletion=0;this.OH=Da;this.YHa=Ud;this.qd=jd;this.Iub=ve;this.Nc=sb;this.shapeId=bf;this.vDa=ec;this.d7=ve.create(this,Jc,jd,Ud)}clone(){return new zf(this.OH,this.Nc,this.vDa,this.d7.QMb,this.qd,this.YHa,this.Iub,this.shapeId)}get paragraphId(){return this.rqa?this.rqa:this.OH.Vdb(this.Nc)}UHf(){this.rqa||
(this.rqa=this.paragraphId,this.d7.UHf())}Rd(){return 0<=this.d7.cp}getData(){const Da=this.d7.QMb;return Da?new xe.a(0,this.Nc,this.vDa,Da,null,null,null,0,this.shapeId):null}static nxb(Da,sb,ec,Jc,jd){return sb?new zf(sb,parseInt(Da.fOa),Da.J3a,Da.EQ,ec,Jc,jd,Da.shapeId):null}}Object(l.a)(zf,"WordPresenceIp",null,[317,92,318]);class $c{constructor(Da,sb,ec){this.LPa=this.aaa=this.vrc=!1;this.N8a=Da;this.FSa=ec;this.user=sb}get ip(){return this.FSa}get r9b(){return this.vrc}set r9b(Da){(this.vrc=
Da)&&this.ip.UHf()}Dhf(){const Da=ke.instance.xAl();return new Vb(this.N8a,this.user.clientId,1,0,this.ip?this.ip.getData():null,new rf(this.user.vQ,this.user.yAc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Da)}KRh(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():Te.a.nil.toString())}Rd(){const Da=!!this.user&&
this.user.Rd(),sb=!this.ip||this.ip.Rd();return Da&&sb}clone(){const Da=new $c;Da.N8a=this.N8a;Da.vrc=this.vrc;Da.user=this.user?this.user.clone():null;Da.FSa=this.ip?this.ip.clone():null;Da.aaa=this.aaa;Da.LPa=this.LPa;return Da}static P_e(Da,sb,ec,Jc,jd){if(!Da||!sb)return null;if(Da.ft)return k.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Da.ft),null;let Ud;Ud=void 0!==Da.Aha&&null!==Da.Aha?Ma.Kth(Da.clientId,Da.Aha.UserName,Da.Aha.Capabilities,Da.Aha.LocalCobaltSessionId,
Da.Aha.SkypeChatThreadId,Da.Aha.Email,Da.client,Da.Aha.ChatThreadDiscoveryUri,Da.Aha.InChat,!1,Da.Aha.IsAnonymous,Da.Aha.PresenceStatus):Ma.Kth(Da.clientId,null,0,void 0,void 0,void 0,Da.client);return new $c(Da.packetId,Ud,zf.nxb(Da.rS,sb,ec,Jc,jd))}}Object(l.a)($c,"WordPresenceInfo",null,[293,92]);class Hg extends jb{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e,cf,oi,Dc,Ag,Uc){super(Da,Ud,Uc,sb);this.kyj=ec;this.BTj=Jc;this.$Rj=jd;this.ib=ve;Hg.rt=bf;this.OH=$e;this.qd=cf;this.YHa=oi;this.QMe=Dc;this.fGa=
Ag}L9f(Da){this.fGa.qji(Da.CommandValueId);return super.L9f(Da)}zom(Da){let sb;({IMf:sb}=this.Psf(Da)).returnValue&&(this.BTj(sb.ip.paragraphId,sb.ip.d7.cp),u.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Da=Hg.IIl(sb),void 0!==Da&&null!==Da?(k.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.ib.setSelection(Da),ab.FocusManager.fJ()&&ab.FocusManager.instance().Jg(eb.AFrame.Zp)):k.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),
Da=new Ca.a(2,1,0,()=>{this.ga.Xb(Zb.a.R8d,2,sb)}),zb.a.instance.$b(Da))}UWh(Da){return Da?(Da=$c.P_e(md(Da),this.OH,this.qd,this.YHa,this.QMe.instance))&&Da.Rd()&&Da.ip?Da:null:null}hrk(Da){return this.tim(Da)?this.xrk(Da)?!0:(k.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(k.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}tim(Da){return!!this.UWh(Da)}Psf(Da){Da=this.UWh(Da);return{returnValue:!!Da,
IMf:Da}}xrk(Da){let sb;return({IMf:sb}=this.Psf(Da)).returnValue?this.kyj(sb.ip.paragraphId,sb.ip.d7.cp):!1}Phl(){if(!this.xC)return[];const Da=[];for(let sb of this.xC.$Xa())sb.userName?Da.push(sb):k.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Da}fGk(Da){let sb;return({IMf:sb}=this.Psf(Da)).returnValue&&sb.user&&sb.user.presenceStatus&&"0"!==sb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,sb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}Bjn(){this.$Rj(this.settings.id)}static createInstance(Da,
sb,ec,Jc,jd,Ud,ve){const bf=Sa.App.xa.jb,$e=u.AFrameworkApplication.ya,cf=Eb.a.instance,oi=qa.a.instance.resolve("Box4.ICoauthCashTelemetry");return new Hg(Da,sb,Dc=>bf.Ic.wi?bf.Ic.sVe(Dc,!0):!1,(Dc,Ag)=>{bf.Ic.wi&&bf.Ic.mdc(Dc,Ag,!0,!0)},()=>{Sa.App.Cv.aI.K3c()},$e,cf,bf,ec,Jc,jd,Ud,oi,ve)}static IIl(Da){const sb=Hg.rt.Yc.zd.Eb(Da.ip.paragraphId);if(void 0===sb||null===sb)return k.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!tc.ParagraphReader.nc(sb))return k.ULS.sendTraceTag(20764577,
325,15,"The obtained node is not a paragraph node"),null;Da=lc.a.Uc(sb,Da.ip.d7.cp);return new Lc.Selection([Da],!0)}}Hg.rt=null;Object(l.a)(Hg,"WordEditorPeoplesWell",jb,[]);class Rc{constructor(){this.ax=()=>{u.AFrameworkApplication.lEi?Rc.gPa.tI().continueWith(this.UTc):k.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.UTc=()=>{Rc.jj=Rc.gPa.tI().result;if(Rc.jj){var Da=()=>{const sb=Sa.App.xa.jb;return sb?sb.Yc?sb.Yc.zd:(k.ULS.sendTraceTag(23196876,
325,15,"ActivePage is null"),null):(k.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Sa.App.Cla().continueWith(()=>{const sb=Sa.App.Cla().result.qj,ec=pa.CuiHelper.VDl(u.AFrameworkApplication.pr,u.AFrameworkApplication.pr,u.AFrameworkApplication.pr,u.AFrameworkApplication.pr),Jc=Ra.createInstance(ec,sb,Object(e.a)(Rc.jj.d5d,Rc.jj.d5d.XJc,"getUserPresence"),Object(e.a)(Rc.jj.d5d,Rc.jj.d5d.meb,"getUserStatusInfo"),u.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));
qa.a.instance.ha("RealtimePresenceUI.WordEditorPeoplesWell",()=>Hg.createInstance(Jc,ka.a.Kq(Rc.W.Za("Common.IPeopleInfoProvider")),Rc.W.Pa("WordEditor.ParagraphWordIdMapping"),Rc.W.Pa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Da,Rc.W.Za("WordEditor.Presence.IWordPresenceCpFactory"),Rc.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").singleInstance();Rc._instance=qa.a.instance.resolve("Common.IPeoplesWell");Rc._instance.Jmn();k.ULS.sendTraceTag(23196877,
325,50,"PeoplesWellControl is fully initialized")})}else k.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}yc(Da){Rc.W=Da}init(){u.AFrameworkApplication.K.zq(this.ax)}dispose(){Rc._instance&&(Rc._instance.dispose(),Rc._instance=null)}static get gPa(){return null!=Rc.Spg?Rc.Spg:Rc.Spg=qa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}Rc._instance=null;Rc.W=null;Rc.jj=null;Object(l.a)(Rc,
"WordEditorPeoplesWellControlPackage",null,[1,2]);var Ed=d(81),Yd=d(143);class Zf{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e=!1){this.e5a=null;this.Jpe=!0;this.dDe=this.Oq=this.xie=null;this.sa=new bb.a;this.THa=Da;this.Mca=sb;this.nWg=ec;this.Ktc=Jc;this.Lvg=Ud;Zf.Hb=jd;this.cRj=ve;this.JY=bf;this.gSj=$e;G.Task.WAA(sb,ec).continueWith(Object(e.a)(this,this.L1l,"initOnTaskReady"))}r9j(Da){this.sa.addHandler("u",Da)}GJi(){this.sa.raiseEvent("u",null,this)}L1l(){this.Mca.result&&this.nWg.result&&(this.Oq=
this.Mca.result,this.dDe=this.nWg.result,this.Oq.rVa(Object(e.a)(this,this.Z2,"onPresenceUpdated")),this.xie=new Ca.a(2,2,this.Lvg,Object(e.a)(this,this.Bgo,"updateAwayClientsTask"),88),Zf.Hb.$b(this.xie))}Z2(Da,sb){(this.Jpe||this.Egn(sb.pFa))&&Zf.Hb.m3(this.xie,0)}Egn(Da){for(let ec in Da){var sb=this.Ktc.CHd({key:ec,value:Da[ec]});if(sb&&sb.clientId&&(sb=sb.clientId.toLowerCase(),(sb=this.e5a[sb]||this.e5a[sb.toUpperCase()])&&2===sb.status))return!0}return!1}Bgo(Da){var sb=this.Oq.kHc();if(sb){var ec=
new Date,Jc=!1;if(this.Jpe){this.e5a=sb;this.Jpe=!1;var jd=this.e5a;for(var Ud in jd){sb=Ud;var ve=jd[Ud];ve.B8b<ec&&(ec=ve.B8b);2===ve.status&&(Jc=!0,this.dDe.XXc(sb))}Jc&&this.GJi();Zf.Hb.m3(Da,this.LUh(ec))}else{ve=new O.a;Ud=!1;var bf=this.e5a;for(jd in bf){bf=jd;if(!(bf in this.e5a)||this.THa.clientId===bf)continue;var $e=this.e5a[bf];const cf=sb[bf];if($e&&cf){$e=$e.status;const oi=cf.status;2===$e&&1===oi?(ve.add(bf),k.ULS.sendTraceTag(38052609,392,50,bf+" returned from away")):1===$e&&2===
oi&&(Ud=Jc=!0,this.dDe.XXc(bf),k.ULS.sendTraceTag(38052610,392,50,bf+" went away"));1===oi&&cf.B8b<ec&&(ec=cf.B8b)}}this.e5a=sb;Zf.Hb.m3(Da,this.LUh(ec));(0<ve.count||Jc)&&this.GJi();0<ve.count&&!this.gSj?(Da=this.Nll(ve),this.t9n(Da)):Da=new O.a;(Ud||0<Da.count)&&this.cRj(vb.a.svd,2)}}}t9n(Da){if(Da.count)for(let sb of Da)Da=this.JY.Yra(String.format(CommonUIStrings.l_EditorsToastArriving,sb),!1),Da.image=5,Da.Nla="CoAuth_AuthorStatus_16x16x32",this.JY.mA(Da)}Nll(Da){const sb=this.Oq.Fzb(),ec=new O.a;
for(let Jc in sb){const jd={key:Jc,value:sb[Jc]};if(Da.contains(jd.key)){const Ud=this.Ktc.CHd(jd);Ud&&(ec.add(Ud.userName),Da.remove(jd.key))}}ec.count||k.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return ec}LUh(Da){const sb=new Date;return Math.max(Da.getTime()+this.Lvg-sb.getTime(),0)}}Zf.Hb=null;Object(l.a)(Zf,"AwayManager",null,[]);var Hc=d(781);class sc{constructor(Da=0){this.updates=Da}get $kf(){return 0!==this.updates}uBa(Da){return!!(this.updates&Da)}C2a(Da){this.updates|=
Da}toString(){if(this.uBa(0))return"none";const Da=new O.a;this.uBa(1)&&Da.add("user(s) joined");this.uBa(2)&&Da.add("user(s) disconnected");this.uBa(4)&&Da.add("user(s) updated");return Da.toArray().join(", ")}}Object(l.a)(sc,"UserUpdateEvent",null,[]);var pd=d(31);class Ub{constructor(Da,sb,ec,Jc,jd=null){this.sa=new bb.a;this.rJ=this.jj=null;this.BRg=this.XRg=this.Cl=!1;this.Vp=new Fa.a;Da.continueWith(()=>{this.jj=Da.result;this.jj.rVa(Object(e.a)(this,this.Vzi,"onRtcPresenceUpdate"));this.jj.Vya(Object(e.a)(this,
this.Uzi,"onRtcConnectionChange"));this.j9f(null,null)});sb.continueWith(()=>{this.rJ=sb.result;this.rJ.nVa(Object(e.a)(this,this.zTc,"onEditorsTableUpdated"))});jd&&jd.continueWith(()=>{jd.result.r9j(Object(e.a)(this,this.j9f,"updateUserStatus"));this.j9f(null,null)});this.Y8a=ec;this.Ktc=Jc}get users(){return this.Vp}iXb(Da){this.sa.addHandler("UU",Da)}S3d(Da){this.sa.removeHandler("UU",Da)}j9f(){if(this.jj){var Da=!1,sb=this.jj.kHc();for(let Jc in sb){var ec=sb[Jc];const jd=Jc;this.users.xb(jd)&&
(ec=this.ucj(ec),Da=this.users.J(jd).Jwb!==ec||Da,this.users.J(jd).Jwb=ec)}Da&&(Da=new sc(4),this.a6d(Da))}}ucj(Da){return 1===Da.status?0:1}$Xa(){this.users.count||(this.XRg||(pd.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.XRg=!0),this.k6m());const Da=[];for(let sb of this.users)Array.add(Da,sb.value);return Da}k6m(){if(this.jj){var Da=this.jj.Fzb();this.Yzf(Da)}if(this.rJ){Da=this.rJ.dHc();for(const sb of Da)sb.Id&&(Da=this.Pvh(sb.Id),this.i9f(new sc,Da))}}coi(Da){({value:Da}=
this.users.Dc(Da));return Da}dispose(){this.Cl||(this.jj&&(this.jj.wIb(Object(e.a)(this,this.Vzi,"onRtcPresenceUpdate")),this.jj.aYc(Object(e.a)(this,this.Uzi,"onRtcConnectionChange"))),this.rJ&&this.rJ.OOi(Object(e.a)(this,this.zTc,"onEditorsTableUpdated")),this.Cl=!0)}Uzi(Da,sb){2===sb.newState&&(Da=this.Yzf(this.jj.Fzb()),Da.$kf&&this.a6d(Da))}zTc(Da,sb){Da=new sc;var ec=this.rJ.dHc();k.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
ec.length,sb.gOm,sb.pti);const Jc=new Fa.a;for(var jd of ec){ec=jd.Id;const Ud=this.Pvh(ec);this.i9f(Da,Ud);Jc.Z(ec,Ud)}if((sb=sb.leaving)&&0<sb.length)for(jd=0;jd<sb.length;jd++)k.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,sb.J(jd).Id),({value:ec}=this.users.Dc(sb.J(jd).Id)).returnValue?ec?(this.users.remove(sb.J(jd).Id),Da.C2a(2),Jc.Z(sb.J(jd).Id,ec)):k.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",sb.J(jd).Id):
k.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",sb.J(jd).Id);sb=this.jj.Fzb();for(let Ud in sb)jd=this.Ktc.CHd({key:Ud,value:sb[Ud]}),Jc.Z(jd.clientId,jd);for(let Ud of this.users)Jc.xb(Ud.value.clientId)||(k.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",Ud.key),this.users.remove(Ud.key),Da.C2a(2));Da.$kf&&this.a6d(Da)}Vzi(Da,sb){Da=this.Yzf(sb.pFa);for(const ec of sb.Dzd)this.users.xb(ec)&&(Da.C2a(2),this.users.J(ec).Jwb=
2);Da.$kf&&this.a6d(Da)}Yzf(Da){const sb=new sc;if(!Da)return sb;for(let Jc in Da){var ec=this.Ktc.CHd({key:Jc,value:Da[Jc]});ec&&(ec=ec.clone(),this.i9f(sb,ec))}return sb}i9f(Da,sb){if(sb){var ec=sb.clientId;var Jc=this.Jxn(sb);({value:sb}=this.users.Dc(ec)).returnValue?sb.equals(Jc)||(Da.C2a(4),this.users.Z(ec,Jc)):(k.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,ec),Da.C2a(1),this.users.Z(ec,Jc))}}Pvh(Da){return this.users.xb(Da)?this.users.J(Da):
Ka.a.QJk(Da)}Jxn(Da){if(!Da||!Da.clientId||!this.rJ)return Da;const sb=Da.clone();sb.Jwb=this.Mll(Da);if(Da=this.rJ.r2b(sb.clientId))sb.isReadOnly=sb.isReadOnly||Da.IsReadOnly?!0:!1,sb.userName=this.Ixn(sb,Da),sb.capabilities=this.OHm(sb.capabilities,Da.Capabilities),sb.email=sb.email||Da.SIPAddress||Da.EmailAddress,Da.JoinCoauthTime&&(sb.WMa=Da.JoinCoauthTime);sb.color=this.Y8a.WJc(new Hc.a(sb.email,void 0,sb.userName,void 0,sb.isAnonymous,sb.clientId),3);return sb}Mll(Da){if(!this.jj)return 2;if(Da&&
Da.clientId){const sb=this.jj.kHc();if(Da.clientId in sb)return this.ucj(sb[Da.clientId])}return 2}HBk(Da,sb){sb.Name&&Da.userName&&sb.Name!==Da.userName&&!this.BRg&&(this.BRg=!0,pd.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}OHm(Da,sb){Da=Da||new Xa.a;sb&&(sb.SupportsRealtimeChannel&&Da.C2a(1),sb.SupportsRename&&Da.C2a(2),sb.SupportsChat&&Da.C2a(4));return Da}Ixn(Da,sb){this.HBk(Da,sb);return sb.Name||Da.userName||(Da.isAnonymous||sb.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}a6d(Da){k.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Da.toString());this.sa.raiseEvent("UU")}}Object(l.a)(Ub,"PeopleInfoProvider",null,[933,9]);var uc;(function(Da){Da[Da.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Da[Da.peopleImageClassName=1]="peopleImageClassName";Da[Da.peopleImageClusterPath=4]="peopleImageClusterPath";Da[Da.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Da[Da.imageDimension=6]="imageDimension";
Da[Da.rtl=8]="rtl";Da[Da.pointerInputManager=9]="pointerInputManager";Da[Da.clickInputManager=10]="clickInputManager";Da[Da.vertical=11]="vertical";Da[Da.zIndex=12]="zIndex";Da[Da.contextMenuInputManager=13]="contextMenuInputManager";Da[Da.imageDomElement=14]="imageDomElement";Da[Da.useIdleTooltip=15]="useIdleTooltip";Da[Da.viewportBoundsCallback=16]="viewportBoundsCallback";Da[Da.flipHorizontalDirection=17]="flipHorizontalDirection";Da[Da.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
Da[Da.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";Da[Da.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(uc||(uc={}));Object(l.b)("PresenceTooltipSettingKeys",uc);class Tc{constructor(){this.nq={}}get(Da,sb=null){Da=uc[Da];return"number"===typeof sb?(sb=this.nq[Da])?Number.parseInvariant(sb.toString()):0:this.nq[Da]}add(Da,sb){this.nq[uc[Da]]=sb}lJa(Da,sb){uc[Da]in this.nq||(this.nq[uc[Da]]=sb)}remove(Da){delete this.nq[uc[Da]]}}Object(l.a)(Tc,"PresenceTooltipSettings",null,
[]);class qd extends bb.a{constructor(Da){super();this._element=null;this.element=Da}get element(){return this._element}set element(Da){this._element=Da}get visible(){return"visible"===this.element.style.visibility}set visible(Da){this.element.style.visibility=Da?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Da){this.element.dir=Da?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Da){this.element.style.zIndex=String(Da)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Da){return this.element.ownerDocument.createElement(Da)}Wga(){return!0}static bvh(Da){return"prControl"+(Da?"Rtl":"")}}Object(l.a)(qd,"BasePresenceControl",bb.a,[9,939]);class re extends Sys.EventArgs{constructor(Da,sb){super();this.type=Da;this.Fn=sb}}re.DT="InteractivityChanged";Object(l.a)(re,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class Je{static $ol(Da){return Je.apl(Da)}static apl(Da){const sb=
document.createElementNS(Je.Lag,"svg");sb.setAttribute("viewBox",String.format(Je.jQk,Je.Pkj,Je.Okj));sb.appendChild(Je.OKl(Da));return sb}static OKl(Da){const sb=Je.Pkj/Da,ec=2*sb,Jc=Je.Okj/2;Da=(Da-12-8)*sb/2;const jd=document.createElementNS(Je.Lag,"g");Sys.UI.DomElement.addCssClass(jd,Je.iQk);for(let Ud=1;3>=Ud;Ud++)jd.appendChild(Je.xll(Ud,ec,Da+(6*Ud-2)*sb,Jc));return jd}static xll(Da,sb,ec,Jc){const jd=document.createElementNS(Je.Lag,"circle");Sys.UI.DomElement.addCssClass(jd,String.format("{0}-{1}",
Je.wvk,Da));jd.setAttribute("cx",String.format("{0}",ec));jd.setAttribute("cy",String.format("{0}",Jc));jd.setAttribute("r",String.format("{0}",sb));return jd}}Je.Lag="http://www.w3.org/2000/svg";Je.iQk="prDancingDots";Je.wvk="prAnimateCircle";Je.jQk="0 0 {0} {1}";Je.Okj=40;Je.Pkj=120;Object(l.a)(Je,"ModernPresenceTooltipDancingDots",null,[]);var Jf=d(90),Ig=d(96),pb=d(7),Lb=d(27),Ic=d(114),Ad=d(50);class oe extends qd{constructor(Da,sb){super(Da);this.W4g=this.T6a=this.jke=this._img=this.GD=this.Gr=
this.ig=null;this.AIa=sb.get(8,!1);this.A6a=sb.get(6,0);this.mZj=sb.get(15,!1);this.Md=sb;this.PDg=0;this.element=Da;this.element.className=oe.b$e;this._span=document.createElement("span");this.element.appendChild(this._span);this.gCj=Je.$ol(sb.get(6,0));this.QA(sb);this._state=5}ivb(Da){this.addHandler(re.DT,Da)}uIb(Da){this.removeHandler(re.DT,Da)}get user(){return this.W4g}get state(){return this._state}dispose(){this.element&&(this.ig.sc(pb.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),
this.ig.sc(pb.a.VC,this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior")),this.Gr.sc(pb.a.pointerDown,this.element,Object(e.a)(this,this.XB,"onPointerDown")),this.Gr.sc(pb.a.pointerOut,this.element,Object(e.a)(this,this.gO,"onPointerOut")),this.Gr.sc(pb.a.pointerOver,this.element,Object(e.a)(this,this.vX,"onPointerOver")),this.GD.sc(this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}QA(Da){this.ig=Da.get(10);this.ig.mb(pb.a.click,
this.element,Object(e.a)(this,this.onClick,"onClick"));this.ig.mb(pb.a.VC,this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior"));this.Gr=Da.get(9);this.Gr.mb(pb.a.pointerOver,this.element,Object(e.a)(this,this.vX,"onPointerOver"));this.Gr.mb(pb.a.pointerOut,this.element,Object(e.a)(this,this.gO,"onPointerOut"));this.Gr.mb(pb.a.pointerDown,this.element,Object(e.a)(this,this.XB,"onPointerDown"));this.GD=Da.get(13);this.GD.mb(this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior"))}hide(Da=
null,sb=0,ec=0){this.mZj&&Da?this.FXn(Da,sb,ec):(3===this.state&&this.zNi(),this.visible=!1,this._state=5)}FXn(Da,sb,ec=0){this.show(Da,sb,15,4,void 0,ec)}m4i(Da,sb,ec=!1,Jc=!1,jd=!1,Ud=0){this.show(Da,sb,20,ec?2:Jc?1:0,jd,Ud)}dXn(Da,sb,ec,Jc=!1,jd=0){this.show(Da,sb,ec+20,3,Jc,jd)}show(Da,sb,ec,Jc=3,jd=!1,Ud=0){!Da||Jc===this.state&&this.RWl(sb,ec)||(this.w1j(Jc,jd,Ud),this.gda(Da,Jc,Ud),this._state=Jc,4===Ud||0===Ud&&!this.AIa?this.element.style.left=sb+"px":this.element.style.right=sb+"px",this.element.style.top=
ec+"px",this.visible=!0)}gda(Da,sb,ec){this.W4g=Da;Ad.a.nA(this._span);Ic.a.dxk(this._span);this._span.id="fly_"+Da.clientId;this._span.style.backgroundColor=Da.color;4!==sb?(this._span.style.height=this.A6a+"px",this._span.style.lineHeight=this.A6a+"px",Ic.a.gec(this._span,"border-radius",this.A6a+"px")):4===ec||0===ec&&!this.AIa?this._span.style.left="0px":this._span.style.right="0px";2!==sb&&(4===sb?Ad.a.iy(this._span,""):1===sb?this._span.appendChild(this.gCj):(this._span.setAttribute("dir","auto"),
ec=Aa.a.Rvl(Da.userName),(!Da.isAnonymous||u.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&ec||0!==sb?(Da=Da.userName,0===sb&&(Da=ec,Ic.a.gec(this._span,"text-align","center")),Ad.a.iy(this._span,Da)):(this._img||(this._img=this.MHk()),this._span.appendChild(this._img),Ic.a.gec(this._span,"text-align","start"))))}onClick(Da){if(0===this.state)return this.raiseEvent(re.DT,new re(1,Da)),!0;3===this.state&&k.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}gO(Da){3===this.state&&this.raiseEvent(re.DT,new re(3,Da));return!1}vX(Da){3!==Da.gg&&this.raiseEvent(re.DT,new re(2,Da));return!1}XB(Da){if(3!==Da.gg)return!0;this.raiseEvent(re.DT,new re(4,Da));return!1}MHk(){const Da=document.createElement("img");Da.src=Jf.a.G9("doughperson_white_glyph.svg");Da.setAttribute("Unselectable","on");Lb.a.Iq(Da,Lb.a.Ch,Lb.a.Az);return Ig.createClusteredImageFromClusterWithImageClass(this.A6a,this.A6a,null,null,oe.$bl,
"",!1,"",this.element.ownerDocument,Da)}w1j(Da,sb=!1,ec=0){if(!this.qNc(this.state)||!this.qNc(Da))switch(Sys.UI.DomElement.removeCssClass(this.element,this.jke),this.state){case 4:3===Da?this.kVa(oe.c$e,oe.hJh):this.qNc(Da)&&this.kVa(oe.a$e,oe.hJh);break;case 3:4===Da?this.kVa(oe.f$e,oe.gJh):this.qNc(Da)&&(sb&&this.zNi(),this.kVa(oe.a$e,oe.gJh,sb?oe.Zbl:""));break;case 0:case 1:case 2:4===Da?this.kVa(oe.f$e,oe.d$e):3===Da&&(sb&&this.D2j(),this.kVa(oe.c$e,oe.d$e,sb?oe.iJh:"",3===ec?oe.ccl:oe.acl));
break;default:4===Da?this.kVa(oe.f$e):3===Da?this.kVa(oe.c$e):this.qNc(Da)&&this.kVa(oe.a$e)}}kVa(...Da){this.jke=Da.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.jke)}D2j(){this.PDg=window.setTimeout(()=>{this.element&&(this.T6a=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.T6a),this.element.style.zIndex="2",this.T6a.style.zIndex="1")},300)}zNi(){window.clearTimeout(this.PDg);this.T6a&&(Sys.UI.DomElement.removeCssClass(this.T6a,oe.d$e+" "+oe.iJh),Sys.UI.DomElement.addCssClass(this.T6a,
oe.Ybl),G.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.T6a.parentNode&&this.element.parentNode.removeChild(this.T6a)}),Ic.a.kcc(this.element,"z-index"))}qNc(Da){return 0===Da||1===Da||2===Da}RWl(Da,sb){const ec=Ic.a.yX(this.element.style.top);return Ic.a.yX(this.element.style.left)===Da&&ec===sb}$Tf(Da){3===Da&&Ic.a.D9(this.element,"left")?(Da=Ic.a.yX(this.element.style.left),Ic.a.kcc(this.element,"left"),this.element.style.right=-1*Da+"px"):4===Da&&Ic.a.D9(this.element,
"right")&&(Da=Ic.a.yX(this.element.style.right),Ic.a.kcc(this.element,"right"),this.element.style.left=-1*Da+"px")}}oe.b$e="prModernFlyout UIFont";oe.f$e="flyoutIdle";oe.c$e="flyoutExpanded";oe.a$e="flyoutCollapsed";oe.hJh="flyoutFromIdle";oe.gJh="flyoutFromExpanded";oe.d$e="flyoutFromCollapsed";oe.iJh="flyoutStacked";oe.Zbl="flyoutFromStacked";oe.Ybl="flyoutFadeOut";oe.$bl="cui-img-cont-float cui-img-20by20";oe.acl="flyoutLtrDir";oe.ccl="flyoutRtlDir";Object(l.a)(oe,"ModernPresenceTooltipFlyoutControl",
qd,[]);class gf{constructor(Da,sb,ec=2,Jc=4){this.offsetTop=Da;this.offsetLeft=sb;this.Mkj=ec;this.N5h=Jc}}Object(l.a)(gf,"FlyoutsPositioningInfo",null,[]);var Oe=d(37);class Sg{constructor(Da=!1,sb=!1){this.Ql=Da;this.Spe=sb}dxl(Da,sb,ec,Jc,jd){const Ud=jd.y,ve=jd.height;var bf=this.Tjl(Jc);const $e=bf+sb,cf=Da*ec+2*(Da-1);ec=null;1===Da||this.Yqk(bf,cf,Ud,ve)?Da=new gf(0,0,2):(Da=this.M9e($e,cf,Ud,ve),Da.offsetTop-=bf);this.Spe?ec=new gf(0,0,void 0,this.Ql?4:3):(Jc=this.Sjl(Jc,jd),bf=Math.max(0,
jd.x),jd=jd.width,sb=Jc+sb,this.Zqk(Jc,bf,jd)?ec=new gf(0,0,void 0,this.Ql?3:4):this.$qk(sb,bf)&&(ec=new gf(0,0,void 0,this.Ql?4:3)),ec||(ec=this.Mal(Jc,sb,bf,jd)));return new gf(Da.offsetTop,ec.offsetLeft,Da.Mkj,ec.N5h)}Tjl(Da){return Oe.a.eLa(Da)}Sjl(Da,sb){return this.Ql?sb.width-Oe.a.SMh(Da):Oe.a.Lbf(Da)}Yqk(Da,sb,ec,Jc){return Da+sb<=ec+Jc}M9e(Da,sb,ec,Jc){let jd=1,Ud=Math.max(ec,Da-sb);sb>Da-ec&&(jd=2,Ud=sb<Jc?Jc-sb:ec);return new gf(Ud,0,jd)}Zqk(Da,sb,ec){return Da+150<=sb+ec}$qk(Da,sb){return 150<=
Da-sb}Mal(Da,sb,ec,Jc){Jc-sb>=Da-ec?Da=4:(sb=Da,Da=3);return new gf(0,sb,void 0,Da)}}Object(l.a)(Sg,"ModernPresenceTooltipPositioner",null,[]);class Ng{constructor(Da,sb,ec,Jc,jd,Ud,ve){this.o8=Da;this._parent=sb;this.tyg=ec;this.azj=Jc;this.UGj=jd;this.wVb=Ud;this.AIa=ve;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Da,sb){if(3!==Da)if(5!==Da&&this.o8&&this.o8.length){if(4===Da){var ec=this.UGj;var Jc=(this.wVb-ec)/2;
this.element.style.height=this.wVb+"px";this.element.style.width=this.wVb+"px";Da=Ic.a.yX(this.o8[0].element.style.top);sb=Ic.a.yX(this.AIa?this.o8[0].element.style.right:this.o8[0].element.style.left)}else ec=this.tyg,Jc=(this.wVb-ec)/2,this.element.style.height=this.wVb+"px",this.element.style.width=this.Qll()+2*Jc+"px",Da=Ic.a.yX(this.o8[this.o8.length-1].element.style.top),sb=this.$pk(this.o8[this.o8.length-1].element,ec,sb);Ic.a.gec(this.element,"border-radius",this.wVb+"px");this.element.style.top=
Da-Jc-ec+"px";this.AIa?this.element.style.right=sb-Jc+"px":this.element.style.left=sb-Jc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}$pk(Da,sb,ec){return this.AIa&&!ec?Ic.a.yX(Da.style.right):this.AIa||ec?this.AIa&&ec?-Ic.a.yX(Da.style.left)-sb:-Ic.a.yX(Da.style.right)-sb:Ic.a.yX(Da.style.left)}Qll(){return this.o8&&this.o8.length?this.tyg+Math.min(this.o8.length-1,2)*
this.azj:0}}Object(l.a)(Ng,"ModernPresenceTooltipTarget",null,[]);var Nh=d(158);class Eg extends qd{constructor(Da,sb,ec){super(Da);this.WTb=this.pHa=this.EIg=this.upb=!1;this.Vp=[];this.gcd={};this.Md=ec;this.Ql=ec.get(8,!1);this.CHg=ec.get(15,!1);this.bBj=ec.get(12,0);this.Aab=ec.get(6,0);this.S9a=sb;this.n5g=ec.get(16);this.Spe=ec.get(17,!1);this.XGj=ec.get(19,!1);this.TQj=ec.get(20,!1);this.Wed=0;this.MQj=new Sg(this.Ql,this.Spe);this.fjc=this.qPh();this.nsb=!1;this.xNb=[];this.Soc=[];this.element.id=
Eg.ddb();this.element.className=qd.bvh(this.Ql);this.XWa&&(this.zIndex=this.XWa);this.rtl=this.Ql;this.JXf(sb);this.D4=this.createElement("div");this.D4.className="prFlyoutContainer";this.element.appendChild(this.D4);this.o8=[];this.s7a=new Ng(this.a2,this.element,this.Aab,4,6,32,this.Ql);this.Gr=ec.get(9);this.Gr.mb(pb.a.pointerDown,this.s7a.element,Object(e.a)(this,this.F$b,"onHitTarget"));this.Gr.mb(pb.a.pointerOver,this.s7a.element,Object(e.a)(this,this.F$b,"onHitTarget"));this.Gr.mb(pb.a.pointerOut,
this.s7a.element,Object(e.a)(this,this.F$b,"onHitTarget"))}get q0d(){return H.a.clone(this.Vp)}get a2(){return this.o8}get XWa(){return this.bBj}get PXa(){return this.a2?this.a2.length:0}get zLb(){return 0<this.PXa?this.a2[0].state:5}get Cqf(){return 3===this.zLb&&!this.upb}ivb(Da){this.addHandler(re.DT,Da)}uIb(Da){this.removeHandler(re.DT,Da)}dispose(){if(this.Cqf)this.nsb=!0;else{if(this.a2)for(const Da of this.a2)Da.uIb(Object(e.a)(this,this.SNa,"onInteractivityChanged")),Ed.a.VA(Da);this.o8=null;
this.Gr.sc(pb.a.pointerDown,this.s7a.element,Object(e.a)(this,this.F$b,"onHitTarget"));this.Gr.sc(pb.a.pointerOver,this.s7a.element,Object(e.a)(this,this.F$b,"onHitTarget"));this.Gr.sc(pb.a.pointerOut,this.s7a.element,Object(e.a)(this,this.F$b,"onHitTarget"));super.dispose()}}Qec(){this.pZb();this.visible=!0}B0c(){this.visible=!0;this.LFh();this.upb=!0}h0f(){this.B0c()}hide(){this.dOi();this.mZa();this.s7a.update(this.zLb,this.WTb)}gda(Da){const sb=this.zLb,ec=this.upb;Da.clientId||(Da.clientId=(Eg.npc++).toString());
if(Da.clientId in this.gcd){var Jc=this.jzb(Da.clientId);if(0<=Jc){Jc=this.Vp[Jc];if(Jc.color===Da.color&&Jc.userName===Da.userName)return;this.Z1a(Da.clientId)}}this.hide();Jc=new oe(this.createElement("div"),this.Md);Jc.ivb(Object(e.a)(this,this.SNa,"onInteractivityChanged"));this.D4.insertBefore(Jc.element,this.D4.firstChild);this.gcd[Da.clientId]=Jc;Array.add(this.Vp,Da);Array.add(this.a2,Jc);this.Zij(sb,ec);this.visible=!0}Z1a(Da){if(this.Cqf)Array.add(this.Soc,Da);else{var sb=this.zLb,ec=this.upb;
this.hide();this.WXc(Da);this.Zij(sb,ec)}}xsi(Da){const sb=this.jzb(Da);if(!(0>=sb)){var ec=this.Vp[sb];Da=this.gcd[Da];Array.removeAt(this.Vp,sb);Array.insert(this.Vp,0,ec);Array.removeAt(this.a2,sb);Array.insert(this.a2,0,Da);this.D4.removeChild(Da.element);this.D4.appendChild(Da.element);this.pZb()}}Zij(Da,sb){0>=this.Vp.length?this.hide():3===Da&&sb?this.B0c():this.Qec()}K7e(Da){if(this.Cqf&&this.XGj)return!1;Da=Eg.dhf(Da);if(this.D4!==Da&&Ad.a.sMa(this.D4,Da))return!0;for(const sb of this.a2)if(Ad.a.sMa(sb.element,
Da))return!0;return!1}position(Da,sb){this.element.style.top=sb+"px";this.element.style.left=Da+"px"}pZb(Da=!1){if(!Da||this.pHa){this.EIg&&this.$_i(!0);var sb=Math.min(3,this.PXa)-1;Da=0;var ec=1,Jc=0;this.WTb&&(Da=this.fjc,ec=-1,Jc=-this.Aab);for(let jd=this.PXa-1;jd>sb;jd--)this.a2[jd].m4i(this.Vp[jd],-4*sb*ec+Jc,!0,!1,!0,Da);for(;0<=sb;sb--)this.a2[sb].m4i(this.Vp[sb],-4*sb*ec+Jc,0<sb,Array.contains(this.xNb,this.Vp[sb].clientId),sb!==this.Wed,Da);this.Wed=0;this.s7a.update(0,this.WTb);this.zIndex=
this.XWa;this.upb=!1;this.dOi(0);this.nsb&&this.dispose()}}LFh(){this.EIg&&this.$_i(!1);this.zIndex=this.XWa+1;let Da,sb,ec;({offsetX:sb,offsetY:Da,M5h:ec}=this.wLn());for(let Jc=0;Jc<this.PXa;Jc++)this.a2[Jc].dXn(this.Vp[Jc],sb,Da+(this.Aab+2)*Jc,Jc!==this.Wed,ec)}mZa(){let Da=0,sb=0;this.WTb&&(Da=this.fjc,sb=-6);for(let ec=0;ec<this.PXa;ec++)this.a2[ec].hide(this.Vp[ec],sb,Da);this.zIndex=this.XWa;this.visible=this.upb=!1;this.nsb&&this.dispose()}IXe(Da=0){Da?(this.pHa=!0,G.Task.delay(Da).continueWith(()=>
{this.CHg?this.qYl():this.pZb(!0);this.pHa=!1})):this.CHg?this.hide():this.pZb()}qYl(){this.pHa&&this.hide()}xik(){if(u.AFrameworkApplication.ua&&u.AFrameworkApplication.ua.Sb.nma&&Nh.c()){const Da=appChrome.selectors.getShyState();return Da.isActive&&0!==Da.state}return!1}SNa(Da,sb){Da=this.zLb;this.xik()||2!==sb.type&&(4!==sb.type||3===Da)?4===sb.type&&3===Da?(this.pHa&&(this.pHa=!1),this.IXe()):3!==sb.type||3!==Da||this.upb||(1<this.PXa?(this.pHa=!0,G.Task.delay(250).continueWith(()=>{this.pZb(!0);
this.pHa=!1})):this.IXe()):(this.pHa&&(this.pHa=!1),3!==Da&&(this.LFh(),3===sb.Fn.gg&&this.IXe(2E3)));this.raiseEvent(re.DT,sb)}F$b(Da){3===Da.gg?this.SNa(this,new re(4,Da)):Da.eventName===pb.a.pointerOver?this.SNa(this,new re(2,Da)):Da.eventName===pb.a.pointerOut&&this.SNa(this,new re(3,Da));return!1}JXf(Da){this.element.style.width=Da+"px";this.element.style.height=this.Aab+"px"}WXc(Da){this.ton(Da);Da=this.jzb(Da);if(!(0>Da)){var sb=this.Vp[Da];Array.removeAt(this.Vp,Da);delete this.gcd[sb.clientId];
sb=this.a2[Da];this.D4.removeChild(sb.element);this.Md.get(18,!1)&&sb.uIb(Object(e.a)(this,this.SNa,"onInteractivityChanged"));Array.removeAt(this.a2,Da);sb.dispose()}}dOi(Da=5){if(this.Soc.length){this.visible&&this.mZa();for(let sb=0;sb<this.Soc.length;sb++)this.WXc(this.Soc[sb]);Array.clear(this.Soc);0>=this.Vp.length||5===Da?this.hide():0===Da&&this.Qec()}}jzb(Da){for(let sb=0;sb<this.Vp.length;sb++)if(this.Vp[sb].clientId===Da)return sb;return-1}ton(Da){-1===this.jzb(Da)?k.ULS.sendTraceTag(41706452,
302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.xNb,Da)&&(Array.remove(this.xNb,Da),this.Vp[0].clientId===Da&&0<this.xNb.length&&this.xsi(this.xNb[this.xNb.length-1]),this.Vp[0].clientId===Da&&1===this.zLb&&this.pZb())}$_i(Da){Da?Sys.UI.DomElement.addCssClass(this.D4,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.D4,"prBackgroundSelection")}wLn(){let Da,sb;sb=Da=0;var ec=this.fjc;if(this.n5g){const Jc=this.n5g(this);if(!Jc)return{offsetX:Da,offsetY:sb,
M5h:ec};const jd=4===this.zLb;ec=this.MQj.dxl(this.PXa,jd?6:this.Aab,this.Aab,this.element,Jc);sb=ec.offsetTop;this.Wed=this.Ivl(ec.Mkj,ec.offsetTop);ec=ec.N5h;ec!==this.fjc&&(this.$Tf(ec),this.element.dir=3===ec?"rtl":"ltr",this.fjc=ec);ec!==this.qPh()?(Da=this.TQj?-2:jd?-6:-this.Aab,this.WTb=!0):this.WTb=!1}return{offsetX:Da,offsetY:sb,M5h:ec}}Ivl(Da,sb){if(1===Da)return this.PXa-1;Da=Math.abs(sb);return 0<Da?Da/(this.Aab+2):0}$Tf(Da){for(let sb=0;sb<this.PXa;sb++)this.a2[sb].$Tf(Da)}qPh(){return this.Ql?
3:4}static ddb(){return String.format("{0}-{1}","presencetooltip",Eg.npc++)}static dhf(Da){return Da.Ib.rawEvent.relatedTarget}}Eg.npc=0;Object(l.a)(Eg,"ModernPresenceTooltipControl",qd,[1052,9]);var Wh=d(204),Bf=d(233);class vf{constructor(Da){this.Md=Da;this.Md.lJa(10,Wh.a.instance);this.Md.lJa(9,Yd.a.instance);this.Md.lJa(6,20);this.Md.lJa(13,Bf.a.instance);this.Md.lJa(17,!1)}w_e(Da,sb=!1){this.Md.lJa(15,sb);return new Eg(Da,20,this.Md)}}Object(l.a)(vf,"ModernPresenceTooltipFactory",null,[1051]);
class Fj extends qd{constructor(Da,sb){super(Da);this.Vp=null;this.AIa=sb.get(8,!1);this.A6a=sb.get(6,0);this.element=Da;this.element.className=Fj.b$e;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.ig=sb.get(10);this.ig.mb(pb.a.click,this.element,Object(e.a)(this,this.onClick,"onClick"));this.Gr=sb.get(9);this.Gr.mb(pb.a.pointerOut,this.element,Object(e.a)(this,this.gO,"onPointerOut"));this.Gr.mb(pb.a.pointerDown,this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior"));
this.GD=sb.get(13);this.GD.mb(this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior"))}ivb(Da){this.addHandler(re.DT,Da)}uIb(Da){this.removeHandler(re.DT,Da)}get users(){return this.Vp}dispose(){this.element&&(this.ig.sc(pb.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.Gr.sc(pb.a.pointerDown,this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior")),this.Gr.sc(pb.a.pointerOut,this.element,Object(e.a)(this,this.gO,"onPointerOut")),
this.GD.sc(this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Da,sb,ec){this.hide();!Da||0>=Da.length||(this.AIa?this.element.style.right=sb+"px":this.element.style.left=sb+"px",this.element.style.top=ec+"px",this.Y5j(Da),this.visible=!0)}Y5j(Da){this.Vp=Da;Ad.a.nA(this._ul);for(let sb=Da.length-1;0<=sb;sb--)this.gda(Da[sb])}gda(Da){const sb=document.createElement("li");sb.style.backgroundColor=Da.color;sb.style.height=
this.A6a+"px";sb.id="fly_"+Da.clientId;sb.style.lineHeight=this.A6a+"px";Ad.a.iy(sb,Da.userName);sb.setAttribute("dir","auto");this._ul.appendChild(sb)}onClick(){this.hide();return!1}gO(Da){this.raiseEvent(re.DT,new re(3,Da));return!1}}Fj.b$e="prFlyout UIFont";Object(l.a)(Fj,"PresenceTooltipFlyoutControl",qd,[]);class Pe extends qd{constructor(Da,sb,ec){super(Da);this._img=null;this.Vp=[];this.element.className="prGlyph";this.Md=sb;this.zTb=this.Md.get(9);this.mq=this.Md.get(10);this.GD=this.Md.get(13);
this.OYl();this.gda(ec);this.nue=!1}get P0a(){return this.Vp.length}get users(){return this.Vp}ivb(Da){this.addHandler(re.DT,Da)}uIb(Da){this.removeHandler(re.DT,Da)}dispose(){this.reo();super.dispose()}gda(Da){Array.add(this.Vp,Da);2===this.P0a?this.uha(!0):1===this.P0a?this.uha(!1):this.uha(this.nue)}Z1a(Da){this.S8k(Da)&&(1<this.P0a&&this.uha(!0),1===this.P0a?this.uha(!1):1>this.P0a&&this.hide())}show(){this.uha(2<=this.P0a);this.visible=!0}hide(){this.visible=!1}rvl(Da){return Da?this.XNh(0,5):
this.XNh(1,4)}S8k(Da){for(let sb=0;sb<this.P0a;sb++)if(this.Vp[sb].clientId===Da)return Da=this.Vp[sb],Array.removeAt(this.Vp,sb),Da;return null}uha(Da){this.nue!==Da&&(this._img&&this.element.removeChild(this._img),this._img=this.rvl(Da),this.element.appendChild(this._img),this.nue=Da);this._img.childNodes[0].style.backgroundColor=this.Vp[this.Vp.length-1].color}XNh(Da,sb){const ec=this.Md.get(6,0),Jc=this.Md.get(14);return Ig.createClusteredImageFromClusterWithImageClass(ec,ec,this.Md.get(Da),this.Md.get(sb),
"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Jc?Jc.cloneNode(!0):null)}vX(Da){3!==Da.gg&&this.raiseEvent(re.DT,new re(2,Da));return!1}onClick(Da){this.raiseEvent(re.DT,new re(1,Da));return!0}gO(Da){3!==Da.gg&&this.raiseEvent(re.DT,new re(3,Da));return!1}reo(){this.element&&(this.zTb.sc(pb.a.pointerDown,this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior")),this.zTb.sc(pb.a.pointerOver,this.element,Object(e.a)(this,this.vX,"onPointerOver")),this.zTb.sc(pb.a.pointerOut,
this.element,Object(e.a)(this,this.gO,"onPointerOut")),this.mq.sc(pb.a.VC,this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior")),this.mq.sc(pb.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.GD.sc(this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior")))}OYl(){this.element&&(this.zTb.mb(pb.a.pointerDown,this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior")),this.zTb.mb(pb.a.pointerOver,this.element,
Object(e.a)(this,this.vX,"onPointerOver")),this.zTb.mb(pb.a.pointerOut,this.element,Object(e.a)(this,this.gO,"onPointerOut")),this.mq.mb(pb.a.VC,this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior")),this.mq.mb(pb.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.GD.mb(this.element,Object(e.a)(this,this.Wga,"stopPropagationAndPreventDefaultBehavior")))}}Object(l.a)(Pe,"PresenceTooltipGlyph",qd,[]);class sf extends qd{constructor(Da,sb,ec){super(Da);this.Vp=
[];this.GJ=[];this.VHa=0;this.Mvc=this.BQb=!1;this.$tg=null;this.hcd={};this.Md=ec;this.Ql=ec.get(8,!1);this.Aia=ec.get(11,!1);Da=ec.get(12,0);this.imageDimension=ec.get(6,0);this.S9a=sb;this.element.id=sf.ddb();this.element.className=qd.bvh(this.Ql);Da&&(this.zIndex=Da);this.rtl=this.Ql;this.JXf(sb);this.vxa=this.createElement("div");this.vxa.className=this.Aia?"prContainerV":"prContainerHr";this.element.appendChild(this.vxa);this.YEg=Array(this.VHa);for(sb=0;sb<this.VHa;sb++)this.c$[sb]=new Fj(this.createElement("div"),
this.Md),this.c$[sb].ivb(Object(e.a)(this,this.SNa,"onInteractivityChanged")),this.element.appendChild(this.c$[sb].element)}get q0d(){return H.a.clone(this.Vp)}get c$(){return this.YEg}get b7g(){return this.$tg}get w9d(){return this.imageDimension+2}get width(){return this.Aia?this.w9d:this.S9a}get height(){return this.Aia?this.S9a:this.w9d}ivb(Da){this.addHandler(re.DT,Da)}uIb(Da){this.removeHandler(re.DT,Da)}dispose(){if(this.c$)for(const Da of this.c$)Da.uIb(Object(e.a)(this,this.SNa,"onInteractivityChanged")),
Ed.a.VA(Da);Ed.a.GVf(this.GJ);this.GJ=this.YEg=null;super.dispose()}Qec(){this.mZa();this.w0f();this.visible=!0;this.BQb=!1}B0c(){!this.GJ||1>this.GJ.length||(this.mZa(),this.visible=!0,this.w0f(),this.g0d(this.GJ[this.GJ.length-1]),this.BQb=!0)}h0f(){if(this.GJ&&!(1>this.GJ.length)){this.visible=!0;this.w0f();var Da=0;for(const sb of this.GJ)this.g0d(sb,Da++);this.BQb=!1;this.Mvc=!0}}hide(){this.visible=!1;this.mZa();for(let Da=0;Da<this.GJ.length;Da++)this.GJ[Da].hide();this.BQb=!1}Nlh(){if(!this.Mvc)return!1;
let Da=0;for(const sb of this.c$)sb.visible&&Da++;return this.Mvc=0<Da&&(this.Vp.length<=this.VHa?Da===this.Vp.length:Da===this.VHa)}gda(Da){if(!(0>=this.VHa)){Da.clientId||(Da.clientId=(sf.npc++).toString());if(Da.clientId in this.hcd){var sb=this.jzb(Da.clientId);if(0<=sb){sb=this.Vp[sb];if(sb.color===Da.color&&sb.userName===Da.userName)return;this.Z1a(Da.clientId)}}sb=this.Nlh();var ec=0;if(this.Vp.length<this.VHa){var Jc=new Pe(this.createElement("div"),this.Md,Da);Jc.ivb(Object(e.a)(this,this.SNa,
"onInteractivityChanged"));this.Ql&&!this.Aia&&0<this.Vp.length?this.vxa.insertBefore(Jc.element,this.vxa.firstChild):(this.vxa.appendChild(Jc.element),ec=this.GJ.length);Array.add(this.GJ,Jc)}else this.Ql&&!this.Aia?Jc=this.GJ[0]:(ec=this.GJ.length-1,Jc=this.GJ[ec]),Jc.gda(Da);Jc.show();this.hcd[Da.clientId]=Jc;Array.add(this.Vp,Da);this.Wgj(Jc,ec);sb&&this.h0f()}}Z1a(Da){const sb=this.Nlh();sb&&this.mZa();this.WXc(Da);this.Vp.length>=this.VHa&&this.GJ.length<this.VHa&&this.Jgn();0>=this.Vp.length?
this.hide():sb&&this.h0f()}xsi(){}WXc(Da){var sb=this.jzb(Da);0>sb||(Da=this.Vp[sb],Array.removeAt(this.Vp,sb),sb=this.hcd[Da.clientId],delete this.hcd[Da.clientId],sb.Z1a(Da.clientId),this.Wgj(sb),0>=sb.P0a&&(this.vxa.removeChild(sb.element),Array.remove(this.GJ,sb),sb.dispose()))}Jgn(){var Da=this.cCl();!Da||1>=Da.users.length||(Da=Array.clone(this.Vp),Da.forEach(sb=>{this.WXc(sb.clientId)}),Da.forEach(sb=>{this.gda(sb)}))}jzb(Da){for(let sb=0;sb<this.Vp.length;sb++)if(this.Vp[sb].clientId===Da)return sb;
return-1}cCl(){return this.Ql&&!this.Aia?this.GJ[0]:this.GJ[this.GJ.length-1]}position(Da,sb){this.element.style.top=sb+"px";this.element.style.left=Da+"px"}w0f(){for(let Da=0;Da<this.GJ.length;Da++)this.GJ[Da].show()}mZa(){for(let Da=0;Da<this.VHa;Da++)this.c$[Da].hide();this.Mvc=!1}g0d(Da,sb=0){if(Da)if(this.$tg=Da,this.Aia){const ec=this.imageDimension;if(1<Da.users.length)this.c$[sb].show(Da.users,ec,this.height-this.imageDimension);else{const Jc=this.vxa.children.length;for(let jd=0;jd<this.vxa.children.length;jd++)Da.element===
this.vxa.children[jd]&&this.c$[sb].show(Da.users,ec,this.height-(Jc-jd)*this.w9d+2)}}else this.c$[sb].show(Da.users,this.width,0)}SNa(Da,sb){var ec=Object(v.a)(Pe,Da);ec=ec?this.BHh(ec):-1;if(2===sb.type||1===sb.type&&-1!==ec&&!this.c$[ec].visible)this.g0d(Da);else if(1===sb.type)this.mZa(),this.BQb=!1;else if(3===sb.type){if(this.K7e(sb.Fn))return;this.BQb||this.mZa()}this.raiseEvent(re.DT,sb)}K7e(Da){Da=sf.dhf(Da);let sb=!1;for(const ec of this.c$)if(Ad.a.sMa(ec.element,Da)){sb=!0;break}return this.vxa!==
Da&&Ad.a.sMa(this.vxa,Da)||sb}Wgj(Da,sb=0){const ec=this.T8l(Da);ec&&0>=Da.P0a?this.c$[sb].hide():ec?this.g0d(Da):this.c$[sb].hide()}BHh(Da){let sb=0;for(const ec of this.GJ){if(Da===ec)return sb;sb++}return-1}T8l(Da){const sb=this.BHh(Da);return!!this.b7g&&Da===this.b7g&&-1!==sb&&this.c$[sb].visible}JXf(Da){this.VHa=Da===this.imageDimension?1:Math.floor(Da/this.w9d);this.Aia?(this.element.style.height=Da+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=Da+"px",this.element.style.height=
this.imageDimension+"px")}static ddb(){return String.format("{0}-{1}","presencetooltip",sf.npc++)}static dhf(Da){Da=Da.Ib.rawEvent;return Da.relatedTarget||Da.toElement}}sf.npc=0;Object(l.a)(sf,"PresenceTooltipControl",qd,[1052,9]);class Xf{constructor(Da){this.Md=Da;this.Md.lJa(10,Wh.a.instance);this.Md.lJa(9,Yd.a.instance);this.Md.lJa(6,16);this.Md.lJa(13,Bf.a.instance)}w_e(Da){return new sf(Da,16,this.Md)}}Object(l.a)(Xf,"PresenceTooltipFactory",null,[1051]);var Se=d(263),$f=d(100),Jg=d(58),fg=
d(5),Lg=d(6),Af=d(21),Jh=d(89),Vi=d(570),Ze=d(307),sd=d(120);class fh extends Sys.EventArgs{constructor(Da,sb){super();this.paragraphId=Da;this.$qm=sb}}Object(l.a)(fh,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class vh extends qd{constructor(Da,sb,ec,Jc,jd,Ud=null,ve=null){super(null);this.Ybd=this.Lm=null;this.GQc=!1;this.soa=0;this.Zo=Da;this.Kwc=sb;this.Gr=ec;this.Ki=Jc;this.fGa=jd;vh.Ppb=0;this.pbh=new Fa.a;this.$Ri=new Fa.a;this.zV=Ud;this.Oa=ve;this.WDj=this.Oa.rc("PresenceIpRenderedFloodgateTimeLapseSec",
30);this.yYj=this.Oa.rc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.fpa=0}get E0a(){return u.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}H6j(Da){this.addHandler("CR",Da)}MOi(Da){this.removeHandler("CR",Da)}C2d(){this.raiseEvent("CR",new fh(this.Zo.ip.paragraphId,this.GQc))}MAf(){if(Object(sd.a)(Eg,this.Lm)){const Da=Object(v.a)(Eg,this.Lm);vh.Ppb=0<vh.Ppb?vh.Ppb+1:Da.XWa+1;Da.zIndex=vh.Ppb;this.element.style.zIndex=String(vh.Ppb)}}Nwn(){if(Object(sd.a)(Eg,this.Lm)){const Da=
Object(v.a)(Eg,this.Lm);vh.Ppb=Da.XWa;Da.zIndex=Da.XWa;this.element.style.zIndex=String(Da.XWa)}}nni(){this.zV&&!this.Xao()&&this.zV.continueWith(()=>{this.zV.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.WDj)&&this.fpa++})}Xao(){return this.fpa>=this.yYj}static Dmi(){vh.KEg||(vh.KEg=!0,k.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static ddb(Da){return vh.a_l+Da.KRh()}}vh.hGi="data-presence-control";vh.lCi="OverlayControlElementOwner";
vh.a_l="ipId_";vh.iGi="WacPresence";vh.w0m="PresenceIpPaddingDiv";vh.KEg=!1;vh.Ppb=0;Object(l.a)(vh,"APresenceControl",qd,[1324,9]);class am{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.R2a=!1}}Object(l.a)(am,"PresenceImageControlStyle",null,[1322]);class aj extends vh{constructor(Da,sb,ec,Jc,jd,Ud=null,ve=null){super(Da,sb,ec,Jc,jd,Ud,ve);this.gO=()=>{this.Eri();return!1};this.KYd=bf=>{this.Lm&&3===bf.gg&&(2!==this.soa?(this.MAf(),this.DKb()):this.Eri());return!1}}Z1a(Da){this.Lm&&
this.Lm.Z1a(Da)}yde(){return this.Lm?this.Lm.q0d.length:0}updatePosition(Da){if(this.element&&this.element.parentNode){var sb=this.mSh(Da);if(sb){var ec=Sys.UI.DomElement.getBounds(this.element.parentNode),Jc,jd;({left:ec,top:Jc,height:jd,width:sb}=this.AEl(sb,ec,this.element.parentNode,this.Ki.instance));this.element.style.top=Jc+"px";this.element.style.left=ec+"px";this.element.style.height=jd+"px";this.element.style.width=sb+"px";ec=this.sSh(Da);Ic.a.JX(this.element,ec);Da=this.Lef(Da,this.Zo.ip.shapeId);
this.E0i(ec,sb,this.isSelected(Da),u.AFrameworkApplication.isRtl);this.DKb()}}}RA(){this.element&&(Ad.a.gv(this.element),this.Lm.Z1a(this.Zo.user.clientId),this.C2d())}Tph(Da,sb,ec,Jc){sb=new am;if(!Jc||!ec)return sb;ec=this.mSh(Da);if(!ec)return sb;sb.top=ec.y;sb.left=ec.x;sb.height=ec.height;sb.width=ec.width;sb.rotation=this.eHl(Da);sb.R2a=!0;return sb}BPi(Da,sb,ec,Jc){vh.Dmi();this.Ybd=Da;if(Jc){const jd=this.Lef(Da,this.Zo.ip.shapeId);if(!jd)return;const Ud=!this.element;Ud&&this.z_e(sb.ownerDocument,
Da);Ud||!this.element.parentNode?jd.appendChild(this.element):this.element.parentNode!==jd&&(this.element.parentNode.removeChild(this.element),jd.appendChild(this.element));this.Lm.gda(this.Zo.user);this.element.style.borderColor=this.Zo.user.color;this.element.id=vh.ddb(this.Zo);ec.R2a&&(this.element.style.height=ec.height+"px",this.element.style.top=ec.top+"px",this.element.style.left=ec.left+"px",this.element.style.width=ec.width+"px",Ic.a.JX(this.element,ec.rotation),Ic.a.JX(this.Lm.element,-1*
ec.rotation),this.E0i(ec.rotation,ec.width,this.isSelected(jd),u.AFrameworkApplication.isRtl),this.DKb())}this.GQc=!Jc;this.C2d()}eHl(Da){return this.element&&this.element.parentNode&&this.lYh(Ic.a.getTransform(this.element.parentNode))?this.lYh(Ic.a.getTransform(this.element)):this.sSh(Da)}lYh(Da){return Da&&-1<Da.indexOf("deg")&&(Da=parseInt(Da.substring(Da.indexOf("(")+1,Da.indexOf("deg"))),!isNaN(Da))?Da:0}wgj(Da){this.element.style.borderColor=this.Zo.user.color;this.element.id=vh.ddb(this.Zo);
this.updatePosition(Da)}z_e(Da,sb){this.element=Da.createElement("div");this.element.setAttribute(vh.hGi,!0);$f.a.Il(this.element,vh.lCi,this);this.element.className=aj.Z7m;u.AFrameworkApplication.K&&u.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoopsCoAuthSelectionIssueFixIsEnable",!1)&&(Da=sb.zb)&&Da.yP&&(this.element.style.pointerEvents="none");this.element.dir=u.AFrameworkApplication.isRtl?"rtl":"ltr";this.Lm=this.Kwc.w_e(this.createElement("div"),!0);this.Lm.gda(this.Zo.user);
this.Lm.hide();this.Gr.mb(pb.a.pointerOut,this.Lm.element,this.gO);this.Gr.mb(pb.a.pointerDown,this.Lm.element,this.KYd);this.Lm.element.classList.add(vh.iGi);this.element.appendChild(this.Lm.element)}AEl(Da,sb,ec,Jc){let jd=Da.y,Ud=Da.x,ve=Da.height;Da=Da.width;(1<Math.abs(sb.width-ec.offsetWidth)||1<Math.abs(sb.height-ec.offsetHeight))&&Jc&&(jd=Math.round(jd/Jc.vj),Ud=Math.round(Ud/Jc.vj),ve=Math.round(ve/Jc.vj),Da=Math.round(Da/Jc.vj));return{left:Ud,top:jd,height:ve,width:Da}}isSelected(Da){return Da.classList.contains(Ze.a.R_b)}E0i(Da,
sb,ec,Jc){this.Lm.element.style.left="auto";this.Lm.element.style.top="auto";this.Lm.element.style.right="auto";this.Lm.element.style.bottom="auto";ec=ec?Math.round(.5*aj.roa)+aj.b$n:0;0<=Da&&90>Da||360===Da?(this.Lm.element.style.top=-.5*aj.roa-ec+"px",Jc?this.Lm.element.style.right=sb-.5*aj.roa+"px":this.Lm.element.style.left=sb-.5*aj.roa+"px"):90<=Da&&180>Da?(this.Lm.element.style.left=-.5*aj.roa-ec+"px",Jc?this.Lm.element.style.bottom=-.5*aj.roa+"px":this.Lm.element.style.top=-.5*aj.roa+"px"):
180<=Da&&270>Da?(this.Lm.element.style.bottom=-.5*aj.roa-ec+"px",Jc?this.Lm.element.style.left=sb-.5*aj.roa+"px":this.Lm.element.style.right=sb-.5*aj.roa+"px"):(this.Lm.element.style.right=-.5*aj.roa-ec+"px",Jc?this.Lm.element.style.top=-.5*aj.roa+"px":this.Lm.element.style.bottom=-.5*aj.roa+"px")}$h(Da,sb){const ec=this.aGd(Da,sb);return ec?ec.properties:(Da=this.rSh(Da,sb))?Da.properties:null}Lef(Da,sb){var ec=this.aGd(Da,sb);return ec&&(ec=ec.HYa(Da.Ig))?ec.element:(sb=this.rSh(Da,sb))?Object(v.a)(Vi.a,
sb).Ce(Da.Tb).htmlElement:null}aGd(Da,sb){Da=Jh.i(Da.zb,5);for(const ec of Da)if(ec.properties.getValue(fg.a.Ayb)===sb)return ec;return null}rSh(Da,sb){Da=Lg.GraphIterator.$a(Da.zb);let ec=Da.Rb(6);for(;ec;){const Jc=ec.properties.getValue(fg.a.Ayb);if(Af.ImageReader.ww(ec)&&Jc===sb)return ec;ec=Da.vf(6)}return null}fvl(Da){const sb=Jg.a.yf(Af.ImageReader.tA(Da),0);Da=Jg.a.yf(Af.ImageReader.JB(Da),1);return{Bha:sb,LXl:Da}}sSh(Da){Da=this.$h(Da,this.Zo.ip.shapeId);return Af.ImageReader.vZ(Da)}mSh(Da){var sb=
this.Zo.ip;if(!sb||!sb.shapeId)return null;var ec=this.$h(Da,sb.shapeId);const Jc=this.Lef(Da,sb.shapeId);if(!ec||!Jc)return null;const jd=Af.ImageReader.ul(ec);let Ud=Da=1,ve;({Bha:sb,LXl:ve}=this.fvl(ec));Sa.App.instance&&Sa.App.instance.Ita(jd)?(ec=Af.ImageReader.ila(ec),Da=Jg.a.yf(ec[0],0),Ud=Jg.a.yf(ec[2],1)):ec.hasProperty(fg.a.f3)?(ec=ec.getValue(fg.a.f3),Da+=Jg.a.yf(ec[0],0),Ud+=Jg.a.yf(ec[2],1)):(Da+=0<Jc.offsetWidth?(Jc.offsetWidth-sb)/2:2,Ud+=0<Jc.offsetHeight?(Jc.offsetHeight-ve)/2:2);
return new Sys.UI.Bounds(Math.round(Da),Math.round(Ud),Math.round(sb),Math.round(ve))}Eri(){this.Lm&&(this.Lm.Qec(),this.soa=1)}DKb(){for(const Da of this.Lm.q0d)if(Da.clientId===this.Zo.user.clientId&&!Da.equals(this.Zo.user)){this.Lm.gda(this.Zo.user);break}if(this.Zo.LPa||2===this.soa)this.Lm.B0c(),this.Zo.LPa=!1,this.Zo.aaa=!0,this.soa=2;this.Zo.aaa&&1!==this.soa||(this.Lm.Qec(),this.Zo.aaa=!0,this.soa=1)}}aj.Z7m="WACImgPresenceHighlight";aj.roa=20;aj.b$n=6;Object(l.a)(aj,"PresenceImageControl",
vh,[]);var nk=d(293);class sk{constructor(){this.height=this.top=this.left=this.K$h=0;this.R2a=!1;this.MA=this.rh=null}}Object(l.a)(sk,"PresenceIpControlStyle",null,[1322]);var De=d(78);class Ai extends vh{constructor(Da,sb,ec,Jc,jd,Ud=null,ve=null,bf=null){super(Da,sb,ec,Jc,jd,Ud,ve);this.Tvc=this.GSa=this.YUb=null;this.vX=$e=>{!this.Lm||this.E0a&&!this.Lm.K7e($e)||(this.MAf(),this.y5d($e));this.wgj(this.Ybd);return!1};this.gO=()=>{this.Lm&&this.fQ();return!1};this.KYd=$e=>{this.Lm&&3===$e.gg&&(2!==
this.soa?(this.MAf(),this.y5d($e)):this.fQ());return!1};this.xC=bf}z_e(Da){this.element=Da.createElement("div");this.element.setAttribute(vh.hGi,!0);$f.a.Il(this.element,vh.lCi,this);this.element.className=vh.w0m;this.element.dir=u.AFrameworkApplication.isRtl?"rtl":"ltr";this.Gr.mb(pb.a.pointerOver,this.element,this.vX);this.E0a&&(this.Gr.mb(pb.a.pointerOut,this.element,this.gO),this.Gr.mb(pb.a.pointerDown,this.element,this.KYd));this.GSa=this.createElement("div");this.GSa.className=Ai.$7m;this.E0a||
(this.Tvc=this.createElement("div"),this.Tvc.className=Ai.c8m,this.GSa.appendChild(this.Tvc));this.Lm=this.Kwc.w_e(this.createElement("div"),this.E0a);Da=this.Oa.$("NoPresenceUserLookUpBeforeRender");this.xC&&!Da&&(this.Zo.user=this.xC.coi(this.Zo.user.clientId)||this.Zo.user);this.Lm.gda(this.Zo.user);this.Lm.hide();this.Lm.element.classList.add(this.E0a?vh.iGi:Ai.I3m);this.GSa.appendChild(this.Lm.element);this.element.appendChild(this.GSa)}OSk(){this.YUb&&(zb.a.instance.We(this.YUb),this.YUb=null)}DKb(Da){for(var sb of this.Lm.q0d)if(sb.clientId===
this.Zo.user.clientId&&!sb.equals(this.Zo.user)){this.Lm.gda(this.Zo.user);break}sb=!1;Ai.SQk===this.Zo.user.color?({value:sb}=this.pbh.Dc(this.Zo.user.clientId,!1),sb||(this.pbh.Z(this.Zo.user.clientId,!0),k.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.Zo.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:sb}=this.$Ri.Dc(this.Zo.user.clientId,!1),sb||(this.$Ri.Z(this.Zo.user.clientId,!0),k.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.Zo.user.clientId+'" , "Event" : "RenderColoredPawn"}')));
return Da||this.Zo.LPa||2===this.soa?(this.nni(),this.Lm.B0c(),this.Zo.LPa=!1,this.Zo.aaa=!0,this.soa=2,Ai.P8n):this.Zo.aaa&&1!==this.soa?0:(this.nni(),this.Lm.Qec(),this.Zo.aaa=!0,this.soa=1,Ai.O8n)}y5d(Da=null){this.OSk();const sb=this.DKb(!!Da);this.E0a&&Da&&Da.eventName===pb.a.pointerOver||this.FCn(sb)}fQ(){this.Lm&&this.soa&&(this.Nwn(),this.Lm.hide(),this.soa=0)}FCn(Da){this.YUb=new Ca.a(2,1,Da,()=>{this.YUb=null;this.fQ()},56);zb.a.instance.$b(this.YUb)}updatePosition(Da){if(this.element&&
this.element.parentNode){var sb=this.WSh(Da);if(sb){Da=Sys.UI.DomElement.getBounds(this.element.parentNode);sb=new Sys.UI.Bounds(sb.x-Da.x,sb.y-Da.y,Ai.N$h,sb.height);var ec;({left:Da,top:sb,height:ec}=this.DEl(sb,Da,this.element.parentNode,this.Ki.instance));this.element.style.height=2*Ai.sac+ec+"px";this.element.style.top=sb-Ai.sac+"px";this.element.style.left=Da-Ai.sac+"px";this.GSa.style.height=Math.max(Ai.sri,ec)+"px";this.y5d()}}}RA(){this.element&&(Ad.a.gv(this.element),this.C2d())}Tph(Da,
sb,ec,Jc,jd){const Ud=new sk;if(!Jc||!ec)return Ud;Jc=this.WSh(Da);if(!Jc)return Ud;var ve=ec;ec=Da;if(Da.Uj){var bf=Da.fc;ve=Da.zg.H3b(this.Zo.ip.d7.cp);0>ve&&0==ve;Da.fc.Dta?Ad.a.sMa(bf.editingElement,Da.zg.Ii.J(ve))||(ec=Da.source.Ni(De.InteractiveViewManager.instance.xd.Tb),sb=ec.zg.Ii.J(ve)):sb=ec.zg.Ii.J(ve);ve=sb.getBoundingClientRect()}ve=new Sys.UI.Bounds(Jc.x-ve.x,Jc.y-ve.y,Ai.N$h,Jc.height);Da=ve.y;Jc=ve.x;ve=ve.height;bf=this.Ki.instance;jd&&bf&&(jd=bf.vj,Da=Math.round(Da/jd),Jc=Math.round(Jc/
jd),ve=Math.round(ve/jd));Ud.top=Da-Ai.sac;Ud.left=Jc-Ai.sac;Ud.height=2*Ai.sac+ve;Ud.K$h=Math.max(Ai.sri,ve);Ud.R2a=!0;Ud.rh=sb;Ud.MA=ec;return Ud}BPi(Da,sb,ec,Jc){vh.Dmi();this.Ybd=Da;Da=ec.rh;sb=ec.MA;if(Da&&sb){if(Jc){const jd=!this.element;jd&&this.z_e(Da.ownerDocument);jd||!this.element.parentNode?Da.appendChild(this.element):this.element.parentNode!==Da&&(this.element.parentNode.removeChild(this.element),Da.appendChild(this.element));this.Ybd=sb;Da=this.Zo.user.color;this.GSa.style.borderColor=
Da;this.E0a||(this.Tvc.style.borderColor=Da);this.element.id=vh.ddb(this.Zo);ec.R2a&&(this.element.style.height=ec.height+"px",this.element.style.top=ec.top+"px",this.element.style.left=ec.left+"px",this.GSa.style.height=ec.K$h+"px",this.y5d())}this.GQc=!Jc;this.C2d()}else k.ULS.sendTraceTag(520950942,302,50,`Skip IpControl rendering due to paragraphElement is null:${!Da} or paragraphViewElement is null:${!sb}`)}dispose(){this.element&&(this.RA(),this.Gr.sc(pb.a.pointerOver,this.element,this.vX),
this.E0a&&(this.Gr.sc(pb.a.pointerOut,this.element,this.gO),this.Gr.sc(pb.a.pointerDown,this.element,this.KYd)),Ed.a.VA(this.Lm),this.element=this.Lm=null);super.dispose()}wgj(Da){const sb=this.Zo.user.color;this.GSa.style.borderColor=sb;this.E0a||(this.Tvc.style.borderColor=sb);this.element.id=vh.ddb(this.Zo);this.updatePosition(Da)}DEl(Da,sb,ec,Jc){let jd=Da.y,Ud=Da.x;Da=Da.height;(1<Math.abs(sb.width-ec.offsetWidth)||1<Math.abs(sb.height-ec.offsetHeight))&&Jc&&(jd=Math.round(jd/Jc.vj),Ud=Math.round(Ud/
Jc.vj),Da=Math.round(Da/Jc.vj));return{left:Ud,top:jd,height:Da}}WSh(Da){const sb=this.Zo.ip;if(!sb)return null;let ec;try{const Jc=sb.d7.cp;ec=nk.a.aZ(Jc,Da,0<Jc,!1,!1,!1)}catch(Jc){k.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",zb.a.instance.Mv,Jc.message,Jc.stack),ec=null}return ec}}Ai.I3m="WacPawn";Ai.N$h=2;Ai.O8n=7E3;Ai.P8n=2E3;Ai.sac=5;Ai.$7m="presenceIp";Ai.c8m="PresenceSmallBox";Ai.sri=10;Ai.SQk="0xcccccc";Object(l.a)(Ai,"PresenceIpControl",
vh,[]);class Mk{constructor(Da,sb,ec,Jc,jd=null,Ud=null,ve=null){this.Alc={};this.ylc={};this.byg={};this.Kwc=Da;this.Gr=sb;this.Mm=ec;this.fGa=Jc;this.zV=jd;this.Oa=Ud;this.xC=ve}get zPk(){return this.Alc}get qwh(){return this.ylc}zEl(Da){const sb=!!this.Oa&&this.Oa.$("PeoplesWellExtraButtonInfoIsEnabled");return Da.ip.shapeId&&sb?this.EEl(Da):this.FEl(Da)}EEl(Da){const sb=Da.ip.shapeId.toString();this.byg[Da.user.clientId]=sb;const ec=this.ylc[sb];return ec?(ec.Zo=Da,{returnValue:ec,wde:!0}):{returnValue:this.ylc[sb]=
new aj(Da,this.Kwc,this.Gr,this.Mm,this.fGa,this.zV,this.Oa),wde:!1}}FEl(Da){const sb=Da.user.clientId,ec=this.Alc[sb];return ec&&ec.Zo.user.equals(Da.user)?(ec.Zo=Da,{returnValue:ec,wde:!0}):{returnValue:this.Alc[sb]=new Ai(Da,this.Kwc,this.Gr,this.Mm,this.fGa,this.zV,this.Oa,this.xC),wde:!1}}XSh(Da){return this.Alc[Da]}avl(Da){return(Da=this.ylc[this.byg[Da]])&&!Da.yde()?Da:null}XXk(){var Da=this.Alc;for(const sb in Da)Da[sb].dispose();Da=this.ylc;for(const sb in Da)Da[sb].dispose()}}Object(l.a)(Mk,
"PresenceControlProvider",null,[]);var pl=d(157);class Og{constructor(){this.N8a=0}PUh(){this.N8a++;this.N8a===Number.MAX_VALUE&&(this.N8a=1);return this.N8a}static get instance(){return Og.Xsc}}Og.Xsc=new Og;Object(l.a)(Og,"PacketIdGenerator",null,[298]);var Rk=d(1065);class xf{constructor(Da,sb,ec){this.TCn=Da;this.u0l=sb;this.Yji=ec}}Object(l.a)(xf,"SuccessfulInboundReplicationCallbackData",null,[]);class Ql{constructor(Da,sb,ec,Jc,jd,Ud,ve){this.wAn=(bf,$e)=>{$e.type||(bf=this.Zj.vCh>=this.lCj,
this.RXj&&bf?(bf=this.Pqe())?bf.nEh():k.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.lE())};this.QXm=bf=>{if(bf=Object(v.a)(xf,bf)){var $e=bf.u0l.oi.toString(),cf=this.Pqe(),oi=cf.eu,Dc="";oi!==bf.Yji&&(k.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",bf.TCn.toString()),Dc=this.iAl(cf,oi,bf.Yji));k.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",
Dc,$e)}else k.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.oAn=Da;this.Pqe=sb;this.Zj=ec;this.RXj=jd;this.lCj=Ud;this.JRb=Jc;this.iq=ve;this.oAn.p1(this.wAn)}lE(){const Da=this.Pqe();if(!Da)k.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.JRb()&&Da.dNa){let sb=-1;Object(sd.a)(Rk.a,Da)&&(sb=Da.Wj.TDa());const ec=this.iq.hg("Task","ShoulderTapInboundReplicationTimer");Da.lE(this.QXm,null,new xf(sb,
ec,Da.eu))}}iAl(Da,sb,ec){const Jc=new Sys.StringBuilder;Da=Da.node.zd.store.getRevision(sb);if(!Da)return k.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:sb}),"";for(Jc.append(Da.id.nr);sb!==ec;){Jc.append(", ");Jc.append(sb.nr);Da=Da.il;if(!Da)break;sb=Da.id}return Jc.toString()}}Object(l.a)(Ql,"ContentNotificationManager",null,[]);class yd extends Ql{constructor(Da,sb,ec,Jc,jd,Ud,ve){super(Da,sb,ec,Jc,jd,Ud,ve)}static get gPa(){return null!=
yd.Upg?yd.Upg:yd.Upg=qa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(Sa.App.xa){var Da=Sa.App.xa.jb;Da&&(Da.hda(yd.iTc),Da=Da.Yc)&&(yd.Uu=Da.contentReplicator,yd.Uu&&Sa.App.Cla().continueWith(yd.SFf))}}static SFf(){yd.c8c=Sa.App.Cla().result;yd.c8c&&yd.c8c.Mp&&yd.gPa.tI().continueWith(yd.UTc)}static UTc(){yd.jj=yd.gPa.tI().result;if(yd.jj){var Da=u.AFrameworkApplication.K,sb=Da.$("Box4ThrottleInboundRequests");Da=Da.rc("Box4ThrottleInboundsAtUserCount",20);yd.Uu.WHd=()=>
yd.jj.tNa;yd.$7c=yd.$7c||new yd(yd.jj,()=>yd.Uu,yd.c8c,()=>u.AFrameworkApplication.Mk,sb,Da,Sa.App.xa.jq);yd.$7c.lE()}}static iTc(Da){yd.$7c||(Da.Cjb(yd.iTc),yd.init())}}yd.$7c=null;yd.jj=null;yd.Uu=null;yd.c8c=null;Object(l.a)(yd,"WordContentNotificationManager",Ql,[]);class Zk{constructor(Da,sb,ec,Jc,jd,Ud){this.U8c=null;this.lWg=Da;this.qd=ec;this.YHa=Jc;this.aA=jd;this.sh=Ud;this.QMb=sb}clone(){return new Zk(this.lWg,this.QMb.clone(),this.qd,this.YHa,this.aA,this.sh)}get cp(){if(null!=this.U8c)return this.U8c;
var Da=this.lWg.paragraphId;if(Da.equals(Te.a.nil))return 0;var sb=this.YHa();if(!sb)return 0;Da=sb.Eb(Da);if(!Da)return k.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;sb=this.qd.kxb(this.qd.hOa(Da.characterData,Da.qa),this.QMb);if(this.aA&&this.sh&&Da.vw){const ec=lc.a.Uc(Da,sb);ec.Fb=this.sh.Mff(Da,sb,this.QMb.Hza);sb=this.aA.Kda(ec,!0)}return sb}UHf(){null==this.U8c&&(this.U8c=this.cp)}equals(Da){return Da?this.QMb.isEqual(Da.QMb,!1):!1}}Object(l.a)(Zk,
"WordPresenceCp",null,[728,92,729]);class Kl{constructor(Da,sb){this.aA=Da;this.sh=sb}create(Da,sb,ec,Jc){return new Zk(Da,sb,ec,Jc,this.aA,this.sh)}}Object(l.a)(Kl,"Factory",null,[698]);var tk=d(524);class $k extends Sys.EventArgs{constructor(Da,sb,ec){super();this.paragraphId=Da;this.presence=sb;this.$of=ec}}Object(l.a)($k,"ParagraphChangedEventArg",Sys.EventArgs,[]);class un{constructor(Da){this.cp=Da}equals(Da){return Da?this.cp===Da.cp:!1}clone(){return new un(this.cp)}}Object(l.a)(un,"PresenceCp",
null,[728,92]);class bm{constructor(Da,sb,ec,Jc,jd){this.paragraphId=Da;this.cp=sb;this.length=ec;this.shapeId=Jc;this.dryDeletion=jd}}Object(l.a)(bm,"SerializablePresenceIpData",null,[]);class yh{constructor(Da,sb,ec,Jc=0,jd=0){this.rqa=null;Da&&(this.rqa=Te.a.Of(Da));this.kWg=new un(sb);this.vDa=ec;this.R_g=Jc;this.wCg=jd}get paragraphId(){return this.rqa}get d7(){return this.kWg}get shapeId(){return this.R_g}get dryDeletion(){return this.wCg}Rd(){return 0<=this.d7.cp&&!!this.paragraphId&&!this.paragraphId.equals(Te.a.nil)}getData(){return new bm(this.paragraphId.toString(),
this.d7.cp,this.vDa,this.shapeId,this.dryDeletion)}clone(){const Da=new yh;Da.rqa=this.paragraphId;Da.kWg=this.d7?this.d7.clone():null;Da.vDa=this.vDa;Da.R_g=this.shapeId;Da.wCg=this.dryDeletion;return Da}static nxb(Da){return Da.paragraphId&&void 0!==Da.cp&&null!==Da.cp&&void 0!==Da.length&&null!==Da.length?new yh(Da.paragraphId,Da.cp,Da.length,void 0,Da.dryDeletion):null}}Object(l.a)(yh,"PresenceIp",null,[317,92]);class fn{constructor(Da,sb){this.ip=Da;this.user=sb}}Object(l.a)(fn,"SerializablePresenceData",
null,[]);class Sj{constructor(Da,sb){this.LPa=this.aaa=this.r9b=!1;this.FSa=sb;this.user=Da}get ip(){return this.FSa}Dhf(){return new fn(this.ip?this.ip.getData():null,this.user.getData())}KRh(){return this.user.clientId+(this.FSa?this.FSa.paragraphId.toString():Te.a.nil.toString())}Rd(){const Da=!!this.user&&this.user.Rd(),sb=!this.ip||this.ip.Rd();return Da&&sb}clone(){const Da=new Sj;Da.user=this.user?this.user.clone():null;Da.FSa=this.FSa?this.FSa.clone():null;Da.aaa=this.aaa;Da.r9b=this.r9b;
Da.LPa=this.LPa;return Da}static nxb(Da){return Da?new Sj(Ma.nxb(Da.user),Da.ip?yh.nxb(Da.ip):null):null}}Object(l.a)(Sj,"PresenceInfo",null,[293,92]);class qg extends bb.a{constructor(){super();this.itc={};this.lRa={};this.EEg=!1}get z1m(){return this.itc}get jfi(){return!!u.AFrameworkApplication.K&&u.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}S$g(Da){this.addHandler("PPC",Da)}pPi(Da){this.removeHandler("PPC",Da)}eJc(Da){return Da.ip.paragraphId.toString()}DOe(Da,sb=!1){this.EEg||
(this.EEg=!0,k.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var ec=({a8m:Jc}=this.Hmm(Da)).returnValue;if(Jc&&!sb)(ec=this.lRa[Da.user.clientId])&&0<=ec.length&&(ec[ec.length-1].ip.vDa=Da.ip.vDa);else{ec||this.iOi(Da.user.clientId);this.jfi&&ec&&this.ojo(Da);sb=this.eJc(Da);var Jc=Da.user.clientId;var jd=this.itc[sb]||[],Ud=this.lRa[Jc]||[];Ud.length>=qg.jqi&&(Ud=Ud.splice(-qg.uNm,qg.jqi));ec||jd.push(Jc);Ud.push(Da);this.itc[sb]=jd;this.lRa[Jc]=Ud;Da.ip.paragraphId.equals(Te.a.nil)||
this.KPf(Da.ip.paragraphId,Da,!0)}}Hmm(Da){var sb=this.lRa[Da.user.clientId];const ec=!sb||0>=sb.length?null:sb[sb.length-1],Jc=!!ec&&this.eJc(ec)===this.eJc(Da);sb=Jc&&ec.ip.d7.equals(Da.ip.d7)&&ec.user.equals(Da.user);this.jfi&&sb&&ec.ip.shapeId&&Da.ip.shapeId&&ec.ip.shapeId!==Da.ip.shapeId&&(sb=!1);return{returnValue:Jc,a8m:sb}}ojo(Da){const sb=this.LPk(Da);sb&&sb.ip.shapeId&&(Da.ip.shapeId&&Da.ip.shapeId===sb.ip.shapeId||this.KPf(sb.ip.paragraphId,sb,!1))}LPk(Da){Da=this.lRa[Da.user.clientId];
return!Da||0>=Da.length?null:Da[Da.length-1]}iOi(Da){const sb=this.lRa[Da];if(sb&&0<sb.length){const ec=sb[0].ip.paragraphId,Jc=this.eJc(sb[0]);delete this.lRa[Da];this.dqn(Jc,Da);ec.equals(Te.a.nil)||this.KPf(ec,sb[0],!1)}}QNh(Da){return this.itc[Da]}iHc(Da,sb,ec,Jc=!1){const jd=[],Ud=this.QNh(Da);if(!Ud)return jd;for(let ve=0;ve<Ud.length;ve++){const bf=Ud[ve],$e=this.lRa[bf];let cf=!1;for(let oi=$e.length-1;0<=oi;oi--){const Dc=$e[oi];if(Jc){if(Dc.aaa&&Dc.ip.paragraphId.equals(Te.a.Of(Da))){cf=
!0;jd.push(Dc);break}}else if(Object(sd.a)(Sj,Dc)?Dc.ip.vDa===sb:Dc.ip.vDa===ec){cf=!0;Dc.r9b=!0;jd.push(Dc);this.lRa[bf]=$e.splice(oi,$e.length);break}}!cf&&0<$e.length&&$e[0].r9b&&$e[0].ip.paragraphId.equals(Te.a.Of(Da))&&jd.push($e[0])}return jd}Ghl(Da){if(!Da||!Da.Qa||!Da.Qa.node)return null;Da=this.iHc(Da.Qa.node.id.toString(),0,0,!0);Da=this.AOl(Da);Da.sort((sb,ec)=>{if(!(sb&&sb.userName&&ec&&ec.userName))return k.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),
0});return Da}AOl(Da){if(!Da||!Da.length)return[];const sb=[],ec=new tk.a(Ga.a.Rj());for(let Jc=0;Jc<Da.length;Jc++){const jd=Da[Jc].user;jd.isAnonymous&&ec.contains(jd.clientId)||!jd.isAnonymous&&jd.email&&ec.contains(jd.email)||(sb.push(jd),ec.add(jd.isAnonymous?jd.clientId:jd.email))}return sb}KPf(Da,sb,ec){this.raiseEvent("PPC",new $k(Da,sb,ec))}dqn(Da,sb){Array.remove(this.itc[Da],sb)}}qg.jqi=10;qg.uNm=2;Object(l.a)(qg,"PresenceDataManager",bb.a,[1293]);class fl extends qg{constructor(Da){super();
this.PD=Da}DOe(Da,sb=!1){super.DOe(Da,sb)}eJc(Da){return Da.ip.Nc.toString()}QNh(Da){Da=this.PD.Eb(Te.a.Of(Da));if(!Da)return null;Da=Da.ia(fg.a.Nc,0);return this.z1m[Da.toString()]}}Object(l.a)(fl,"WordPresenceDataManager",qg,[]);var gm=d(1459),xl=d(1027),Ch=d(1805),gi=d(19);class Dh{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e,cf,oi,Dc,Ag,Uc,cl,Sh,Kh,uk,Xg,nj,qj,Lj,bh,si){this.XIa=Array(5);this.FLe=this._started=this.CGe=!1;this.aDe=null;this.KWg=new tk.a(Ga.a.Rj());this.gid={};this.tve=!1;this.g1m=()=>
{if(!this.FLe&&!this.sk.Lv){var nf=new Ca.a(0,1,20,()=>{const ig=new O.a;var Nk=this.a9a.zPk;for(var Nd in Nk){const $d=Nk[Nd];$d.GQc&&ig.add($d.Zo.ip.paragraphId)}if(this.pWd){Nk=this.a9a.qwh;for(const $d in Nk)Nd=Nk[$d],Nd.GQc&&!ig.contains(Nd.Zo.ip.paragraphId)&&ig.add(Nd.Zo.ip.paragraphId)}this.bMh(ig);this.FLe=!1},72);this.Hb.$b(nf);this.FLe=!0}};this.Exi=()=>{this.CGe&&(this.GWf(),this.CGe=!1)};this.a3=(nf,ig)=>{this.cXi(ig.ll.kb)};this.Z2=(nf,ig)=>{nf=ig.pFa;for(var Nk in nf){const Nd=nf[Nk];
this.Oa.$("CashTelemetryIsEnabled")&&this.gFc(Nd,new Date,null);Nd.ip?this.vOe(Nd):this.XXc(Nd.user.clientId)}ig=ig.Dzd;for(Nk=0;Nk<ig.length;++Nk)this.ATk(ig[Nk]);this.V3d()};this.VHf=(nf,ig)=>{ig.paragraphId?this.llo(ig.paragraphId.toString(),ig.$qm,this.gid):k.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.jGi=(nf,ig)=>{ig.paragraphId&&(nf=this.mC.Eb(ig.paragraphId))&&((Object(sd.a)(Sj,ig.presence)?this.Gqe(nf):this.Hqe(nf))===ig.presence.ip.vDa&&this.MCn(ig.paragraphId),this.pWd&&this.b8m(ig))};
this.tv=Da;this.ib=Jc;this.xC=jd;this.tsb=Ud;this.sk=$e;this.iCj=cf;this.a9a=oi;this.mC=ec;this.zGg=Dc;this.Gqe=Ag;this.Hqe=Uc;this.Euj=ve;this.mCj=bf;this.THa=cl;this.Jm=Sh;this.Hc=Kh;this.Hb=uk;this.$2g=Lj;this.URj=si;this.bDe=nj;this.Oa=qj;this.Mhd=sb;Dh.Tid=new Fa.a;for(Da=0;Da<this.Mhd.length;Da++)this.Mhd[Da].zmn(this);this.tsb.S$g(this.jGi);this.tv.rVa(this.Z2);bh&&this.sk.yja(this.g1m);this.tv.g3d(this)}get pWd(){return!!this.Oa&&this.Oa.$("PeoplesWellExtraButtonInfoIsEnabled")}V3d(Da=!1){this.$2g&&
!Da||this.xPi()}xPi(){const Da=new O.a,sb=this.gid;for(const ec in sb)Da.add(Te.a.Of(ec));this.bMh(Da);this.gid={}}GWf(){this.ib.hb&&this.cXi(this.ib.hb.kb,!0)}cXi(Da,sb=!1){this.URj||(this.mC.Om.Wta||sb?Da?(sb=this.CMk(Da))?this.tv.OWf(sb):(this.tv.OWf(null),k.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Da.Qa.contextId)):this.tv.OWf(null):this.CGe=!0)}CMk(Da){if(!this.pWd||!Da.Fgb)if(Da=gi.SelectionEditor.Pj(Da,!0,!1),!gi.SelectionEditor.Qm(Da))return null;return this.Ehh(Da)}Ehh(Da){const sb=
Da.Qa.cpBegin,ec=Da.Qa.node.id;Da=this.Gqe(Da.Qa.node);return new yh(ec.toString(),sb,Da)}gFc(Da,sb,ec){if(this.bDe)if(Da&&Da.user&&Da.user.clientId){var Jc=Da.user.clientId;this.KWg.contains(Jc)||(this.aDe?(this.aDe.gFc(Jc,sb,null,Dh.mHl(ec||Da.user.client)),this.KWg.add(Jc)):this.bDe.continueWith(()=>{this.aDe=this.bDe.result;this.gFc(Da,sb,ec)}))}else k.ULS.sendTraceTag(42262876,302,15,"invalid presence")}BEl(Da){const sb=new O.a;for(let ec=0;ec<Da.length;ec++)sb.add(this.rOl(Da[ec]));return sb}vOe(Da){var sb=
null;Da&&Da.user&&(sb=Da.user.client);Da=Da.clone();Da.user=this.xC.coi(Da.user.clientId)||Da.user;this.Oa.$("CashTelemetryIsEnabled")&&this.gFc(Da,new Date,sb);Da.Rd()&&!Da.user.VW()&&(sb=Da.user.clientId,Dh.Tid.xb(sb)||this.A2h(sb),this.Zko(sb),Da.user.userName=CommonUIStrings.l_AnonymousUserName);this.tsb.DOe(Da,!1)}Zko(Da){const {value:sb}=Dh.Tid.Dc(Da,!1);sb||(Dh.Tid.Z(Da,!0),k.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Da+'" , "Event" : "CreateAnonymousGrayPawn"}'))}A2h(){}XXc(Da){this.tsb.iOi(Da)}ATk(Da){this.XXc(Da);
const sb=this.a9a.XSh(Da);sb&&(sb.MOi(this.VHf),sb.dispose());this.pWd&&(Da=this.a9a.avl(Da))&&(Da.MOi(this.VHf),Da.dispose())}l3b(Da){if(12!==Da.type)return new O.a;Da=this.tsb.iHc(Da.id.toString(),this.Gqe(Da),this.Hqe(Da));return 0>=Da.length?new O.a:this.BEl(Da)}llo(Da,sb,ec){!sb&&Da in ec&&delete ec[Da]}dispose(){this.stop();this.tsb.pPi(this.jGi);this.tv.wIb(this.Z2);this.tv.H7f(this);for(let Da=0;Da<this.Mhd.length;Da++)this.Mhd[Da].jfo(this);Ed.a.GVf([this.Euj,this.mCj,this.tv]);this.a9a.XXk()}rOl(Da){let sb=
!1;Da=({wde:sb}=this.a9a.zEl(Da)).returnValue;sb||Da.H6j(this.VHf);return Da}N0h(Da){Da=this.mC.Eb(Da);if(!Da)return this.XIa[0]||(k.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.XIa[0]=!0),null;if(!tc.ParagraphReader.nc(Da))return this.XIa[1]||(k.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.XIa[1]=!0),null;if(!Da.Ce(this.sk.Tb))return this.XIa[2]||(k.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.XIa[2]=!0),null;if(!Da.anchor)return this.XIa[3]||
(k.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.XIa[3]=!0),null;this.XIa[4]||(k.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.XIa[4]=!0);return Da}NNi(Da){Da=this.tsb.iHc(Da.toString(),-1,-1,!0);if(!H.a.mf(Da))for(const sb of Da)(Da=this.a9a.XSh(sb.user.clientId))&&Da.element&&Da.RA()}bMh(Da){if(Da.count){var sb=new O.a;for(var ec of Da)(Da=this.N0h(ec))?sb.add(Da):this.NNi(ec);if(sb.count){ec=this.Hc.Rc(2);try{ec.set(this.Jm);for(const Jc of sb)this.LAh(Jc)}finally{ec&&
ec.dispose()}}}}LAh(Da){Da.dH(this.sk.Tb,32,!0);Da.dH(this.iCj,32,!0)}MCn(Da){this.gid[Da.toString()]=null;this.$2g&&!this.tve&&(Da=new Ca.a(0,1,200,()=>{this.tve=!1;this.xPi()},70),this.Hb.$b(Da),this.tve=!0)}b8m(Da){if(Da.presence.ip.shapeId&&!Da.$of){var sb=this.a9a.qwh[Da.presence.ip.shapeId.toString()];sb&&sb.Z1a(Da.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.ib.uga(this.a3),this.zGg.iPi(this.Exi))}start(){if(!this._started){this._started=!0;this.ib.oB(this.a3);this.zGg.sPe(this.Exi);
var Da=this.tv.Fzb();delete Da[this.THa.clientId];this.Z2(null,new Ch.a(Da,[]));this.GWf()}}R8d(Da){if(Da&&Da.Rd()&&Da.ip){var sb=this.tsb.iHc(Da.ip.paragraphId.toString(),-1,-1),ec=!1,Jc=null;for(let jd=0;jd<sb.length;jd++)if(Jc=sb[jd],Jc.user.clientId===Da.user.clientId){ec=Jc.LPa=!0;break}if(ec)if(sb=Jc.ip.paragraphId,Da=this.N0h(sb)){sb=this.Hc.Rc(2);try{sb.Db(Da),this.LAh(Da)}finally{sb&&sb.dispose()}}else this.NNi(sb)}}static mHl(Da){return Da?Da?1===Da?1:2===Da?2:0:2:0}}Dh.Tid=null;Object(l.a)(Dh,
"PresenceManager",null,[1281,9,121,1282,1283,1284]);class Yj{constructor(Da,sb,ec,Jc){this.bPb=null;this._started=this.Qte=!1;this.uub=null;this.Vma=(jd,Ud)=>{if(!u.AFrameworkApplication.Mk&&(jd=this.qhj(Ud.ll),this.bPb&&jd)){jd=this.xme.iHc(this.bPb.toString(),-1,-1,!0);for(Ud=0;Ud<jd.length;Ud++)this.uub[jd[Ud].user.clientId]=jd[Ud];0>=jd.length||(jd=this.rJk(jd),this.zp.sendNotification(jd,!0))}};this.nzi=(jd,Ud)=>{this.ib.hb&&!u.AFrameworkApplication.Mk&&this.Qte&&this.bPb&&this.bPb.equals(Ud.paragraphId)&&
(jd=null,!Ud.$of||Ud.presence.user.clientId in this.uub?Ud.$of||(jd=this.Quh(Ud.presence.user.userName,!1),delete this.uub[Ud.presence.user.clientId]):(jd=this.Quh(Ud.presence.user.userName,!0),this.uub[Ud.presence.user.clientId]=Ud.presence),jd&&this.zp.sendNotification(jd,!0))};this.jj=Jc;this.ib=sb;this.xme=Da;this.zp=ec;this.jj.g3d(this)}start(){this._started||(this._started=!0,this.uub={},this.xme.S$g(this.nzi),this.ib.oB(this.Vma),this.qhj(this.ib.hb))}stop(){this._started&&(this._started=!1,
this.uub=null,this.xme.pPi(this.nzi),this.ib.uga(this.Vma))}rJk(Da){if(1===Da.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Da[0].user.userName);const sb=[],ec=Da.length;for(let Jc=0;Jc<ec;Jc++)sb.push(Da[Jc].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,sb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}Quh(Da,sb){return String.format(sb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,
Da)}dispose(){this.jj.H7f(this);this.stop()}qhj(Da){if(!Da)return!1;Da=Da.kb;if(!Da)return!1;Da=Da.Qa;if(!Da)return!1;this.Qte=gi.SelectionEditor.xf(Da);Da=Da.node.id;if(Da.equals(this.bPb)||!this.Qte)return!1;this.bPb=Da;this.uub={};return!0}}Object(l.a)(Yj,"PresenceAccessibilityManager",null,[9,121]);class Ek{constructor(Da,sb){this._started=!1;this.rJ=null;this.gdd=!1;this.zTc=()=>{this._started&&this.NWi()};this.jj=Da;sb&&(this.rJ=sb,this.rJ.nVa(this.zTc));this.jj.g3d(this)}start(){this._started||
(this._started=!0,this.rJ?this.NWi():this.jj.oO(1,this.Bth()))}NWi(){const Da=this.gdd;(this.gdd=!!this.rJ.Oy)&&!Da&&this.jj.oO(1,this.Bth())}Bth(){const Da={};Da.Id="{"+u.AFrameworkApplication.userSessionId.toUpperCase()+"}";Da.HQ=!1;Da.NT=1;Da.WEB=!0;return Da}stop(){this._started&&(this._started=this.gdd=!1)}dispose(){this.jj.H7f(this);this.rJ&&this.rJ.OOi(this.zTc)}}Object(l.a)(Ek,"EditorsTableNotifier",null,[9,121]);var wg=d(391),ye=d(18);class Td extends Dh{constructor(Da,sb,ec,Jc,jd,Ud,ve,
bf,$e,cf,oi,Dc,Ag,Uc,cl,Sh,Kh,uk,Xg,nj,qj,Lj,bh,si,nf,ig,Nk,Nd,$d,Xd){super(Da,sb,ec,Jc,jd,Ud,ve,bf,$e,cf,oi,Ag,Uc,cl,Sh,Xg,nj,qj,Lj,bh,si,nf,ig,$d);this.Zj=null;this.s0k=ie=>{const Wk=!!this.Zj.YA.r2b(ie);k.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",ie,Wk)};this.r0k=(ie,Wk)=>{k.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",Wk,ie)};Dc.gb(ye.a.nYn,wb.a.application,Td.h4j,64);Dc.gb(ye.a.mSf,wb.a.application,Td.mSf,64);
Dc.gb(ye.a.hPf,wb.a.application,Td.hPf,96);Dc.gb(Zb.a.R8d,wb.a.application,Td.mYn,64);this.OH=Kh;this.qd=uk;this.Iub=Nk;this.THa.ibc=Nd;this.THa.ibc.L8j(Td.ozi);Xd.continueWith(()=>{this.Zj=Xd.result});k.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized")}gBa(Da){if(!Da||!Da.anchor)return null;for(Da=Da.anchor.Ip;Da;Da=Da.Rz)if(Da.lCa)return Da.yr.node;return null}Ehh(Da){var sb=null;sb=u.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");var ec=Da.Qa.cpBegin,Jc=Da.Qa.node;
sb&&Af.ImageReader.ww(Jc)&&(Jc=this.gBa(Jc));if(!Jc)return k.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Jc=this.Hqe(Jc);const jd=Da.Qa.node.ia(fg.a.Nc,0);if(!this.OH)return k.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var Ud=this.OH.value.Vdb(jd);const ve=Td.PD.Eb(Ud);if(!ve)return k.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+Ud),null;ec=this.qd.iic(this.qd.hOa(ve.characterData,ve.qa),ec);ec.Hza=-1===Da.Qa.Fb?0:Da.Qa.Fb;Ud=0;sb&&Da.Fgb&&(Ud=
this.XIl(Da));return sb=new zf(this.OH.value,jd,Jc,ec,this.qd,()=>Td.PD,this.Iub,Ud)}XIl(Da){const sb=Af.ImageReader.$Aa(Da.Qa);return sb?sb.properties.ia(fg.a.Ayb,0):Da.Qa.node.properties.ia(fg.a.Ayb,0)}A2h(Da){this.Zj&&this.Zj.Gka&&this.Zj.Gka.lE(this.s0k,this.r0k,Da)}static get jw(){return qa.a.instance.resolve("Common.Utils.IAriaNotifier")}static tI(){return Td.opc.task}static get_instance(){return Td.Sid.task}static GEl(){return Td.mWg.task}static get gPa(){return null!=Td.Tpg?Td.Tpg:Td.Tpg=
qa.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){Td.Sid||(Td.Sid=new n.a);Td.REg&&(k.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),Td.REg=!1);if(Sa.App.xa){var Da=Sa.App.xa.jb;Da?(Da.hda(Td.iTc),Td.dsb=Da.Ic,Td.dsb&&Td.dsb.wi?(Td.WM=Da.Yc.contentReplicator,Td.WM?(Td.PD=Da.Yc.zd,Td.PD?Td.gPa.tI().continueWith(Td.JWm):k.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):k.ULS.sendTraceTag(4252228,
302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):k.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):k.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else k.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static JWm(){Td.jj=
Td.gPa.tI().result;if(Td.jj){var Da=[Td.dsb.kUc,Td.dsb.editingView.kUc],sb=Eb.a.instance,ec=qa.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),Jc=new Yj(ec,sb,Td.jw,Td.jj),jd=u.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?Sa.App.ud.YA:null;jd=new Ek(Td.jj,jd);var Ud=qa.a.instance.ef("WordEditor.IParagraphWordIdMapping"),ve=qa.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),bf=qa.a.instance.resolve("Common.IPeopleInfoProvider");
Td._instance=new Td(Td.jj,Da,Td.PD,sb,bf,ec,Jc,jd,Td.dsb,Td.dsb.editingView.Tb,qa.a.instance.resolve("Box4.Presence.PresenceControlProvider"),u.AFrameworkApplication.ya,Td.WM,tc.ParagraphReader.textLength,tc.ParagraphReader.Hka,qa.a.instance.resolve("Box4.Presence.MyPresenceUser"),Ud,ve,Sa.App.Xj.al,new wg.a,zb.a.instance,gm.a.get_instance(),ka.a.Kq(qa.a.instance.Za("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),u.AFrameworkApplication.K,u.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),
u.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),qa.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),qa.a.instance.resolve("Common.IPresenceStatusProvider"),!Sa.App.As&&!Sa.App.Bm,Sa.App.Cla());k.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");Td.Sid.Gg(Td._instance);Td.opc.Gg(Td._instance);Td.mWg.Gg(Td._instance);Da=qa.a.instance;Da.ha("WordEditor.Presence.WordPresenceManager",()=>Td._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").singleInstance();
Da.resolve("WordEditor.Presence.WordPresenceManager")}else k.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static iTc(Da){Td._instance||(k.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Da=Object(v.a)(10,Da))&&Da.Cjb(Td.iTc),Td.init())}static ozi(){Td._instance.GWf()}static h4j(Da,sb,ec,Jc,jd){ec=jd.split(",");if(!ec||3!==ec.length)return 8;Da=ec[0].trim();sb=ec[1].trim();ec=
Number.parseInvariant(ec[2].trim());Da=new Sj(new Ma(Da),new yh(sb,ec,-1));if(!Td.opc.task.isCompleted)return 8;sb=Td.tI().result;sb.vOe(Da);sb.V3d();return 32}static mSf(Da,sb,ec,Jc,jd){if(!Td.opc.task.isCompleted)return 8;Da=Td.tI().result;Da.XXc(jd);Da.V3d();return 32}static mYn(Da,sb,ec,Jc,jd){if(!Td.opc.task.isCompleted)return 8;Da=Td.tI().result;if(!Da)return 8;Da.R8d(jd);return 32}static hPf(Da,sb,ec,Jc,jd){if(1===ec)return 32;if(!Td.gPa.tI().isCompleted)return 8;Da=Td.gPa.tI().result;if(!Da)return k.ULS.sendTraceTag(4301136,
302,10,"rtcProxy is null when trying to display RTC connection status"),8;jd[xl.a.Value]=2===Da.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Da.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:"";return 32}}Td._instance=null;Td.REg=!0;Td.Sid=new n.a;Td.opc=new n.a;Td.mWg=new n.a;Td.PD=null;Td.dsb=null;Td.WM=null;Td.jj=null;Object(l.a)(Td,"WordPresenceManager",Dh,[]);class cg{constructor(Da){this.sa=new bb.a;this.pY=Da;this.pY.CWR(()=>this.pY.result.J6j(()=>{this.sa.raiseEvent("X")}))}L8j(Da){this.sa.addHandler("X",
Da)}ksn(Da){this.sa.removeHandler("X",Da)}getStatus(){return this.pY.isCompleted&&this.pY.result?this.pY.result.gDc.toString():"0"}}Object(l.a)(cg,"WordPresenceStatusProvider",null,[697]);class Hi{constructor(Da,sb,ec,Jc){this.jj=null;this.JEg=this.sye=!1;this.KWm=()=>{this.Mca.isCompleted&&this.Mca.result?(this.jj=this.Mca.result,this.jj.rVa(this.Z2),k.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):k.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};
this.Z2=(jd,Ud)=>{jd=Ud.pFa;for(const ve in jd)if(Ud=jd[ve],!this.sye&&Ud.user.vQ&&Ud.user.vQ!==this.B8.vQ){k.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.B8.vQ,Ud.user.vQ);this.sye=!0;break}this.sye&&this.jj.wIb(this.Z2);this.JEg||(k.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.JEg=!0)};this.Zj=Da;this.B8=sb;this.Mca=ec;ec.continueWith(this.KWm);this.RMj=Jc;this.RMj.exf=this.B8}}Object(l.a)(Hi,"WordPresenceUpdateMonitor",
null,[]);var ee=d(448),Fk=d(1511),te=d(216),Cg=d(1807),cc=d(1808);class rh{constructor(Da,sb,ec,Jc,jd,Ud,ve){this.sa=new bb.a;this.ZKg=this.UMg=this.wwe=this.APg=!1;this.KLe=this.Uod=0;this.bWb=null;this.THa=Ud;this.THa.clientId=Da.clientId;this.Oq=Da;this.d8=sb;this.UO=Jc;this.iEj=jd;this.Hb=ec;this.u6a=new te.a;this.Wm=ve;this.d8&&this.d8.continueWith(()=>{this.d8.ho||this.d8.Ji||this.d8.result.M9g(Object(e.a)(this,this.Nvi,"onAmIAloneChanged"))})}get connectionState(){return this.Oq.connectionState}rVa(Da){this.sa.addHandler("PU",
Da)}wIb(Da){this.sa.removeHandler("PU",Da)}Vya(Da){this.sa.addHandler("CSC",Da)}aYc(Da){this.sa.removeHandler("CSC",Da)}nrd(Da){this.sa.addHandler("PSU",Da)}Q3d(Da){this.sa.removeHandler("PSU",Da)}mrd(Da){this.sa.addHandler("PSC",Da)}P3d(Da){this.sa.removeHandler("PSC",Da)}ZWi(){}get clientId(){return this.Oq.clientId}p1(Da){this.sa.addHandler("UN",Da)}xIb(Da){this.sa.removeHandler("UN",Da)}d2l(){this.bWb=Array(12);for(let Da=0;12>Da;Da++)this.bWb[Da]=0;this.UMg=this.Wm?this.Wm.$("UpdateNotificationTaskExperimentIsEnabled"):
!0;u.AFrameworkApplication.xK(()=>{this.dCm()})}init(){this.Oq.Vya(Object(e.a)(this,this.Pfa,"onConnectionStateChanged"));this.Oq.rVa(Object(e.a)(this,this.Z2,"onPresenceUpdated"));this.Oq.nrd(Object(e.a)(this,this.wGb,"onPersistentStateUpdated"));this.Oq.mrd(Object(e.a)(this,this.Q$b,"onPersistentStateCleared"));this.Oq.p1(Object(e.a)(this,this.Caa,"onUpdateNotificationReceived"));this.fqh();this.d2l()}g3d(Da){this.u6a.contains(Da,(sb,ec)=>sb===ec)||(this.u6a.add(Da),2===this.connectionState&&Da.start())}H7f(Da){for(let sb=
0;sb<this.u6a.length;sb++)if(this.u6a.J(sb)===Da){this.u6a.mF(sb);break}}connect(){this.wwe||this.Oq.connect()}disconnect(){this.Oq.disconnect()}get d5d(){return this.Oq}Kyh(Da){return Sj.nxb(Da)}aXf(Da,sb){return(new Sj(Da,sb)).Dhf()}OWf(Da){Da&&Da.Rd()&&!this.UO()?this.Oq.ZWi(this.aXf(this.THa.Pzl(),Da)):G.Task.e$(null)}PZc(Da,sb){return this.Oq.PZc(Da,sb)}cbf(Da){return this.Oq.cbf(Da)}kHc(){return this.Oq.kHc()}oO(Da,sb,ec=!1){return this.Oq.oO(Da,sb,ec)}Fzb(){return this.sth(this.Oq.Fzb())}aMb(){return G.Task.e$(null)}get tNa(){return this.Oq.tNa}Pfa(Da,
sb){2===sb.newState&&this.u6a.forEach(ec=>{ec.start();return!0});sb.newState||this.Wm.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.wwe||this.u6a.forEach(ec=>{ec.stop();return!0});this.sa.raiseEvent("CSC",sb)}O9e(Da){return Da.toLowerCase()}Z2(Da,sb){if(!this.UO()){Da=this.sth(sb.pFa);sb=this.uth(sb.Dzd);var ec=new Ch.a(Da,sb);sb=new Ca.a(0,1,0,()=>{this.sa.raiseEvent("PU",ec)},57);this.Hb.$b(sb)}}sth(Da){const sb={};for(const Jc in Da){var ec=Jc;const jd=this.Kyh(Da[Jc]);jd&&jd.Rd()?sb[this.O9e(ec)]=
jd:k.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",ec)}return sb}uth(Da){const sb=Array(Da.length);for(let ec=0;ec<Da.length;ec++)sb[ec]=this.O9e(Da[ec]);return sb}wGb(Da,sb){if(!this.UO()){var ec={};Da=sb.pFa;for(var Jc in Da)ec[this.O9e(Jc)]=Da[Jc];Jc=new Ca.a(0,1,0,()=>{this.sa.raiseEvent("PSU",new Cg.a(sb.type,ec))},80);this.Hb.$b(Jc)}}Q$b(Da,sb){if(!this.UO()){Da=this.uth(sb.bvd);var ec=new cc.a(Da);Da=new Ca.a(0,1,0,()=>{this.sa.raiseEvent("PSC",ec)},81);this.Hb.$b(Da)}}Caa(Da,sb){this.UMg?
this.eBi(sb):(Da=new Ca.a(0,1,0,()=>{this.eBi(sb)},58),this.Hb.$b(Da))}eBi(Da){var sb=Date.now();this.sa.raiseEvent("UN",Da);sb=Date.now()-sb;500<=sb&&(this.Uod++,k.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Da.type,sb),this.K$k(Da));this.KLe++}K$k(Da){0>Da.type||21<=Da.type?k.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",Da.type):this.bWb[Da.type]++}dCm(){if(!this.ZKg){var Da=
{};Da.TC=this.KLe;Da.HRC=this.Uod;this.bWb&&0<this.Uod&&(Da.TBC=this.bWb);this.Uod=this.KLe=0;this.bWb=null;k.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",Da);this.ZKg=!0}}dispose(){this.u6a=new te.a;this.Oq.aYc(Object(e.a)(this,this.Pfa,"onConnectionStateChanged"));this.Oq.wIb(Object(e.a)(this,this.Z2,"onPresenceUpdated"));this.Oq.Q3d(Object(e.a)(this,this.wGb,"onPersistentStateUpdated"));this.Oq.P3d(Object(e.a)(this,this.Q$b,"onPersistentStateCleared"));this.Oq.xIb(Object(e.a)(this,
this.Caa,"onUpdateNotificationReceived"));this.d8&&this.d8.continueWith(()=>{this.d8.ho||this.d8.Ji||this.d8.result.krn(Object(e.a)(this,this.Nvi,"onAmIAloneChanged"))});this.Oq.disconnect();k.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}Nvi(){this.fqh()}fqh(){let Da=!1;this.d8?this.d8.continueWith(()=>{this.d8.ho||this.d8.Ji||(Da=!this.d8.result.amIAlone);this.Oq.connectionState||!Da&&!this.iEj()?2!==this.Oq.connectionState||Da||(this.disconnect(),k.ULS.sendTraceTag(4564937,
302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),k.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.APg&&Da&&(k.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.APg=!0)}):(this.connect(),k.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}dEc(){this.wwe=!0;this.disconnect();k.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(l.a)(rh,
"RtcProxy",null,[1261,9,851,1262]);class pe extends rh{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e,cf,oi,Dc,Ag){super(Da,sb,ec,Jc,jd,Ud,Ag);this.c9=null;this.OH=ve;this.qd=bf;this.YHa=$e;this.Xsc=cf;this.sIe=oi;this.Iub=Dc}get $I(){return this.c9||(this.c9=this.sIe())}Pfa(Da,sb){2===sb.newState&&k.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.Alo();super.Pfa(Da,sb)}Alo(){this.$I&&this.$I.MQ("RtcConnectionStatusLabel")}Kyh(Da){return $c.P_e(md(Da),this.OH,this.qd,this.YHa,this.Iub)}aXf(Da,sb){return Object(sd.a)(zf,
sb)?(Da=new $c(this.Xsc.PUh(),Da,sb),Ie(Da.Dhf())):super.aXf(Da,sb)}}Object(l.a)(pe,"WordRtcProxy",rh,[]);class ah{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e,cf,oi,Dc,Ag){this.fr=new n.a;this.A0g=!0;this.le=sb;this.Hb=ec;this.UO=Jc;this.THa=jd;this.OH=Ud;this.dra=ve;this.YHa=bf;this.Xsc=$e;this.sIe=cf;this.Hqa=oi;this.Iub=Dc;this.Oa=Ag}tI(){this.ybo();return this.fr.task}BIc(){return ee.a.then(this.tI(),Da=>Da)}ybo(){if(this.A0g)if(this.A0g=!1,Sa.App.Ctf()&&Sa.App.Brf()){var Da=u.AFrameworkApplication.Xe;
if(Da){Da=Fk.RealtimeChannel.createInstance("{"+u.AFrameworkApplication.userSessionId+"}",u.AFrameworkApplication.userSessionId,u.AFrameworkApplication.NTi,Da,this.Hqa,1,this.le,this.Oa.lb("RtcEndpointUrl"),void 0,void 0,null,this.Oa.$("FindSessionOnBootIsEnabled")?qa.a.instance.resolve("Common.IFindSessionUtils"):null,this.Oa.lb("RtcBootToken"));var sb=this.Oa.$("RtcAlwaysOnEnabled"),ec=new pe(Da,sb?null:Sa.App.Cla(),this.Hb,this.UO,ah.idl,this.THa,this.OH,this.dra,this.YHa,this.Xsc,this.sIe,this.Iub,
u.AFrameworkApplication.K);Sa.App.GNn(ec);this.rmn(ec);ec.init();pl.App.q2a=ec;this.Hqa.execute(Jc=>{Jc.N$a(()=>{ec.dEc()})});this.fr.Gg(ec)}else k.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else k.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}rmn(Da){const sb=qa.a.instance;sb.ha("WordEditor.Presence.WordRtcProxy",()=>Da).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").singleInstance();
sb.resolve("Common.IRealtimeChannelBasic")}static idl(){return!1}}Object(l.a)(ah,"WordRtcProxyProvider",null,[686,687]);class Tg{constructor(){this.W=null;this.Cl=!1}get name(){return"WordEditor.Presence"}init(){k.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");Sa.App.emj&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").tI(),Td.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));Sa.App.bCc&&yd.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");
if(Tg.MKg){const Da=this.W.resolve("WordEditor.IMainViewModeManager");Da.kvb(this.$If);Tg.Xue=1===Da.Lw}}dispose(){if(!this.Cl){this.Cl=!0;Td.tI().continueWith(()=>{Ed.a.VA(Td.tI().result)});var Da=this.W.resolve("Box4.Presence.MyPresenceUser");Da&&Da.ibc&&Da.ibc.ksn(Td.ozi)}}yc(Da){this.W=Da;this.W.ha("Box4.Presence.MyPresenceUser",()=>new Na).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").singleInstance();Da.ha("WordEditor.Presence.IWordPresenceCpFactory",
()=>new Kl(Da.resolve("Box4.CpConversionManagerImpl"),Da.resolve("Box4.IContentControlReader"))).singleInstance();Da.ha("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new Hi(new J.a(()=>Sa.App.ud),Se.a.instance,Da.resolve("WordEditor.Presence.WordRtcProxyProvider").BIc(),Da.resolve("Box4.Presence.IMyPresenceUser"))).singleInstance();Da.ha("WordEditor.Presence.WordRtcProxyProvider",()=>new ah(u.AFrameworkApplication.buildVersion,Sa.App.xa.jq,zb.a.instance,()=>u.AFrameworkApplication.Mk,qa.a.instance.resolve("Box4.Presence.IMyPresenceUser"),
qa.a.instance.Pa("WordEditor.ParagraphWordIdMapping"),qa.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>u.AFrameworkApplication.ua&&Sa.App.xa.jb&&Sa.App.xa.jb.Yc?Sa.App.xa.jb.Yc.zd:null,Og.instance,()=>qa.a.instance.Pa("WordEditor.IStatusBarUser"),qa.a.instance.Za("Common.ISessionExpirationManager"),qa.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),u.AFrameworkApplication.K)).singleInstance().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");
Da.ha("Box4.Presence.PresenceControlProvider",()=>new Mk(Tg.pOk(),Yd.a.instance,qa.a.instance.Za("Common.IZoomManager"),qa.a.instance.resolve("Box4.ICoauthCashTelemetry"),ka.a.Kq(qa.a.instance.Za("Common.ISystemInitiatedFeedbackWithTimeLapse")),u.AFrameworkApplication.K,Da.resolve("Common.IPeopleInfoProvider"))).singleInstance();Da.ha("Common.App.Presence.AwayManager",()=>new Zf(qa.a.instance.resolve("Common.IPresenceUser"),qa.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").BIc(),Td.GEl(),
qa.a.instance.resolve("Common.IPresenceConverter"),zb.a.instance,u.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:u.AFrameworkApplication.K.rc("AwayCoauthorThresholdMs",9E5),Object(e.a)(u.AFrameworkApplication.ya,u.AFrameworkApplication.ya.processAction,"processAction"),Sa.App.xa.notificationBar,u.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).singleInstance();Da.ha("WordEditor.Presence.WordPresenceStatusProvider",()=>new cg(ka.a.Kq(qa.a.instance.Za("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").singleInstance();
Da.ha("Common.App.Presence.PeopleInfoProvider",()=>new Ub(Da.resolve("WordEditor.Presence.WordRtcProxyProvider").BIc(),Sa.App.Cla().CWR(()=>Sa.App.Cla().result.YA),Da.resolve("Common.App.People.IPeopleColorUtils"),Da.resolve("Common.IPresenceConverter"),ka.a.Kq(Da.Za("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").singleInstance();Da.ha("Box4.Presence.WordPresenceDataManager",()=>new fl(Sa.App.xa.jb.Yc.zd)).as("Box4.IPresenceDataManager").singleInstance()}$If(Da,sb){Sa.App.xa&&
Sa.App.xa.lC&&(Tg.Ihd=null,Tg.Xue=1===sb.b$b)}static get $Bi(){if(!Tg.Ihd&&Sa.App.xa&&Sa.App.xa.lC){const Da=pl.App.fm.lC;Tg.Ihd=Tg.Xue&&Tg.MKg?Da.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:Da.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return Tg.Ihd}static pOk(){const Da=u.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),sb=u.AFrameworkApplication.K.$("PresenceIgnoreEventOnExpandedTooltip"),ec=u.AFrameworkApplication.K.$("PresenceIpWidthAdjustForFlyout"),
Jc=new Tc;Jc.add(uc.multipleBrowsersImageClassName,Ig.getImageClassWithCluster(u.AFrameworkApplication.hQ,"MoreUsersGlyph16"));Jc.add(uc.multipleBrowserImageClusterPath,u.AFrameworkApplication.pr);Jc.add(uc.peopleImageClassName,Ig.getImageClassWithCluster(u.AFrameworkApplication.hQ,Da?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Jc.add(uc.peopleImageClusterPath,u.AFrameworkApplication.pr);Jc.add(uc.zIndex,1);Jc.add(uc.rtl,u.AFrameworkApplication.isRtl);Jc.add(uc.viewportBoundsCallback,
Tg.aPl);Jc.add(uc.ignoreEventOnExpandedTooltip,sb);Jc.add(uc.ipWidthAdjustForFlyout,ec);return Da?new vf(Jc):new Xf(Jc)}static aPl(){return Tg.$Bi?Oe.a.getElementBounds(Tg.$Bi):null}}Tg.Xue=!0;Tg.MKg=u.AFrameworkApplication.K.$("FlippedFlyoutForPaginationViewIsEnabled");Tg.Ihd=null;Object(l.a)(Tg,"WordPresencePackage",null,[1,2]);var ri=d(1006),Rl=d(1384),Tf=d(1012),hm=d(125);class mh{constructor(Da,sb){this.wOe=Da;this.paragraphId=sb}get opType(){return 2}get operation(){return this.wOe}}Object(l.a)(mh,
"RttAppliedAddParagraphOp",null,[292]);class ck{constructor(Da,sb){this.yun=Da;this.paragraphId=sb}get opType(){return 6}get operation(){return this.yun}}Object(l.a)(ck,"RttAppliedReplaceSymbolRangeOp",null,[292]);class Uf{constructor(Da,sb){this.Cun=Da;this.paragraphId=sb}get opType(){return 1}get operation(){return this.Cun}}Object(l.a)(Uf,"RttAppliedReplaceTextRangeOp",null,[292]);class al{constructor(Da,sb,ec){this.m7i=Da;this.v9d=sb;this.$Cc=ec}get opType(){return 4}get operation(){return this.m7i}get K_j(){return this.m7i.i_b()?
this.$Cc:this.v9d}}Object(l.a)(al,"RttAppliedSplitParagraphOp",null,[292]);class gl{constructor(){this.s5a=new Fa.a}evf(Da){return Da.toString()}$xc(Da,sb){Da=this.evf(Da);this.s5a.xb(Da)||this.s5a.Z(Da,new O.a);this.s5a.J(Da).add(sb)}FHf(Da){switch(Da.opType){case 1:var sb=Object(v.a)(Uf,Da);this.$xc(sb.paragraphId,Da);break;case 6:sb=Object(v.a)(ck,Da);this.$xc(sb.paragraphId,Da);break;case 4:sb=Object(v.a)(al,Da);this.$xc(sb.v9d,Da);this.$xc(sb.$Cc,Da);break;case 2:sb=Object(v.a)(mh,Da),this.$xc(sb.paragraphId,
Da)}}NSm(Da){return this.gib(Da)}gib(Da){Da=this.evf(Da);if(!this.s5a.xb(Da))return new O.a;const sb=this.s5a.J(Da);this.s5a.remove(Da);for(let ec of sb)ec.operation&&(ec.operation.s5=null);return sb}ABl(Da){let sb;return({value:sb}=this.s5a.Dc(this.evf(Da),sb)).returnValue?sb:new O.a}Tgl(Da){for(let sb of this.s5a.values){if(!sb.count)continue;if(2!==sb.J(0).opType)continue;const ec=sb.J(0);if(ec.wOe.JDf===Da)return ec}return null}}Object(l.a)(gl,"RttAppliedOpTracker",null,[308]);var nm=d(229),dj;
(function(Da){Da[Da.E5k=0]="expired";Da[Da.GDo=1]="dried"})(dj||(dj={}));Object(l.b)("RemoveChangeReason",dj);class bi{constructor(){this.vwa=new nm.a}r1j(Da){if(!Da)return k.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const sb=Da.Nc,ec=Da.nj;this.vwa.xb(sb)||this.vwa.add(sb,new nm.a);this.vwa.J(sb).Z(ec,Da);return this.hQk(sb,ec)?(k.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",sb),this.vwa.J(sb).remove(ec),
!1):!0}Qff(Da,sb){if(!this.vwa.xb(Da))return null;Da=this.vwa.J(Da);return Da.xb(sb)?Da.J(sb):null}$Gd(Da){const sb=new O.a;for(let ec of this.vwa.keys){const Jc=this.vwa.J(ec);for(let jd of Jc.keys){const Ud=Jc.J(jd);Da(Ud)&&sb.add(Ud)}}return sb}aOi(Da,sb){let ec=null;({value:ec}=this.vwa.Dc(Da.Nc,ec)).returnValue?(Da.activity.MFf(dj[sb]),ec.remove(Da.nj),ec.count||this.vwa.remove(Da.Nc)):k.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",
Da.Nc,sb)}VRf(Da){this.aOi(Da,1)}YRf(Da){this.aOi(Da,0)}hQk(Da,sb){if(!this.vwa.xb(Da))return!1;Da=this.vwa.J(Da);if(!Da.xb(sb))return!1;for(var ec=Da.J(sb);ec;){ec=ec.D_;if(ec===sb)return!0;if(!Da.xb(ec))break;ec=Da.J(ec)}return!1}}Object(l.a)(bi,"RttDataStore",null,[305,306]);var Qd=d(298),Mi=d(64),Hn=d(292),Df=d(17);class ci{constructor(Da,sb){this.oXd=(ec,Jc)=>{4===this.Sp.opType?k.ULS.shipAssertTag(9204866,355,12===Jc.node.type||11===Jc.node.type,"Unexpected graph modification detected during RTT edit"):
k.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.gib=()=>{k.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")};this.Fxi=()=>{k.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.Sp=Da;if(this.Po=sb)Da=this.Po.Se(12),Da.ys(this.oXd),Da.zv(this.gib),Da.lp(this.Fxi)}dispose(){if(this.Po){const Da=this.Po.Se(12);Da.jM(this.oXd);Da.Saa(this.gib);Da.EX(this.Fxi)}}}Object(l.a)(ci,
"GraphChangeValidator",null,[9]);class Ll{constructor(Da,sb,ec,Jc){this.id=Da;this.cpBegin=sb;this.cpEnd=ec;this.btk=Jc}kpo(Da){var sb=this.id===Da.id;sb&&(sb=this.btk.replace("\u00a0"," "),Da=Da.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),sb=sb===Da);return sb}}Object(l.a)(Ll,"RttOpValidator",null,[329]);class Wc{constructor(Da,sb){this.s5=this.x4a=this.activity=null;this.opType=Da;this.metadata=sb}yif(){return""}serialize(){return null}}Object(l.a)(Wc,"RttOp",
null,[150]);class dk extends Wc{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e){super($e,bf);this.Nc=Da;this.nj=sb;this.EQ=ec;this.V2=Jc;this.D_=jd;this.Dlb=Ud;this.UG=ve}lvh(){return this.EQ.isEqual(this.V2,!0)?new xe.a(0,this.Nc,this.nj,this.EQ,void 0,void 0,void 0,this.UG):new xe.a(1,this.Nc,this.nj,this.EQ,this.Nc,this.nj,this.V2,this.UG)}static qdj(Da){let sb,ec;var Jc=Da.rS;if(1===Jc.J2d&&(Jc.fOa!==Jc.oDa||Jc.J3a!==Jc.hgc))return k.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),
ec=sb=null,Da=Jc=-1,{returnValue:!1,EQ:ec,V2:sb,Nc:Da,nj:Jc};if(Jc.UG)return ec=sb=null,Da=Jc=-1,{returnValue:!1,EQ:ec,V2:sb,Nc:Da,nj:Jc};sb=ec=Jc.EQ;1===Jc.J2d&&(sb=Jc.V2);Da=Jc.fOa;Jc=Jc.J3a;return{returnValue:!0,EQ:ec,V2:sb,Nc:Da,nj:Jc}}}Object(l.a)(dk,"RttReplaceRangeOp",Wc,[]);var Ni=d(1382),Ld=d(407),Gk=d(590);class bl extends Gk.a{constructor(){super();this.RttStatusRecords=this.FileId=null}Wl(){return 110}static I9(Da,sb){const ec=new bl;ec.FileId=Da;ec.RttStatusRecords=sb;return ec}}Object(l.a)(bl,
"RttStatusRequest",Gk.a,[]);class Ae{}Object(l.a)(Ae,"RttStatusOp",null,[]);class mg{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(l.a)(mg,"WireRttStatusOpRecord",null,[]);class xk extends Ld.a{constructor(){super();const {App:Da}=d(157);this.pUb=new O.a;this.GFe=new O.a;this.Wj=new Ni.a(u.AFrameworkApplication.K.rc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=
1;Da.E_.register(this)}asj(){const Da=Date.now();for(let sb of this.pUb)sb.EGb&&1===sb.EGb&&(sb.EGb=2,sb.timeToRender=Da-sb.metadata.v5f)}Pee(Da){const sb=new Ae;sb.metadata=Da.operation.metadata;sb.opType=Da.opType;sb.EGb=1;this.pUb.add(sb)}get Mma(){return"RttStatusReplicator"}m2(){return this.he&&2===this.he.status?!0:1===this.enabled&&this.Wj.IW()?this.MB():!1}MB(){for(let Da of this.pUb)if(Da.EGb&&2===Da.EGb)return!0;return!1}ROa(){if(1===this._state){this._state=3;const sb=this.pUb.toArray().filter(ec=>
2===ec.EGb);var Da=this.RIk(sb);Da=bl.I9(u.AFrameworkApplication.rootQuerySignature,Da);sb.forEach(ec=>this.pUb.remove(ec));sb.forEach(ec=>this.GFe.add(ec));this.he.Yr=Da;this.he.iH="RttStatusRequest";this.he.status=1}else 3===this._state&&this.he&&2===this.he.status&&(this.Wj.U_(),2!==this.he.statusCode&&this.pUb.EA(0,this.GFe),this.GFe.clear(),this._state=1)}RIk(Da){const sb=[];Da.forEach(ec=>{const Jc=new mg;Jc.clientId=ec.metadata.clientId;Jc.clientType=ec.metadata.clientType;Jc.packetId=ec.metadata.packetId;
Jc.packetVersion=ec.metadata.packetVersion;Jc.strictlySequentialId=ec.metadata.strictlySequentialId;Jc.contentType=ec.opType;Jc.contentState=ec.EGb;Jc.timeToRender=ec.timeToRender;sb.push(Jc)});return sb}Aec(){return!0}lE(){}forceOutbound(){}}Object(l.a)(xk,"RttStatusReplicator",Ld.a,[]);class lf{constructor(Da,sb,ec,Jc,jd,Ud){this.packetId=Da;this.clientId=sb;this.clientType=ec;this.v5f=Jc;this.packetVersion=jd;this.strictlySequentialId=Ud}static create(Da){let sb=null;null!=Da.strictlySequentialId&&
(sb=Da.strictlySequentialId);return new lf(Da.packetId,Da.clientId,Da.client,Date.now(),Da.version,sb)}}Object(l.a)(lf,"RttOpMetadata",null,[]);class ej extends Wc{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e){super(4,$e);this.D_=0;this.Nc=Da;this.nj=sb;this.offset=ec;this.UG=Jc;this.lag=jd;this.e5f=Ud;this.pee=ve;this.f5f=bf;this.lag===this.Nc?this.D_=this.e5f:this.pee===this.Nc?this.D_=this.f5f:(k.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.D_=0)}i_b(){return this.Nc===
this.pee}get H7n(){return this.D_}get zso(){return this.i_b()?this.lag:this.pee}get iaj(){return this.i_b()?this.e5f:this.f5f}serialize(){const Da=new xe.a(3,this.Nc,this.nj,this.offset,null,null,null,this.UG),sb=new vc(this.lag,this.e5f,this.pee,this.f5f);return new Vb(this.metadata.packetId,this.metadata.clientId,1,4,Da,null,void 0,void 0,void 0,void 0,sb,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const sb=Da.rS,ec=Da.LKb;return new ej(sb.fOa,sb.J3a,sb.EQ,sb.UG,ec.cKf,ec.d5f,
ec.dKf,ec.g5f,lf.create(Da))}static vHl(Da,sb,ec){if(1!==Da.type)return null;const Jc=ec.hOa(Da.W2.characterData,Da.W2.qa);return new ej(Da.W2.Nc,Da.W2.nj,ec.iic(Jc,Da.Z6i),Da.UG,Da.Mub.Nc,Da.Mub.nj,Da.vzc.Nc,Da.vzc.nj,sb)}}Object(l.a)(ej,"RttSplitParagraphOp",Wc,[124,150]);class hl{constructor(Da,sb,ec,Jc){this.VOm=()=>{this.etb.asj()};this.Qha=Da;this.ssc=sb;this.sia=ec;this.Stb=Jc;null!=u.AFrameworkApplication.K&&u.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",
!1)&&(this.etb=new xk,Qd.GraphTransactionManager.instance.L9g(this.VOm))}Edk(Da,sb,ec,Jc=null){if(sb.isDirty)return Jc&&Jc.properties.Z(hl.jDi,"1"),!1;const jd=new ci(Da,sb.Qi);try{if(1===Da.opType||6===Da.opType){const bf=Object(v.a)(dk,Da),$e=this.HEk(bf,sb);var Ud=$e.node.characterData;const cf=10<=$e.cpBegin?$e.cpBegin-10:0;let oi=$e.cpEnd+10<=Ud.length?$e.cpEnd+10:Ud.length;const Dc=Ud.substr(cf,$e.cpBegin-cf),Ag=Ud.substr($e.cpEnd,oi-$e.cpEnd);oi=oi+bf.Dlb.length-($e.cpEnd-$e.cpBegin);var ve=
new Ll($e.node.id,cf,oi,Dc+bf.Dlb+Ag);const Uc=6===bf.opType;Ud="";Uc&&(Ud=bf.font);if(!this.fun($e,bf.Dlb,Uc,Ud,Jc))return!1;let cl;cl=1===Da.opType?new Uf(bf,sb.id):new ck(bf,sb.id);sb.Hka=Da.D_;bf.x4a=ve;Da.s5=cl;ec.FHf(cl);null!=this.etb&&this.etb.Pee(cl)}else return 4===Da.opType?this.Ddk(Da,sb,ec):!1}finally{jd&&jd.dispose()}return!0}Ddk(Da,sb,ec){const Jc=Object(v.a)(ej,Da);var jd=this.Stb.hOa(sb.characterData,sb.qa);jd=this.Stb.kxb(jd,Jc.offset);if(!this.Mgi(lc.a.createTextRange(sb,0,tc.ParagraphReader.textLength(sb))))return!1;
var Ud=Lg.GraphIterator.$a(sb);Ud.Bb(10);if(this.h7b(Ud))return!1;let ve;Ud=this.sia.Rc(3);try{Ud.Db(sb);const bf=sb.QX();try{const $e=Lg.GraphIterator.$a(sb);$e.Bb(10);$e.kd(11);let cf=$e.currentNode;Jc.i_b()&&($e.Hqf?cf=null:($e.bH(),cf=$e.currentNode));$e.mc();const oi=this.ssc.vxb();$e.cH(oi,cf,89);$e.Ei(oi);ve=sb.clone();const Dc=ve.QX();try{ve.setValue(fg.a.Nc,Jc.zso);ve.setValue(fg.a.nj,Jc.iaj);ve.isDirty=!1;$e.Sf(ve,2);$e.Ei(ve);this.vGk(sb,ve);const Ag=Jc.i_b()?ve:sb,Uc=Jc.i_b()?sb:ve;Ag.vN=
!0;Uc.vN=!0;this.Qha.yTf(this.sbb(Ag,jd,tc.ParagraphReader.textLength(Ag)),"",!1,"");this.Qha.yTf(this.sbb(Uc,0,jd),"",!1,"");sb.Hka=Jc.H7n;ve.Hka=Jc.iaj}finally{Dc&&Dc.dispose()}}finally{bf&&bf.dispose()}Ud.qPa()}finally{Ud&&Ud.dispose()}sb=new al(Jc,sb.id,ve.id);Da.s5=sb;ec.FHf(sb);null!=this.etb&&this.etb.Pee(sb);return!0}h7b(Da){const sb=new Lg.GraphIterator;sb.fd(Da);sb.kd(11);return Mi.ListReader.ai(sb)?(k.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}P9k(Da,
sb,ec){var Jc=sb.Vdb(Da.Nc);if(Jc.equals(Te.a.nil))return null;Jc=ec.Eb(Jc);if(!Jc||!tc.ParagraphReader.nc(Jc)||!Jc.isConnected)return null;const jd=Lg.GraphIterator.$a(Jc);if(!jd.Bb(23))return null;if(Da.kag){Da=sb.Vdb(Da.kag);if(Da.equals(Te.a.nil))return null;ec=ec.Eb(Da);if(!ec||!tc.ParagraphReader.nc(ec)||!ec.isConnected)return null;ec=Lg.GraphIterator.$a(ec);if(!ec.Bb(23))return null;ec.kd(11);ec.bH();ec.Xd();if(ec.currentNode!==Jc)return null}return this.h7b(jd)?null:jd}tbo(Da,sb,ec,Jc){const jd=
sb.currentNode,Ud=this.sia.Rc(3);try{Ud.Db(jd);sb.kd(11);const ve=sb.currentNode;sb.mc();const bf=this.ssc.vxb();sb.cH(bf,ve,89);sb.Ei(bf);const $e=Hn.a.instance.createInstance(393230),cf=$e.QX();try{$e.setValue(Df.a.lo,""),$e.mCa=!0,Jc.sIb($e),Jc=[0],$e.setValue(fg.a.Hq,Jc),$e.setValue(fg.a.gt,Jc),$e.mCa=!1,$e.setValue(fg.a.Nc,Da.JDf),$e.setValue(fg.a.nj,Da.IDf),$e.isDirty=!1,sb.Sf($e,2),$e.vN=!0,$e.Hka=Da.IDf}finally{cf&&cf.dispose()}Ud.qPa();Da.s5=new mh(Da,$e.id);ec.FHf(Da.s5);null!=this.etb&&
this.etb.Pee(Da.s5)}finally{Ud&&Ud.dispose()}return!0}sbb(Da,sb,ec){return sb===ec?lc.a.Uc(Da,sb):lc.a.createTextRange(Da,sb,ec)}fun(Da,sb,ec,Jc,jd=null){const Ud=Da.node;if(Da.cpBegin!==Da.cpEnd&&!this.Mgi(Da))return jd&&jd.properties.Z(hl.pfj,"1"),!1;jd=this.sia.Rc(3);try{jd.Db(Ud);const ve=Ud.QX();try{Ud.vN=!0,this.Qha.yTf(Da,sb,ec,Jc)}finally{ve&&ve.dispose()}jd.qPa()}finally{jd&&jd.dispose()}return!0}vGk(Da,sb){sb.mCa=!0;sb.Dva(Da.characterData);sb.Hka=Da.Hka;sb.qa.clear();for(var ec=0;ec<Da.qa.length;ec++){const Jc=
Da.qa.J(ec).Kra(sb);sb.qa.add(Jc)}sb.wn();if(sb.wordRunProperties.length)for(Da=0;Da<sb.qa.length;Da++){if((ec=sb.qa.J(Da).formatting)&&-1!==ec.Ee)for(;sb.wordRunProperties.length<=ec.Ee;)sb.wordRunProperties.DZ(sb.wordRunProperties.length-1,256)}else k.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");sb.mCa=!1}Cuf(Da){Da=Lg.GraphIterator.$a(Da);Da.Bb(23);Da.mc();return{returnValue:89===Da.role,iterator:Da}}ESf(Da){const sb=new Lg.GraphIterator;sb.fd(Da);
sb.mc();const ec=this.sia.Rc(3);try{ec.Db(sb.currentNode),Da.Eg()}finally{ec&&ec.dispose()}}Fon(Da){if(Da.anchor)if(({iterator:sb}=this.Cuf(Da)).returnValue)this.ESf(sb);else{var sb=Da.Lc.Om;var ec=this.sia.Rc(3);try{ec.Db(Da),Da.load(sb.Eb(Da.id)),Da.anchor.SW(4)}finally{ec&&ec.dispose()}}}ZUf(Da,sb,ec){for(let Ud=sb.count-1;0<=Ud;Ud--){var Jc=sb.J(Ud);switch(Jc.opType){case 4:Jc=Object(v.a)(al,Jc);if(!Da.id.equals(Jc.v9d)){k.ULS.shipAssertTag(9204885,355,Da.id.equals(Jc.$Cc));continue}Jc=ec.Eb(Jc.$Cc);
if(!Jc)break;if(!Jc||!tc.ParagraphReader.nc(Jc)){k.ULS.shipAssertTag(9204886,355,!1);break}if(!Jc.isConnected)continue;var jd=({iterator:Jc}=this.Cuf(Jc)).returnValue;k.ULS.shipAssertTag(9204887,355,jd);jd&&this.ESf(Jc);break;case 2:(Jc=Object(v.a)(mh,Jc),Da.id.equals(Jc.paragraphId))?Da.isConnected&&(jd=({iterator:Jc}=this.Cuf(Da)).returnValue,k.ULS.shipAssertTag(16820002,355,jd),jd&&this.ESf(Jc)):k.ULS.shipAssertTag(16820001,355,!1)}}}HEk(Da,sb){const ec=this.Stb.hOa(sb.characterData,sb.qa),Jc=
this.Stb.kxb(ec,Da.EQ);Da=this.Stb.kxb(ec,Da.V2);return Jc===Da?lc.a.Uc(sb,Jc):lc.a.createTextRange(sb,Jc,Da)}Mgi(Da){const sb=Da.node.qa,ec=Da.cpBegin;Da=Da.cpEnd;for(let Jc=0;Jc<sb.length;Jc++){const jd=sb.J(Jc);if(jd.cp>=Da)break;if(jd.cp>=ec){if(jd.Ff)return k.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(jd.blob)return k.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(jd.af||jd.wgb||jd.t6b)return k.ULS.sendTraceTag(8242649,
355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}hl.jDi="ParagraphAlreadyDirty";hl.pfj="UnsafeWetChange";Object(l.a)(hl,"RttEditor",null,[291]);var Xh=d(1426),Cd=d(249);class db{constructor(){this.w6c=new O.a}add(Da){this.w6c.add(Da);return!0}$Gd(Da){const sb=new O.a;for(let ec of this.w6c)Da(ec)&&sb.add(ec);return sb}VRf(Da){Da.activity.MFf("dried");this.w6c.remove(Da)}YRf(Da){Da.activity.MFf("expired");this.w6c.remove(Da)}}Object(l.a)(db,"RttAddParagraphDataStore",null,[]);
class Db extends Wc{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf){super(2,bf);this.Nc=Da;this.nj=sb;this.D_=ec;this.kag=Jc;this.JDf=jd;this.IDf=Ud;this.UG=ve}serialize(){const Da=new xe.a(2,this.Nc,this.nj,null,this.kag,null,null,this.UG),sb=new lb(this.D_,this.JDf,this.IDf);return new Vb(this.metadata.packetId,this.metadata.clientId,1,3,Da,null,void 0,void 0,sb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const sb=Da.rS,ec=Da.TWb;let Jc=null;null!=Da.rS.oDa&&(Jc=Da.rS.oDa);
return new Db(sb.fOa,sb.J3a,ec.h5f,Jc,ec.fKf,ec.D_,sb.UG,lf.create(Da))}static rHl(Da,sb){return 3!==Da.type?null:new Db(Da.Qma.Nc,Da.Qma.nj,Da.WKm.nj,Da.NNa?Da.NNa.Nc:null,Da.tua.Nc,Da.tua.nj,Da.UG,sb)}}Object(l.a)(Db,"RttAddParagraphOp",Wc,[]);class Yb{constructor(Da){this.IU=Da}LKi(){this.IU&&this.IU.properties.Z(Yb.nGh,"1")}ahn(Da){this.IU&&(this.IU.properties.xb(Yb.YAf)||this.IU.properties.Z(Yb.YAf,(Da-this.IU.startTime).toString()))}MFf(Da){this.IU&&(this.IU.properties.Z(Yb.sPi,Da),this.IU.end())}oin(Da){this.IU&&
this.IU.properties.Z(Yb.rCi,Da.toString())}nin(Da){this.IU&&this.IU.properties.Z(Yb.LBi,Da)}static $mf(Da){Da.t3(ye.a.aJb,Yb.nGh,Xh.a.p9i);Da.t3(ye.a.aJb,Yb.T6k,Xh.a.p9i);Da.t3(ye.a.aJb,Yb.YAf,Xh.a.Ugk);Da.t3(ye.a.aJb,Yb.sPi,Xh.a.Wra);Da.t3(ye.a.aJb,Yb.rCi,Xh.a.Wra);Da.t3(ye.a.aJb,Yb.LBi,Xh.a.Wra)}static create(Da){if(!Da)return null;Da=Da.oo(ye.a.aJb,Yb.rro);return new Yb(Da)}}Yb.nGh="FailedToFindInitialParaID";Yb.T6k="FailedToFindInitialTextID";Yb.YAf="MsecUntilApplied";Yb.sPi="RemovedBecause";
Yb.rCi="PacketVersions";Yb.LBi="OperationType";Yb.rro=48E4;Object(l.a)(Yb,"RttOpActivity",null,[]);var zc;(function(Da){Da[Da.unknown=0]="unknown";Da[Da.QJo=1]="replaceTextRangeOp";Da[Da.hBo=2]="addParagraphOp";Da[Da.fDo=3]="deleteParagraphOp";Da[Da.QLo=4]="splitParagraphOp";Da[Da.xHo=5]="mergeParagraphOp";Da[Da.PJo=6]="replaceSymbolRangeOp"})(zc||(zc={}));Object(l.b)("RttOpType",zc);var Vc=d(134);class bd extends dk{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e,cf,oi){super(Jc,jd,Ud,ve,bf,$e,cf,oi,6);this.font=
Da;this.legacy=sb}yif(){return"OffsetStart: "+this.EQ+"OffsetEnd: "+this.V2}serialize(){const Da=this.lvh();return new Vb(this.metadata.packetId,this.metadata.clientId,1,7,Da,null,this.D_,this.Dlb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){let sb,ec,Jc,jd;if(!({EQ:sb,V2:ec,Nc:Jc,nj:jd}=dk.qdj(Da)).returnValue)return null;let Ud,ve;if(1===Da.text.length)Ud=!1,ve=Vc.AParagraphNode.BB;else if(2===Da.text.length)if(Aa.a.sdi(Da.text,0)&&Aa.a.Ny(Da.text,1))Ud=
!0,ve=Da.text;else return k.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",Da.ft),null;else return k.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Da.ft),null;const bf=Da.G1c,$e=lf.create(Da);return new bd(bf.L3f,bf.M3f,Ud,Jc,jd,sb,ec,Da.oLb,ve,Da.rS.UG,$e)}}Object(l.a)(bd,"RttReplaceSymbolRangeOp",dk,[124,150]);class ce extends dk{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf){super(Da,sb,ec,
Jc,jd,Ud,ve,bf,1)}yif(){return"OffsetStart: "+this.EQ+"OffsetEnd: "+this.V2+"TextAddedLength: "+this.Dlb.length}serialize(){const Da=this.lvh();return new Vb(this.metadata.packetId,this.metadata.clientId,1,2,Da,null,this.D_,this.Dlb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){let sb,ec,Jc,jd;if(!({EQ:sb,V2:ec,Nc:Jc,nj:jd}=dk.qdj(Da)).returnValue)return null;let Ud="";Da.text&&(Ud=Da.text);const ve=lf.create(Da);return new ce(Jc,jd,sb,ec,Da.oLb,Ud,Da.rS.UG,
ve)}static sGl(Da,sb,ec){if(Da.type)return null;const Jc=ec.hOa(Da.W2.characterData,Da.W2.qa);return new ce(Da.W2.Nc,Da.W2.nj,ec.iic(Jc,Da.cpBegin),ec.iic(Jc,Da.cpEnd),Da.tua.nj,Da.uua,Da.UG,sb)}}Object(l.a)(ce,"RttReplaceTextRangeOp",dk,[124,150]);class ud{constructor(Da,sb,ec,Jc,jd,Ud,ve,bf,$e,cf,oi,Dc,Ag,Uc,cl,Sh,Kh,uk,Xg,nj,qj){this.Oq=null;this.uve=this.H5g=!1;this.j$c=!0;this.S9c=!1;this.FSg=0;this.o_g=this.DGe=this.q_g=this.n_g=this.p_g=this.U0g=!1;this.mIf=()=>{k.ULS.sendTraceTag(7685328,
355,50,"All prerequisite ready for RttManager");this.Oq=this.Mca.result;k.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Oq.p1(this.Caa)};this.Caa=(Lj,bh)=>{if(3===bh.type||this.S9c&&10===bh.type)if(this.S9c&&10===bh.type)this.FSg="boolean"===typeof bh.dJ?bh.dJ?1:0:bh.dJ;else if(this.sSb.value&&!this.sSb.value.OKd)k.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(bh.dJ){if(this.Ain(),(Lj=this.VTk(bh.dJ))&&1!==Lj.metadata.clientType){this.zin();
if(this.Bo&&!this.Bo.baa&&(u.AFrameworkApplication.Hf("1i00j689;ba0dg262"),this.U0g))return;if(!this.S9c||2!==this.FSg)switch(this.oUb&&this.j$c&&(this.nUb.XKi(),this.j$c=!1),this.H5g||this.f2l(),Lj.opType){case 1:case 6:case 4:if(!({Bg:Lj}=this.s1j(Lj)).returnValue)break;this.a3g?this.gVi(Lj):this.tej(Lj);break;case 2:this.kjc.add(Lj),this.J7h(Lj),this.a3g?this.gVi(Te.a.nil):this.sej(Lj)}}}else k.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")};this.D5k=()=>{const Lj=this.Bi.value;if(Lj){var bh=
this.dA()-ud.Qon,si=this.yob.$Gd(ig=>ig.metadata.v5f<bh);0<si.count&&this.bhn();var nf=new Cd.a;for(let ig of si)if(this.yob.YRf(ig),ig.s5)switch(ig.s5.opType){case 1:nf.add(ig.s5.paragraphId.toString());break;case 6:nf.add(ig.s5.paragraphId.toString());break;case 4:nf.add(ig.s5.v9d.toString()),nf.add(ig.s5.$Cc.toString())}si=this.kjc.$Gd(ig=>ig.metadata.v5f<bh);for(let ig of si)this.kjc.YRf(ig),ig.s5&&nf.add(ig.s5.paragraphId.toString());for(let ig of nf)(nf=Lj.Eb(Te.a.Of(ig)))?nf.vN?(this.dtb.Fon(nf),
nf.vN||this.crc.value.JOi(nf)):k.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):k.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.Bi.$Kd&&k.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.dtb=Da;this.yob=sb;this.crc=ec;this.sSb=Jc;this.OH=jd;this.Mca=Ud;this.Bi=ve;this.Hb=bf;this.dA=$e;this.Stb=cf;this.ld=oi;this.eDe=Ag;this.Hc=Uc;this.a3g=cl;this.nUb=Sh;this.oUb=
!!u.AFrameworkApplication.K&&u.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.RttPerfMetricsIsEnabled",!1);this.wnb=Kh;this.QMe=uk;this.jtc=new tk.a(Ga.a.Rj());this.kjc=new db;Dc.execute(ud.$mf);this.S9c=Xg;this.U0g=nj;this.Bo=qj}f2l(){const Da=new Ca.a(3,2,ud.Sqn,this.D5k);this.Hb.$b(Da);this.H5g=!0}init(){return this.Mca?this.Mca.continueWith(this.mIf):G.Task.e$(!1)}VTk(Da){Da=md(Da);if(!Da)return null;switch(Da.ft){case 2:return ce.create(Da);case 7:return bd.create(Da);
case 4:return ej.create(Da);case 3:return Db.create(Da);default:return k.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Da.ft),null}}s1j(Da){let sb=Te.a.nil;if(!this.yob.r1j(Da))return{returnValue:!1,Bg:sb};this.J7h(Da);if(!this.OH)return{returnValue:!1,Bg:sb};const ec=this.OH.Vdb(Da.Nc);if(ec.equals(Te.a.nil)||!this.Bi.value.Eb(ec))return Da.activity.LKi(),{returnValue:!1,Bg:sb};this.$Ki();return{returnValue:!0,Bg:ec}}gVi(Da){Da.equals(Te.a.nil)||this.jtc.add(Da.toString());
this.uve||(Da=new Ca.a(0,1,200,()=>{this.gdo();this.uve=!1},71),this.Hb.$b(Da),this.uve=!0)}BCn(Da){Da=new Ca.a(0,1,0,Da,71);this.Hb.$b(Da)}J7h(Da){Da.activity=Yb.create(this.ld);Da.activity.oin(Da.metadata.packetVersion);Da.activity.nin(zc[Da.opType])}gdo(){var Da=this.kjc.$Gd(ec=>!ec.s5);for(let ec of Da)this.sej(ec);if(this.jtc.count){Da=null;for(var sb of this.jtc){sb=Te.a.Of(sb);Da=this.Bi.value.Eb(sb);break}sb=this.Hc.Rc(3);try{sb.Db(Da);for(let ec of this.jtc)this.tej(Te.a.Of(ec))}finally{sb&&
sb.dispose()}this.jtc.clear()}}tej(Da){Da=this.Bi.value.Eb(Da);let sb;const ec=this.Hc.Rc(3);try{ec.Db(Da);sb=this.ld.oo(ye.a.adh);const Jc=this.edh(Da,sb);sb.end();Jc&&this.g4j(Jc)}finally{ec&&ec.dispose(),this.oUb&&(this.nUb.tQf(1),this.j$c=!0)}}sej(Da){var sb=this.dtb.P9k(Da,this.OH,this.Bi.value);sb&&(this.$Ki(),this.dtb.tbo(Da,sb,this.wnb,qa.a.instance.resolve("Box4.IParagraphEditor"))&&(sb=this.Bi.value.Eb(Da.s5.paragraphId),this.xdh(sb,Da),this.oUb&&(this.nUb.tQf(1),this.j$c=!0)))}g4j(Da){this.eDe.continueWith(()=>
{if(1===Da.opType){var sb=this.CEl(Da);sb&&(this.eDe.result.vOe(sb),this.eDe.result.V3d(!0))}})}CEl(Da){const sb=Da.serialize();if(2!==sb.ft||sb.rS.oDa&&sb.rS.fOa!==sb.rS.oDa)return null;const ec=Da.EQ.clone();0<Da.Dlb.length&&(ec.knh(),ec.cp+=Da.Dlb.length);sb.ft=0;sb.text=null;sb.rS.J2d=0;sb.rS.EQ=ec;sb.rS.J3a=sb.oLb;sb.rS.oDa=null;sb.rS.hgc=null;sb.rS.V2=null;sb.oLb=null;return $c.P_e(sb,this.OH,this.Stb,()=>this.Bi.value,this.QMe.instance)}xdh(Da,sb){return this.crc.value?this.crc.value.j0j(Da,
sb.metadata.clientId).returnValue?!0:(k.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(k.ULS.shipAssertTag(7866378,355,!!this.crc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}ddh(Da,sb){this.edh(Da,sb)}edh(Da,sb){if(!Da)return null;if(!Da.anchor)return sb&&sb.properties.Z(ud.$ti,"1"),null;if(!Da.hasProperty(fg.a.Nc))return k.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!Da.hasProperty(fg.a.nj))return k.ULS.sendTraceTag(8197722,
355,15,"Paragraph is missing the TextId property"),null;if(Da.hasProperty(fg.a.Yzh)&&Da.getValue(fg.a.Yzh))return k.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const ec=Da.getValue(fg.a.Nc);var Jc=Da.Hka;sb&&(sb.properties.Z(ud.QLm,Jc.toString()),sb.properties.Z(ud.SLm,ec.toString()));Jc=this.yob.Qff(ec,Jc);if(!Jc)return sb&&sb.properties.Z(ud.Nti,"1"),null;if(!this.xdh(Da,Jc))return sb&&sb.properties.Z(ud.vsh,"1"),null;let jd=0,Ud=null;for(;Jc;){if(!this.dtb.Edk(Jc,Da,
this.wnb,sb)){sb&&sb.properties.Z(ud.slj,"1");break}jd++;Jc.activity.ahn(this.dA());Ud=Jc;Jc=Da.Hka;Jc=this.yob.Qff(ec,Jc)}0<jd&&this.sKi();sb&&sb.properties.add(ud.tlj,jd.toString());return Ud}z3d(Da){if(Da.hasProperty(fg.a.Nc)&&Da.hasProperty(fg.a.nj)){var sb=Da.getValue(fg.a.Nc),ec=Da.ia(fg.a.nj,0),Jc=this.ld.oo(ye.a.QMi),jd=this.wnb.NSm(Da.id);0<jd.count&&(this.dtb.ZUf(Da,jd,this.Bi.value),this.mpn(Da,jd,ec));var Ud=this.wnb.Tgl(sb);if(Ud&&!Da.id.equals(Ud.paragraphId)){const ve=this.Bi.value;
this.BCn(()=>{const bf=this.wnb.gib(Ud.paragraphId),$e=ve.Eb(Ud.paragraphId);k.ULS.shipAssertTag(16820032,355,!!$e,"Could not find added graph node");$e&&(this.dtb.ZUf($e,bf,ve),this.kjc.VRf(Ud.wOe))})}this.yob.Qff(sb,ec)||this.crc.value.JOi(Da);this.ddh(Da,Jc);Jc.end()}}mpn(Da,sb,ec){let Jc=!1;for(let Ud=sb.count-1;0<=Ud;Ud--){var jd=sb.J(Ud);switch(jd.opType){case 1:case 6:case 4:jd=Object(v.a)(124,jd.operation);break;default:continue}jd.D_===ec&&(Jc=!0,jd.x4a&&!jd.x4a.kpo(Da)&&k.ULS.sendTraceTag(8765831,
355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",jd.opType,jd.yif(),Da.id,jd.x4a.id,jd.x4a.cpBegin,jd.x4a.cpEnd));Jc&&this.yob.VRf(jd)}Jc&&this.sKi()}MTc(Da){const sb=this.wnb.gib(Da.id);0<sb.count&&(2===sb.J(0).opType&&sb.removeAt(0),this.dtb.ZUf(Da,sb,this.Bi.value))}X7d(Da){var sb=this.wnb.ABl(Da.id);for(let ec of sb)if(4===ec.opType&&(sb=Object(v.a)(al,ec),Da.id.equals(sb.K_j)))return!0;return!1}Ain(){this.p_g||
(k.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.p_g=!0)}zin(){this.n_g||(k.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.n_g=!0)}$Ki(){this.q_g||(k.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.q_g=!0)}sKi(){this.DGe||(k.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.DGe=!0)}bhn(){this.DGe||this.o_g||(k.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.o_g=!0)}static $mf(Da){const sb=
[ye.a.adh,ye.a.QMi];for(let ec of sb)Da.t3(ec,ud.tlj,Xh.a.Wra),Da.t3(ec,ud.Nti,Xh.a.Wra),Da.t3(ec,ud.$ti,Xh.a.Wra),Da.t3(ec,ud.vsh,Xh.a.Wra),Da.t3(ec,ud.slj,Xh.a.Wra),Da.t3(ec,hl.jDi,Xh.a.Wra),Da.t3(ec,hl.pfj,Xh.a.Wra);Yb.$mf(Da)}}ud.Sqn=6E4;ud.Qon=18E4;ud.tlj="WetChangeCount";ud.Nti="NoChangesToApply";ud.$ti="NodeNotConnected";ud.vsh="CouldNotGetLock";ud.slj="WetChangeBlocked";ud.SLm="NodeWordId";ud.QLm="NodeTextId";Object(l.a)(ud,"RttManager",null,[125]);class Sb{constructor(Da,sb){this.PTi=0;this.keb=
Da;this.zAn=sb}XKi(){this.PTi=this.keb()}tQf(Da){const sb=this.keb()-this.PTi;0<=sb&&this.zAn.track(Math.round(sb),0===Da?"CTB":"RTP")}}Object(l.a)(Sb,"RttPerfCounter",null,[123]);var Gf=d(1853);class gg{constructor(){this.Puc=new Gf.a}O4j(Da,sb){this.Puc.back()&&sb&&this.Puc.back().Vab(Da)||this.Puc.enqueue(Da)}lAl(){return this.Puc.isEmpty?null:this.Puc.dequeue()}}Object(l.a)(gg,"RttSendDataStore",null,[120]);class mi extends Wc{constructor(Da,sb,ec,Jc){super(3,Jc);this.Nc=Da;this.nj=sb;this.UG=
ec}get D_(){return 0}serialize(){const Da=new xe.a(4,this.Nc,this.nj,null,null,null,null,this.UG);return new Vb(this.metadata.packetId,this.metadata.clientId,1,5,Da,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const sb=Da.rS;return new mi(sb.fOa,sb.J3a,sb.UG,lf.create(Da))}static sHl(Da,sb){return 4!==Da.type?null:new mi(Da.W_b.Nc,Da.W_b.nj,Da.UG,sb)}}Object(l.a)(mi,"RttDeleteParagraphOp",Wc,[124,150]);class ni extends Wc{constructor(Da,
sb,ec,Jc,jd,Ud,ve,bf){super(5,bf);this.jag=Da;this.haj=sb;this.yso=ec;this.I7n=Jc;this.UG=jd;this.gmj=Ud;this.igc=ve}get Nc(){return this.jag}get nj(){return this.haj}get D_(){return this.jag===this.gmj?this.igc:0}serialize(){const Da=new xe.a(5,this.jag,this.haj,null,this.yso,this.I7n,null,this.UG),sb=new Kb(this.gmj,this.igc);return new Vb(this.metadata.packetId,this.metadata.clientId,1,6,Da,null,void 0,void 0,void 0,sb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Da){const sb=
Da.rS,ec=Da.aSc;return new ni(sb.fOa,sb.J3a,sb.oDa,sb.hgc,sb.UG,ec.eKf,ec.igc,lf.create(Da))}static tHl(Da,sb){return 2!==Da.type?null:new ni(Da.Qma.Nc,Da.Qma.nj,Da.NNa.Nc,Da.NNa.nj,Da.UG,Da.LUd.Nc,Da.LUd.nj,sb)}}Object(l.a)(ni,"RttMergeParagraphOp",Wc,[124,150]);class hi{constructor(Da,sb,ec,Jc,jd,Ud){this.tvc=this.jj=null;this.sca=!1;this.GKe=this.z3g=0;this.Vmd=this.J4g=!1;this.EFe=0;this.mIf=()=>{k.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.jj=this.Mca.result;
this.jj.g3d(this)};this.azi=(ve,bf)=>{if(this.jj&&2===this.jj.connectionState&&(ve=bf.AF,ve.length))if(bf.y9)100>this.GKe&&(this.GKe++,k.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",bf.Aik,this.z3g,this.GKe));else{for(bf=0;bf<ve.length;bf++)if(!this.Xmm(ve[bf]))return;for(bf=0;bf<ve.length;bf++){let $e=ve[bf];this.oZg.O4j($e,!$e.type&&!bf)}this.tvc||this.Iyi(this.tvc,this.jj)}};this.Mca=Da;this.oZg=sb;this.wca=ec;this.rt=Jc;this.dra=jd;this.nUb=
Ud;this.oUb=!!u.AFrameworkApplication.K&&u.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.RttPerfMetricsIsEnabled",!1)}get Gp(){return this.wca.value}init(){return this.Mca?this.Mca.continueWith(this.mIf):G.Task.e$(!1)}start(){this.sca||(this.rt.Yc?(this.rt.Yc.AF.F8j(this.azi),this.sca=!0):k.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.sca&&(this.sca=!1,this.rt.Yc.AF.gsn(this.azi))}Xmm(Da){return Da&&-1!==Da.UG?Da.type&&3!==
Da.type&&1!==Da.type?!1:!0:!1}eBm(){this.Vmd||(this.J4g||(k.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.J4g=!0),!this.Vmd&&5>=this.EFe&&this.EFe++)}sBm(){!this.Vmd&&5>=this.EFe&&(k.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.Vmd=!0)}Iyi(Da,sb){this.eBm();Da&&(Da.Ji||Da.ho)&&k.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Da.exception);this.oUb&&this.nUb.XKi();(Da=this.uHl(this.oZg.lAl()))?(this.z3g++,this.tvc=sb.oO(3,Ie(Da.serialize())),
this.sBm(),this.oUb&&this.nUb.tQf(0),this.tvc.continueWith(ec=>{this.Iyi(ec,sb)})):this.tvc=null}uHl(Da){if(!Da)return null;if(!this.Gp)return k.ULS.sendTraceTag(8245957,355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const sb=new lf(Og.instance.PUh(),this.Gp.qj,1,0,0,ke.instance.yAl());let ec=null;switch(Da.type){case 0:ec=ce.sGl(Da,sb,this.dra);break;case 4:ec=mi.sHl(Da,sb);break;case 3:ec=Db.rHl(Da,sb);break;case 2:ec=ni.tHl(Da,sb);break;case 1:ec=ej.vHl(Da,
sb,this.dra)}return ec}}Object(l.a)(hi,"RttSendManager",null,[121]);class nh{constructor(){this.W=null;this.syl=()=>Sa.App.ud&&Sa.App.ud.Lq?Sa.App.ud.Lq:(k.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}yc(Da){const sb=ka.a.Kq(Da.Za("Box4.IOutlineElementEditor")),ec=ka.a.Kq(Da.Za("Box4.IFeatureHelper")),Jc=ka.a.Kq(Da.Za("Common.IActivityAggregationInfo")),jd=ka.a.Kq(Da.Za("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),
Ud=ka.a.Kq(Da.Za("Box4.CompositionStateManager"));this.W=Da;const ve=new wg.a;G.Task.WAA.call(null,sb,ec,Jc,jd,Ud).continueWith(()=>{Da.ha("WordEditor.RealTimeTyping.IRttEditor",()=>new hl(Da.resolve("Box4.ICharacterPropertiesEditor"),Da.resolve("Box4.IOutlineElementEditor"),ve,Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).singleInstance();Da.register(Sb,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").singleInstance().Yd(()=>new Sb(Oe.a.lf,ri.a.sF(17,
1,new Rl.a(new Tf.a(.25)))));Da.ha("WordEditor.RealTimeTyping.RttManager",()=>new ud(Da.resolve("WordEditor.RealTimeTyping.IRttEditor"),new bi(hm.a.instance),new J.a(this.syl),new J.a(()=>Sa.App.F_),Da.resolve("WordEditor.ParagraphWordIdMapping"),Da.resolve("Box4.Presence.IRtcProxyProvider").tI(),new J.a(()=>Sa.App.xa.jb&&Sa.App.xa.jb.Yc?Sa.App.xa.jb.Yc.zd:(k.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),zb.a.instance,()=>Date.now(),Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),
hm.a.instance,Da.Za("Common.IActivityAggregationInfo"),Td.tI(),ve,u.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),Da.resolve("WordEditor.IRttPerfCounter"),new gl,Da.Za("WordEditor.Presence.IWordPresenceCpFactory"),u.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.DisableRttInFluid",!1),u.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.SkipUpdateGraphWhenComposing",!1),Da.resolve("Box4.CompositionStateManager"))).as("WordEditor.RealTimeTyping.IRttManager").singleInstance();
Da.ha("WordEditor.RealTimeTyping.RttSendManager",()=>new hi(Da.resolve("Box4.Presence.IRtcProxyProvider").tI(),new gg,new J.a(()=>Sa.App.ud),Sa.App.xa.jb,Da.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Da.resolve("WordEditor.IRttPerfCounter"))).singleInstance();this.anf()})}anf(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){ua.a.instance.Oc(new nh)}}Object(l.a)(nh,
"WordEditorRealTimeTypingPackage",null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");la.main();Type.registerNamespace("Common.App.CollabControls");Ma.prototype.toString=Ka.a.prototype.toString;
Na.prototype.toString=Ka.a.prototype.toString;ua.a.instance.Oc(new Tg);nh.main();Type.registerNamespace("RealtimePresenceUI");ua.a.instance.Oc(new Rc);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");va.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/16477519/wdjs/WordEditorDS.collab.js.map