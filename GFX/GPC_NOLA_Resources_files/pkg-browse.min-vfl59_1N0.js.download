define("metaserver/static/js/cloud_docs/create_api",["require","exports","tslib","typescript/libraries/shared/apex-metrics/src/index","metaserver/static/js/api_v2/user_client","metaserver/static/js/cloud_docs/constants","metaserver/static/js/cloud_docs/create_pointer_modal","metaserver/static/js/cloud_docs/event_logging","metaserver/static/js/cloud_docs/types","metaserver/static/js/filepath/filepath","metaserver/static/js/logging/hive/schemas/web-modal-activity","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/folder_dialog/async","metaserver/static/js/components/ui/modal","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/browse/api","metaserver/static/js/browse/action_logger","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/browser","js/browser/cookies","metaserver/static/js/core/i18n","spectrum/util/uuid_generator","metaserver/static/js/metrics/index","metaserver/static/js/cloud_docs/constants"],(function(e,t,r,o,s,i,a,n,c,l,d,_,u,p,E,f,m,S,g,h,O,T,I,R){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCreateActionSource=t.createNewPointer=t.createNewCloudOnlyDoc=t.createPlaceholderTabForNewCloudDoc=t.constructFormForCreateNewMicrosoftFile=t.createNewFile=t.showAsyncFolderDialog=t.logCreateFileSuccessCallback=t.logCreateFileCallback=t.logCreateFileAttempt=t.getDepthFromPath=t.CloudDocSnackbarId=void 0,l=r.__importStar(l),_=r.__importStar(_),u=r.__importStar(u),f=r.__importStar(f),g=r.__importStar(g);const v=O.intl.formatMessage({id:"UpDkTB",defaultMessage:"Create file in..."}),A=O.intl.formatMessage({id:"7E4VWP",defaultMessage:"Create shortcut in..."}),b=O.intl.formatMessage({id:"bhV8Xa",defaultMessage:"Create"}),N=O.intl.formatMessage({id:"GDikFY",defaultMessage:"Choose folder"});t.CloudDocSnackbarId="create-cloud-doc";t.getDepthFromPath=e=>(e.replace(/\/$/,"").match(/\//g)||[]).length;t.logCreateFileAttempt=(e,t)=>{(0,n.logUserAction)({actionEvent:c.UserActionEventType.PRE_CREATE,userId:t.userId,actionSource:t.action_source,data:{webOpenId:e}})};t.logCreateFileCallback=({ts:e,documentType:t,selectionMode:s,emptyFolder:i,error:a})=>r.__awaiter(void 0,void 0,void 0,(function*(){const r=(0,I.getMetricsReporter)(),n={};n.document_type=t||"unknown",n.selection_mode=s||"undefined",n.empty_folder=String(i),n.error=a?"true":"false",r.createStats({ns:R.CLOUD_DOCS_AMP_NAMESPACE,name:"web/createFile"},n).recordDuration(Date.now()-e,o.TimeUnit.MILLISECONDS)}));t.logCreateFileSuccessCallback=({ts:e,openId:r,selection_mode:o,empty_folder:s})=>i=>{(0,t.logCreateFileCallback)({ts:Date.now(),documentType:i.documentType,selectionMode:o,emptyFolder:s}),(0,m.logFileCreateSuccess)({uid:i.userId,document_type:i.documentType,time_elapsed:Date.now()-e,open_id:r,selection_mode:o,empty_folder:s}),(0,n.logUserAction)({actionEvent:c.UserActionEventType.CREATE,userId:i.userId,docPathOrId:i.fq_path,actionSource:i.action_source,data:{webOpenId:r}})};t.showAsyncFolderDialog=({user:e,source:r,documentType:o,selection_mode:s,empty_folder:a,handleClickNewFolder:n,initialPath:c})=>{const l=(0,i.isPointerFileType)(o),_=l?A:v,p=l?N:b;u.showFolderDialog({modalName:d.ModalName.CLOUD_DOCS_CREATE,user:e,title:_,primaryActionLabel:p,handleClickNewFolder:n,initialPath:c,useApiV2:!0,onSuccess:(i,n)=>{const c=i||"/";(0,m.logFileCreateClick)({uid:e.id,source:r,action:S.WebUserActionLogEvent.FILE_CREATE_HOME_FOLDER_SELECTED,depth_folder_selected:(0,t.getDepthFromPath)(c),selection_mode:s,empty_folder:a}),(0,t.createNewFile)({user:e,path:c,documentType:o,source:r,selection_mode:s,empty_folder:a})}})};t.createNewFile=({user:o,path:s,documentType:c,source:l,selection_mode:d,empty_folder:_,defaultUrl:u})=>r.__awaiter(void 0,void 0,void 0,(function*(){return Promise.all([new Promise((t,r)=>{e(["metaserver/static/js/account/email"],t,r)}).then(r.__importStar),new Promise((t,r)=>{e(["metaserver/static/js/account/email_verify_reasons"],t,r)}).then(r.__importStar)]).then(([{EmailVerification:e},{EmailVerificationReasons:r}])=>{if(!e.get_for_user(o).verified_or_show(r.CLOUD_DOCS))return;const p=(0,T.generateUUID)("web-create");if((0,i.isMicrosoftFileType)(c)){(0,t.logCreateFileAttempt)(p,{userId:o.id,action_source:(0,n.getActionSourceFromNewFileMenuType)(l)});const e=(0,t.logCreateFileSuccessCallback)({ts:Date.now(),openId:p,selection_mode:d,empty_folder:_});C({userId:o.id,path:s,documentType:c,logSuccessCallback:e,source:l})}else if((0,i.isPointerFileType)(c))a.CreatePointerModal.showInstance({createOnSubmit:e=>{(0,t.logCreateFileAttempt)(p,{userId:o.id,action_source:(0,n.getActionSourceFromNewFileMenuType)(l)});const r=(0,t.logCreateFileSuccessCallback)({ts:Date.now(),openId:p,selection_mode:d,empty_folder:_});(0,t.createNewPointer)({userId:o.id,pathName:s,name:e.pointerData.name,url:e.pointerData.url,onError:e.onError,logSuccessCallback:r,source:l})},defaultUrl:u});else{(0,t.logCreateFileAttempt)(p,{userId:o.id,action_source:(0,n.getActionSourceFromNewFileMenuType)(l)});const e=(0,t.logCreateFileSuccessCallback)({ts:Date.now(),openId:p,selection_mode:d,empty_folder:_});(0,t.createNewCloudOnlyDoc)({userId:o.id,pathName:s,title:O.intl.formatMessage({id:"j+AeKy",defaultMessage:"Untitled"}),documentType:c,logSuccessCallback:e,source:l,openId:p,selection_mode:d,empty_folder:_})}})}));const C=({userId:e,path:r,documentType:o,logSuccessCallback:s,source:i})=>{const a={fq_path:r,extension:o,action_source:(0,t.getCreateActionSource)(i),_subject_uid:String(e),t:h.Cookies.read("__Host-js_csrf")},c=(0,t.constructFormForCreateNewMicrosoftFile)(a);document.body.appendChild(c),c.submit(),s({userId:e,documentType:o,action_source:(0,n.getActionSourceFromNewFileMenuType)(i)})};t.constructFormForCreateNewMicrosoftFile=e=>{const t=document.createElement("form");t.action="/ow/msft/create_new_file",t.method="POST",t.target="_blank";for(const r of Object.keys(e)){const o=document.createElement("input");o.type="hidden",o.name=r,o.value=e[r],t.appendChild(o)}return t};t.createPlaceholderTabForNewCloudDoc=()=>g.open_tab(i.LOADING_PAGE_URL,!0);t.createNewCloudOnlyDoc=({userId:e,pathName:r,title:o,documentType:s,logSuccessCallback:i,source:a,openId:c,selection_mode:l,empty_folder:d})=>{const u=O.intl.formatMessage({id:"XcMi4Q",defaultMessage:"Creating new file…"}),p=O.intl.formatMessage({id:"5VrbkU",defaultMessage:"File created!"}),m=e=>(e.preventDefault(),e.returnValue="","");window.addEventListener("beforeunload",m);let S=(0,t.createPlaceholderTabForNewCloudDoc)();const g=h=>{E.Snackbar.sync(u,!0,t.CloudDocSnackbarId),f.createCloudDoc({pathName:r,title:o,documentType:s,userId:e,onSuccess:({changesets:r,createdFile:o,failureDetails:u})=>{if(u){const e=()=>{i=(0,t.logCreateFileSuccessCallback)({ts:Date.now(),openId:c,selection_mode:l,empty_folder:d}),S=(0,t.createPlaceholderTabForNewCloudDoc)(),g(!1)};S.close(),E.Snackbar.close(t.CloudDocSnackbarId),window.removeEventListener("beforeunload",m),_.showFileSystemWarningsModal({fsws:u,confirmText:O.intl.formatMessage({id:"bhV8Xa",defaultMessage:"Create"}),onFinalAccept:e})}else if(E.Snackbar.complete(p,t.CloudDocSnackbarId),window.removeEventListener("beforeunload",m),null!==o&&(i({userId:e,documentType:s,fq_path:o.fq_path,action_source:(0,n.getActionSourceFromNewFileMenuType)(a)}),S)){let e=o.open_to_url;try{const t=new URL(e);t.searchParams.set("web_open_id",c),e=t.toString()}catch(e){}S.location.replace(e)}},onError:e=>{(0,t.logCreateFileCallback)({ts:Date.now(),documentType:s,selectionMode:l,emptyFolder:d,error:!0}),E.Snackbar.fail(e,t.CloudDocSnackbarId),window.removeEventListener("beforeunload",m)},checkFSWs:h})};g(!0)};t.createNewPointer=({userId:e,pathName:t,name:r,url:o,onError:a,logSuccessCallback:d,source:_})=>{const u=new s.UserApiV2Client,f=O.intl.formatMessage({id:"l6L9q8",defaultMessage:"Creating new shortcut"}),m=O.intl.formatMessage({id:"EqUCHi",defaultMessage:"Created shortcut"});return E.Snackbar.sync(f,!0,"create-cloud-shortcut"),u.ns("cloud_docs").rpc("create",{to_path:l.normalize(t)||"/",title:r,cloud_doc_type:c.SimplePointer,pointer_url:o},{subjectUserId:e}).then(t=>{d({userId:e,documentType:i.PointerFileTypes.SIMPLE_POINTER,fq_path:t.result_path,action_source:(0,n.getActionSourceFromNewFileMenuType)(_)}),p.Modal.close(),E.Snackbar.complete(`${m} "${l.filename(t.result_path)}"`,"create-cloud-shortcut")}).catch(e=>{a(),E.Snackbar.fail(O.intl.formatMessage({id:"fi9Okp",defaultMessage:"Oops, something went wrong. Please try again later."}),"create-cloud-shortcut")})};t.getCreateActionSource=e=>{switch(e){case i.NewFileMenuFromType.BROWSE:return i.ActionSourceValue.WEB_BROWSE;case i.NewFileMenuFromType.HOME:return i.ActionSourceValue.WEB_HOME;default:return i.ActionSourceValue.WEB}}})),define("metaserver/static/js/cloud_docs/create_pointer_modal",["require","exports","tslib","react","metaserver/static/js/cloud_docs/pointers_common","metaserver/static/js/components/ui/css","metaserver/static/js/components/ui/modal","metaserver/static/js/core/i18n","dig-components/modal","dig-components/buttons"],(function(e,t,r,o,s,i,a,n,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreatePointerModal=void 0,o=r.__importDefault(o);const d=n.intl.formatMessage({id:"8yzGEK",defaultMessage:"Create a new shortcut"}),_=n.intl.formatMessage({id:"S8dvWz",defaultMessage:"Create"}),u=n.intl.formatMessage({id:"I5Fo4y",defaultMessage:"Creating..."}),p=n.intl.formatMessage({id:"vPeF94",defaultMessage:"Name"}),E=n.intl.formatMessage({id:"nYdrYR",defaultMessage:"URL"}),f=n.intl.formatMessage({id:"U1i5X8",defaultMessage:"Invalid URL"});class m extends o.default.Component{constructor(e){super(e),this.onChange=e=>{this.setState({pointerData:e})},this.handleCreateOnClick=()=>{this.setState({creationInProgress:!0}),this.props.createOnSubmit({pointerData:{name:this.state.pointerData.name.trim(),url:this.state.pointerData.url.trim()},onError:this.handleSubmitError})},this.handleSubmitError=()=>{this.setState({creationInProgress:!1})},this.closeModal=()=>{a.Modal.close()},this.state={pointerData:{name:"",url:""},creationInProgress:!1}}render(){const e=s.CreatePointerFields.canSubmit(this.state.pointerData)&&!this.state.creationInProgress;return o.default.createElement(c.Modal,{title:d,"aria-label":"Shortcut Creation Modal",open:!0},o.default.createElement(c.Modal.Header,{hasBottomSpacing:"title-standard"},o.default.createElement(c.Modal.Title,null,d)),o.default.createElement(c.Modal.Body,{hasVerticalSpacing:!1},o.default.createElement(s.CreatePointerFields,{name:this.state.pointerData.name,url:this.state.pointerData.url,onChange:this.onChange,onSubmit:this.handleCreateOnClick,nameLabel:p,urlLabel:E,urlValidationMessage:f,urlPrepopulateFunction:()=>Promise.resolve(this.props.defaultUrl)})),o.default.createElement(c.Modal.Footer,null,o.default.createElement(l.Button,{variant:"opacity",onClick:this.closeModal},n.intl.formatMessage({id:"gZIlfg",defaultMessage:"Cancel"})),o.default.createElement(l.Button,{variant:"primary",disabled:!e,onClick:this.handleCreateOnClick},this.state.creationInProgress?u:_)))}static showInstance(e){return a.Modal.showInstance(o.default.createElement(S,Object.assign({},e)))}}t.CreatePointerModal=m,m.displayName="CreatePointerModal";const S=(0,i.requireCssWithComponent)(m,["/static/metaserver/static/css/spectrum/index.web-vflJy4G-t.css","/static/metaserver/static/css/cloud_docs/create_pointer_modal-vflATc8Dt.css"])})),define("metaserver/static/js/cloud_docs/event_logging",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/api_v2/noauth_client","metaserver/static/js/cloud_docs/types","metaserver/static/js/clean/web_timing_logger","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/logging/hive/schemas/web-user-action","metaserver/static/js/logging/telemetry","metaserver/static/js/file_viewer/constants","metaserver/static/js/cloud_docs/constants","metaserver/static/js/perf_tools/web_timing_utils","metaserver/static/js/core/exception","metaserver/static/js/filepath/filepath"],(function(e,t,r,o,s,i,a,n,c,l,d,_,u,p,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logLoggedOutUXSnackBarAction=t.logInterstitialLoginAction=t.logFileConvertPromptAction=t.logFileOpenPromptAction=t.getActionSourceFromNewFileMenuType=t.getActionSourceFromSourceArgs=t.getActionSourceFromSurface=t.checkAndLogNpu=t.logLoggedOutUserAction=t.logUserAction=t.logClientEvent=t.logViewEvent=t.getStartTime=void 0,a=r.__importStar(a),l=r.__importStar(l);let f=void 0;t.getStartTime=()=>{try{f=f||window.performance.timing.fetchStart}catch(e){(0,p.reportStack)("Unable to get fetchStart from browser.",{severity:p.SEVERITY.NONCRITICAL}),f=a.start_time()}return f},t.logViewEvent=function(e,t,r){const s={file_views:[{file_info:{shared_link_details:{url:t}},platform_type:{".tag":r}}]};(new o.UserApiV2Client).ns("seen_state").rpc("log_file_view",s,{subjectUserId:e})},t.logClientEvent=function(e,r,o,n,c){const l=c||[];l.push({key:"time_on_page_with_redirect",value:a.time_since_start().toString()}),l.some(e=>"time_now"===e.key)||l.push({key:"time_now",value:Date.now().toString()}),(new s.NoAuthApiV2Client).ns("cloud_docs").rpc("log_client_event",{client:i.editorTypeToClient[r],doc_id:e,event_name:o,auth_token:n,time_on_page:u.WebTimingUtil.getNow()-(0,t.getStartTime)(),extras:l},{})},t.logUserAction=function(e){const t=(new o.UserApiV2Client).ns("cloud_docs");let r;e.hasOwnProperty("docPathOrId")&&e.docPathOrId&&(r={".tag":"path_or_id",path_or_id:e.docPathOrId});const s=e.data&&e.data.webOpenId,i=e.data&&e.data.origDest,a=e.data&&e.data.routingDest;t.rpc("log_user_action",{action:e.actionEvent,doc_id:r,source:e.actionSource,open_id:s,orig_dest:i,routing_dest:a,extra_info:e.extra},{subjectUserId:e.userId})},t.logLoggedOutUserAction=function(e){const t=(new s.NoAuthApiV2Client).ns("cloud_docs");let r;e.hasOwnProperty("docPathOrId")&&e.docPathOrId&&(r={".tag":"path_or_id",path_or_id:e.docPathOrId});const o=e.data&&e.data.webOpenId,i=e.data&&e.data.origDest,a=e.data&&e.data.routingDest;t.rpc("logged_out/log_user_action",{action:e.actionEvent,doc_id:r,source:e.actionSource,open_id:o,orig_dest:i,routing_dest:a,extra_info:e.extra},{})},t.checkAndLogNpu=function(e,t,r,s,i){(new o.UserApiV2Client).ns("cloud_docs").rpc("log_new_partner_users",{partner:t,cloud_doc_type:(0,E.file_extension)(r),cloud_editor:s,platform:i},{subjectUserId:e})};t.getActionSourceFromSurface=e=>"search"===e?i.UserActionSourceType.WEB_SEARCH:"previews"===e?i.UserActionSourceType.WEB_PREVIEW:"home_recent"===e||"home_starred"===e?i.UserActionSourceType.WEB_HOME:"browse"===e||"sidebar"===e?i.UserActionSourceType.WEB_BROWSE:i.UserActionSourceType.WEB;t.getActionSourceFromSourceArgs=e=>e.fileViewOrigin===d.FileViewOriginType.SEARCH?i.UserActionSourceType.WEB_SEARCH:e.fileViewOrigin===d.FileViewOriginType.BROWSE?i.UserActionSourceType.WEB_BROWSE:e.fileViewOrigin===d.FileViewOriginType.HOME?i.UserActionSourceType.WEB_HOME:i.UserActionSourceType.WEB;t.getActionSourceFromNewFileMenuType=e=>{switch(e){case _.NewFileMenuFromType.BROWSE:return i.UserActionSourceType.WEB_BROWSE;case _.NewFileMenuFromType.HOME:return i.UserActionSourceType.WEB_HOME;default:return i.UserActionSourceType.WEB}},t.logFileOpenPromptAction=function(e,t,r,o,s){(new l.HiveLogger).log(new c.WebUserActionRow({user_id:e,event_name:n.WebUserActionLogEvent.FILE_OPEN_PROMPT_ACTION,extra:{file_type:t,integration_name:r,prompt_action:o,ask_again:s}}))},t.logFileConvertPromptAction=function(e,t,r,o){(new l.HiveLogger).log(new c.WebUserActionRow({user_id:e,event_name:n.WebUserActionLogEvent.FILE_CONVERT_PROMPT_ACTION,extra:{prompt_action:t,integration_name:r,file_extension:o}}))},t.logInterstitialLoginAction=function(e,t,r){(new l.HiveLogger).log(new c.WebUserActionRow({event_name:n.WebUserActionLogEvent.INTERSTITIAL_LOGIN_ACTION,extra:{prompt_action:e,logged_out_ux_google_variant:t,file_extension:r}}))},t.logLoggedOutUXSnackBarAction=function(e,t,r,o){(new l.HiveLogger).log(new c.WebUserActionRow({event_name:n.WebUserActionLogEvent.LOGGED_OUT_UX_SNACKBAR_ACTION,extra:{prompt_action:e,file_extension:t,logged_out_ux_google_variant:r||"",logged_out_ux_paper_variant:o||""}}))}})),define("metaserver/static/js/cloud_docs/open_with_utils",["require","exports","tslib","typescript/libraries/shared/apex-metrics/src/index","metaserver/static/js/core/browser","metaserver/static/js/cloud_docs/constants","metaserver/static/js/cloud_docs/event_logging","metaserver/static/js/cloud_docs/types","metaserver/static/js/clean/referrer_cleansing_redirect","metaserver/static/js/cloud_docs/constants","metaserver/static/js/core/uri","metaserver/static/js/cloud_docs/utils","metaserver/static/js/clean/open_with","spectrum/util/uuid_generator","metaserver/static/js/core/browser_detection","metaserver/static/js/cloud_docs/create_api","metaserver/static/js/metrics/index"],(function(e,t,r,o,s,i,a,n,c,l,d,_,u,p,E,f,m){"use strict";let S;Object.defineProperty(t,"__esModule",{value:!0}),t.getGoogleEditorType=t.isCloudBasedDoc=t.isShortcut=t.isGoogleDoc=t.getOpenWithWopiEditorInfo=t.getOpenWithGoogleEditorInfo=t.getOpenWithCloudEditorInfo=t.OpenWithCloudDocProvider=t.openCloudDoc=t.openWithCloudEditor=t.fileToOpenWithParams=t.openCloudEditorUrl=t.isInEdgeIframe=t.handleError=t.decodeAPIError=t.getCloudEditorUrl=t.getCloudEditorUrlCached=void 0,c=r.__importStar(c),u=r.__importDefault(u),E=r.__importStar(E);t.getCloudEditorUrlCached=(e,o)=>r.__awaiter(void 0,void 0,void 0,(function*(){return S||(S=(0,t.getCloudEditorUrl)(e,o)),S}));function g(e){if(void 0!==e&&void 0!==e.error&&void 0!==e.error[".tag"])return e.error[".tag"]}function h(e){switch(g(e)){case"invalid_file_id":case"permission_denied":case"other":default:return}}t.getCloudEditorUrl=(t,o)=>r.__awaiter(void 0,void 0,void 0,(function*(){return(yield(function(){return r.__awaiter(this,void 0,void 0,(function*(){const{UserApiV2Client:t}=yield new Promise((t,r)=>{e(["metaserver/static/js/api_v2/user_client"],t,r)}).then(r.__importStar);return(new t).ns("cloud_docs")}))})()).rpc("get_cloud_editor_url",{file_id:o},{subjectUserId:t})})),t.decodeAPIError=g,t.handleError=h;function O(e,t,r,o,i,c,l){const _=(0,p.generateUUID)("web_open_id"),u=d.URI.parse(e.cloud_editor_url).updateQuery({cloud_editor:i,web_open_id:_});c&&u.updateQuery({ignore_lock:"1"});const E=u.toString();E&&(void 0===l&&(l=n.UserActionSourceType.WEB),(0,a.logUserAction)({actionEvent:n.UserActionEventType.PRE_OPEN,userId:o,docPathOrId:r,actionSource:l,data:{webOpenId:_}}),null!=t?(0,s.redirect)(E,t):(0,s.open_tab)(E))}t.isInEdgeIframe=()=>{let e=!1;if(E.edge||E.msie||E.edgeChromium())try{e=window.self!==window.top}catch(t){e=!0}return e},t.openCloudEditorUrl=O;t.fileToOpenWithParams=e=>({fileId:e.file_id,openToUrl:e.open_to_url});t.openWithCloudEditor=({fileId:e,openToUrl:s},a,n,c,l)=>r.__awaiter(void 0,void 0,void 0,(function*(){try{const r=performance.now(),d=(0,m.getMetricsReporter)(),_={};try{_.editor=n,l&&(_.source=l[".tag"]);const u=(0,t.isInEdgeIframe)();if(_.isInEdgeIframe=String(u),s&&s.startsWith("https://www.dropbox.com/scl/fi/")){_.usedOpenToURLFromFile="true",O({cloud_editor_url:s},null,e,a,n,c,l)}else{_.usedOpenToURLFromFile="false";const r=u?null:(0,f.createPlaceholderTabForNewCloudDoc)();O(u?yield(0,t.getCloudEditorUrlCached)(a,e):yield(0,t.getCloudEditorUrl)(a,e),r,e,a,n,c,l)}_.error="false"}catch(e){_.error="true",h(e)}finally{d.createStats({ns:i.CLOUD_DOCS_AMP_NAMESPACE,name:"web/openWithCloudEditor"},_).recordDuration(performance.now()-r,o.TimeUnit.MILLISECONDS)}}catch(e){h(e)}}));var T;t.openCloudDoc=(t,o,l)=>{if(l||(l=n.UserActionSourceType.WEB),t.href)if((0,i.isPointerByExtension)(t.ns_path))c.safe_open_tab_and_redirect(t.href),(0,a.logUserAction)({actionEvent:n.UserActionEventType.PRE_OPEN,userId:o.id,docPathOrId:t.file_id,actionSource:l});else{const e=(0,p.generateUUID)("web_open_id"),r=d.URI.parse(t.href).updateQuery("web_open_id",e).toString();(0,s.open_tab)(r),(0,a.logUserAction)({actionEvent:n.UserActionEventType.PRE_OPEN,userId:o.id,docPathOrId:t.file_id,actionSource:l,data:{webOpenId:e}})}else{const s=(0,f.createPlaceholderTabForNewCloudDoc)();new Promise((t,r)=>{e(["metaserver/static/js/previews/data/actions"],t,r)}).then(r.__importStar).then(e=>e.fetchPreviewUrl(t,o)).then(e=>{e&&null!==s&&c.redirect(e,s,!0)})}},(function(e){e.OfficeOnline="OfficeOnline",e.GoogleDSS="GoogleDSS"})(T=t.OpenWithCloudDocProvider||(t.OpenWithCloudDocProvider={}));t.getOpenWithCloudEditorInfo=(e,r,o,s)=>{const i=[],a=(0,t.getOpenWithWopiEditorInfo)(e,r,s);a&&o.wopi&&i.push(a);const n=(0,t.getOpenWithGoogleEditorInfo)(e,r,s);return n&&o.gdd&&i.push(n),i};t.getOpenWithGoogleEditorInfo=(e,r,o)=>{const s=v(e,r);return s?{text:l.DSS_TYPE_TO_TEXT[s],iconUrl:l.DSS_TYPE_TO_OPEN_WITH_ICONS[s],handler:()=>(0,t.openWithCloudEditor)((0,t.fileToOpenWithParams)(e),r.id,s,!1,o),provider:T.GoogleDSS}:null};function I(e){return[".gdoc",".gsheet",".gslides"].indexOf((0,_.getFileExt)(e))>=0}function R(e){return".web"===(0,_.getFileExt)(e)}function v(e,t){const r=(0,_.getFileExt)(e);for(const e of Object.keys(l.DSS_TYPE_TO_SUPPORTED_EXTS)){const t=e;if(l.DSS_TYPE_TO_SUPPORTED_EXTS[t].indexOf(r)>=0)return t}switch(r){case".gdoc":return l.GoogleFileTypes.GOOGLE_DSS_DOC;case".gsheet":return l.GoogleFileTypes.GOOGLE_DSS_SHEET;case".gslides":return l.GoogleFileTypes.GOOGLE_DSS_SLIDES}return null}t.getOpenWithWopiEditorInfo=(e,r,o)=>{const s=u.default.getWopiOpenWithButtonInfo(e);return s?{text:s.name,spriteName:s.icon,handler:()=>(0,t.openWithCloudEditor)((0,t.fileToOpenWithParams)(e),r.id,s.editor,!1,o),provider:T.OfficeOnline}:null},t.isGoogleDoc=I,t.isShortcut=R,t.isCloudBasedDoc=function(e){return!!I(e)||!!R(e)},t.getGoogleEditorType=v})),define("metaserver/static/js/cloud_docs/pointers_common",["require","exports","tslib","ts-key-enum","react","dig-components/text_fields"],(function(e,t,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreatePointerFields=void 0,s=r.__importStar(s);class a extends s.Component{constructor(){super(...arguments),this.handleKeyPress=e=>{e.key===o.Key.Enter&&a.canSubmit({name:this.props.name,url:this.props.url})&&this.props.onSubmit()},this.handleNameChange=e=>{const t=e.target.value;this.props.onChange({name:t,url:this.props.url})},this.handleUrlChange=e=>{const t=e.target.value;this.props.onChange({name:this.props.name,url:t})},this.setNameFieldRef=e=>{this.nameRef=e}}render(){const e=""===this.props.url||a.isUrlValid(this.props.url);let t="";return e||(t=this.props.urlValidationMessage),s.createElement("div",{className:"create-pointer--fields"},s.createElement("div",{className:"create-pointer--fieldset"},s.createElement("label",{htmlFor:"create-pointer--link_input"},this.props.urlLabel),s.createElement("div",{className:"create-pointer--fieldset-with-icon"},this.props.urlIcon,s.createElement(i.TextInput,{id:"create-pointer--link_input",className:"create-pointer--link_input",isInvalid:!e,onChange:this.handleUrlChange,onKeyPress:this.handleKeyPress,value:this.props.url,placeholder:this.props.urlPlaceholder,autoFocus:!0}))),s.createElement("div",{className:"create-pointer--url-validation-warning"},t),s.createElement("div",{className:"create-pointer--fieldset"},s.createElement("label",{htmlFor:"create-pointer--name_input"},this.props.nameLabel),s.createElement(i.TextInput,{id:"create-pointer--name_input",onChange:this.handleNameChange,onKeyPress:this.handleKeyPress,ref:this.setNameFieldRef,placeholder:this.props.namePlaceholder})))}componentDidMount(){return r.__awaiter(this,void 0,void 0,(function*(){if(this.props.urlPrepopulateFunction){const e=yield this.props.urlPrepopulateFunction();e&&(this.props.onChange({name:this.props.name,url:e}),this.nameRef.focus())}}))}}t.CreatePointerFields=a,a.isUrlValid=e=>/^((http|https):\/\/)?([^.:/\\?#@!]+?\.)+[^.:/\\?#@!]+/i.test(e.trim()),a.canSubmit=e=>""!==e.name&&""!==e.url&&a.isUrlValid(e.url),a.displayName="CreatePointerFields"})),define("metaserver/static/js/cloud_docs/preferred_editor_utils",["require","exports","tslib","metaserver/static/js/core/i18n","metaserver/static/js/core/browser","metaserver/static/js/core/exception","metaserver/static/js/cloud_docs/event_logging","metaserver/static/js/cloud_docs/utils","metaserver/static/js/cloud_docs/types","react","metaserver/static/js/filepath/filepath","metaserver/static/js/cloud_docs/open_with_utils","metaserver/static/js/core/uri","metaserver/static/js/cloud_docs/cloud_doc_api_client","spectrum/util/uuid_generator","metaserver/static/js/cloud_docs/preferred_editor_constants","metaserver/static/js/cloud_docs/create_api"],(function(e,t,r,o,s,i,a,n,c,l,d,_,u,p,E,f,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPreferredEditorPrompt=t.openInPreferredEditor=t.hasPreferredEditorSupport=void 0,l=r.__importDefault(l),t.hasPreferredEditorSupport=function(e){const t=(0,n.getFileExt)(e);return f.PREFERRED_EDITOR_SUPPORTED_EXTS.indexOf(t)>=0},t.openInPreferredEditor=function(e,t,r,o,l){const d=(0,n.getFileExt)(t),S=r[e.id];let g="";if(S)try{const r=S[f.EXTENSION_TO_DOC_TYPE[d]],n=r===f.PreferredEditorTypes.GoogleDSS||r===f.PreferredEditorTypes.OfficeOnline,h=(0,E.generateUUID)("web_open_id");if(t.is_in_vault_folder)return n&&(0,a.logUserAction)({actionEvent:c.UserActionEventType.PRE_OPEN,userId:e.id,docPathOrId:t.file_id,actionSource:(0,a.getActionSourceFromSourceArgs)(l),data:{webOpenId:h},extra:{block_vault_content:"true"}}),void o();if(n){const r=(0,m.createPlaceholderTabForNewCloudDoc)();(0,_.getCloudEditorUrl)(e.id,t.file_id).then(s=>{g=u.URI.parse(s.cloud_editor_url).updateQuery("web_open_id",h).toString(),r?r.location.replace(g):o(),(0,a.logUserAction)({actionEvent:c.UserActionEventType.PRE_OPEN,userId:e.id,docPathOrId:t.file_id,actionSource:(0,a.getActionSourceFromSourceArgs)(l),data:{webOpenId:h}})}).catch(e=>{(0,i.reportStack)("Error getting cloud editor url from preferred editor open.",{severity:i.SEVERITY.CRITICAL,exc_extra:{preferred_editor_url:g,file_ext:d,preferred_editor_configs:S,error:e.message}}),r&&r.close(),o()})}else(0,p.getPreferredUrl)(e.id,t.file_id,d).then(r=>{r.preferred_editor_url&&(g=u.URI.parse(r.preferred_editor_url).updateQuery("web_open_id",h).toString(),(0,a.logUserAction)({actionEvent:c.UserActionEventType.PRE_OPEN,userId:e.id,docPathOrId:t.file_id,actionSource:(0,a.getActionSourceFromSourceArgs)(l),data:{webOpenId:h}}),(0,s.redirect)(g))}).catch(e=>{(0,i.reportStack)("Error getting preferred editor url from preferred editor open.",{severity:i.SEVERITY.CRITICAL,exc_extra:{preferred_editor_url:g,file_ext:d,preferred_editor_configs:S,error:e.message}})}),o()}catch(e){(0,i.reportStack)("Error opening docs in preferred editor.",{severity:i.SEVERITY.CRITICAL,exc_extra:{preferred_editor_url:g,file_ext:d,preferred_editor_configs:S,error:e.message}}),o()}else o()},t.getPreferredEditorPrompt=function(e,t){const r="."+(0,d.file_extension)(e),s=f.EXTENSION_TO_DOC_TYPE[r],i=f.INTEGRATION_NAME_TO_PROMPT[t][s];return i?{title:o.intl.formatMessage({id:"jXF9I9",defaultMessage:"Would you like to open <b>{file_extension}</b> files with {web_editor_name} by default?"},{file_extension:r,web_editor_name:i,b:e=>l.default.createElement("b",null,e)}),body:o.intl.formatMessage({id:"f37GH8",defaultMessage:"{web_editor_name} will automatically be used to open your <b>{file_extension}</b> files in Dropbox. You can always update this later in your Dropbox settings."},{file_extension:r,web_editor_name:i,b:e=>l.default.createElement("b",null,e)})}:null}})),define("metaserver/static/js/cloud_docs/preferred_editor_constants",["require","exports","metaserver/static/js/core/i18n","metaserver/static/js/cloud_docs/types"],(function(e,t,r,o){"use strict";var s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.IntegrationNameToPreferredEditorEnums=t.INTEGRATION_NAME_TO_PROMPT=t.PREFERRED_EDITOR_SUPPORTED_EXTS=t.EXTENSION_TO_DOC_TYPE=t.PreferredEditorOptionsMap=t.PreferredEditorDocTypes=t.PreferredEditorTypes=void 0,(function(e){e[e.Unknown=0]="Unknown",e[e.FileViewer=1]="FileViewer",e[e.OfficeOnline=2]="OfficeOnline",e[e.GoogleDSS=3]="GoogleDSS"})(s=t.PreferredEditorTypes||(t.PreferredEditorTypes={})),(function(e){e.WORD="ms_word",e.EXCEL="ms_excel",e.POWERPOINT="ms_powerpoint"})(i=t.PreferredEditorDocTypes||(t.PreferredEditorDocTypes={})),t.PreferredEditorOptionsMap={[i.WORD]:{1:r.intl.formatMessage({id:"5+Wabe",defaultMessage:"View in dropbox.com"}),2:r.intl.formatMessage({id:"Y9FcUQ",defaultMessage:"Word for the web"}),3:r.intl.formatMessage({id:"+HsOFj",defaultMessage:"Google Docs"})},[i.EXCEL]:{1:r.intl.formatMessage({id:"5+Wabe",defaultMessage:"View in dropbox.com"}),2:r.intl.formatMessage({id:"o3mRdr",defaultMessage:"Excel for the web"}),3:r.intl.formatMessage({id:"cpuRML",defaultMessage:"Google Sheets"})},[i.POWERPOINT]:{1:r.intl.formatMessage({id:"5+Wabe",defaultMessage:"View in dropbox.com"}),2:r.intl.formatMessage({id:"RTj2SO",defaultMessage:"PowerPoint for the web"}),3:r.intl.formatMessage({id:"PcJCVL",defaultMessage:"Google Slides"})}},t.EXTENSION_TO_DOC_TYPE={".docx":i.WORD,".doc":i.WORD,".xlsx":i.EXCEL,".xls":i.EXCEL,".pptx":i.POWERPOINT,".ppt":i.POWERPOINT},t.PREFERRED_EDITOR_SUPPORTED_EXTS=Object.keys(t.EXTENSION_TO_DOC_TYPE),t.INTEGRATION_NAME_TO_PROMPT={[o.IntegrationName.GOOGLE_DSS]:{[i.WORD]:r.intl.formatMessage({id:"+HsOFj",defaultMessage:"Google Docs"}),[i.EXCEL]:r.intl.formatMessage({id:"cpuRML",defaultMessage:"Google Sheets"}),[i.POWERPOINT]:r.intl.formatMessage({id:"PcJCVL",defaultMessage:"Google Slides"})},[o.IntegrationName.OFFICE_ONLINE]:{[i.WORD]:r.intl.formatMessage({id:"Y9FcUQ",defaultMessage:"Word for the web"}),[i.EXCEL]:r.intl.formatMessage({id:"o3mRdr",defaultMessage:"Excel for the web"}),[i.POWERPOINT]:r.intl.formatMessage({id:"RTj2SO",defaultMessage:"PowerPoint for the web"})},[o.IntegrationName.PAPER_INTEGRATION]:{}},t.IntegrationNameToPreferredEditorEnums={[o.IntegrationName.GOOGLE_DSS]:s.GoogleDSS,[o.IntegrationName.OFFICE_ONLINE]:s.OfficeOnline,[o.IntegrationName.PAPER_INTEGRATION]:s.Unknown}})),define("metaserver/static/js/cloud_docs/utils",["require","exports","metaserver/static/js/filepath/filepath","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/cloud_docs/types"],(function(e,t,r,o,s){"use strict";function i(e){return e.replace(/[/?<>:*\\]/g,"_")}Object.defineProperty(t,"__esModule",{value:!0}),t.replaceInvalidURLFilenameChars=t.replaceInvalidFilenameChars=t.integrationNameToShareActionOrigin=t.getFileExt=void 0,t.getFileExt=function(e){let t="";return e.hasOwnProperty("ext")?t=e.ext:e.hasOwnProperty("filename")?(t=(0,r.file_extension)(e.filename),t&&(t="."+t)):(t=(0,r.file_extension)(e),t&&(t="."+t)),t},t.integrationNameToShareActionOrigin=function(e){switch(e){case s.IntegrationName.GOOGLE_DSS:return o.SHARE_ACTION_ORIGIN_TYPE.GOOGLE_DSS;case s.IntegrationName.PAPER_INTEGRATION:return o.SHARE_ACTION_ORIGIN_TYPE.PAPER_INTEGRATION;case s.IntegrationName.OFFICE_ONLINE:return o.SHARE_ACTION_ORIGIN_TYPE.OFFICE_INTEGRATION;default:throw"No mapping for integration to share action origin: "+e}},t.replaceInvalidFilenameChars=i,t.replaceInvalidURLFilenameChars=function(e){return i(e).replace(/\ /g,"-")}})),define("metaserver/static/js/growth/smb_funnel/smb_funnel_logger",["require","exports","metaserver/static/js/metrics/index","metaserver/static/js/core/exception","typescript/libraries/shared/apex-metrics/src/index"],(function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SMBFunnelLogger=t.SMBFunnelLoggerSingleton=t.Platform=void 0,(function(e){e.WEB="web",e.DESKTOP_SSCV="desktop_sscv",e.MOBILE_WEB="mobile_web"})(t.Platform||(t.Platform={}));const i=["platform","variant","isJoiner"],a=e=>{const t={};return Object.keys(e).forEach(r=>{i.indexOf(r)>=0&&(t[r]=e[r])}),t};class n{constructor(e={}){this.setCommonTags=e=>{const t=a(e);Object.keys(t).forEach(t=>{this.commonTags[t]&&this.commonTags[t]!==e[t]&&(0,o.reportStack)(`Attempting to change ${t} after it was already set`,{severity:o.SEVERITY.NONCRITICAL,tags:["activation-targeted","smb-funnel"]})}),this.commonTags=t},this.log=(e,t={})=>{const r=Object.assign(Object.assign({},this.commonTags),t),o=this.metricsReporter.createCounter({ns:"smb_funnel",name:e},r);o.increment(),o.record()},this.logDuration=(e,t,r={})=>{const o=Object.assign(Object.assign({},this.commonTags),r);this.metricsReporter.createStats({ns:"smb_funnel",name:e},o).recordDuration(t,s.TimeUnit.MILLISECONDS)},this.commonTags=a(e),this.metricsReporter=(0,r.getMetricsReporter)()}}t.SMBFunnelLoggerSingleton=n,t.SMBFunnelLogger=new n})),define("metaserver/static/js/admin/ui/teams/onboarding/web/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContUrl=t.FlowId=t.AMPMetrics=t.Platform=t.BackgroundColors=t.StepStatus=t.Steps=t.MODULE_NAME=t.FRAMEWORK=void 0,t.FRAMEWORK="team_setup_essential",t.MODULE_NAME="smooth_transitions",(function(e){e.VERIFICATION="verification",e.RIGHTSIZING="rightsizing",e.TEAM_INFO="team_info",e.MOVE_FOLDERS="move_folders",e.CONFIRM_FOLDERS="confirm_folders",e.RESULTS_FOLDERS="results_folders",e.INVITE_MEMBERS="invite_members",e.SUGGESTED_INVITE_MEMBERS="suggested_invite_members",e.INVITE_MOBILE="invite_mobile",e.INSTALL="install",e.INSTALL_MOBILE="install_mobile",e.IMPORT_CONTACTS="import_contacts",e.ROLE="role",e.COLLABORATION="collaboration",e.LOADING_SCREEN="loading_screen",e.PAIR="team_install_page_pair",e.OPEN="team_install_page_open",e.DOWNLOAD="team_install_page_download",e.DOWNLOAD_COMPLETE="download_complete",e.MOBILE_INSTALL="mobile_install",e.DOCSEND_ONBOARD="docsend_onboard",e.JOIN_ACCEPT="join_accept",e.JOIN_LOGIN="join_login",e.JOIN_MOVE_FILES="join_move_files",e.JOIN_PRIVACY_QUESTION="privacy_question",e.JOIN_TWO_ACCOUNT_SUGGESTION="two_account_suggestion",e.JOIN_ONE_ACCOUNT_SUGGESTION="one_account_suggestion",e.JOIN_CREATE_NEW_PERSONAL="create_new_personal",e.JOIN_PERSONAL_VERIFICATION="personal_verification",e.HELP_US_HELP_YOU="help_us_help_you"})(t.Steps||(t.Steps={})),(function(e){e.Inactive="inactive",e.Active="active",e.Completed="completed"})(t.StepStatus||(t.StepStatus={})),(function(e){e.CELADON="celadon",e.CLOUD="cloud",e.NAVY="navy",e.ORCHID="orchid",e.SAPPHIRE="sapphire",e.SAND="sand",e.VANILLA="vanilla",e.WHITE="white"})(t.BackgroundColors||(t.BackgroundColors={})),(function(e){e.DESKTOP_WEB="desktop_web",e.DESKTOP_SSCV="desktop_sscv",e.MOBILE_WEB="mobile_web"})(t.Platform||(t.Platform={})),(function(e){e.SETUP_START="setup/start",e.SETUP_FINISH="setup/finish",e.SETUP_STEP_START="setup/step/start",e.SETUP_STEP_FINISH="setup/step/finish",e.SETUP_STEP_ERROR="setup/step/error",e.SETUP_STEP_INTERRUPT="setup/step/interrupt",e.SETUP_STEP_CTA="setup/step/cta",e.SETUP_STEP_FETCH="setup/step/fetch",e.ACTIVATION_IMM_VIEW="activation/imm/view",e.ACTIVATION_IMM_ADD_MEMBERS="activation/imm/add_members",e.ACTIVATION_DESKTOP_ICON_OPEN="activation/desktop_icon/open",e.ACTIVATION_EMPTY_STATE_VIEW="activation/empty_state/view",e.ACTIVATION_EMPTY_STATE_CLICK_UPLOAD_CTA="activation/empty_state/click_browse_upload_cta",e.ACTIVATION_SUGGESTED_FOLDER_CREATE="activation/suggested_folder/create",e.ACTIVATION_SUGGESTED_FOLDER_DISMISS="activation/suggested_folder/dismiss",e.ACTIVATION_SUGGESTED_FOLDER_TOGGLE="activation/suggested_folder/toggle",e.ACTIVATION_QUICK_ACTIONS_PANEL_VIEW="activation/quick_actions_panel/view",e.ACTIVATION_QUICK_ACTION_CREATE_CF="activation/quick_action/create_cf",e.ACTIVATION_QUICK_ACTION_REDIRECT="activation/quick_action/redirect",e.ACTIVATION_QUICK_ACTION_SEE_SF="activation/quick_action/see_sf",e.ACTIVATION_QUICK_ACTION_DISMISS="activation/quick_action/dismiss",e.ACTIVATION_COLLECTION_FOLDER_VIEW="activation/collection_folder/view",e.ACTIVATION_COLLECTIONS_ACTION_REDIRECT="activation/collections_action/redirect",e.ACTIVATION_COLLECTIONS_ACTION_UPLOAD="activation/collections_action/upload",e.ACTIVATION_COLLECTIONS_ACTION_CREATE="activation/collections_action/create",e.ACTIVATION_COLLECTIONS_ACTION_PAPER="activation/collections_action/paper",e.ACTIVATION_COLLECTIONS_ACTION_OPEN_DESKTOP="activation/collections_action/open_desktop",e.ACTIVATION_COLLECTIONS_ACTION_OPEN_SETTINGS="activation/collections_action/open_settings",e.ACTIVATION_INVITE_LINK_CREATE="activation/invite_link/create",e.ACTIVATION_MOBILE_LINK_SEND="activation/mobile_link/send",e.ACTIVATION_DESKTOP_LINK_DISMISS="activation/desktop_link/dismiss",e.ACTIVATION_DESKTOP_LINK_INIT="activation/desktop_link/init",e.ACTIVATION_DESKTOP_LINK_SEND="activation/desktop_link/send",e.ACTIVATION_SUGGESTED_ITEMS_TO_MOVE_START_MOVE="activation/suggested_items_to_move/start_move",e.ACTIVATION_SUGGESTED_ITEMS_TO_MOVE_END_MOVE="activation/suggested_items_to_move/end_move",e.ACTIVATION_IN_FOLDER_OPEN_DESKTOP="activation/in_folder/open_desktop"})(t.AMPMetrics||(t.AMPMetrics={})),(function(e){e[e.ESSENTIAL_SETUP=1]="ESSENTIAL_SETUP",e[e.TEAM_JOINER_FLOW=9]="TEAM_JOINER_FLOW"})(t.FlowId||(t.FlowId={})),(function(e){e.DEFAULT="",e.WORK="/work",e.ESSENTIAL_SETUP="/team/setup/essential",e.ESSENTIAL_JOIN="/team/join/essential"})(t.ContUrl||(t.ContUrl={}))})),define("metaserver/static/js/folder_subscriptions/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTypes=t.FolderSubscriptionState=t.RequestFlightStatus=t.Frequencies=t.FOLLOW_MODAL_QUERY_PARAM=void 0,t.FOLLOW_MODAL_QUERY_PARAM="manage_folder_subscription",t.Frequencies={INSTANT:{".tag":"instant"},DAILY:{".tag":"daily"}},(function(e){e.IDLE="idle",e.READY="ready",e.INFLIGHT="inflight",e.ERROR="error"})(t.RequestFlightStatus||(t.RequestFlightStatus={})),(function(e){e.FOLLOWING="FOLLOWING",e.FOLLOWING_PARENT="FOLLOWING_PARENT",e.NOT_FOLLOWING="NOT_FOLLOWING"})(t.FolderSubscriptionState||(t.FolderSubscriptionState={})),(function(e){e.FETCHING_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/FETCHING_FOLDER_SUBSCRIPTION",e.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/OPTIMISTIC_SET_FOLDER_SUBSCRIPTION",e.CONFIRM_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/CONFIRM_FOLDER_SUBSCRIPTION",e.ERROR_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/ERROR_FOLDER_SUBSCRIPTION"})(t.ActionTypes||(t.ActionTypes={}))})),define("metaserver/static/js/folder_subscriptions/data/action_creators",["require","exports","tslib","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/constants","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/logger_util","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/folder_subscriptions/data/api","metaserver/static/js/folder_subscriptions/data/selectors","metaserver/static/js/folder_subscriptions/data/types","metaserver/static/js/folder_subscriptions/follow/snackbar","metaserver/static/js/clean/web_user_action_events"],(function(e,t,r,o,s,i,a,n,c,l,d,_,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.editFolderSubscription=t.deleteFolderSubscriptionFromEmail=t.deleteFolderSubscription=t.createFolderSubscription=t.logAction=t.FolderSubscriptionOrigin=t.fetchFolderSubscription=void 0,i=r.__importStar(i),a=r.__importStar(a),n=r.__importStar(n),c=r.__importStar(c),l=r.__importStar(l);const p=(e,t,r)=>{e({type:d.ActionTypes.CONFIRM_FOLDER_SUBSCRIPTION,payload:{folderSubscription:r,path:t,timestamp:new Date}})},E=(e,t,r)=>{e({type:d.ActionTypes.ERROR_FOLDER_SUBSCRIPTION,payload:{folderSubscription:r,path:t}})};var f;t.fetchFolderSubscription=e=>(t,o)=>r.__awaiter(void 0,void 0,void 0,(function*(){const r=o(),s=i.user(r).id;l.getRequestState(r,e).status!==d.RequestFlightStatus.INFLIGHT&&(((e,t)=>{e({type:d.ActionTypes.FETCHING_FOLDER_SUBSCRIPTION,payload:{path:t}})})(t,e),c.getFolderSubscription(e,s).then(r=>p(t,e,r),()=>E(t,e)))})),(function(e){e.Email="email",e.SideMenu="side_menu",e.Thumbnail="thumbnail"})(f=t.FolderSubscriptionOrigin||(t.FolderSubscriptionOrigin={}));t.logAction=(e,t,r,c)=>{var d,_;const u=i.user(t).id,p=i.selectedFiles(t),{num_files_selected:E,num_folders_selected:f}=a.countFilesAndFolders(p),m=l.folderSubscription(t,r),S=null===(d=null==m?void 0:m.settings)||void 0===d?void 0:d.activity_types;(0,o.logBrowseAction)({action:e,uid:u,num_files_selected:E,num_folders_selected:f,view_type:n.selectViewType(t,{instanceId:s.BROWSE_FILES_VIEW_ID}),extra:{ns_id:c.ns_id.toString(),origin:c.origin||null,frequency:(null===(_=null==m?void 0:m.settings)||void 0===_?void 0:_.frequency[".tag"])||null,file_add:S?S.file_added.toString():null,file_delete:S?S.file_deleted.toString():null}})};const m=({dispatch:e,getState:r,path:o,newValue:s,apiUpdate:i,onSuccess:a,onError:n})=>{const c=r(),_=l.folderSubscription(c,o);return((e,t,r)=>{e({type:d.ActionTypes.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION,payload:{folderSubscription:r,path:t}})})(e,o,s),i().then(t=>{p(e,o,s),a(t)},()=>{E(e,o,_),e((0,t.fetchFolderSubscription)(o)),n()})};t.createFolderSubscription=(e,r,o)=>(s,a)=>{const n=a(),p=i.user(n).id;if(l.folderSubscriptionState(n,e)===d.FolderSubscriptionState.NOT_FOLLOWING)return m({dispatch:s,getState:a,path:e,newValue:{subscriptionState:d.FolderSubscriptionState.FOLLOWING,followingPath:e,settings:r},apiUpdate:()=>c.createFolderSubscription(e,r,p),onSuccess:()=>{(0,_.showSetOptionsConfirmationSnackbar)(e),(0,t.logAction)(u.WebUserActionLogEvent.FOLLOW_FOLDER,a(),e,o)},onError:()=>(0,_.showSetOptionsErrorSnackbar)(e)})};t.deleteFolderSubscription=(e,r)=>(o,s)=>{const a=s(),n=i.user(a).id;if(l.folderSubscriptionState(a,e)===d.FolderSubscriptionState.FOLLOWING)return m({dispatch:o,getState:s,path:e,newValue:{subscriptionState:d.FolderSubscriptionState.NOT_FOLLOWING},apiUpdate:()=>c.deleteFolderSubscription(e,n),onSuccess:()=>{(0,_.showUnfollowConfirmationSnackbar)(e),(0,t.logAction)(u.WebUserActionLogEvent.UNFOLLOW_FOLDER,s(),e,r)},onError:()=>(0,_.showUnfollowErrorSnackbar)(e)})};t.deleteFolderSubscriptionFromEmail=(e,r)=>(o,s)=>{const a=s(),n=i.user(a).id;return c.deleteFolderSubscription(e,n).then(()=>{(0,_.showUnfollowConfirmationSnackbar)(e),(0,t.logAction)(u.WebUserActionLogEvent.UNFOLLOW_FOLDER,a,e,{ns_id:r,origin:f.Email})},()=>(0,_.showUnfollowErrorSnackbar)(e))};t.editFolderSubscription=(e,r,o)=>(s,a)=>{const n=a(),p=i.user(n).id;if(l.folderSubscriptionState(n,e)===d.FolderSubscriptionState.FOLLOWING)return m({dispatch:s,getState:a,path:e,newValue:{subscriptionState:d.FolderSubscriptionState.FOLLOWING,followingPath:e,settings:r},apiUpdate:()=>c.editFolderSubscription(e,r,p),onSuccess:()=>{(0,_.showSetOptionsConfirmationSnackbar)(e),(0,t.logAction)(u.WebUserActionLogEvent.EDIT_FOLDER_FOLLOW_SETTINGS,a(),e,o)},onError:()=>(0,_.showSetOptionsErrorSnackbar)(e)})}})),define("metaserver/static/js/folder_subscriptions/data/api",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/folder_subscriptions/data/types"],(function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.editFolderSubscription=t.deleteFolderSubscription=t.createFolderSubscription=t.getFolderSubscription=void 0;t.getFolderSubscription=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return(new o.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/get",{identifier:e},{subjectUserId:t}).then((r=e,({subscription:e})=>{if(!e)return{subscriptionState:s.FolderSubscriptionState.NOT_FOLLOWING};const t=e.fq_path;return t!==r?{subscriptionState:s.FolderSubscriptionState.FOLLOWING_PARENT,followingPath:t}:{subscriptionState:s.FolderSubscriptionState.FOLLOWING,followingPath:t,settings:e.settings}}));var r}))},t.createFolderSubscription=function(e,t,s){return r.__awaiter(this,void 0,void 0,(function*(){return(new o.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/create",{identifier:e,settings:t},{subjectUserId:s})}))},t.deleteFolderSubscription=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return(new o.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/delete",{identifier:e},{subjectUserId:t})}))},t.editFolderSubscription=function(e,t,s){return r.__awaiter(this,void 0,void 0,(function*(){return(new o.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/edit",{identifier:e,settings:t},{subjectUserId:s})}))}})),define("metaserver/static/js/folder_subscriptions/data/reducer",["require","exports","tslib","immutable","metaserver/static/js/folder_subscriptions/data/types"],(function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderSubscriptionsReducer=t.defaultFolderSubscriptionsState=void 0,o=r.__importStar(o),t.defaultFolderSubscriptionsState={requests:o.Map(),folderSubscriptions:o.Map()},t.folderSubscriptionsReducer=function(e=t.defaultFolderSubscriptionsState,r){switch(r.type){case s.ActionTypes.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:r,folderSubscription:o}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(r,{status:s.RequestFlightStatus.INFLIGHT}),folderSubscriptions:e.folderSubscriptions.set(r,o)})})(e,r);case s.ActionTypes.FETCHING_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:r}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(r,{status:s.RequestFlightStatus.INFLIGHT})})})(e,r);case s.ActionTypes.CONFIRM_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:r,folderSubscription:o,timestamp:i}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(r,{status:s.RequestFlightStatus.READY,lastUpdated:i}),folderSubscriptions:e.folderSubscriptions.set(r,o)})})(e,r);case s.ActionTypes.ERROR_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:r,folderSubscription:o}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(r,{status:s.RequestFlightStatus.ERROR}),folderSubscriptions:o?e.folderSubscriptions.set(r,o):e.folderSubscriptions})})(e,r)}return e}})),define("metaserver/static/js/folder_subscriptions/data/selectors",["require","exports","metaserver/static/js/redux/selectors","metaserver/static/js/redux/namespaces","metaserver/static/js/folder_subscriptions/data/types","metaserver/static/js/folder_subscriptions/data/reducer"],(function(e,t,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderSubscriptions=t.folderSubscription=t.folderSubscriptionState=t.getRequestState=t.getFolderSubscriptionsState=void 0;t.getFolderSubscriptionsState=e=>(0,r.getStateAtNamespace)(e,o.FOLDER_SUBSCRIPTIONS_NAMESPACE_KEY)||i.defaultFolderSubscriptionsState;t.getRequestState=(e,r)=>(0,t.getFolderSubscriptionsState)(e).requests.get(r,{status:s.RequestFlightStatus.IDLE});t.folderSubscriptionState=(e,r)=>{var o;return null===(o=(0,t.folderSubscription)(e,r))||void 0===o?void 0:o.subscriptionState};t.folderSubscription=(e,r)=>(0,t.folderSubscriptions)(e).get(r);t.folderSubscriptions=e=>(0,t.getFolderSubscriptionsState)(e).folderSubscriptions})),define("metaserver/static/js/folder_subscriptions/data/store",["require","exports","metaserver/static/js/folder_subscriptions/data/reducer","metaserver/static/js/redux/store","metaserver/static/js/redux/namespaces"],(function(e,t,r,o,s){"use strict";let i;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForFolderSubscriptions=void 0;t.getStoreForFolderSubscriptions=()=>(i||(i=(0,o.getStoreAndRegisterReducers)({[s.FOLDER_SUBSCRIPTIONS_NAMESPACE_KEY]:r.folderSubscriptionsReducer})),i)})),define("metaserver/static/js/folder_subscriptions/follow/snackbar",["require","exports","tslib","react","metaserver/static/js/filepath/filepath","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/core/i18n"],(function(e,t,r,o,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showFollowFailedSnackbar=t.showUnfollowErrorSnackbar=t.showUnfollowConfirmationSnackbar=t.showSetOptionsErrorSnackbar=t.showSetOptionsConfirmationSnackbar=t.showFolderSubscriptionSnackbar=void 0,o=r.__importDefault(o);const n=a.intl.formatMessage({id:"JBINyn",defaultMessage:"Close"}),c=a.intl.formatMessage({id:"Wzr+Eu",defaultMessage:"Unfollow"});function l({callToActionFn:e,isSuccess:t,message:r}){const s=t?"complete":"fail",a=t&&e?c:void 0,l=t?e:void 0,d=t&&e?void 0:n,_=o.default.createElement(i.Snackbar,{title:r,variant:s,actionButtonText:a,onActionClick:l,closeButtonText:d,timeoutDelayMs:5e3,id:"browse-action"});i.Snackbar.show(_)}t.showFolderSubscriptionSnackbar=l,t.showSetOptionsConfirmationSnackbar=function(e){l({isSuccess:!0,message:a.intl.formatMessage({id:"74emIA",defaultMessage:'Notification options for "{folderName}" have been set'},{folderName:(0,s.filename)(e)})})},t.showSetOptionsErrorSnackbar=function(e){l({isSuccess:!1,message:a.intl.formatMessage({id:"fwZe/f",defaultMessage:'Couldn\'t set options for "{folderName}"'},{folderName:(0,s.filename)(e)})})},t.showUnfollowConfirmationSnackbar=function(e){l({isSuccess:!0,message:a.intl.formatMessage({id:"nQncys",defaultMessage:'You’ll no longer get notifications about "{folderName}"'},{folderName:(0,s.filename)(e)})})},t.showUnfollowErrorSnackbar=function(e){l({isSuccess:!1,message:a.intl.formatMessage({id:"/QEApB",defaultMessage:'Unable to unfollow "{folderName}"'},{folderName:(0,s.filename)(e)})})},t.showFollowFailedSnackbar=function(e){l({isSuccess:!1,message:a.intl.formatMessage({id:"0G1Llb",defaultMessage:'Unable to follow "{folderName}"'},{folderName:e})})}})),define("metaserver/static/js/browse/api",["require","exports","tslib","lodash","metaserver/static/js/deprecated_ajax/ajax","metaserver/static/js/api_v2/user_client","metaserver/static/js/filepath/filepath","metaserver/static/js/browse/models","metaserver/static/js/core/assert","metaserver/static/js/core/html","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/core/uri","metaserver/static/js/sharing/api/client","metaserver/static/js/sync_everything/constants"],(function(e,t,r,o,s,i,a,n,c,l,d,_,u,p,E){"use strict";function f(e){try{return JSON.parse(e)}catch(e){if(!(e instanceof SyntaxError))throw e}return null}function m(e){if(void 0===e)return{};const t={};for(const r of e)void 0!==r.ns_id&&void 0!==r.mount_point&&(t[r.ns_id]=r.mount_point);return t}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchChronicleEventsApi=t.getFolderMemberCounts=t.fetchUnmountedBackupFolderSizes=t.fetchSameNamespaceFolderSizes=t.fetchSharedFolderSizes=t.getChangesForDirectory=t.createCloudDoc=t.rollbackChangeSets=t.restoreFiles=t.moveFiles=t.isRewindButtonEnabled=t.copyFiles=t.loadPath2Continue=t.loadPath2=void 0,o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),t.loadPath2=function(e){var t,o,s,a;return r.__awaiter(this,void 0,void 0,(function*(){const{userId:r,rootNsId:l,path:d,sortType:_,sortIsAscending:u,includeDeleted:p}=e,E=new i.UserApiV2Client,f=yield E.ns("files").rpc("browse",{root_ns_id:l,fq_path:d,include_deleted:p,sort_type:_,sort_is_ascending:u,sort_folders_first:!0,include_xattrs:!0,include_folder_overview:!0},{subjectUserId:r});return(0,c.assert)(void 0!==f.context,"context is undefined"),(0,c.assert)(void 0!==f.paginated_file_info,"paginated_file_info is undefined"),(0,c.assert)(void 0!==f.total_count,"total_count is undefined"),{folderOverview:null!==(t=f.folder_overview)&&void 0!==t?t:null,mountPoints:m(f.context.ns_id_infos),context:n.BrowseContext.fromApiV2Object(f.context),items:f.paginated_file_info.map(e=>e.file_info),hasMore:null!==(o=f.has_more)&&void 0!==o&&o,nextRequestVoucher:null!==(s=f.next_request_voucher)&&void 0!==s?s:null,paginatedTotalNumFiles:f.total_count,currentFolderInfo:null===(a=f.folder_info)||void 0===a?void 0:a.file_info}}))},t.loadPath2Continue=function(e,t){return(new i.UserApiV2Client).ns("files").rpc("browse_continue",{cursor:e},{subjectUserId:t})},t.copyFiles=function(e){const{files:t,newPath:r,userId:o,onSuccess:i,checkFSWs:a}=e,c=t.map(e=>e.fq_path);return c.includes(r)?(_.Notify.error(d.intl.formatMessage({id:"wWiDtY",defaultMessage:"You can’t copy a folder into itself."})),!1):(s.WebProgressRequest({url:"/cmd/copy",data:{files:c,to_path:r,fsw_request:a?"check":void 0},dataType:"text",subject_user:o,progress_text:d.intl.formatMessage({id:"AZPIG5",defaultMessage:"Copying files..."}),success(e,t){try{const e=JSON.parse(t),o=e.new_browse_files?e.new_browse_files.map(n.File.fromServerObject):[];i({newFiles:o,destinationPath:r,changesets:e.changesets,failureDetails:e.failure_details})}catch(e){}}}),!0)},t.isRewindButtonEnabled=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){try{return"/"===e&&(e=""),(new i.UserApiV2Client).ns("chronicle").rpc("can_rewind",{path:e,version:2},{subjectUserId:t})}catch(e){return{can_rewind:!1}}}))},t.moveFiles=function(e){const{path:t,files:r,newPath:o,userId:i,onSuccess:c,allowOwnershipTransfer:u,checkFSWs:p}=e;if(void 0!==t&&a.paths_are_equal(t,o))return _.Notify.error(d.intl.formatMessage({id:"V6/bVk",defaultMessage:"Those files already exist in that folder."})),!1;const E=r.map(e=>e.fq_path);return E.includes(o)?(_.Notify.error(d.intl.formatMessage({id:"blAaiJ",defaultMessage:"You can’t move a folder into itself."})),!1):(s.WebProgressRequest({url:"/cmd/move",data:{files:E,to_path:o,allow_ownership_transfer:u,fsw_request:p?"check":void 0},dataType:"text",subject_user:i,progress_text:d.intl.formatMessage({id:"FdTkAn",defaultMessage:"Moving files..."}),skipNotifyError:!u,success(e,r){try{const e=JSON.parse(r),s=e.new_browse_files?e.new_browse_files.map(n.File.fromServerObject):[];c({path:t,destinationPath:o,newFiles:s,changesets:e.changesets,failureDetails:e.failure_details})}catch(e){}},error:(t,r,o)=>{_.Notify.error(new l.HTML(o.message)),e.onError&&e.onError(o.message)}}),!0)},t.restoreFiles=function(e){const{files:t,userId:r,onSuccess:o,isSearchMode:i,rootNsId:a}=e;s.WebProgressRequest({url:"/cmd/restore",data:{files:t.map(e=>e.fq_path),source:i?"search":"browse",backup_ns_id:(0,E.isBackupBrowse)()&&a?a:void 0},dataType:"text",subject_user:r,progress_text:d.intl.formatMessage({id:"kBkLSN",defaultMessage:"Restoring…"}),success(){o()}})},t.rollbackChangeSets=function(e){const{userId:t,changesets:r=null,progressText:o,onSuccess:i}=e;s.WebProgressRequest({url:"/cmd/rollback",data:{ns_to_cs:JSON.stringify(r)},dataType:"text",subject_user:t,progress_text:o,success(){i()}})},t.createCloudDoc=function(e){const{pathName:t,title:r,documentType:o,userId:i,onSuccess:a,onError:c,checkFSWs:l,actionSource:d}=e,_=`${t}/${r}.${o}`.replace("//","/");s.WebRequest({url:new u.URI({path:"/cmd/create_cloud_doc"}).toString(),subject_user:i,data:{to_path:_,title:r,fsw_request:l?"check":void 0,action_source:d},dataType:"text",success(e,t){const r=f(t);if(r){const e=r.new_browse_files?n.File.fromServerObject(r.new_browse_files[0]):null;a({changesets:null,createdFile:e,failureDetails:r.failure_details})}},error(e,t,r){c(r.message)},skipNotifyError:!0})},t.getChangesForDirectory=function(e){const{path:t,userId:r,namespaceToJournalIdMap:i,onSuccess:a,onComplete:n,includeDeletedFiles:c,limitScope:l}=e,d={fq_dir:"/"===t?"":t,ns_map:o.map(i,(e,t)=>`${t}_${e}`).join(","),show_deleted:!!c,limit_scope:l},_=new AbortController;return s.SilentBackgroundRequest({url:"/update/list_dir",subject_user:r,data:d,dataType:"text",signal:_.signal,success(e,t){const r=f(t);r&&a(r)},complete:n}),_},t.fetchSharedFolderSizes=function(e,t){return(new i.UserApiV2Client).ns("folders").rpc("get_shared_subfolder_sizes",t,{subjectUserId:e})},t.fetchSameNamespaceFolderSizes=function(e,t){return(new i.UserApiV2Client).ns("folders").rpc("get_subfolder_sizes_in_same_namespace",t,{subjectUserId:e})},t.fetchUnmountedBackupFolderSizes=function(e,t,r){return(new i.UserApiV2Client).ns("folders_info").rpc("get_folder_sizes",{paths:[t],allow_unmounted_ns:!0},{subjectUserId:e}).then(({folder_sizes:e})=>({sizes_dict:e.map(({size:e})=>({fq_path:r.fq_path,size:e})),queue:[]}))},t.getFolderMemberCounts=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){try{const r=new p.FolderShareApiClient({userId:t,client:new i.UserApiV2Client}),o=yield r.getMemberCounts({contentId:e});return o?o.total_unique_users:0}catch(e){return 0}}))},t.fetchChronicleEventsApi=function(e,t,o,s,a,n,c){return r.__awaiter(this,void 0,void 0,(function*(){const r={path:t,version:2,direction:s,timestamp:o,filter:{only_rewindable:a,op_type_filters:n},ns_id:c};return yield(new i.UserApiV2Client).ns("chronicle").rpc("list_events",r,{subjectUserId:e})}))}})),define("metaserver/static/js/file_uploader/action_logger",["require","exports","tslib","metaserver/static/js/filepath/filepath","metaserver/static/js/file_uploader/constants","metaserver/static/js/file_uploader/web_upload_action_logger","metaserver/static/js/clean/web_user_action_logger","metaserver/static/js/file_uploader/web_upload_action_events","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/modules/constants/global_file_upload","metaserver/static/js/core/browser","metaserver/static/js/file_uploader/utils","metaserver/static/js/core/exception","metaserver/static/js/pap/analytics_client","metaserver/static/js/dropbox/proto/pap_events/manual_upload/upload_file","metaserver/static/js/pap/util"],(function(e,t,r,o,s,i,a,n,c,l,d,_,u,p,E,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logUploadAction=void 0,o=r.__importStar(o),d=r.__importStar(d);const m=E.pap_events.manual_upload.Upload_File;function S(){const e=d.get_pathname();return"/h"===e?"HOME":"/recents"===e?"RECENTS":"/starred"===e?"STARRED":e.startsWith("/share")?"SHARED":"/requests"===e?"FILE_REQUESTS":"/deleted_files"===e?"DELETED_FILES":"BROWSE"}function g(e){return e&&!!e.uploadId}function h(e){return e&&!!e.batchId}function O(e){var t;return null!==(t=(0,f.getEnumValueForString)(`${e.toUpperCase()}_FILE_TYPE`,m.FileType))&&void 0!==t?t:m.FileType.UNKNOWN_FILE_TYPE}function T(e){var t;return null!==(t=(0,f.getEnumValueForString)(e,E.pap_events.EventState))&&void 0!==t?t:E.pap_events.EventState.UNKNOWN_EVENT_STATE}t.logUploadAction=function({action:e,upload:t,chooser_type:r,upload_method:E,num_files:f,num_dirs:I,errorType:R,extra:v,batchId:A,user:b,uploadPath:N,useUploadKit:C,source:L}){let P={num_files:f,num_dirs:I,chooser_type:r,upload_method:E,extra:Object.assign({origin:S(),use_upload_kit:C?"true":"false",use_upload_session:l.UPLOAD_SESSION_MIGRATION?"true":"false",upload_precheck_optimizations:l.UPLOAD_PRECHECK_OPTIMIZATIONS?"true":"false",use_upload_prevent_sleep:l.UPLOAD_PREVENT_SLEEP?"true":"false",use_persistent_upload:l.PERSISTENT_UPLOAD?"true":"false",use_autoretry_optimization:l.UPLOAD_AUTORETRY_OPTIMIZATION?"true":"false"},L&&{source:L})};if(g(t)){const r=t,i=e===n.WebUploadActionEvent.UPLOAD_FAILURE?r.errorType===s.UploadErrorType.GENERIC&&R?R:r.errorType:void 0;P=Object.assign(Object.assign({},P),{upload_id:r.uploadId,file_size:r.size,file_extension:o.file_extension(r.name),failure_reason:i,batch_id:r.batchId,upload_destination:r.dest,current_path:d.get_pathname(),file_name:r.name})}else if(h(t)){const e=t;P=Object.assign(Object.assign({},P),{file_size:e.size,file_extension:o.file_extension(e.name),batch_id:e.batchId})}if(!P.chooser_type&&t&&"chooserType"in t&&t.chooserType&&(P.chooser_type=t.chooserType),A&&(P.batch_id=A),N&&(P.batch_dest_folder_level=(0,_.getFolderLevel)(N),b&&(P.member_folder=(0,_.isInMemberFolder)(b,N))),v&&(P.extra=Object.assign(Object.assign({},P.extra),v)),b){let r;const s=v&&v.targetSurface;if((function(e){return e===c.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK||e===c.WebUserActionLogEvent.ADD_MORE_FILES_CLICK||e===c.WebUserActionLogEvent.VIEW_DETAILS_CLICK||e===c.WebUserActionLogEvent.CLOSE_MODAL_CLICK||e===c.WebUserActionLogEvent.UPLOAD_FILES_CLICK||e===c.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK||e===c.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK})(e)){if(e===c.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK){const e=T("CANCELED");if(g(t)||h(t)){const i=t,a=O(o.file_extension(i.name));r={eventState:e,actionSurface:s,cancelTime:Math.round(Date.now()/1e3),fileSize:i.size,fileType:a}}else r={eventState:e,actionSurface:s,cancelTime:Math.round(Date.now()/1e3)};(0,p.logEvent)(m.create(r))}return void a.WebUserActionLog.log(b.id,e,P)}if(e=e,P.client_timestamp=Math.round(Date.now()/1e3),i.WebUploadActionLog.log(b.id,e,P),g(t)||h(t)){const i=t,a=O(o.file_extension(i.name));if(e===n.WebUploadActionEvent.UPLOAD_ATTEMPT&&(r={eventState:T("START"),fileType:a,startTime:P.client_timestamp,uploadMethod:E,actionSurface:s,fileSize:i.size},(0,p.logEvent)(m.create(r))),e===n.WebUploadActionEvent.UPLOAD_FAILURE){const e=v&&v.errorMessage,t=v&&v.fswData,o=v&&v.errorCode;r={eventState:T("FAILED"),fileType:a,fileSize:i.size,errorMessage:e,actionSurface:s,fileSystemWarning:t,errorCode:Number(o),uploadMethod:E},(0,p.logEvent)(m.create(r))}if(e===n.WebUploadActionEvent.UPLOAD_SUCCESS){const e={eventState:T("SUCCESS"),fileType:a,fileSize:i.size,actionSurface:s,uploadMethod:E};(0,p.logEvent)(m.create(e))}}}else(0,u.reportStack)("Trying to log web upload event but user is null",{severity:u.SEVERITY.NONCRITICAL})}})),define("metaserver/static/js/file_uploader/constants",["require","exports","tslib","immutable"],(function(e,t,r,o){"use strict";var s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.ValidChunkSizeStrings=t.FileUpload=t.OverQuotaStatusType=t.isUploadTypeError=t.UploadErrorType=t.TeamAccessLevel=t.FileStatusType=t.UploaderActionType=t.MAX_FILE_SIZE=t.ChooserType=void 0,o=r.__importStar(o),(function(e){e.FILE="file",e.FOLDER="folder",e.FILE_FOLDER="file_folder",e.UNKNOWN="unknown"})(t.ChooserType||(t.ChooserType={})),t.MAX_FILE_SIZE=524288e5,(function(e){e.ALL_UPLOADS_COMPLETE="ALL_UPLOADS_COMPLETE",e.SET_PATH="UPLOADER_SET_PATH",e.SET_FOLDER_NS_ID="UPLOADER_SET_FOLDER_NS_ID",e.SET_USER="UPLOADER_SET_USER",e.SET_NUM_DRAGGING_FILES="SET_NUM_DRAGGING_FILES",e.READY_UPLOADS="READY_UPLOADS",e.QUEUE_UPLOADS="QUEUE_UPLOADS",e.START_UPLOAD="START_UPLOAD",e.COMPLETE_UPLOAD="COMPLETE_UPLOAD",e.CANCEL_UPLOADS="CANCEL_UPLOADS",e.SET_CURRENT_UPLOAD_PROGRESS="SET_CURRENT_UPLOAD_PROGRESS",e.UPLOAD_ERROR="UPLOAD_ERROR",e.SET_IS_UPLOAD_MODAL_OPEN="SET_IS_UPLOAD_MODAL_OPEN",e.SET_INLINE_STATUS_SHOULD_BE_DISMISSED="SET_INLINE_STATUS_SHOULD_BE_DISMISSED",e.ADD_NEW_FAILED_FILE="ADD_NEW_FAILED_FILE",e.CONFIRM_FSW="CONFIRM_FSW",e.ADD_FILES_TO_PLU="ADD_FILES_TO_PLU",e.ADD_DIRECTORIES_TO_PLU="ADD_DIRECTORIES_TO_PLU",e.REMOVE_FILES="REMOVE_FILES",e.SET_HAS_OVERQUOTA_ERROR="SET_HAS_OVERQUOTA_ERROR",e.SET_IS_PERMISSIONS_AT_UPLOAD_MODAL_OPEN="SET_IS_PERMISSIONS_AT_UPLOAD_MODAL_OPEN",e.ADD_TEAM_ACCESS_LEVEL="ADD_TEAM_ACCESS_LEVEL",e.RESET_TEAM_ACCESS_LEVELS="RESET_TEAM_ACCESS_LEVELS",e.SET_UPLOAD_PROGRESS="SET_UPLOAD_PROGRESS",e.SET_FILE_UPLOAD_TIME_LEFT="SET_FILE_UPLOAD_TIME_LEFT"})(t.UploaderActionType||(t.UploaderActionType={})),(function(e){e.SET_PERMISSIONS="SET_PERMISSIONS",e.PENDING="PENDING",e.UPLOADING="UPLOADING",e.COMPLETE="COMPLETE",e.CANCELLED="CANCELLED",e.FAILED="FAILED"})(s=t.FileStatusType||(t.FileStatusType={})),(function(e){e.WRITER="WRITER",e.READER="READER",e.NO_ACCESS="NO_ACCESS",e.INHERIT="INHERIT"})(t.TeamAccessLevel||(t.TeamAccessLevel={})),(function(e){e.FILE_SIZE_ERROR="FILE_SIZE_ERROR",e.HTTP_ERROR="HTTP_ERROR",e.CONNECTION_ERROR="CONNECTION_ERROR",e.OVER_QUOTA_ERROR="OVER_QUOTA_ERROR",e.LOCKED_TEAM_ERROR="LOCKED_TEAM_ERROR",e.IGNORED="IGNORED",e.INVALID_EXTENSION="INVALID_EXTENSION",e.EMPTY_OR_FOLDER="EMPTY_OR_FOLDER",e.FOLDER_SAFARI="FOLDER_SAFARI",e.PACKAGE_FILE="PACKAGE_FILE",e.GENERIC="GENERIC",e.BLOCKS_MISSING_ERROR="BLOCKS_MISSING_ERROR",e.COMMIT_HTTP_ERROR="COMMIT_HTTP_ERROR",e.COMMIT_INVALID_ARGS="COMMIT_INVALID_ARGS",e.UPLOAD_BLOCK_ERROR="UPLOAD_BLOCK_ERROR",e.CHUNKS_NOT_ENABLED_ERROR="CHUNKS_NOT_ENABLED_ERROR",e.SERVER_RESPONSE_ERROR="SERVER_RESPONSE_ERROR",e.SERVER_TOKEN_EMPTY_ERROR="SERVER_TOKEN_EMPTY_ERROR",e.SERVER_TOKENS_MISSING_ERROR="SERVER_TOKENS_MISSING_ERROR",e.SERVER_HASH_RESPONSE_ERROR="SERVER_HASH_RESPONSE_ERROR",e.BLOCK_RUNTIME_ID_MISSING_ERROR="BLOCK_RUNTIME_ID_MISSING",e.CLIENT_HASH_EMPTY_ERROR="CLIENT_HASH_EMPTY_ERROR",e.SERVER_HASH_EMPTY_ERROR="SERVER_HASH_EMPTY_ERROR",e.HASHES_NOT_EQUAL_ERROR="HASHES_NOT_EQUAL_ERROR",e.BLOCK_INDEX_ERROR="BLOCK_INDEX_ERROR",e.BLOCK_EMPTY_ERROR="BLOCK_EMPTY_ERROR",e.BLOB_EMPTY_ERROR="BLOB_EMPTY_ERROR",e.BLOB_MISSING_ERROR="BLOB_MISSING_ERROR",e.CLIENT_HASH_DIGEST_ERROR="CLIENT_HASH_DIGEST_ERROR",e.FILE_READER_NULL_RESULT_ERROR="FILE_READER_NULL_RESULT_ERROR",e.COMMIT_READINESS_ERROR="COMMIT_READINESS_ERROR",e.UPLOAD_PRECHECK_ERROR="UPLOAD_PRECHECK_ERROR",e.UPLOAD_PRECHECK_INVALID_CHAR_ERROR="UPLOAD_PRECHECK_INVALID_CHAR_ERROR",e.PERMISSIONS_AT_UPLOAD_ERROR="PERMISSIONS_AT_UPLOAD_ERROR",e.START_UPLOAD_SESSION_ERROR="START_UPLOAD_SESSION_ERROR",e.APPEND_BLOCK_MISSING_PARAMS="APPEND_BLOCK_MISSING_PARAMS"})(i=t.UploadErrorType||(t.UploadErrorType={})),t.isUploadTypeError=function(e){return-1!==Object.values(i).indexOf(e)},(function(e){e.NONE="NONE",e.BASIC_OVER_QUOTA="BASIC_OVER_QUOTA",e.BASIC_NEAR_QUOTA="BASIC_NEAR_QUOTA",e.LIMITED_TEAM_USER_OVER_QUOTA="LIMITED_TEAM_USER_OVER_QUOTA",e.LIMITED_TEAM_TSD_OVER_QUOTA="LIMITED_TEAM_TSD_OVER_QUOTA",e.LOCKED_TEAM_USER_OVER_QUOTA="LOCKED_TEAM_USER_OVER_QUOTA"})(t.OverQuotaStatusType||(t.OverQuotaStatusType={}));class a extends(o.Record({uploadId:void 0,dest:"",ns_id:null,ns_path:null,userId:null,name:"",size:0,percentUploaded:0,status:s.SET_PERMISSIONS,errorType:i.GENERIC,errorMessage:"",batchId:void 0,chooserType:void 0,numSecondsLeft:0},"FileUpload")){}t.FileUpload=a,(function(e){e[e["4mb"]=0]="4mb",e[e["8mb"]=1]="8mb"})(t.ValidChunkSizeStrings||(t.ValidChunkSizeStrings={}))})),define("metaserver/static/js/file_uploader/utils",["require","exports","tslib","react","dig-components/tooltips","metaserver/static/js/modules/constants/global_file_upload","metaserver/static/js/clean/base64","metaserver/static/js/filepath/filepath","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/file_uploader/constants","metaserver/static/js/upload_kit/lib/types","metaserver/static/js/core/browser","metaserver/static/js/core/i18n","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/clean/viewer","metaserver/static/js/clean/em_string","metaserver/static/js/user_survey/user_survey","typescript/libraries/file-viewer/src/file_extension/extension_constants"],(function(e,t,r,o,s,i,a,n,c,l,d,_,u,p,E,f,m,S){"use strict";function g(){let e="";for(let t=0;t<16;++t)e+=String.fromCharCode(Math.floor(256*Math.random()));let t=a.encode(e);return t=t.replace(/\+/g,"-"),t=t.replace(/\//g,"_"),t=t.replace(/\=*$/,""),t}Object.defineProperty(t,"__esModule",{value:!0}),t.uploadSuccessEmitEventIsOn=t.uploadFailureEmitEventIsOn=t.precheckOptimizationIsOn=t.logMediaFileToUserSurvey=t.makeUploadSnippet=t.showCannotUploadLinksSnackbar=t.showCannotUploadEmptyFolderSnackbar=t.newPromiseWithRetries=t.legacyPromiseWithRetries=t.folderModalTitle=t.getDestinationDir=t.showInvalidFileWarning=t.getFolderLevel=t.getFileUploadsWithStatus=t.isUploadInTmf=t.uploadContainsFolder=t.isMultifolderUpload=t.getRootDests=t.getRootDest=t.getFSWMetadataToLog=t.PERMISSION_FSW_IDS=t.getUploadLocationMetadataToLog=t.isInMemberFolder=t.getOQmodalOQALocationCode=t.getNsId=t.calculateSizeOfUploads=t.generateBatchId=t.generateUploadId=void 0,o=r.__importDefault(o),a=r.__importStar(a),n=r.__importStar(n),c=r.__importStar(c),_=r.__importStar(_),t.generateUploadId=function(){return g()},t.generateBatchId=function(){return"batch-"+g()},t.calculateSizeOfUploads=function(e,t){let r=0;return e.forEach(e=>{-1!==t.indexOf(e.status)&&(r+=e.size)}),r},t.getNsId=function(e,t,r){let o=t,s=0;return e.forEach((e,t)=>{let i=0;const a=e.split("/"),n=r.split("/");for(;i<a.length&&i<n.length&&a[i]===n[i];)i++;i===a.length&&i>1&&i>s&&(s=i,o=Number(t))}),o};function h(e,t){return!e.is_team||!e.is_cdm_member||""!==n.normalize(t)&&(n.paths_are_equal(e.cdm_tmf_path,t)||n.inSubDirectory(e.cdm_tmf_path,t))}function O(e,t){let r=e.dest;const o=I(t);for(;I(r)-1>o;)r=n.parent_dir(r);return r}function T(e,t){const r=e.toArray().map(e=>O(e,t));return Array.from(new Set(r))}function I(e){return(n.normalize(e).match(/\//g)||[]).length+1}function R(e){switch(e){case d.UploadErrorType.EmptyFile:return u.intl.formatMessage({id:"KZETkM",defaultMessage:"Empty files cannot be uploaded."});case d.UploadErrorType.OverMaxFileSize:return u.intl.formatMessage({id:"Hg3ZgC",defaultMessage:"File is too large to be uploaded."});default:return u.intl.formatMessage({id:"WQDOGQ",defaultMessage:"This file is not supported by Dropbox and cannot be uploaded."})}}t.getOQmodalOQALocationCode=e=>"/h"===(e||_.get_uri().path)?"ho":"fb",t.isInMemberFolder=h,t.getUploadLocationMetadataToLog=function(e,t){return{root_folder:""===n.normalize(t),member_folder:h(e,t),folder_level:n.normalize(t).split("/").length}},t.PERMISSION_FSW_IDS=["action_commit_to_tsd_root","action_missing_parent"],t.getFSWMetadataToLog=function(e){return{has_permissions:e.includes("action_commit_to_tsd_root"),has_permissions_nonroot:e.includes("action_missing_parent"),has_other:e.some(e=>!t.PERMISSION_FSW_IDS.includes(e))}},t.getRootDest=O,t.getRootDests=T,t.isMultifolderUpload=function(e,t){const r=T(e.filter(e=>l.FileStatusType.SET_PERMISSIONS===e.status),t);return!r.every(e=>e===r[0])},t.uploadContainsFolder=function(e,t){const r=e.filter(e=>l.FileStatusType.SET_PERMISSIONS===e.status),o=I(t);return T(r,t).some(e=>I(e)>o)},t.isUploadInTmf=function(e,t){if(!t.cdm_tmf_path)return!1;const r=e.filter(e=>l.FileStatusType.SET_PERMISSIONS===e.status),o=n.normalize(t.cdm_tmf_path);return r.some(e=>e.dest===o||n.inSubDirectory(o,e.dest))},t.getFileUploadsWithStatus=function(e,t){return e.valueSeq().toArray().filter(e=>t.includes(e.status))},t.getFolderLevel=I,t.showInvalidFileWarning=function(e,t,r){return new Promise((o,s)=>{if(e.length){const{title:i,text:a}=(function(e){if(1===e.length){const{name:t,validationError:r}=e[0];return{title:u.intl.formatMessage({id:"uQF0D4",defaultMessage:"Unable to upload {file}"},{file:t}),text:R(r)}}{const t=u.intl.formatMessage({id:"Chf30m",defaultMessage:"Unable to upload one or more files"}),r=e.map(({name:e})=>e);if(e.length<=3)return{title:t,text:u.intl.formatMessage({id:"fKAsp7",defaultMessage:"The following files are not supported by Dropbox and cannot be uploaded: {files}"},{files:r.join(", ")})};const o=r.length-3;return{title:t,text:u.intl.formatMessage({id:"z9swUK",defaultMessage:"{count, plural, one{The following files are not supported by Dropbox and cannot be uploaded: {files} and {count} more} other{The following files are not supported by Dropbox and cannot be uploaded: {files} and {count} more}}"},{files:r.slice(0,3).join(", "),count:o})}}})(e),n=e.some(({validationError:e})=>e===d.UploadErrorType.CloudDoc)?"https://www.dropbox.com/help/syncing-uploads/web-based-files":"https://help.dropbox.com/installs-integrations/sync-uploads/files-not-syncing";c.showFileSystemWarningsModal({confirmText:u.intl.formatMessage({id:"Bmo28B",defaultMessage:"{count, plural, one{Skip this file} other{Skip these files}}"},{count:e.length}),fsws:[{id:"action_upload_invalid_extension",blocking:t,title:i,text:a,learn_more:n}],onFinalAccept:o,onAbortAction:r?s:void 0})}else o()})},t.getDestinationDir=function(e,t){const r=n.normalize(e),o=n.parent_dir(t);return""===r?"/"===o?"/":"/"+o:"/"===o?r:r+"/"+o},t.folderModalTitle=o.default.createElement(o.default.Fragment,null,u.intl.formatMessage({id:"2sJoAc",defaultMessage:"Upload file in..."}),o.default.createElement(s.Toggletip,{"aria-label":"More information",iconButtonSize:"standard",title:u.intl.formatMessage({id:"Grmp0v",defaultMessage:"Choose a folder you have access to"})}));const v=e=>r.__awaiter(void 0,void 0,void 0,(function*(){return new Promise(t=>setTimeout(t,e))}));t.legacyPromiseWithRetries=(e,t)=>r.__awaiter(void 0,void 0,void 0,(function*(){let r=0,o=yield e();for(;o.isError&&r<t;)r++,yield v(5**r),o=yield e();return{response:o,retryCount:r}}));class A{constructor(){this.isSnackbarShown=!1}hideSnackbar(){this.isSnackbarShown&&(p.Snackbar.close("upload_network_warning_snackbar"),this.isSnackbarShown=!1)}showSnackbar(){this.isSnackbarShown||(this.isSnackbarShown=!0,p.Snackbar.warn(A.warningText,"upload_network_warning_snackbar",!0,{timeoutDelayMs:void 0}))}}A.warningText=u.intl.formatMessage({id:"hCYxpM",defaultMessage:"You seem to be having internet issues. Hang tight and we’ll resume your upload once you reconnect."});const b=new A;t.newPromiseWithRetries=(e,t=5)=>r.__awaiter(void 0,void 0,void 0,(function*(){let r=0,o=yield e();const s=(i=t)+Math.random()*(i/2);for(var i;o.isError;){const{isRetriable:t=!0,maxRetries:i=3,isNetworkError:a}=o;if(a?b.showSnackbar():b.hideSnackbar(),!t||i&&r>i)break;r++;const n=Math.min(s**r,1e4);yield v(n),o=yield e()}return o.isError||b.hideSnackbar(),{response:o,retryCount:r}}));t.showCannotUploadEmptyFolderSnackbar=()=>{p.Snackbar.fail(u.intl.formatMessage({id:"j0CgUw",defaultMessage:"Can’t upload empty file or folder."}),"upload-error-empty-dir",!0)};t.showCannotUploadLinksSnackbar=()=>{p.Snackbar.fail(u.intl.formatMessage({id:"VRES4Y",defaultMessage:"Can’t upload links. To save a link, go to Create > More > Shortcut."}),"upload-error-no-links",!0)};t.makeUploadSnippet=(e,t,r)=>{const o=E.Viewer.get_viewer();let s;return o.is_paired&&t.is_team&&(s=o.team_name),o.is_paired?t.is_team?N(r,e,s):C(r,e):L(r,e)};const N=(e,t,r)=>{const o=f.Emstring.em_snippet(n.filename(e),t);return"/"===e?u.intl.formatMessage({id:"hem9Id",defaultMessage:"upload to your {team_name} Dropbox"},{team_name:r}):u.intl.formatMessage({id:"dFFTlY",defaultMessage:"upload to the folder ‘{folder}’ in your {team_name} Dropbox"},{folder:o,team_name:r})},C=(e,t)=>{const r=f.Emstring.em_snippet(n.filename(e),t);return"/"===e?u.intl.formatMessage({id:"2iuZ56",defaultMessage:"upload to your personal Dropbox"}):u.intl.formatMessage({id:"ezK+EU",defaultMessage:"upload to the folder ‘{folder}’ in your personal Dropbox"},{folder:r})},L=(e,t)=>{const r=f.Emstring.em_snippet(n.filename(e),t);return"/"===e?u.intl.formatMessage({id:"te1cSD",defaultMessage:"upload to your Dropbox"}):u.intl.formatMessage({id:"bgpbuT",defaultMessage:"upload to the folder ‘{folder}’"},{folder:r})};t.logMediaFileToUserSurvey=e=>{const t=e.lastIndexOf(".");if(-1===t)return;const r=e.slice(t);S.AUDIO_EXTS.includes(r)?m.UserSurvey.trackEvent("upload_audio_item","browse"):S.PHOTO_EXTS.includes(r)?m.UserSurvey.trackEvent("upload_photo_item","browse"):S.TRANSCODE_VIDEO_EXTS.includes(r)&&m.UserSurvey.trackEvent("upload_video_item","browse")};t.precheckOptimizationIsOn=()=>"ON"===i.UPLOAD_PRECHECK_OPTIMIZATIONS||"GA"===i.UPLOAD_PRECHECK_OPTIMIZATIONS;t.uploadFailureEmitEventIsOn=()=>i.UPLOAD_FAILURE_EMIT_EVENT;t.uploadSuccessEmitEventIsOn=()=>i.UPLOAD_SUCCESS_EMIT_EVENT})),define("metaserver/static/js/files_view/file_actions/api_v2",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/filepath/filepath","metaserver/static/js/core/exception"],(function(e,t,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPathLookupFailure=t.isFailure=t.createFolder=t.deleteFiles=t.copyFiles=t.moveAndRenameFolder=t.moveFiles=t.renameFile=t.undo=t.getFilenameFromActionInfo=t.fileInfoIsFqPathBased=t.createUndefinedRpcResult=t.EXCLOG_TAG=void 0,s=r.__importStar(s);t.EXCLOG_TAG="file_actions_client_error";t.createUndefinedRpcResult=e=>({isError:!0,error:{".tag":"undefined_error"},error_summary:"undefined_error",jobId:e});const a=(e,r)=>{(0,i.reportStack)(JSON.stringify("error"in r?r.error:r),{severity:i.SEVERITY.NON_CRITICAL,silent:!0,tags:[t.EXCLOG_TAG,`${t.EXCLOG_TAG}_${e}`]})};function n(e){return Boolean("fq_path"in e?e:null)}function c(e){return n(e)?s.filename(e.fq_path):e.name}t.fileInfoIsFqPathBased=n,t.getFilenameFromActionInfo=c,t.undo=function(e,s){return r.__awaiter(this,void 0,void 0,(function*(){const r=new o.UserApiV2Client;try{return{isError:!1,result:yield r.ns("files").rpc("undo_batch",{entries:e},{subjectUserId:s.id})}}catch(e){return a("undo_batch",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.summary}:(0,t.createUndefinedRpcResult)()}}))},t.renameFile=function(e,t,i,a){return r.__awaiter(this,void 0,void 0,(function*(){const r=s.parent_dir(e),n=s.normalize(r)+"/"+t,c=new o.UserApiV2Client,{checkFSWs:l}=a;try{const t=yield c.ns("files").rpc("move_v2",{from_path:e,to_path:n,autorename:!0,allow_ownership_transfer:!1,fsw_request:l?{".tag":"check"}:void 0},{subjectUserId:i});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",success:t.metadata}]}}}catch(e){return p(e)}}))};const l=(e,t,r,o,s)=>()=>e.ns("files").rpc("move_batch_v2",{entries:r,autorename:!0,allow_ownership_transfer:!!o,fsw_request:s?{".tag":"check"}:void 0},{subjectUserId:t}),d=(e,t)=>r=>e.ns("files").rpc("move_batch/check_v2",{async_job_id:r},{subjectUserId:t});function _(e,o){return r.__awaiter(this,void 0,void 0,(function*(){try{const r=yield e();if("complete"===r[".tag"])return E("relocation_batch",r),{isError:!1,result:r};{let e=void 0;do{yield new Promise(e=>setTimeout(e,1e3)),e=yield o(r.async_job_id)}while(e&&"in_progress"===e[".tag"]);if("complete"===e[".tag"]){const t=e;for(const e of t.entries){const t=u(e,r.async_job_id);if(t)return t}return E("relocation_batch",t),{isError:!1,result:t,jobId:r.async_job_id}}return a("relocation_batch_poll",e),(0,t.createUndefinedRpcResult)(r.async_job_id)}}catch(e){return a("relocation_batch_poll",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.error[".tag"]}:(0,t.createUndefinedRpcResult)()}}))}function u(e,t){if("failure"===e[".tag"]&&"relocation_error"===e.failure[".tag"]&&"to"===e.failure.relocation_error[".tag"]&&"file_system_warnings"===e.failure.relocation_error.to[".tag"])return{isError:!0,error:e.failure.relocation_error,error_summary:"file_system_warnings",jobId:t}}function p(e){var r;if(null===(r=null==e?void 0:e.error)||void 0===r?void 0:r[".tag"]){const t={".tag":"failure",failure:{".tag":"relocation_error",relocation_error:e.error}},r=u(t,void 0);return void 0!==r?r:{isError:!1,result:{changeset_data:[],entries:[t]}}}return(0,t.createUndefinedRpcResult)()}t.moveFiles=function(e,t,s,i={}){return r.__awaiter(this,void 0,void 0,(function*(){const r=new o.UserApiV2Client,{allowOwnershipTransfer:a,checkFSWs:u}=i,E=e=>{const r=`${t}/${c(e)}`;return n(e)?{from_path:e.fq_path,to_path:r}:{from_path:e.id,to_path:r}};if(1===e.length&&n(e[0])&&!e[0].is_dir)try{const t=yield r.ns("files").rpc("move_v2",Object.assign(Object.assign({},E(e[0])),{allow_ownership_transfer:!!a,fsw_request:u?{".tag":"check"}:void 0}),{subjectUserId:s});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",success:t.metadata}]}}}catch(e){return p(e)}const f=l(r,s,e.map(E),a,u),m=d(r,s);return yield _(f,m)}))},t.moveAndRenameFolder=function(e,t,s,i,a={}){return r.__awaiter(this,void 0,void 0,(function*(){const r=new o.UserApiV2Client,{allowOwnershipTransfer:c,checkFSWs:u}=a,p=l(r,i,[(e=>{const r=`${t}/${s}`;return n(e)?{from_path:e.fq_path,to_path:r}:{from_path:e.id,to_path:r}})(e)],c,u),E=d(r,i);return yield _(p,E)}))},t.copyFiles=function(e,t,i,a={}){var n;return r.__awaiter(this,void 0,void 0,(function*(){const r=new o.UserApiV2Client,{checkFSWs:c}=a;if(1===e.length&&!e[0].is_dir)try{const o=yield r.ns("files").rpc("copy_v2",{from_path:null!==(n=e[0].file_id)&&void 0!==n?n:e[0].fq_path,to_path:`${t}/${s.filename(e[0].fq_path)}`,autorename:!0,fsw_request:c?{".tag":"check"}:void 0},{subjectUserId:i});return{isError:!1,result:{changeset_data:o.changeset_data,entries:[{".tag":"success",success:o.metadata}]}}}catch(e){return p(e)}return yield _(()=>r.ns("files").rpc("copy_batch_v2",{entries:e.map(e=>{var r;return{from_path:null!==(r=e.file_id)&&void 0!==r?r:e.fq_path,to_path:`${t}/${s.filename(e.fq_path)}`}}),autorename:!0,fsw_request:c?{".tag":"check"}:void 0},{subjectUserId:i}),e=>r.ns("files").rpc("copy_batch/check_v2",{async_job_id:e},{subjectUserId:i}))}))},t.deleteFiles=function(e,s,i){var n;return r.__awaiter(this,void 0,void 0,(function*(){const c=new o.UserApiV2Client,l=e=>"file_id"in e?e.file_id:e.fq_path;if(1===e.length&&!e[0].is_dir)try{const t=yield c.ns("files").rpc("delete_v2",{path:l(e[0]),fsw_request:i?{".tag":"check"}:void 0},{subjectUserId:s});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",metadata:t.metadata}]}}}catch(e){return(0,t.isPathLookupFailure)(e)||a("delete_v2",e),(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n[".tag"])?{isError:!1,result:{changeset_data:[],entries:[{".tag":"failure",failure:e.error}]}}:(0,t.createUndefinedRpcResult)()}return yield(function(e,o){return r.__awaiter(this,void 0,void 0,(function*(){try{const r=yield e();if("complete"===r[".tag"])return E("delete_batch",r),{isError:!1,result:r};if("other"===r[".tag"])return a("delete_batch",r),(0,t.createUndefinedRpcResult)();{let e=void 0;do{yield new Promise(e=>setTimeout(e,1e3)),e=yield o(r.async_job_id)}while(e&&"in_progress"===e[".tag"]);return"complete"===e[".tag"]?(E("delete_batch",e),{isError:!1,result:e,jobId:r.async_job_id}):(a("delete_batch_poll",e),(0,t.createUndefinedRpcResult)(r.async_job_id))}}catch(e){return a("delete_batch",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.summary}:(0,t.createUndefinedRpcResult)()}}))})(()=>c.ns("files").rpc("delete_batch",{entries:e.map(e=>({path:l(e)})),fsw_request:i?{".tag":"check"}:void 0},{subjectUserId:s}),e=>c.ns("files").rpc("delete_batch/check",{async_job_id:e},{subjectUserId:s}))}))};const E=(e,t)=>{t.entries.forEach(t=>{".tag"in t&&"failure"===t[".tag"]&&a(e,t.failure)})};t.createFolder=function(e,i,n,c){return r.__awaiter(this,void 0,void 0,(function*(){const r=new o.UserApiV2Client;try{return{isError:!1,result:yield r.ns("files").rpc("create_folder_v2",{path:s.normalize(e)+"/"+i,autorename:!0,fsw_request:c?{".tag":"check"}:void 0},{subjectUserId:n.id})}}catch(e){return a("create_folder",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.summary}:(0,t.createUndefinedRpcResult)()}}))};t.isFailure=e=>"failure"===e[".tag"];t.isPathLookupFailure=e=>"path_lookup"===e[".tag"]})),define("metaserver/static/js/folder_dialog/async",["require","exports","tslib","react","metaserver/static/js/components/ui/modal_controller","metaserver/static/js/css/css"],(function(e,t,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prewarmFolderDialog=t.showFolderDialog=void 0,o=r.__importDefault(o),t.showFolderDialog=function(t){new Promise((t,r)=>{e(["metaserver/static/js/folder_dialog/folder_dialog"],t,r)}).then(r.__importStar).then(({FolderDialog:e})=>{(0,s.mountModal)(o.default.createElement(e,Object.assign({},t)))})},t.prewarmFolderDialog=function(){new Promise((t,r)=>{e(["metaserver/static/js/folder_dialog/folder_dialog"],t,r)}).then(r.__importStar).then(()=>{(0,i.require_css)("/static/metaserver/static/css/react/folder_picker-vflhBHl9O.css")})}})),define("metaserver/static/js/new_file_menu/new_file_icon",["require","exports","tslib","react","spectrum/icon_partners/index","metaserver/static/js/clean/static_urls"],(function(e,t,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFileIcon=void 0,o=r.__importDefault(o);const a={dropbox_form:(0,i.static_url)("/static/metaserver/static/images/dropbox_form-vfl1f-v2W.svg")};t.NewFileIcon=({iconName:e,displayName:t})=>{const r=a[e];return r?o.default.createElement("img",{alt:t,src:r,width:"24px",height:"24px"}):o.default.createElement(s.IconPartners,{name:e,width:"24px",height:"24px"})},t.NewFileIcon.displayName="NewFileIcon"})),define("metaserver/static/js/new_file_menu/new_file_menu",["require","exports","tslib","classnames","react","dig-components/buttons","dig-components/typography","dig-components/menu","metaserver/static/js/cloud_docs/constants","metaserver/static/js/cloud_docs/create_api","metaserver/static/js/browse/action_logger","metaserver/static/js/components/ui/css","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/modules/constants/page_load","metaserver/static/js/new_file_menu/new_file_icon","metaserver/static/js/new_file_menu/new_file_util","metaserver/static/js/dropbox/proto/pap_events/organize/finish_browse_time_to_success","metaserver/static/js/browse_tts/browse_tts"],(function(e,t,r,o,s,i,a,n,c,l,d,_,u,p,E,f,m,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFileMenu=t.NewFileTypeRow=t.handleNewFileSelection=void 0,o=r.__importDefault(o),s=r.__importDefault(s),p=r.__importStar(p);var g=m.pap_events.organize.Finish_BrowseTimeToSuccess.BrowseTtsEventName;const h=new Map([[c.GoogleFileTypes.GOOGLE_DSS_DOC,g.CREATE_DOCUMENT_BROWSE_TTS_EVENT_NAME],[c.MicrosoftFileTypes.WORD,g.CREATE_DOCUMENT_BROWSE_TTS_EVENT_NAME],[c.GoogleFileTypes.GOOGLE_DSS_SLIDES,g.CREATE_PRESENTATION_BROWSE_TTS_EVENT_NAME],[c.MicrosoftFileTypes.POWERPOINT,g.CREATE_PRESENTATION_BROWSE_TTS_EVENT_NAME],[c.GoogleFileTypes.GOOGLE_DSS_SHEET,g.CREATE_SPREADSHEET_BROWSE_TTS_EVENT_NAME],[c.MicrosoftFileTypes.EXCEL,g.CREATE_SPREADSHEET_BROWSE_TTS_EVENT_NAME]]);t.handleNewFileSelection=e=>{e.handleClick()};class O extends s.default.Component{render(){return s.default.createElement(n.Menu.ActionItem,{key:this.props.item.displayName,value:this.props.item,className:this.props.item.className,withLeftAccessory:s.default.createElement(E.NewFileIcon,{displayName:this.props.item.displayName,iconName:this.props.item.iconName})},s.default.createElement(a.Text,null,this.props.item.displayName))}}t.NewFileTypeRow=O,O.displayName="NewFileTypeRow";class T extends s.default.Component{constructor(){super(...arguments),this.handleCreateNewFile=(e,t)=>()=>{var r;const o=null!==(r=h.get(e))&&void 0!==r?r:g.CREATE_SOMETHING_ELSE_BROWSE_TTS_EVENT_NAME;(0,S.logBrowseTTS)(o);const{selection_mode:s,empty_folder:i}=this.props,a=t=>{(0,l.showAsyncFolderDialog)({user:this.props.user,source:this.props.source,documentType:e,selection_mode:s,empty_folder:i,handleClickNewFolder:this.props.handleClickNewFolder?this.props.handleClickNewFolder(this.props.user,a):void 0,initialPath:t})};t&&t(e),(0,d.logFileCreateClick)({uid:this.props.user.id,source:this.props.source,action:(0,f.newFileTypeToLogEvent)(e),depth_folder_selected:this.props.path?(0,l.getDepthFromPath)(this.props.path):void 0,selection_mode:s,empty_folder:i}),this.props.path?(0,l.createNewFile)({user:this.props.user,path:this.props.path,documentType:e,source:this.props.source,selection_mode:s,empty_folder:i}):a()},this.logTriggerClick=()=>{const{empty_folder:e,selection_mode:t,path:r,user:o,source:s}=this.props;(0,d.logFileCreateClick)({uid:o.id,source:s,action:u.WebUserActionLogEvent.FILE_CREATE_OPEN_MENU,depth_folder_selected:r?(0,l.getDepthFromPath)(r):void 0,selection_mode:t,empty_folder:e})}}getNewFileTypeSections(){const e=[],t=[];this.props.showPaper&&(t.push({displayName:f.NewPaperDocLabel,iconName:"dropbox_paper",className:"action-create-file-paper-doc",handleClick:this.handleCreateNewFile(c.PaperNewFileTypes.PAPER,this.props.logClickEvent)}),t.push({displayName:f.NewPaperTemplateLabel,iconName:"dropbox_paper_template",className:"action-create-file-paper-template",handleClick:this.handleCreateNewFile(c.PaperNewFileTypes.PAPER_TEMPLATE,this.props.logClickEvent)})),this.props.showBinder&&t.push({displayName:f.NewPaperBinderDocLabel,iconName:"dropbox_paper_binder",className:"action-create-file-paper-binder",handleClick:this.handleCreateNewFile(c.PaperNewFileTypes.PAPER_BINDER,this.props.logClickEvent)}),t.push({displayName:f.NewSimplePointerLabel,iconName:"shortcut",className:"action-create-simple-pointer",handleClick:this.handleCreateNewFile(c.PointerFileTypes.SIMPLE_POINTER,this.props.logClickEvent)}),t.length>0&&e.push(t);const r=[];if(r.push({displayName:f.NewMicrosoftWordDocLabel,iconName:"microsoft_docx",className:"action-create-file-word",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.WORD,this.props.logClickEvent)}),r.push({displayName:f.NewMicrosoftExcelWorkbookLabel,iconName:"microsoft_xlsx",className:"action-create-file-excel",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.EXCEL,this.props.logClickEvent)}),r.push({displayName:f.NewMicrosoftPowerPointPresentationLabel,iconName:"microsoft_pptx",className:"action-create-file-powerpoint",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.POWERPOINT,this.props.logClickEvent)}),e.push(r),this.props.showGdd){const t=[];t.push({displayName:f.NewGoogleDocsLabel,iconName:"google_gdoc",className:"action-create-file-google-doc",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_DOC,this.props.logClickEvent)}),t.push({displayName:f.NewGoogleSheetsLabel,iconName:"google_gsheet",className:"action-create-file-google-sheet",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_SHEET,this.props.logClickEvent)}),t.push({displayName:f.NewGoogleSlidesLabel,iconName:"google_gslides",className:"action-create-file-google-slides",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_SLIDES,this.props.logClickEvent)}),e.push(t)}return e}renderTrigger(e){const t=0===p.USER_LOCALE.indexOf("en")||this.props.forceLongLabel?f.LongNewFileCreateLabel:f.ShortNewFileCreateLabel,r=Object.assign(Object.assign({},e),{disabled:this.props.disabled,className:(0,o.default)("primary-action-menu__button","action-create-file"),variant:this.props.enableSecondary?"opacity":"primary"});return s.default.createElement(i.Button,Object.assign({key:f.LongNewFileCreateLabel,withDropdownIcon:!0},r),t)}renderSection(e,t){return s.default.createElement(n.Menu.Segment,{key:t},e.map(e=>s.default.createElement(O,{item:e,key:e.displayName})))}render(){const e=this.getNewFileTypeSections();return s.default.createElement(n.Menu.Wrapper,{onToggle:this.logTriggerClick,onSelection:t.handleNewFileSelection},({getContentProps:t,getTriggerProps:r})=>s.default.createElement(s.default.Fragment,null,this.renderTrigger(r()),s.default.createElement(n.Menu.Content,Object.assign({},t()),e.map(this.renderSection))))}}T.defaultProps={},T.displayName="NewFileMenu";const I=(0,_.requireCssWithComponent)(T,["/static/metaserver/static/css/dig-components/index.web-vflR-4-Ka.css","/static/metaserver/static/css/cloud_docs/create_pointer_modal-vflATc8Dt.css"]);t.NewFileMenu=I})),define("metaserver/static/js/new_file_menu/new_file_util",["require","exports","metaserver/static/js/cloud_docs/constants","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/i18n"],(function(e,t,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newFileTypeToLogEvent=t.NewSimplePointerLabel=t.NewPaperBinderDocLabel=t.NewPaperTemplateLabel=t.NewPaperDocLabel=t.NewMicrosoftWordDocLabel=t.NewMicrosoftPowerPointPresentationLabel=t.NewMicrosoftExcelWorkbookLabel=t.NewGoogleSlidesLabel=t.NewGoogleSheetsLabel=t.NewGoogleDocsLabel=t.ShortNewFileCreateLabel=t.LongNewFileCreateLabel=void 0,t.LongNewFileCreateLabel=s.intl.formatMessage({id:"8/w9ir",defaultMessage:"Create new file"}),t.ShortNewFileCreateLabel=s.intl.formatMessage({id:"o96TiK",defaultMessage:"Create"}),t.NewGoogleDocsLabel=s.intl.formatMessage({id:"+HsOFj",defaultMessage:"Google Docs"}),t.NewGoogleSheetsLabel=s.intl.formatMessage({id:"cpuRML",defaultMessage:"Google Sheets"}),t.NewGoogleSlidesLabel=s.intl.formatMessage({id:"PcJCVL",defaultMessage:"Google Slides"}),t.NewMicrosoftExcelWorkbookLabel=s.intl.formatMessage({id:"0rYKaW",defaultMessage:"Excel Workbook"}),t.NewMicrosoftPowerPointPresentationLabel=s.intl.formatMessage({id:"e9uLbL",defaultMessage:"PowerPoint Presentation"}),t.NewMicrosoftWordDocLabel=s.intl.formatMessage({id:"yY5byF",defaultMessage:"Word Document"}),t.NewPaperDocLabel=s.intl.formatMessage({id:"neBk7u",defaultMessage:"Dropbox Paper"}),t.NewPaperTemplateLabel=s.intl.formatMessage({id:"Rvv7NR",defaultMessage:"Dropbox Paper Template"}),t.NewPaperBinderDocLabel=s.intl.formatMessage({id:"sbO30Y",defaultMessage:"Dropbox Binder (Beta)"}),t.NewSimplePointerLabel=s.intl.formatMessage({id:"4gEt6j",defaultMessage:"Shortcut"});t.newFileTypeToLogEvent=e=>{switch(e){case r.MicrosoftFileTypes.WORD:return o.WebUserActionLogEvent.FILE_CREATE_WORD;case r.MicrosoftFileTypes.EXCEL:return o.WebUserActionLogEvent.FILE_CREATE_EXCEL;case r.MicrosoftFileTypes.POWERPOINT:return o.WebUserActionLogEvent.FILE_CREATE_POWERPOINT;case r.GoogleFileTypes.GOOGLE_DSS_DOC:return o.WebUserActionLogEvent.FILE_CREATE_GOOGLE_DOC;case r.GoogleFileTypes.GOOGLE_DSS_SHEET:return o.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SHEET;case r.GoogleFileTypes.GOOGLE_DSS_SLIDES:return o.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SLIDES;case r.PaperNewFileTypes.PAPER:return o.WebUserActionLogEvent.FILE_CREATE_PAPER;case r.PaperNewFileTypes.PAPER_TEMPLATE:return o.WebUserActionLogEvent.FILE_CREATE_PAPER_TEMPLATE;case r.PaperNewFileTypes.PAPER_BINDER:return o.WebUserActionLogEvent.FILE_CREATE_BINDER;case r.PointerFileTypes.SIMPLE_POINTER:return o.WebUserActionLogEvent.FILE_CREATE_SIMPLE_POINTER}}})),define("metaserver/static/js/share_download/ui/api",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery"],(function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchDownloadUrl=t.testDownload=t.TooLargeError=t.DownloadError=void 0,o=r.__importStar(o);class s extends class{constructor(e){this.message=e}}{}t.DownloadError=s;class i extends s{}t.TooLargeError=i,t.testDownload=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){let r;try{r=yield o.SilentBackgroundRequest({url:e,data:{rlkey:t}})}catch(e){throw new s}if("OK"!==r)throw 0===r.indexOf("err:")?new i:new s}))},t.fetchDownloadUrl=function(e,t,r){return o.SilentBackgroundRequest({url:"/sharing/fetch_user_content_link",data:{url:e,rlkey:t,origin:r}})}})),define("metaserver/static/js/file_uploader/web_upload_action_logger",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_jquery"],(function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebUploadActionLogClass=t.WebUploadActionLog=t.MAX_ERRORS=void 0,o=r.__importStar(o),t.MAX_ERRORS=3;class s{constructor(){this.errorCount=0,this.lastError=Date.now(),this.shouldReport=!0}log(e,r,s){return s=Object.assign(Object.assign(Object.assign({},s),s.extra),{extra:void 0}),this.shouldReport&&(this.errorCount<t.MAX_ERRORS||Date.now()-this.lastError>6e5)?new Promise((i,a)=>{o.SilentBackgroundRequest({url:"/log/web_upload_action",data:{_subject_uid:e,event_type:r,extra_params:JSON.stringify(s)},error:e=>{429===e.status?this.errorCount=t.MAX_ERRORS:this.errorCount++,this.lastError=Date.now(),a(e)},success:e=>{try{const t=JSON.parse(e);t&&!t.continue_sending&&(this.shouldReport=!1),this.errorCount=0,i(e)}catch(e){throw this.errorCount++,this.lastError=Date.now(),a(e),e}}})}):Promise.resolve({})}}t.WebUploadActionLog=new s,t.WebUploadActionLogClass=s})),define("metaserver/static/js/core/custom_protocol",["require","exports","tslib","metaserver/static/js/core/browser_detection"],(function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canLaunchUri=t.launchUriForMicrosoftBrowsers=t.launchUriByIframe=t.launchUri=void 0;const s=(o=r.__importStar(o)).chrome?1e3:2e3;function i(e){const t=document.createElement("iframe");t.src=e,t.setAttribute("style","display: none;"),document.body.appendChild(t)}function a(e,t,r){const o=window.navigator;o&&o.msLaunchUri?o.msLaunchUri(e,t,r):r()}t.launchUri=function(e){let t=null;return new Promise((r,n)=>{function c(){window.removeEventListener("blur",c),null!==t&&clearTimeout(t),r()}window.addEventListener("blur",c),t=setTimeout(()=>{window.removeEventListener("blur",c),n()},s),o.chromium()?window.location.assign(e):o.mozilla||o.safari?i(e):(o.msie||o.edge)&&a(e,r,n)})},t.launchUriByIframe=i,t.launchUriForMicrosoftBrowsers=a,t.canLaunchUri=function(){return o.msie?o.windowsInfo.win8OrHigher:!!(o.mozilla||o.safari||o.chrome)}})),define("metaserver/static/js/vault/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENCRYPTED_DOWNLOAD_ARGS_QUERY_PARAM_KEY=t.ENCRYPTED_OWNER_QUERY_PARAM_KEY=t.VAULT_OWNER_DISPLAY_NAME_QUERY_PARAM_KEY=t.VAULT_OWNER_FNAME_QUERY_PARAM_KEY=t.DEFAULT_APPS_PATH=t.SECURITY_CHECKUP_RELATIVE_URL=t.VAULT_STYLESHEETS=t.VAULT_NAME=t.VAULT_HASH_MODAL_KEY=t.VAULT_HASH_TAB_KEY=t.VAULT_URL=void 0,t.VAULT_URL="/vault",t.VAULT_HASH_TAB_KEY="tab",t.VAULT_HASH_MODAL_KEY="modal",t.VAULT_NAME="Vault",t.VAULT_STYLESHEETS=["/static/metaserver/static/css/spectrum/index.web-vflJy4G-t.css","/static/metaserver/static/css/dig-components/index.web-vflR-4-Ka.css","/static/typescript/component_libraries/vault/src/index.web-vfljKwJih.css","/static/metaserver/static/css/vault/vault-vflbqmnaC.css"],t.SECURITY_CHECKUP_RELATIVE_URL="/security_checkup",t.DEFAULT_APPS_PATH="/account/default_apps",t.VAULT_OWNER_FNAME_QUERY_PARAM_KEY="vo_fn",t.VAULT_OWNER_DISPLAY_NAME_QUERY_PARAM_KEY="vo_dn",t.ENCRYPTED_OWNER_QUERY_PARAM_KEY="vo",t.ENCRYPTED_DOWNLOAD_ARGS_QUERY_PARAM_KEY="enc"})),define("metaserver/static/js/flows/components/badge_async",["require","exports","tslib","react"],(function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncBadgeComponent=void 0,o=r.__importStar(o);const{lazy:s,Suspense:i}=o,a=s(()=>r.__awaiter(void 0,void 0,void 0,(function*(){const{FlowsFolderBadge:t}=yield new Promise((t,r)=>{e(["metaserver/static/js/flows/components/badge"],t,r)}).then(r.__importStar);return{default:t}})));t.AsyncBadgeComponent=({type:e,isInUnifiedModal:t,isFolderFocused:r})=>o.createElement(i,{fallback:o.createElement("div",null)},o.createElement(a,{type:e,isInUnifiedModal:t,isFolderFocused:r})),t.AsyncBadgeComponent.displayName="AsyncBadgeComponent"})),define("metaserver/static/js/search/unified_search/portaling",["require","exports","tslib","react","react-dom","metaserver/static/js/search/unified_search/search_window_state"],(function(e,t,r,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PortalTarget=t.PortalSource=void 0,o=r.__importStar(o);t.PortalSource=({portalType:e,children:t,className:r})=>{const[a,n]=(0,o.useState)((0,i.getLastDiv)(e));return(0,o.useEffect)(()=>((0,i.setRefListener)(e,e=>{var t;n(null!==(t=null==e?void 0:e.current)&&void 0!==t?t:null)}),()=>{(0,i.setRefListener)(e,null)}),[]),a?(r&&a.classList.add(...r.split(" ")),(0,s.createPortal)(t,a)):o.default.createElement(o.default.Fragment,null)};t.PortalTarget=({portalType:e})=>{const t=(0,o.createRef)();return(0,o.useEffect)(()=>((0,i.getRefListener)(e)(t),()=>{const t=(0,i.getRefListener)(e);t&&t(null)}),[]),o.default.createElement("div",{ref:t,"data-testid":`${e}-portal-target`})}})),define("metaserver/static/js/search/unified_search/renderer",["require","exports","tslib","classnames","react","metaserver/static/js/search/single_page/input/wrapper","metaserver/static/js/search/unified_search/portaling"],(function(e,t,r,o,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchInputRenderer=void 0,o=r.__importDefault(o),s=r.__importDefault(s);t.SearchInputRenderer=({user:e,searchInputProps:t})=>{var r;const n=null!==(r=null==t?void 0:t.inputBoxRef)&&void 0!==r?r:s.default.createRef();return s.default.createElement("div",{"data-testid":"search-input-portal"},s.default.createElement(a.PortalSource,{portalType:"search-input",className:(0,o.default)({"global-header__search":!0,"global-header__search--active":!!(null==t?void 0:t.isActive)})},s.default.createElement(i.SearchInput,Object.assign({},t,{user:e,inputBoxRef:n,variant:"full-page",shouldNotRenderGlobalHeaderClasses:!0}))))},t.SearchInputRenderer.displayName="SearchInputRenderer"})),define("metaserver/static/js/search/unified_search/search_provider",["require","exports","tslib","react","metaserver/static/js/search/unified_search/renderer","metaserver/static/js/search/unified_search/search_state_provider","metaserver/static/js/search/unified_search/utils","metaserver/static/js/clean/viewer"],(function(e,t,r,o,s,i,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchProvider=void 0,o=r.__importStar(o);t.SearchProvider=({children:e,userId:t,searchInputProps:r})=>{const c=(0,o.useMemo)(()=>n.Viewer.get_viewer().get_user_by_id(t),[t]);return o.default.createElement(i.SearchStateProvider,{user:c},(0,a.shouldUseSearchInputPortal)()&&o.default.createElement(s.SearchInputRenderer,{user:c,searchInputProps:r}),e)},t.SearchProvider.displayName="SearchProvider"})),define("metaserver/static/js/search/unified_search/search_state_provider",["require","exports","tslib","react"],(function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useSearchState=t.SearchStateContext=t.SearchStateProvider=void 0,o=r.__importStar(o);t.SearchStateProvider=({children:e,user:r})=>o.default.createElement(t.SearchStateContext.Provider,{value:{user:r}},e),t.SearchStateProvider.displayName="SearchStateProvider",t.SearchStateContext=(0,o.createContext)({});t.useSearchState=()=>(0,o.useContext)(t.SearchStateContext)})),define("metaserver/static/js/search/unified_search/search_window_state",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLastDiv=t.getRefListener=t.setRefListener=void 0;const r=()=>{const e=window;if(e.unifiedSearch)return e.unifiedSearch;const t={refListeners:{},lastDivs:{}};return window.unifiedSearch=t,t};t.setRefListener=(e,t)=>{r().refListeners[e]=t};t.getRefListener=e=>t=>{var o,s,i;r().lastDivs[e]=null!==(o=null==t?void 0:t.current)&&void 0!==o?o:null,null===(i=(s=r().refListeners)[e])||void 0===i||i.call(s,t)};t.getLastDiv=e=>{var t;return null!==(t=r().lastDivs[e])&&void 0!==t?t:null}})),define("metaserver/static/js/search/unified_search/utils",["require","exports","metaserver/static/js/modules/constants/search"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUseReactQuery=t.shouldUseFullPageVariantOnDeletedFiles=t.shouldUseFullPageVariantOnAccount=t.shouldUseSearchInputPortalInGlobalHeader=t.shouldUseSearchInputPortal=t.isUnifiedSearchEnabled=t.UNIFIED_SEARCH_VARIANTS=t.SEARCH_REACT_QUERY_VARIANT=t.SEARCH_INPUT_PORTAL_GH_VARIANT=t.SEARCH_INPUT_PORTAL_VARIANT=void 0,t.SEARCH_INPUT_PORTAL_VARIANT="SEARCH_INPUT_PORTAL",t.SEARCH_INPUT_PORTAL_GH_VARIANT="SEARCH_INPUT_PORTAL_GH",t.SEARCH_REACT_QUERY_VARIANT="SEARCH_REACT_QUERY",t.UNIFIED_SEARCH_VARIANTS=[t.SEARCH_INPUT_PORTAL_VARIANT,t.SEARCH_INPUT_PORTAL_GH_VARIANT,t.SEARCH_REACT_QUERY_VARIANT];t.isUnifiedSearchEnabled=()=>Object.values(t.UNIFIED_SEARCH_VARIANTS).includes(r.UNIFIED_SEARCH_VARIANT);t.shouldUseSearchInputPortal=()=>[t.SEARCH_INPUT_PORTAL_VARIANT,t.SEARCH_INPUT_PORTAL_GH_VARIANT].includes(r.UNIFIED_SEARCH_VARIANT);t.shouldUseSearchInputPortalInGlobalHeader=e=>r.UNIFIED_SEARCH_VARIANT===t.SEARCH_INPUT_PORTAL_GH_VARIANT&&"full-page"===e.searchVariant&&!!window.RUNNING_IN_EDISON;t.shouldUseFullPageVariantOnAccount=e=>"ON"===e&&r.UNIFIED_SEARCH_ACCOUNT_USE_FULL_PAGE_VARIANT;t.shouldUseFullPageVariantOnDeletedFiles=()=>r.UNIFIED_SEARCH_DELETED_FILES_USE_FULL_PAGE_VARIANT;t.shouldUseReactQuery=()=>r.UNIFIED_SEARCH_VARIANT==t.SEARCH_REACT_QUERY_VARIANT})),define("metaserver/static/js/search/utils",["require","exports","metaserver/static/js/core/exception"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assertOnceQuietly=void 0;const o={};t.assertOnceQuietly=(e,t)=>{o[e]||(o[e]=!0,(0,r.reportStack)(...t))}}));
//# sourceMappingURL=pkg-browse.min.js-vfl0MUvX4.map